!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=49)}([function(e,t,n){"use strict";n.d(t,"x",(function(){return h})),n.d(t,"z",(function(){return x})),n.d(t,"r",(function(){return w})),n.d(t,"i",(function(){return S})),n.d(t,"u",(function(){return V})),n.d(t,"j",(function(){return k})),n.d(t,"D",(function(){return _})),n.d(t,"k",(function(){return j})),n.d(t,"q",(function(){return C})),n.d(t,"t",(function(){return R})),n.d(t,"l",(function(){return I})),n.d(t,"b",(function(){return P})),n.d(t,"v",(function(){return T})),n.d(t,"w",(function(){return A})),n.d(t,"C",(function(){return N})),n.d(t,"f",(function(){return O})),n.d(t,"y",(function(){return G})),n.d(t,"s",(function(){return M})),n.d(t,"n",(function(){return E})),n.d(t,"m",(function(){return D})),n.d(t,"a",(function(){return U})),n.d(t,"c",(function(){return q})),n.d(t,"d",(function(){return F})),n.d(t,"h",(function(){return L})),n.d(t,"g",(function(){return B})),n.d(t,"e",(function(){return z})),n.d(t,"o",(function(){return H})),n.d(t,"p",(function(){return K})),n.d(t,"B",(function(){return W})),n.d(t,"A",(function(){return J}));var r=n(8),a=n.n(r),o=n(6),i=n.n(o),s=n(3),c=n.n(s),u=n(39),d=n.n(u),l=n(40),p=n.n(l),m=n(1),f=n(11);function g(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){g(o,r,a,i,s,"next",e)}function s(e){g(o,r,a,i,s,"throw",e)}i(void 0)}))}}var b=c.a.model("User",f.a),y=p.a.Strategy,h=d.a.use(new y({clientID:m.a.production.googleClientID,clientSecret:m.a.production.googleClientSecret,callbackURL:m.a.production.callBackUrl},(function(e,t,n,r){return r(null,n)}))),$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split(" ").join("");return e.startsWith("+")||(t="+51"+e.split(" ").join("")),t},x=function(){var e=v(regeneratorRuntime.mark((function e(t,n,r){var o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=t.body.displayName.toLowerCase(),(i=new b(t.body)).celular=$(t.body.celular),i.username=o,e.next=7,a.a.hash(t.body.password,10);case 7:return i.hashPassword=e.sent,i.type="low",i.nombre=t.body.nombre.toUpperCase(),i.apellido=t.body.apellido.toUpperCase(),e.next=13,i.save();case 13:(s=e.sent).hashPassword=void 0,t.savedUSer=s,r(),e.next=22;break;case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,n,r){return e.apply(this,arguments)}}(),w=function(){var e=v(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findById(t.body.idUser);case 3:if(!1!==e.sent.verified){e.next=6;break}return e.abrupt("return",n.json({reload:!1}));case 6:return e.abrupt("return",n.json({reload:!0}));case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),S=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findById(t.params.idUser);case 3:if(!1!==(r=e.sent).verified){e.next=9;break}return a=i.a.sign({_id:r._id},m.a.production.jwtLogin,{expiresIn:"120s"}),e.next=8,b.findByIdAndUpdate(r._id,{verified:!0},{useFindAndModify:!1});case 8:return e.abrupt("return",n.redirect("".concat(m.a.production.link_front,"login/auto/").concat(a)));case 9:return e.abrupt("return",n.status(202).send("<h1>Este usuario ya esta verificado.</h1>"));case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),V=function(){var e=v(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.a.verify(t.body.loginToken,m.a.production.jwtLogin,(function(e,a){if(e)return"TokenExpiredError"===e.name?n.status(400).json({error:"Token Expirado"}):n.status(500).json({error:e.message});t.logintoken=a,r()}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),k=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findById(t.logintoken._id);case 3:return r=e.sent,e.abrupt("return",n.json({displayName:r.displayName,username:r.username,success:!0,message:"Success",type:r.type,token:i.a.sign({aud:r.username+" "+r.type,_id:r.id},m.a.production.jwtKey)}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.exists({username:t.params.username.toLowerCase()});case 3:return r=e.sent,e.abrupt("return",n.json({exists:r}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.exists({email:t.params.email.toLowerCase()});case 3:return r=e.sent,e.abrupt("return",n.json({exists:r}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),C=function(){var e=v(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.exists({email:t.user._json.email});case 3:if(!e.sent){e.next=6;break}return e.abrupt("return",r());case 6:return a=i.a.sign(t.user._json,m.a.production.jwtGoogleLogin,{expiresIn:"30s"}),e.abrupt("return",n.redirect("".concat(m.a.production.link_front,"login/registro/").concat(a)));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),R=function(){var e=v(regeneratorRuntime.mark((function e(t,n,r){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOneAndUpdate({email:t.user._json.email},{verified:!0},{new:!0,useFindAndModify:!1});case 3:return a=e.sent,o=i.a.sign({_id:a._id},m.a.production.jwtLogin,{expiresIn:"120s"}),e.next=7,b.findByIdAndUpdate(a._id,{verified:!0},{useFindAndModify:!1});case 7:return e.abrupt("return",n.redirect("".concat(m.a.production.link_front,"login/auto/").concat(o)));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),I=function(){var e=v(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.a.verify(t.body.loginToken,m.a.production.jwtGoogleLogin,(function(e,t){return e?"TokenExpiredError"===e.name?n.status(400).json({error:"Token Expirado"}):n.status(500).json({error:e.message}):n.json(t)}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),P=function(e,t,n){if(!e.user||"admin"!==e.user.aud.split(" ")[1])return t.status(401).json({message:"Usuario No Autorizado"});n()},T=function(e,t,n){if(!e.user||"low"!==e.user.aud.split(" ")[1])return t.status(401).json({message:"Usuario No Autorizado"});n()},A=function(e,t,n){if(!e.user||"vent"!==e.user.aud.split(" ")[1]&&"admin"!==e.user.aud.split(" ")[1]&&"contador"!==e.user.aud.split(" ")[1])return t.status(401).json({message:"Usuario No Autorizado"});n()},N=function(e,t,n){if(!e.user||"vent"!==e.user.aud.split(" ")[1]&&"admin"!==e.user.aud.split(" ")[1])return t.status(401).json({message:"Usuario No Autorizado"});n()},O=function(e,t,n){if(!e.user)return t.status(401).json({message:"Usuario No Autorizado"});n()},G=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.body.username,(o=new b(t.body)).displayName=r,o.username=r.toLowerCase(),e.next=7,a.a.hash(t.body.password,10);case 7:return o.hashPassword=e.sent,e.next=10,o.save();case 10:return(i=e.sent).hashPassword=void 0,e.abrupt("return",n.json(i));case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",n.status(e.t0.status||400).send({message:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}(),M=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOne({username:t.body.username.toLowerCase()});case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",n.status(400).json({username:t.body.username,success:!1,message:"Authenticacion failed. No user found!",token:null}));case 6:return e.next=8,r.comparePassword(t.body.password,r.hashPassword);case 8:if(e.sent){e.next=12;break}return e.abrupt("return",n.status(400).json({username:t.body.username,success:!1,message:"Authenticacion failed. Incorrect Password!",token:null}));case 12:return e.abrupt("return",n.json({displayName:r.displayName,username:r.username,success:!0,message:"Success",type:r.type,token:i.a.sign({aud:r.username+" "+r.type,_id:r.id},m.a.production.jwtKey)}));case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),e.t0;case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}(),E=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOne({username:t.params.username.toLowerCase()});case 3:(r=e.sent).hashPassword=void 0,n.json(r),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),D=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOne({username:t.user.aud.split(" ")[0]});case 3:(r=e.sent).hashPassword=void 0,n.json(r),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),U=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOneAndUpdate({_id:t.body.id},{celular:$(t.body.celular)},{useFindAndModify:!1,new:!0});case 3:(r=e.sent).hashPassword=void 0,n.json(r),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),q=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOneAndUpdate({_id:t.body.id},{dirOne:t.body.dirOne,dirTwo:t.body.dirTwo||"",reference:t.body.reference,city:"Trujillo, La Libertad. Perú"},{useFindAndModify:!1,new:!0});case 3:(r=e.sent).hashPassword=void 0,n.json(r),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),F=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOneAndUpdate({_id:t.body.id},{documento:t.body.documento,tipoPersona:t.body.dirTwo},{useFindAndModify:!1,new:!0});case 3:(r=e.sent).hashPassword=void 0,n.json(r),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),L=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findById(t.body.id);case 3:return r=e.sent,e.next=6,r.comparePassword(t.body.oldPassword,r.hashPassword);case 6:if(e.sent){e.next=8;break}return e.abrupt("return",n.json({valid:!1}));case 8:n.json({valid:!0}),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}(),B=function(){var e=v(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findById(t.body.id);case 3:return r=e.sent,e.next=6,r.comparePassword(t.body.passwordOld,r.hashPassword);case 6:if(e.sent){e.next=8;break}return e.abrupt("return",n.json({changed:!1}));case 8:return e.next=10,a.a.hash(t.body.password,10);case 10:return o=e.sent,e.next=13,b.findByIdAndUpdate(t.body.id,{hashPassword:o},{new:!0,useFindAndModify:!1});case 13:return e.abrupt("return",n.json({changed:!0}));case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),z=function(){var e=v(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOneAndUpdate({username:t.user.aud.split(" ")[0]},{$push:{ventaActiva:t.saveResult.codigo}},{useFindAndModify:!1});case 3:n.json({message:"Venta generada con el codigo: ".concat(t.saveResult.codigo),venta:t.saveResult}),e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}(),H=function(){var e=v(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOne({username:t.user.aud.split(" ")[0]});case 3:a=e.sent,t.ventaCod=a.ventaActiva,r(),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n,r){return e.apply(this,arguments)}}(),K=function(){var e=v(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOne({username:t.user.aud.split(" ")[0]});case 3:a=e.sent,n.json(a.ventaActiva),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),W=function(){var e=v(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOne({username:t.user.aud.split(" ")[0]});case 3:if(!((a=e.sent).ventaActiva.lenght>4)){e.next=6;break}return e.abrupt("return",n.status(409).json({message:"Ya tienes 5 ventas activas."}));case 6:t.ventaCod=a.ventaActiva,r(),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),J=function(){var e=v(regeneratorRuntime.mark((function e(t,n,r){var o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=t.body.displayName.toLowerCase(),(s=new b(t.body)).celular=$(t.body.celular),s.username=o,e.next=7,a.a.hash(t.body.password,10);case 7:return s.hashPassword=e.sent,s.type="low",s.nombre=t.body.nombre.toUpperCase(),s.apellido=t.body.apellido.toUpperCase(),s.verified=!0,e.next=14,s.save();case 14:return(c=e.sent).hashPassword=void 0,e.abrupt("return",n.json({displayName:c.displayName,username:c.username,success:!0,message:"Success",type:c.type,token:i.a.sign({aud:c.username+" "+c.type,_id:c.id},m.a.production.jwtKey)}));case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,n,r){return e.apply(this,arguments)}}()},function(e,t,n){"use strict";var r=n(31),a=n.n(r),o=n(25);n(28).config();var i=o.name,s=o.version,c=function(e,t,n){return a.a.createLogger({name:"".concat(e,":").concat(t),level:n})},u={development:{PORT:process.env.PORT,mongoKey:process.env.MONGO_KEY,tinyKey:process.env.TINY_KEY,jwtKey:process.env.JWT_KEY,jwtLogin:process.env.JWT_LOGIN,jwtGoogleLogin:process.env.JWT_GOOGLE_LOGIN,awsID:process.env.AWS_ID,awsKey:process.env.AWS_KEY,bucket:process.env.S3_BUCKET,sunatToken:process.env.SUNAT_TOKEN,googleClientID:process.env.GOOGLE_CLIENT_ID,googleClientSecret:process.env.GOOGLE_CLIENT_SECRET,callBackUrl:process.env.CALLBACK_URL_TEST,BHOST:process.env.HOST_SENDIBLUE,BPORT:process.env.PORT_SENDIBLUE,BUSER:process.env.USER_SENDIBLUE,BPASS:process.env.PASSWORD_SENDIBLUE,nbfToken:process.env.NBF_TOKEN,reToken:process.env.RE_TOKEN,emailFrom:"loginmanager@siriodinar.com",link:"http://localhost:5000/",link_front:"http://localhost:4000/",origin:["http://localhost:4200","http://localhost:4000"],log:function(){return c(i,s,"debug")}},production:{PORT:process.env.PORT,mongoKey:process.env.MONGO_KEY,tinyKey:process.env.TINY_KEY,jwtKey:process.env.JWT_KEY,jwtLogin:process.env.JWT_LOGIN,jwtGoogleLogin:process.env.JWT_GOOGLE_LOGIN,awsID:process.env.AWS_ID,awsKey:process.env.AWS_KEY,bucket:process.env.S3_BUCKET,sunatToken:process.env.SUNAT_TOKEN,googleClientID:process.env.GOOGLE_CLIENT_ID,googleClientSecret:process.env.GOOGLE_CLIENT_SECRET,callBackUrl:process.env.CALLBACK_URL,BHOST:process.env.HOST_SENDIBLUE,BPORT:process.env.PORT_SENDIBLUE,BUSER:process.env.USER_SENDIBLUE,BPASS:process.env.PASSWORD_SENDIBLUE,nbfToken:process.env.NBF_TOKEN,reToken:process.env.RE_TOKEN,emailFrom:"loginmanager@siriodinar.com",link:"https://inventario-sirio-dinar.herokuapp.com/",link_front:"https://inventario.siriodinar.com/",origin:["https://inventario.siriodinar.com","https://sirio-inventario-front.herokuapp.com"],log:function(){return c(i,s,"debug")}}};t.a=u},function(e,t,n){"use strict";n.d(t,"r",(function(){return R})),n.d(t,"s",(function(){return I})),n.d(t,"H",(function(){return P})),n.d(t,"N",(function(){return T})),n.d(t,"Y",(function(){return A})),n.d(t,"X",(function(){return N})),n.d(t,"F",(function(){return O})),n.d(t,"G",(function(){return M})),n.d(t,"R",(function(){return E})),n.d(t,"h",(function(){return D})),n.d(t,"v",(function(){return U})),n.d(t,"eb",(function(){return q})),n.d(t,"gb",(function(){return F})),n.d(t,"fb",(function(){return L})),n.d(t,"db",(function(){return B})),n.d(t,"c",(function(){return z})),n.d(t,"k",(function(){return H})),n.d(t,"i",(function(){return W})),n.d(t,"Z",(function(){return J})),n.d(t,"g",(function(){return Q})),n.d(t,"q",(function(){return Y})),n.d(t,"P",(function(){return Z})),n.d(t,"d",(function(){return X})),n.d(t,"A",(function(){return ee})),n.d(t,"p",(function(){return te})),n.d(t,"L",(function(){return ne})),n.d(t,"e",(function(){return re})),n.d(t,"w",(function(){return oe})),n.d(t,"l",(function(){return ie})),n.d(t,"m",(function(){return se})),n.d(t,"x",(function(){return ce})),n.d(t,"y",(function(){return ue})),n.d(t,"z",(function(){return de})),n.d(t,"E",(function(){return le})),n.d(t,"ab",(function(){return pe})),n.d(t,"bb",(function(){return me})),n.d(t,"o",(function(){return fe})),n.d(t,"f",(function(){return ge})),n.d(t,"W",(function(){return ve})),n.d(t,"cb",(function(){return be})),n.d(t,"j",(function(){return he})),n.d(t,"t",(function(){return $e})),n.d(t,"T",(function(){return xe})),n.d(t,"S",(function(){return we})),n.d(t,"U",(function(){return Se})),n.d(t,"M",(function(){return Ve})),n.d(t,"u",(function(){return ke})),n.d(t,"D",(function(){return _e})),n.d(t,"J",(function(){return je})),n.d(t,"B",(function(){return Ce})),n.d(t,"n",(function(){return Re})),n.d(t,"a",(function(){return Ie})),n.d(t,"V",(function(){return Pe})),n.d(t,"I",(function(){return Te})),n.d(t,"K",(function(){return Ae})),n.d(t,"C",(function(){return Ne})),n.d(t,"hb",(function(){return Oe})),n.d(t,"Q",(function(){return Ge})),n.d(t,"O",(function(){return Me})),n.d(t,"b",(function(){return Ee}));var r=n(3),a=n.n(r),o=n(9),i=n(15),s=n.n(i);function c(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}var u=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var n,r,a,o,i,c,u,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new s.a.Workbook,r={sheetFormat:{defaultRowHeight:20,defaultColWidth:20}},a=n.addWorksheet("Gastos",r),o=n.addWorksheet("Ventas",r),i=n.addWorksheet("Balance",r),c=n.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00"}),u=n.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00",fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),a.row(2).setHeight(40),a.column(1).setWidth(10),a.column(5).setWidth(60),o.row(2).setHeight(40),o.column(1).setWidth(10),o.column(5).setWidth(60),i.row(2).setHeight(40),i.column(1).setWidth(10),i.column(5).setWidth(60),d(n,a,o,i,t.name),l(n,a,o),p(a,t,5,c,u,0),m(o,t,5,c,u,0),e.next=23,n.writeToBuffer();case 23:return f=e.sent,e.abrupt("return",f);case 27:throw e.prev=27,e.t0=e.catch(0),new Error(e.t0);case 30:case"end":return e.stop()}}),e,null,[[0,27]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){c(o,r,a,i,s,"next",e)}function s(e){c(o,r,a,i,s,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),d=function(e,t,n,r,a){var o=e.createStyle({font:{color:"white",size:16,bold:!0},alignment:{horizontal:"center",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#005087"}});t.cell(2,2,2,6,!0).string("Gastos | ".concat(a)).style(o),n.cell(2,2,2,6,!0).string("Ganancias | ".concat(a)).style(o),r.cell(2,2,2,6,!0).string("Balance | ".concat(a)).style(o),t.row(3).setHeight(10),n.row(3).setHeight(10),r.row(3).setHeight(10)},l=function(e,t,n){for(var r=e.createStyle({font:{color:"white",size:14},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{horizontal:"left",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),a=2,o=0,i=["Fecha","Comentario","Cantidad","Sub Cantidad","Costo"];o<i.length;o++){var s=i[o];t.cell(4,a).string(s).style(r),n.cell(4,a).string(s).style(r),a++}t.row(4).filter({firstColumn:2,lastColumn:3}),n.row(4).filter({firstColumn:2,lastColumn:3})},p=function e(t,n,r,a,o,i){var s,c=r-5;if((c+=i)>=n.variaciones.length)return 5;if(!1===n.variaciones[c].tipo)return 0+e(t,n,r,a,o,i+1);s=r%2==0?o:a;var u=n.variaciones[c],d=new Date(u.date);t.cell(r,2).date(d.toLocaleDateString()).style(s).style({numberFormat:"dd-mm-yyy",alignment:{horizontal:"left",vertical:"center"}}),t.cell(r,4).string(u.cantidad.toString()).style(s);var l="";u.cantidadSC&&(u.cantidadSC.forEach((function(e){var t=e.cantidadVenta;"new item"===u.comentario&&(t=e.cantidadDisponible);var n="";e.nameSecond&&(n="-"+e.nameSecond),l=l+e.name+n+": "+t+", "})),l.length>1&&(l=l.slice(0,-2))),t.cell(r,5).string(l).style(s);var p=u.costoVar;t.cell(r,6).number(p).style(s);var m=u.comentario;return"new item"===u.comentario?m="Nuevo Item":"anular"===u.comentario.split("|")[0]&&(m="Anulada "+u.comentario.split("|")[1]),t.cell(r,3).string(m).style(s),1+e(t,n,r+1,a,o,i)},m=function e(t,n,r,a,o,i){var s,c=r-5;if((c+=i)>=n.variaciones.length)return 5;if(!0===n.variaciones[c].tipo)return 0+e(t,n,r,a,o,i+1);s=r%2==0?o:a;var u=n.variaciones[c],d=new Date(u.date);t.cell(r,2).date(d.toLocaleDateString()).style(s).style({numberFormat:"dd-mm-yyy",alignment:{horizontal:"left",vertical:"center"}}),t.cell(r,4).string(u.cantidad.toString()).style(s);var l="";u.cantidadSC&&(u.cantidadSC.forEach((function(e){var t=e.cantidadVenta;"new item"===u.comentario&&(t=e.cantidadDisponible);var n="";e.nameSecond&&(n="-"+e.nameSecond),l=l+e.name+n+": "+t+", "})),l.length>1&&(l=l.slice(0,-2))),t.cell(r,5).string(l).style(s);var p=u.costoVar;t.cell(r,6).number(p).style(s);var m=u.comentario;return"venta"===u.comentario.split("|")[0]&&(m="Venta "+u.comentario.split("|")[1]),t.cell(r,3).string(m).style(s),1+e(t,n,r+1,a,o,i)},f=n(12),g=new r.Schema({name:{type:String,required:!0,unique:!0},codigo:{type:String,required:!0,unique:!0},ruc:{type:Number}}),v=new r.Schema({name:{type:String,required:!0,unique:!0},deleted:{type:Boolean,default:!1}}),b=n(11),y=n(13),h=n(4);function $(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){w(o,r,a,i,s,"next",e)}function s(e){w(o,r,a,i,s,"throw",e)}i(void 0)}))}}var V=a.a.model("Item",f.a),k=a.a.model("Marca",g),_=a.a.model("Venta",y.a),j=a.a.model("User",b.a),C=a.a.model("Tag",v),R=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new RegExp(t.body.value+"+[a-z0-9._ ]*$","ig"),e.next=4,V.find({name:{$regex:r},deleted:!1}).limit(t.body.limit);case 4:a=e.sent,n.json(a),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),I=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new RegExp(t.body.value+"+[a-z0-9._ ]*$","ig"),e.next=4,C.find({name:{$regex:r},deleted:!1}).limit(t.body.limit);case 4:a=e.sent,n.json(a),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),P=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.find({oferta:{$gt:0},deleted:!1});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),T=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.find({tipo:t.params.tipo,codigo:{$ne:t.params.codigo},deleted:!1}).limit(8);case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new RegExp(t.params.searchTerms+"+[a-z0-9._ ]*$","ig"),e.next=4,V.find({name:{$regex:r},deleted:!1}).limit(8);case 4:a=e.sent,n.json(a),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new RegExp(t.params.searchTerms+"+[a-z0-9._ ]*$","ig"),e.next=4,V.find({name:{$regex:r},deleted:!1}).limit(6);case 4:a=e.sent,n.json(a),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),O=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOne({codigo:t.params.codigo});case 3:r=e.sent,a=G(r.variaciones),n.json({message:a}),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),G=function(e){try{var t,n=0,r=0,a=$(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;!0===o.tipo?r+=o.costoVar:n+=o.costoVar}}catch(e){a.e(e)}finally{a.f()}return Math.round(100*(n-r+Number.EPSILON))/100}catch(e){throw new Error(e)}},M=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOne({codigo:t.params.codigo});case 3:return r=e.sent,e.next=6,u(r);case 6:a=e.sent,n.writeHead(200,{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":"attachment; filename=reporteItem-".concat(r.codigo,".xlsx")}),n.write(a,"binary"),n.end(null,"binary"),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),E=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.aggregate([{$match:{codigo:t.body.codVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}}]);case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),D=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.body.itemVendido.ventaCod=t.body.codigoVenta,e.next=4,_.aggregate([{$match:{codigo:t.body.codigoVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}},{$count:"thisItem"}]);case 4:if(0===e.sent.length){e.next=15;break}return e.next=8,_.aggregate([{$match:{codigo:t.body.codigoVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}}]);case 8:return r=e.sent,a=Math.round(100*(r[0].totalPrice-t.body.itemVendido.totalPrice+Number.EPSILON))/100*-1,o=Math.round(100*(r[0].totalPriceNoIGV-t.body.itemVendido.totalPriceNoIGV+Number.EPSILON))/100*-1,e.next=13,_.findOneAndUpdate({codigo:t.body.codigoVenta,itemsVendidos:{$elemMatch:{codigo:t.body.itemVendido.codigo}}},{$set:{"itemsVendidos.$":t.body.itemVendido},$inc:{totalPrice:a,totalPriceNoIGV:o}},{useFindAndModify:!1,new:!0});case 13:return i=e.sent,e.abrupt("return",n.json({message:"Cantidades actualizadas",venta:i}));case 15:return e.next=17,_.findOneAndUpdate({codigo:t.body.codigoVenta},{$push:{itemsVendidos:t.body.itemVendido},$inc:{totalPrice:t.body.itemVendido.totalPrice,totalPriceNoIGV:t.body.itemVendido.totalPriceNoIGV}},{useFindAndModify:!1,new:!0});case 17:s=e.sent,n.json({message:"Item agregado correctamente",venta:s}),e.next=24;break;case 21:return e.prev=21,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 24:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t,n){return e.apply(this,arguments)}}(),U=function(){var e=S(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=new _(t.body.venta),e.next=4,K(a.documento.type);case 4:return a.codigo=e.sent,a.itemsVendidos[0].ventaCod=a.codigo,a.vendedor=t.user.aud.split(" ")[0],e.next=9,a.save();case 9:t.saveResult=e.sent,r(),e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n,r){return e.apply(this,arguments)}}(),q=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,i,s,c,u,d,l,p,m,f,g,v,b,y,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.startSession();case 2:return(r=e.sent).startTransaction(),e.prev=4,e.next=7,_.findOne({codigo:t.body.codigo});case 7:if("anuladaPost"!==e.sent.estado){e.next=13;break}return e.next=11,r.abortTransaction();case 11:return r.endSession(),e.abrupt("return",n.status(409).json({errorMSG:"Ya anulada"}));case 13:i=[],s=[],c=$(t.body.itemsVendidos);try{for(c.s();!(u=c.n()).done;)d=u.value,s.push(d.codigo),i.push({date:Date.now(),cantidad:d.cantidad,tipo:!0,comentario:"anular|"+t.body.codigo,costoVar:d.totalPrice,usuario:t.user.aud.split(" ")[0],cantidadSC:d.cantidadSC})}catch(e){c.e(e)}finally{c.f()}l=0,p=$(t.body.itemsVendidos),e.prev=19,p.s();case 21:if((m=p.n()).done){e.next=46;break}f=m.value,g=$(f.cantidadSC),e.prev=24,g.s();case 26:if((v=g.n()).done){e.next=33;break}if(!((b=v.value).cantidadVenta>0)){e.next=31;break}return e.next=31,V.findOneAndUpdate({codigo:f.codigo,"subConteo.order":{$elemMatch:{name:b.name,nameSecond:b.nameSecond}}},{$inc:{"subConteo.order.$.cantidad":b.cantidadVenta}},{useFindAndModify:!1,new:!0,session:r});case 31:e.next=26;break;case 33:e.next=38;break;case 35:e.prev=35,e.t0=e.catch(24),g.e(e.t0);case 38:return e.prev=38,g.f(),e.finish(38);case 41:return e.next=43,V.findOneAndUpdate({codigo:f.codigo},{$inc:{cantidad:f.cantidad},$push:{variaciones:i[l]}},{new:!0,useFindAndModify:!1,session:r});case 43:l++;case 44:e.next=21;break;case 46:e.next=51;break;case 48:e.prev=48,e.t1=e.catch(19),p.e(e.t1);case 51:return e.prev=51,p.f(),e.finish(51);case 54:if(y="","noone"===t.body.documento.type){e.next=64;break}if("factura"!==t.body.documento.type){e.next=60;break}return e.next=59,Object(o.a)(1,t.body.serie,t.body.numero,"Anulación de venta");case 59:y=e.sent;case 60:if("boleta"!==t.body.documento.type){e.next=64;break}return e.next=63,Object(o.a)(2,t.body.serie,t.body.numero,"Anulación de venta");case 63:y=e.sent;case 64:return e.next=66,_.findOneAndUpdate({codigo:t.body.codigo},{estado:"anuladaPost",linkComprobante:y},{useFindAndModify:!1,new:!0,session:r});case 66:return h=e.sent,e.next=69,r.commitTransaction();case 69:return r.endSession(),e.abrupt("return",n.json({message:"succes||".concat(h.codigo)}));case 73:return e.prev=73,e.t2=e.catch(4),e.next=77,r.abortTransaction();case 77:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t2}));case 79:case"end":return e.stop()}}),e,null,[[4,73],[19,48,51,54],[24,35,38,41]])})));return function(t,n){return e.apply(this,arguments)}}(),F=function(){var e=S(regeneratorRuntime.mark((function e(t,n,r){var o,i,s,c,u,d,l,p,m,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.startSession();case 2:return(o=e.sent).startTransaction(),e.prev=4,e.next=7,K(t.body.venta.documento.type);case 7:return i=e.sent,t.body.venta.itemsVendidos[0].ventaCod=i,e.next=11,V.findOne({codigo:t.body.venta.itemsVendidos[0].codigo});case 11:if(s=e.sent,c={date:Date.now(),cantidad:t.body.venta.itemsVendidos[0].cantidad,tipo:!1,comentario:"venta|"+i,usuario:t.user.aud.split(" ")[0],costoVar:t.body.venta.totalPrice,cantidadSC:t.body.venta.itemsVendidos[0].cantidadSC},0===t.body.venta.itemsVendidos[0].cantidadSC.length){e.next=43;break}u=$(t.body.venta.itemsVendidos[0].cantidadSC),e.prev=15,u.s();case 17:if((d=u.n()).done){e.next=35;break}if(!((l=d.value).cantidadVenta>0)){e.next=33;break}return e.next=22,V.findOneAndUpdate({codigo:t.body.venta.itemsVendidos[0].codigo,"subConteo.order":{$elemMatch:{name:l.name,nameSecond:l.nameSecond}}},{$inc:{"subConteo.order.$.cantidad":-l.cantidadVenta}},{useFindAndModify:!1,new:!0,session:o});case 22:p=e.sent,m=0;case 24:if(!(m<p.subConteo.order.length)){e.next=33;break}if(!(p.subConteo.order[m].cantidad<0)){e.next=30;break}return e.next=28,o.abortTransaction();case 28:return o.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado",item:s}));case 30:m++,e.next=24;break;case 33:e.next=17;break;case 35:e.next=40;break;case 37:e.prev=37,e.t0=e.catch(15),u.e(e.t0);case 40:return e.prev=40,u.f(),e.finish(40);case 43:return e.next=45,V.findOneAndUpdate({codigo:t.body.venta.itemsVendidos[0].codigo},{$inc:{cantidad:-t.body.venta.itemsVendidos[0].cantidad},$push:{variaciones:c}},{new:!0,useFindAndModify:!1,session:o});case 45:if(!(e.sent.cantidad<0)){e.next=51;break}return e.next=49,o.abortTransaction();case 49:return o.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado",item:s}));case 51:return(f=new _(t.body.venta)).codigo=i,f.vendedor=t.user.aud.split(" ")[0],e.next=56,f.save({session:o});case 56:if(t.ventResult=e.sent,"factura"!==f.documento.type){e.next=63;break}return e.next=60,_.countDocuments({tipoComprobante:{$eq:1}});case 60:t.count=e.sent,e.next=67;break;case 63:if("boleta"!==f.documento.type){e.next=67;break}return e.next=66,_.countDocuments({tipoComprobante:{$eq:2}});case 66:t.count=e.sent;case 67:if(!t.body.venta.guia){e.next=71;break}return e.next=70,_.countDocuments({guia:{$eq:!0}});case 70:t.countGuia=e.sent;case 71:return e.next=73,Object(h.i)(f);case 73:return e.next=75,o.commitTransaction();case 75:o.endSession(),r(),e.next=85;break;case 79:return e.prev=79,e.t1=e.catch(4),e.next=83,o.abortTransaction();case 83:return o.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 85:case"end":return e.stop()}}),e,null,[[4,79],[15,37,40,43]])})));return function(t,n,r){return e.apply(this,arguments)}}(),L=function(){var e=S(regeneratorRuntime.mark((function e(t,n,r){var o,i,s,c,u,d,l,p,m,f,g,v,b,y,x,w,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.startSession();case 2:return(o=e.sent).startTransaction(),e.prev=4,i=[],s=[],e.next=9,_.findOne({codigo:t.body.venta.codigo});case 9:if("ejecutada"!==(c=e.sent).estado){e.next=15;break}return e.next=13,o.abortTransaction();case 13:return o.endSession(),e.abrupt("return",n.status(409).json({errorMSG:"La venta ya ha sido ejecutada."}));case 15:u=$(c.itemsVendidos);try{for(u.s();!(d=u.n()).done;)"N"!==(l=d.value).codigo.charAt(2)&&"I"!==l.codigo.charAt(3)&&(s.push(l.codigo),i.push({date:Date.now(),cantidad:l.cantidad,tipo:!1,comentario:"venta|"+c.codigo,costoVar:l.totalPrice,usuario:t.user.aud.split(" ")[0],cantidadSC:l.cantidadSC}))}catch(e){u.e(e)}finally{u.f()}p=0,m=$(c.itemsVendidos),e.prev=19,m.s();case 21:if((f=m.n()).done){e.next=64;break}if("N"===(g=f.value).codigo.charAt(2)||"I"===g.codigo.charAt(3)){e.next=62;break}v=$(g.cantidadSC),e.prev=25,v.s();case 27:if((b=v.n()).done){e.next=45;break}if(!((y=b.value).cantidadVenta>0)){e.next=43;break}return e.next=32,V.findOneAndUpdate({codigo:g.codigo,"subConteo.order":{$elemMatch:{name:y.name,nameSecond:y.nameSecond}}},{$inc:{"subConteo.order.$.cantidad":-y.cantidadVenta}},{useFindAndModify:!1,new:!0,session:o});case 32:x=e.sent,w=0;case 34:if(!(w<x.subConteo.order.length)){e.next=43;break}if(!(x.subConteo.order[w].cantidad<0)){e.next=40;break}return e.next=38,o.abortTransaction();case 38:return o.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado"}));case 40:w++,e.next=34;break;case 43:e.next=27;break;case 45:e.next=50;break;case 47:e.prev=47,e.t0=e.catch(25),v.e(e.t0);case 50:return e.prev=50,v.f(),e.finish(50);case 53:return e.next=55,V.findOneAndUpdate({codigo:g.codigo},{$inc:{cantidad:-g.cantidad},$push:{variaciones:i[p]}},{new:!0,useFindAndModify:!1,session:o});case 55:if(!(e.sent.cantidad<0)){e.next=61;break}return e.next=59,o.abortTransaction();case 59:return o.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado"}));case 61:p++;case 62:e.next=21;break;case 64:e.next=69;break;case 66:e.prev=66,e.t1=e.catch(19),m.e(e.t1);case 69:return e.prev=69,m.f(),e.finish(69);case 72:return e.next=74,_.findOneAndUpdate({codigo:t.body.venta.codigo},{estado:"ejecutada",documento:t.body.venta.documento,guia:t.body.venta.guia,cliente_email:t.body.venta.cliente_email,medio_de_pago:t.body.venta.medio_de_pago},{useFindAndModify:!1,new:!0,session:o});case 74:if(S=e.sent,t.ventResult=S,"factura"!==S.documento.type){e.next=82;break}return e.next=79,_.countDocuments({tipoComprobante:{$eq:1}});case 79:t.count=e.sent,e.next=86;break;case 82:if("boleta"!==S.documento.type){e.next=86;break}return e.next=85,_.countDocuments({tipoComprobante:{$eq:2}});case 85:t.count=e.sent;case 86:if(!t.body.venta.guia){e.next=90;break}return e.next=89,_.countDocuments({guia:{$eq:!0}});case 89:t.countGuia=e.sent;case 90:return e.next=92,j.findOneAndUpdate({username:t.user.aud.split(" ")[0]},{$pull:{ventaActiva:t.body.venta.codigo}},{useFindAndModify:!1});case 92:return e.next=94,Object(h.i)(S);case 94:return e.next=96,o.commitTransaction();case 96:o.endSession(),r(),e.next=106;break;case 100:return e.prev=100,e.t2=e.catch(4),e.next=104,o.abortTransaction();case 104:return o.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t2}));case 106:case"end":return e.stop()}}),e,null,[[4,100],[19,66,69,72],[25,47,50,53]])})));return function(t,n,r){return e.apply(this,arguments)}}(),B=function(){var e=S(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.findOneAndUpdate({codigo:t.body.venta.codigo},{estado:"anulada"},{useFindAndModify:!1});case 3:return e.next=5,j.findOneAndUpdate({username:t.user.aud.split(" ")[0]},{$pull:{ventaActiva:t.body.venta.codigo}},{useFindAndModify:!1});case 5:n.json({message:"succes"}),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),z=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.sunat_guia||(t.sunat_guia=""),e.next=4,_.findByIdAndUpdate(t.ventResult._id,{linkComprobante:t.sunat.enlace_del_pdf,numero:t.sunat.numero,guia_link:t.sunat_guia.enlace_del_pdf,serie:t.sunat.serie,tipoComprobante:t.sunat.tipo_de_comprobante},{new:!0,useFindAndModify:!1});case 4:r=e.sent,n.json({item:r,message:"Succes||".concat(t.ventResult.codigo),_sunat:t.sunat}),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),H=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.countDocuments({tipoVendedor:{$in:["admin","vent"]}});case 3:return e.t0=e.sent,r=e.t0+1,e.next=7,_.countDocuments({});case 7:e.t1=e.sent,a=e.t1+1,n.json({c:r,ct:a}),e.next=15;break;case 12:return e.prev=12,e.t2=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t2}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),K=function(){var e=S(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.countDocuments({});case 3:e.t0=e.sent,n=e.t0+1,r="SD01-000000",e.t1=t,e.next="factura"===e.t1?9:"boleta"===e.t1?11:13;break;case 9:return r="E002-000000",e.abrupt("break",14);case 11:return r="EB02-000000",e.abrupt("break",14);case 13:return e.abrupt("break",14);case 14:for(a=0;a<n.toString().length;a++)r=r.slice(0,-1);return o=r+n.toString(),e.abrupt("return",o);case 19:return e.prev=19,e.t2=e.catch(0),e.abrupt("return",res.status(500).json({errorMSG:e.t2}));case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),W=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOne({codigo:t.body.codigo});case 3:if(r=e.sent,t.body.tipo){e.next=8;break}if(!(r.cantidad-t.body.cantidad<0)){e.next=8;break}throw"Cantidad Invalidad";case 8:return a=t.body.cantidad,o={date:Date.now(),cantidad:a,tipo:t.body.tipo,comentario:t.body.tipo?"agregar|"+t.body.comentario:"quitar|"+t.body.comentario,costoVar:t.body.costoVar*a,cantidadSC:[]},e.next=12,V.findOneAndUpdate({codigo:t.body.codigo},{$inc:{cantidad:t.body.tipo?t.body.cantidad:-1*t.body.cantidad},$push:{variaciones:o}},{new:!0,useFindAndModify:!1});case 12:i=e.sent,n.json(i),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),J=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s,c,u,d,l,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=0,e.next=4,V.findOne({codigo:t.body.codigo});case 4:a=e.sent,r=t.body.cantidad,o={date:Date.now(),cantidad:r,tipo:t.body.tipo,comentario:t.body.tipo?"agregar|"+t.body.comentario:"quitar|"+t.body.comentario,costoVar:t.body.costoVar*r,cantidadSC:[]},i=[],s=$(a.subConteo.order);try{for(u=function(){var e=c.value;-1!==t.body.subConteo.order.findIndex((function(t){return t.name===e.name&&t.nameSecond===e.nameSecond}))&&i.push(e)},s.s();!(c=s.n()).done;)u()}catch(e){s.e(e)}finally{s.f()}a.subConteo.order=i,d=$(t.body.subConteo.order);try{for(p=function(){var e=l.value,n=a.subConteo.order.findIndex((function(t){return t.name===e.name&&t.nameSecond===e.nameSecond})),r=n>-1?a.subConteo.order[n].cantidad:0;if(n>-1){if(t.body.tipo)a.subConteo.order[n].cantidad+=e.cantidad;else if(a.subConteo.order[n].cantidad-=e.cantidad,a.subConteo.order[n].cantidad<0)throw"Cantidad Invalidad"}else a.subConteo.order.push({cantidad:e.cantidad,name:e.name,nameSecond:e.nameSecond||void 0});o.cantidadSC.push({name:e.name,nameSecond:e.nameSecond,cantidadDisponible:r,cantidadVenta:e.cantidad})},d.s();!(l=d.n()).done;)p()}catch(e){d.e(e)}finally{d.f()}if(t.body.tipo){e.next=17;break}if(!(a.cantidad-t.body.cantidad<0)){e.next=17;break}throw"Cantidad Invalidad";case 17:return e.next=19,V.findOneAndUpdate({codigo:t.body.codigo},{subConteo:a.subConteo,$inc:{cantidad:t.body.tipo?t.body.cantidad:-1*t.body.cantidad},$push:{variaciones:o}},{new:!0,useFindAndModify:!1});case 19:m=e.sent,n.json(m),e.next=26;break;case 23:return e.prev=23,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 26:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,n){return e.apply(this,arguments)}}(),Q=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new C(t.body),e.next=4,r.save();case 4:return a=e.sent,e.abrupt("return",n.json(a));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),Y=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C.updateMany({name:{$in:t.body}},{deleted:!0});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Z=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C.find({deleted:!1});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),X=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=new k(t.body)).codigo=Date.now().toString(),e.next=5,r.save();case 5:return a=e.sent,e.abrupt("return",n.json(a));case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),ee=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.aggregate([{$match:{codigo:"4SDtT4"}},{$project:{cantidadTotal:{$sum:"$subConteo.order.cantidad"}}}]);case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),te=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.params.deleteString.split("_"),e.next=4,k.deleteMany({name:{$in:r}});case 4:n.json({message:"succes"}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ne=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.find({});case 3:r=e.sent,n.json(r),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),re=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=new V(t.body)).priceNoIGV=ye(r.priceIGV),e.next=5,ae(r.name,r.tipo);case 5:if(r.codigo=e.sent,r.nameLowerCase=r.name,a={date:Date.now(),cantidad:r.cantidad,tipo:!0,comentario:"new item",costoVar:Math.round(100*(r.costoPropio*r.cantidad+Number.EPSILON))/100,cantidadSC:[]},r.subConteo){o=$(r.subConteo.order);try{for(o.s();!(i=o.n()).done;)s=i.value,a.cantidadSC.push({name:s.name,nameSecond:s.nameSecond,cantidadDisponible:s.cantidad,cantidadVenta:0})}catch(e){o.e(e)}finally{o.f()}}return r.variaciones=[a],e.next=12,r.save();case 12:return c=e.sent,e.abrupt("return",n.json(c));case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),ae=function(){var e=S(regeneratorRuntime.mark((function e(){var t,n,r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"",n=a.length>1&&void 0!==a[1]?a[1]:"",e.prev=2,e.next=5,V.countDocuments({});case 5:return r=e.sent,e.abrupt("return",r.toString()+"SD"+t.charAt(0)+n.charAt(0)+Math.floor(10*Math.random()).toString());case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",new Error(e.t0));case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),oe=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.find({deleted:!1}).sort({orderNumber:1});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ie=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOneAndUpdate({codigo:t.body.codigo},{oferta:1},{new:!0,useFindAndModify:!1});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),se=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOneAndUpdate({codigo:t.body.codigo},{oferta:0},{new:!0,useFindAndModify:!1});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ce=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s,c,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=0,"asc"===t.params.tipoSort?r=1:"dsc"===t.params.tipoSort&&(r=-1),a=t.params.subORtipo,o=t.params.tipoBusqueda,i=t.params.filtro,s=parseInt(t.params.limit),c=s-12,u={},"all"!==t.params.filtro&&("destacado"===i.toLowerCase()?u={oferta:{$gt:0},deleted:!1}:"sub"===a?u={subTipo:i,deleted:!1}:"tipo"===a&&(u={tipo:i,deleted:!1})),e.t0=o,e.next="date"===e.t0?13:"name"===e.t0?17:"priceIGV"===e.t0?21:25;break;case 13:return e.next=15,V.find(u).collation({locale:"en",strength:2}).sort({date:-1*r}).skip(c).limit(s);case 15:return d=e.sent,e.abrupt("break",26);case 17:return e.next=19,V.find(u).collation({locale:"en",strength:2}).sort({name:r}).skip(c).limit(s);case 19:return d=e.sent,e.abrupt("break",26);case 21:return e.next=23,V.find(u).collation({locale:"en",strength:2}).sort({priceIGV:r}).skip(c).limit(s);case 23:return d=e.sent,e.abrupt("break",26);case 25:return e.abrupt("break",26);case 26:return e.abrupt("return",n.json(d));case 29:return e.prev=29,e.t1=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 32:case"end":return e.stop()}}),e,null,[[0,29]])})));return function(t,n){return e.apply(this,arguments)}}(),ue=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.find({tipo:t.params.tipo,deleted:!1});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),de=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.find({subTipo:t.params.subTipo,tipo:t.params.tipo,deleted:!1}).sort({orderNumber:1});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),le=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={},e.prev=1,e.t0=t.params.tipo,e.next="cod"===e.t0?5:"name"===e.t0?9:"tipo"===e.t0?13:17;break;case 5:return e.next=7,V.findOne({codigo:t.params.codigo});case 7:return r=e.sent,e.abrupt("break",19);case 9:return e.next=11,V.find({name:t.body.name});case 11:return r=e.sent,e.abrupt("break",19);case 13:return e.next=15,V.find({tipo:t.body.tipo});case 15:return r=e.sent,e.abrupt("break",19);case 17:return r={message:"Not A Type Of Search"},e.abrupt("break",19);case 19:return e.abrupt("return",n.json(r));case 22:return e.prev=22,e.t1=e.catch(1),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 25:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t,n){return e.apply(this,arguments)}}(),pe=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r={},a=0,o=0,"redu"!==t.params.tipo){e.next=19;break}return e.next=7,V.findOne({codigo:t.body.codigo});case 7:if(r=e.sent,!((a=r.cantidad)>=t.body.cantidad)){e.next=16;break}return o=a-t.body.cantidad,e.next=13,V.findOneAndUpdate({codigo:t.body.codigo},{cantidad:o},{new:!0,useFindAndModify:!1});case 13:r=e.sent,e.next=17;break;case 16:return e.abrupt("return",n.status(409).json({message:"No Hay Los Suficientes Items En Stock"}));case 17:e.next=32;break;case 19:if("aume"!==t.params.tipo){e.next=31;break}return e.next=22,V.findOne({codigo:t.body.codigo});case 22:if(r=e.sent,!((a=r.cantidad)>=t.body.cantidadRedu)){e.next=29;break}return o=a+t.body.cantidadRedu,e.next=28,V.findOneAndUpdate({codigo:t.body.codigo},{cantidad:o},{new:!0,useFindAndModify:!1});case 28:r=e.sent;case 29:e.next=32;break;case 31:return e.abrupt("return",n.json({message:"Not An opc"}));case 32:return e.abrupt("return",n.json(r));case 35:return e.prev=35,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 38:case"end":return e.stop()}}),e,null,[[0,35]])})));return function(t,n){return e.apply(this,arguments)}}(),me=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=t.body).priceIGV&&(r.priceNoIGV=ye(r.priceIGV)),e.next=5,V.findOneAndUpdate({codigo:t.body.codigo},r,{new:!0,useFindAndModify:!1});case 5:a=e.sent,n.json(a),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),fe=function(){var e=S(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOneAndUpdate({codigo:t.params.codigo},{deleted:!0},{new:!0,useFindAndModify:!1});case 3:a=e.sent,t.result=a,t.photNameToDelete=a.photo,r(),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n,r){return e.apply(this,arguments)}}(),ge=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOneAndUpdate({codigo:t.body.codigo},{oferta:t.body.ofertaNum},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ve=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOneAndUpdate({codigo:t.body.codigo},{oferta:0},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.status(200).json({res:r,uploadInfo:t.uploadInfo}),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),n.status(500).json({errorMSG:e.t0});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),be=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOneAndUpdate({codigo:t.params.codigo},{photo:t.fileName},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.status(200).json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ye=function(e){var t=e/1.18;return Math.round(100*(t+Number.EPSILON))/100},he=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOneAndUpdate({codigo:t.params.codigo},{ficha:!0},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.status(200).json({res:r,uploadInfo:t.uploadInfo}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),$e=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=[],a=t.gananciaPorItem.filter((function(e){return!(6===e.name.length&&"N"===e.name.split("")[2]&&"I"===e.name.split("")[3])})).slice(0,4),-1!==(o=a.findIndex((function(e){return"3SDKP7"===e.name})))?a.splice(o,1):a.pop(),i=0;case 6:if(!(i<a.length)){e.next=15;break}return e.next=9,V.findOne({codigo:a[i].name});case 9:s=e.sent,a[i].name=s.name,r.push({name:a[i].name,series:[{name:"Ventas",value:a[i].totalVenta},{name:"Ganancias",value:a[i].value}]});case 12:i++,e.next=6;break;case 15:n.json(r),e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,n){return e.apply(this,arguments)}}(),xe=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!1}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"quitar"}},{$group:{_id:null,totalVarQuitar:{$sum:"$variaciones.costoVar"}}}]);case 3:return r=e.sent,e.next=6,V.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!0}},{$group:{_id:{codigo:"$codigo",name:"$name"},posVar:{$sum:"$variaciones.costoVar"}}},{$project:{_id:0,codigo:"$_id.codigo",name:"$_id.name",posVar:1}},{$sort:{name:1}},{$group:{_id:null,totalVarPos:{$sum:"$posVar"}}}]);case 6:return a=e.sent,e.next=9,V.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!1}},{$group:{_id:{codigo:"$codigo",name:"$name"},posVar:{$sum:"$variaciones.costoVar"}}},{$project:{_id:0,codigo:"$_id.codigo",name:"$_id.name",posVar:1}},{$sort:{name:1}},{$group:{_id:null,totalVarNeg:{$sum:"$posVar"}}}]);case 9:return o=e.sent,e.next=12,V.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!0}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"anular"}},{$group:{_id:null,totalVarAnular:{$sum:"$variaciones.costoVar"}}}]);case 12:i=e.sent,n.json({gastosInventario:a[0].totalVarPos-((r[0]?r[0].totalVarQuitar:0)+(i[0]?i[0].totalVarAnular:0)),gananciasInventario:o[0].totalVarNeg-((r[0]?r[0].totalVarQuitar:0)+(i[0]?i[0].totalVarAnular:0))}),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),we=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!1}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"quitar"}},{$group:{_id:null,totalVarQuitar:{$sum:"$variaciones.costoVar"}}}]);case 3:return r=e.sent,e.next=6,V.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!0}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"anular"}},{$group:{_id:null,totalVarAnular:{$sum:"$variaciones.costoVar"}}}]);case 6:return a=e.sent,e.next=9,V.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!0}},{$group:{_id:{codigo:"$codigo",name:"$name"},posVar:{$sum:"$variaciones.costoVar"}}},{$project:{_id:0,codigo:"$_id.codigo",name:"$_id.name",posVar:1}},{$sort:{name:1}},{$group:{_id:null,totalVarPos:{$sum:"$posVar"}}}]);case 9:return o=e.sent,e.next=12,_.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$project:{codigo:1,codArray:{$split:["$codigo","NI"]},totalPrice:1,codSize:{$strLenCP:"$codigo"},costoTotalPropio:{$multiply:["$priceCosto","$cantidad"]}}},{$match:{codSize:6}},{$set:{arrayCodSize:{$size:"$codArray"}}},{$match:{arrayCodSize:2}},{$project:{codigo:1,costoTotalPropio:1,totalPrice:1,primeraParteLen:{$strLenCP:{$arrayElemAt:["$codArray",0]}},segundaParteLen:{$strLenCP:{$arrayElemAt:["$codArray",0]}}}},{$match:{primeraParteLen:2,segundaParteLen:2}},{$group:{_id:null,costoTotalPropio:{$sum:"$costoTotalPropio"},ingresoTotal:{$sum:"$totalPrice"}}}]);case 12:return i=e.sent,e.next=15,V.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!1}},{$group:{_id:{codigo:"$codigo",name:"$name"},posVar:{$sum:"$variaciones.costoVar"}}},{$project:{_id:0,codigo:"$_id.codigo",name:"$_id.name",posVar:1}},{$sort:{name:1}},{$group:{_id:null,totalVarNeg:{$sum:"$posVar"}}}]);case 15:s=e.sent,n.json({gastoTotalHistorico:o[0].totalVarPos-((r[0]?r[0].totalVarQuitar:0)+(a[0]?a[0].totalVarAnular:0))+i[0].costoTotalPropio,ingresoTotalHistorico:s[0].totalVarNeg-((r[0]?r[0].totalVarQuitar:0)+(a[0]?a[0].totalVarAnular:0))+i[0].ingresoTotal}),e.next=22;break;case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,n){return e.apply(this,arguments)}}(),Se=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.aggregate([{$match:{deleted:!1}},{$project:{_id:0,cantidad:1,priceIGV:1,total:{$multiply:["$priceIGV","$cantidad"]}}},{$group:{_id:null,totalPotencial:{$sum:"$total"}}}]);case 3:return r=e.sent,e.next=6,V.aggregate([{$match:{deleted:!1}},{$project:{_id:0,cantidad:1,costoPropio:1,total:{$multiply:["$costoPropio","$cantidad"]}}},{$group:{_id:null,totalPotencial:{$sum:"$total"}}}]);case 6:a=e.sent,n.json({ventasPosibles:r[0].totalPotencial,costoPropioTotalAprox:a[0].totalPotencial,gananciaAprox:r[0].totalPotencial-a[0].totalPotencial}),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),Ve=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.aggregate([{$match:{deleted:!1}},{$unwind:"$variaciones"},{$project:{_id:0,codigo:1,name:1,variaciones:1,costoVarTrue:{$cond:[{$eq:["$variaciones.tipo",!0]},"$variaciones.costoVar",0]},costoVarFalse:{$cond:[{$eq:["$variaciones.tipo",!1]},"$variaciones.costoVar",0]}}},{$group:{_id:{name:"$name",codigo:"$codigo"},totalTrue:{$sum:"$costoVarTrue"},totalFalse:{$sum:"$costoVarFalse"}}},{$project:{_id:0,name:"$_id.name",codigo:"$_id.codigo",totalTrue:1,totalFalse:1,balance:{$subtract:["$totalFalse","$totalTrue"]}}},{$sort:{balance:1}}]);case 3:r=e.sent,n.json({peor:r[0],mejor:r[r.length-1]}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ke=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.aggregate([{$match:{deleted:!1}},{$project:{codigo:1,name:1,cantidad:1,costoPropio:1,priceIGV:1,totalIngreso:{$multiply:["$cantidad","$priceIGV"]},totalCosto:{$multiply:["$cantidad","$costoPropio"]}}},{$project:{codigo:1,name:1,cantidad:1,costoPropio:1,priceIGV:1,balance:{$subtract:["$totalIngreso","$totalCosto"]}}}]).sort({balance:-1}).limit(1);case 3:r=e.sent,n.json(r[0]),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),_e=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$project:{codigo:1,codArray:{$split:["$codigo","NI"]},totalPrice:1,codSize:{$strLenCP:"$codigo"},costoTotalPropio:{$multiply:["$priceCosto","$cantidad"]}}},{$match:{codSize:6}},{$set:{arrayCodSize:{$size:"$codArray"}}},{$match:{arrayCodSize:2}},{$project:{codigo:1,costoTotalPropio:1,totalPrice:1,primeraParteLen:{$strLenCP:{$arrayElemAt:["$codArray",0]}},segundaParteLen:{$strLenCP:{$arrayElemAt:["$codArray",1]}}}},{$match:{primeraParteLen:2,segundaParteLen:2}},{$group:{_id:null,costoTotalPropio:{$sum:"$costoTotalPropio"},ingresoTotal:{$sum:"$totalPrice"}}}]);case 3:return r=e.sent,e.next=6,_.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$project:{codigo:1,totalPrice:1,costoTotalPropio:{$multiply:["$priceCosto","$cantidad"]}}},{$group:{_id:null,costoTotalPropio:{$sum:"$costoTotalPropio"},ingresoTotal:{$sum:"$totalPrice"}}}]);case 6:a=e.sent,n.json({gananciaEnVentasFueraTienda:r[0].ingresoTotal-r[0].costoTotalPropio,gananciaEnVentas:a[0].ingresoTotal-a[0].costoTotalPropio,gananciaEnVentasDeTienda:a[0].ingresoTotal-r[0].ingresoTotal-(a[0].costoTotalPropio-r[0].costoTotalPropio)}),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),je=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$group:{_id:"$codigo",cantidad:{$sum:1}}},{$sort:{cantidad:-1}}]);case 3:return r=e.sent,e.next=6,V.findOne({codigo:r[0]._id});case 6:a=e.sent,n.json(a),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),Ce=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$documento"},{$replaceRoot:{newRoot:"$documento"}},{$match:{codigo:{$ne:null}}},{$group:{_id:{codigo:"$codigo",name:"$name"},cantidad:{$sum:1}}},{$sort:{cantidad:-1}}]);case 3:r=e.sent,n.json({cliente:r[0]._id.name,numero:r[0].cantidad}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Re=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOneAndUpdate({codigo:t.body.itemCod},{$pull:{caracteristicas:{$in:t.body.deleteArray}}},{useFindAndModify:!1,new:!0});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Ie=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.findOneAndUpdate({codigo:t.body.itemCod},{$push:{caracteristicas:t.body.newCaracteristica}},{useFindAndModify:!1,new:!0});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Pe=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.startSession();case 2:return(r=e.sent).startTransaction(),e.prev=4,e.next=7,V.countDocuments({deleted:!1,subTipo:t.body.itemReOrder[0].subTipo,tipo:t.body.itemReOrder[0].tipo});case 7:if(e.sent===t.body.itemReOrder.length){e.next=10;break}throw"Variacion Invalida";case 10:o=0;case 11:if(!(o<t.body.itemReOrder.length)){e.next=17;break}return e.next=14,V.findOneAndUpdate({codigo:t.body.itemReOrder[o].codigo},{orderNumber:o},{useFindAndModify:!1});case 14:o++,e.next=11;break;case 17:return e.next=19,r.commitTransaction();case 19:r.endSession(),n.json({message:"done"}),e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(4),e.next=27,r.abortTransaction();case 27:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 29:case"end":return e.stop()}}),e,null,[[4,23]])})));return function(t,n){return e.apply(this,arguments)}}(),Te=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.find({deleted:!1,$and:[{cantidad:{$lt:5}},{cantidad:{$gt:0}}]});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Ae=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.find({deleted:!1,cantidad:0});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Ne=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.aggregate([{$match:{codigo:t.params.codigoItem}},{$unwind:"$variaciones"},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$set:{firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$set:{cantidadVarNI:{$cond:[{$eq:["$firstPartVar","new item"]},"$variaciones.cantidad",0]},cantidadVarQuitar:{$cond:[{$eq:["$firstPartVar","quitar"]},"$variaciones.cantidad",0]},cantidadVarAgregar:{$cond:[{$eq:["$firstPartVar","agregar"]},"$variaciones.cantidad",0]},cantidadVarAnular:{$cond:[{$eq:["$firstPartVar","anular"]},"$variaciones.cantidad",0]},cantidadVarVenta:{$cond:[{$eq:["$firstPartVar","venta"]},"$variaciones.cantidad",0]}}},{$group:{_id:null,totalCantidadNI:{$sum:"$cantidadVarNI"},totalCantidadQuitar:{$sum:"$cantidadVarQuitar"},totalCantidadAgregar:{$sum:"$cantidadVarAgregar"},totalCantidadVenta:{$sum:"$cantidadVarVenta"},totalCantidadAnular:{$sum:"$cantidadVarAnular"}}}]);case 3:return r=e.sent,e.next=6,V.aggregate([{$match:{codigo:t.params.codigoItem}},{$unwind:"$variaciones"},{$project:{_id:0,codigo:1,name:1,variaciones:1,costoVarTrue:{$cond:[{$eq:["$variaciones.tipo",!0]},"$variaciones.costoVar",0]},costoVarFalse:{$cond:[{$eq:["$variaciones.tipo",!1]},"$variaciones.costoVar",0]}}},{$group:{_id:{name:"$name",codigo:"$codigo"},totalTrue:{$sum:"$costoVarTrue"},totalFalse:{$sum:"$costoVarFalse"}}}]);case 6:return a=e.sent,e.next=9,V.aggregate([{$match:{codigo:t.params.codigoItem}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!1}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"quitar"}},{$group:{_id:null,totalVarQuitar:{$sum:"$variaciones.costoVar"}}}]);case 9:return o=e.sent,e.next=12,V.aggregate([{$match:{codigo:t.params.codigoItem}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!0}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"anular"}},{$group:{_id:null,totalVarAnular:{$sum:"$variaciones.costoVar"}}}]);case 12:i=e.sent,n.json({itemVendidos:r[0].totalCantidadVenta-r[0].totalCantidadAnular,cantidadHistorica:r[0].totalCantidadNI+r[0].totalCantidadAgregar-r[0].totalCantidadQuitar,totalCosto:a[0].totalTrue-((o[0]?o[0].totalVarQuitar:0)+(i[0]?i[0].totalVarAnular:0)),totalIngreso:a[0].totalFalse-((o[0]?o[0].totalVarQuitar:0)+(i[0]?i[0].totalVarAnular:0))}),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),Oe=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.aggregate([{$match:{codigo:t.params.codigoItem}},{$unwind:"$variaciones"},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$set:{firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$set:{cantidadVarAnular:{$cond:[{$eq:["$firstPartVar","anular"]},"$variaciones.cantidad",0]},cantidadVarVenta:{$cond:[{$eq:["$firstPartVar","venta"]},"$variaciones.cantidad",0]},dateVar:{$dateToString:{format:"%Y-%m",date:"$variaciones.date",timezone:"-05:00"}}}},{$group:{_id:"$dateVar",valueVenta:{$sum:"$cantidadVarVenta"},valueAnular:{$sum:"$cantidadVarAnular"}}},{$project:{_id:0,name:"$_id",value:{$subtract:["$valueVenta","$valueAnular"]}}},{$sort:{name:1}}]);case 3:r=e.sent,a=[{name:"Cantidad",series:r}],n.json(a),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),Ge=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.aggregate([{$match:{deleted:!1}},{$unwind:"$variaciones"},{$project:{name:1,variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$set:{firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$set:{cantidadVarAnular:{$cond:[{$eq:["$firstPartVar","anular"]},"$variaciones.costoVar",0]},cantidadVarVenta:{$cond:[{$eq:["$firstPartVar","venta"]},"$variaciones.costoVar",0]}}},{$group:{_id:"$name",valueVenta:{$sum:"$cantidadVarVenta"},valueAnular:{$sum:"$cantidadVarAnular"}}},{$project:{_id:0,name:"$_id",value:{$subtract:["$valueVenta","$valueAnular"]}}},{$sort:{value:-1}}]);case 3:return e.sent,e.next=6,V.aggregate([{$match:{deleted:!1}},{$unwind:"$variaciones"},{$project:{name:1,variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$set:{firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$set:{cantidadVarAgregar:{$cond:[{$eq:["$firstPartVar","agregar"]},"$variaciones.costoVar",0]},cantidadVarNewItem:{$cond:[{$eq:["$firstPartVar","new item"]},"$variaciones.costoVar",0]},cantidadVarQuitar:{$cond:[{$eq:["$firstPartVar","quitar"]},"$variaciones.costoVar",0]},cantidadVarAnular:{$cond:[{$eq:["$firstPartVar","anular"]},"$variaciones.costoVar",0]},cantidadVarVenta:{$cond:[{$eq:["$firstPartVar","venta"]},"$variaciones.costoVar",0]}}},{$group:{_id:"$name",valueAgregar:{$sum:"$cantidadVarAgregar"},valueVenta:{$sum:"$cantidadVarVenta"},valueAnular:{$sum:"$cantidadVarAnular"},valueNewItem:{$sum:"$cantidadVarNewItem"},valueQuitar:{$sum:"$cantidadVarQuitar"}}},{$project:{_id:0,valueQuitar:1,name:"$_id",preValueTwo:{$subtract:["$valueVenta","$valueAnular"]},prevalue:{$sum:["$valueAgregar","$valueNewItem"]}}},{$project:{_id:0,name:1,preValueTwo:1,preValueT:{$subtract:["$prevalue","$valueQuitar"]}}},{$project:{_id:0,name:1,value:{$subtract:["$preValueTwo","$preValueT"]}}},{$sort:{value:-1}}]);case 6:return e.sent,e.next=9,V.aggregate([{$match:{deleted:!1}},{$unwind:"$variaciones"},{$project:{name:1,variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$set:{firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$set:{cantidadVarAgregar:{$cond:[{$eq:["$firstPartVar","agregar"]},"$variaciones.costoVar",0]},cantidadVarNewItem:{$cond:[{$eq:["$firstPartVar","new item"]},"$variaciones.costoVar",0]},cantidadVarQuitar:{$cond:[{$eq:["$firstPartVar","quitar"]},"$variaciones.costoVar",0]}}},{$group:{_id:"$name",valueAgregar:{$sum:"$cantidadVarAgregar"},valueNewItem:{$sum:"$cantidadVarNewItem"},valueQuitar:{$sum:"$cantidadVarQuitar"}}},{$project:{_id:0,valueQuitar:1,name:"$_id",prevalue:{$sum:["$valueAgregar","$valueNewItem"]}}},{$project:{_id:0,name:1,value:{$subtract:["$prevalue","$valueQuitar"]}}},{$sort:{value:-1}}]);case 9:r=e.sent,n.json(r),e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}(),Me=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.aggregate([{$match:{deleted:!1}},{$unwind:"$variaciones"},{$project:{name:1,codigo:1,cantidad:1,variaciones:1,priceIGV:1,costoPropio:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$set:{firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$set:{cantidadVarAgregar:{$cond:[{$eq:["$firstPartVar","agregar"]},"$variaciones.costoVar",0]},cantidadVarNewItem:{$cond:[{$eq:["$firstPartVar","new item"]},"$variaciones.costoVar",0]},cantidadVarQuitar:{$cond:[{$eq:["$firstPartVar","quitar"]},"$variaciones.costoVar",0]},cantidadVarAnular:{$cond:[{$eq:["$firstPartVar","anular"]},"$variaciones.costoVar",0]},cantidadVarVenta:{$cond:[{$eq:["$firstPartVar","venta"]},"$variaciones.costoVar",0]}}},{$group:{_id:{name:"$name",codigo:"$codigo",cantidad:"$cantidad",priceIGV:"$priceIGV",costoPropio:"$costoPropio"},valueAgregar:{$sum:"$cantidadVarAgregar"},valueVenta:{$sum:"$cantidadVarVenta"},valueAnular:{$sum:"$cantidadVarAnular"},valueNewItem:{$sum:"$cantidadVarNewItem"},valueQuitar:{$sum:"$cantidadVarQuitar"}}},{$project:{_id:0,name:"$_id.name",codigo:"$_id.codigo",cantidad:"$_id.cantidad",priceIGV:"$_id.priceIGV",costoPropio:"$_id.costoPropio",valueQuitar:1,preValueGasto:{$sum:["$valueAgregar","$valueNewItem"]},valueIngreso:{$subtract:["$valueVenta","$valueAnular"]}}},{$project:{_id:0,name:1,codigo:1,cantidad:1,priceIGV:1,costoPropio:1,valueGasto:{$subtract:["$preValueGasto","$valueQuitar"]},valueIngreso:1}},{$sort:{valueIngreso:-1}}]);case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Ee=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.aggregate([{$match:{codigo:t.body.codigo}},{$unwind:"$variaciones"},{$match:{"variaciones.usuario":t.user.aud.split(" ")[0]}},{$limit:4}]);case 3:if(0!==e.sent.length){e.next=6;break}return e.abrupt("return",n.status(403).json({message:"No has comprado el item."}));case 6:return r=new Date,e.next=9,V.findOne({codigo:t.body.codigo});case 9:if(a=e.sent,o=!1,a.reviews.length>0&&(o=a.reviews.some((function(e){return e.user===t.user.aud.split(" ")[0]}))),!o){e.next=17;break}return e.next=15,V.findOneAndUpdate({codigo:t.body.codigo,"reviews.user":t.user.aud.split(" ")[0]},{$set:{"reviews.$.date":r.toISOString(),"reviews.$.rating":t.body.rating}},{new:!0,useFindAndModify:!1});case 15:return i=e.sent,e.abrupt("return",n.json(i));case 17:return e.next=19,V.findOneAndUpdate({codigo:t.body.codigo},{$push:{reviews:{user:t.user.aud.split(" ")[0],rating:t.body.rating,date:r.toISOString()}}},{new:!0,useFindAndModify:!1});case 19:return s=e.sent,e.abrupt("return",n.json(s));case 23:return e.prev=23,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 26:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,n){return e.apply(this,arguments)}}()},function(e,t){e.exports=require("mongoose")},function(e,t,n){"use strict";n.d(t,"i",(function(){return C})),n.d(t,"d",(function(){return R})),n.d(t,"a",(function(){return I})),n.d(t,"b",(function(){return P})),n.d(t,"e",(function(){return T})),n.d(t,"g",(function(){return A})),n.d(t,"h",(function(){return N})),n.d(t,"c",(function(){return O})),n.d(t,"f",(function(){return G}));var r=n(14),a=n.n(r),o=n(21),i=n.n(o),s=n(22),c=n.n(s),u=n(23),d=n.n(u),l=n(24),p=n.n(l),m=(n(18),n(1)),f=n(44),g=n.n(f),v=function(e,t){var n=new g.a({size:"A4",margin:50});return b(n,t),y(n,e),w(n,e),S(n),n},b=function(e,t){e.image(t,50,30,{width:70}).fillColor("#444444").fontSize(20).fontSize(10).text("Sirio Dinar | RUC: 20605746587",200,50,{align:"right"}).text("Jr. Felipe Pardo Y Aliaga 213, Trujillo.",200,65,{align:"right"}).text("+51 977-426-349",200,80,{align:"right"}).moveDown()},y=function(e,t){e.fillColor("#444444").fontSize(20).text("Comprobante",50,160),h(e,185);e.fontSize(10).text("Codigo:",50,200).font("Helvetica-Bold").text(t.codigo,150,200).font("Helvetica").text("Fecha de emisión:",50,240).text(x(new Date),150,240).font("Helvetica-Bold").text(t.documento.name,300,200).font("Helvetica").text(t.documento.codigo,300,240).moveDown(),h(e,260)},h=function(e,t){e.strokeColor("#aaaaaa").lineWidth(1).moveTo(50,t).lineTo(550,t).stroke()},$=function(e){return"S/"+e.toFixed(2)},x=function(e){var t=e.getDate(),n=e.getMonth()+1;return e.getFullYear()+"/"+n+"/"+t},w=function(e,t){var n,r=307;for(e.fontSize(8).font("Helvetica-Bold"),V(e,r,"Cod","Nombre","Descripcion","Precio","Cantidad","Total"),h(e,(r=300)+25),e.font("Helvetica"),n=0;n<t.itemsVendidos.length;n++){var a=t.itemsVendidos[n],o=a.descripcion;a.cantidadSC.length>0&&(o+="\nCantidades: ");for(var i=0;i<a.cantidadSC.length;i++)a.cantidadSC[i].cantidadVenta>0&&(o=o+a.cantidadSC[i].name+" - "+a.cantidadSC[i].nameSecond+": "+a.cantidadSC[i].cantidadVenta+", ");a.cantidadSC.length>0&&(o=o.slice(0,-2)+".");var s=r+30*(2*n+1);V(e,s,a.codigo,a.name,o,$(a.priceNoIGV),a.cantidad,$(a.totalPriceNoIGV)),h(e,s+55)}var c=r+31*(2*n+1);V(e,c,"","","","","Subtotal",$(t.totalPriceNoIGV));var u=c+15;V(e,u,"","","","","IGV 18%",$(t.totalPrice-t.totalPriceNoIGV));var d=u+15;e.font("Helvetica-Bold"),V(e,d,"","","","","Total",$(t.totalPrice)),e.font("Helvetica")},S=function(e){e.fontSize(10).text("siriodinar.com",50,780,{align:"center",width:500})},V=function(e,t,n,r,a,o,i,s){e.fontSize(8).text(n,50,t,{width:40}).text(r,100,t,{width:100}).text(a,210,t,{width:180}).text(o,400,t,{width:35,align:"right"}).text(i,460,t,{width:35,align:"right"}).text(s,0,t,{align:"right"})};function k(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function _(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){k(o,r,a,i,s,"next",e)}function s(e){k(o,r,a,i,s,"throw",e)}i(void 0)}))}}var j=new a.a.S3({accessKeyId:m.a.production.awsID,secretAccessKey:m.a.production.awsKey,Bucket:m.a.production.bucket,region:"us-east-1"}),C=function(){var e=_(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getObject({Bucket:m.a.production.bucket,Key:"sirio-logo.png"}).promise();case 3:return n=e.sent,(r=v(t,n.Body)).end(),e.next=8,j.upload({Bucket:m.a.production.bucket,Key:"".concat(t.codigo,".pdf"),Body:r,ContentType:"application/pdf"}).promise();case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(0),m.a.production.log().error(e.t0),e.abrupt("return",e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=_(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getObject({Bucket:m.a.production.bucket,Key:t.params.imgName}).promise();case 3:return r=e.sent,e.next=6,i.a.buffer(r.Body,{plugins:[c()({quality:50})]});case 6:a=e.sent,n.writeHead(200,{"Content-Type":"image/webp"}),n.write(a,"binary"),n.end(null,"binary"),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),I=function(){var e=_(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noPhoto.jpg"===t.body.oldPhoto){e.next=7;break}return e.next=4,j.deleteObject({Bucket:m.a.production.bucket,Key:t.body.oldPhoto}).promise();case 4:return a=t.body.oldPhoto.split("."),e.next=7,j.deleteObject({Bucket:m.a.production.bucket,Key:"".concat(a[0],".webp")}).promise();case 7:r(),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),P=function(){var e=_(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noPhoto.jpg"===t.photNameToDelete){e.next=4;break}return e.next=4,j.deleteObject({Bucket:m.a.production.bucket,Key:t.photNameToDelete}).promise();case 4:n.json(t.result),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),T=function(){var e=_(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getObject({Bucket:m.a.production.bucket,Key:t.params.pdfName}).promise();case 3:r=e.sent,n.writeHead(200,{"Content-Type":"aplication/pdf"}),n.write(r.Body,"binary"),n.end(null,"binary"),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),A=d()({storage:p()({s3:j,bucket:m.a.production.bucket,metadata:function(e,t,n){n(null,Object.assign({},e.body))},key:function(e,t,n){var r=t.originalname.split(".")[1];n(null,"IMG-"+Date.now().toString()+"."+r)}}),limits:{fileSize:2e6},fileFilter:function(e,t,n){t.originalname.match(/\.(jpg|jpeg|png)$/)||n(new Error("Please upload JPG and PNG images only!")),t.size>2e6&&n(new Error("Tamaño Exedido!")),n(void 0,!0)}}),N=(d()({storage:p()({s3:j,bucket:m.a.production.bucket,metadata:function(e,t,n){n(null,Object.assign({},e.body))},key:function(e,t,n){var r=t.originalname.split(".")[1];n(null,"STI_".concat(e.params.codigo,"_").concat(e.params.subCat),"."+r)}}),limits:{fileSize:2e6},fileFilter:function(e,t,n){t.originalname.match(/\.(jpg|jpeg|png)$/)||n(new Error("Please upload JPG and PNG images only!")),t.size>2e6&&n(new Error("Tamaño Exedido!")),n(void 0,!0)}}),d()({storage:p()({s3:j,bucket:m.a.production.bucket,metadata:function(e,t,n){n(null,Object.assign({},e.body))},key:function(e,t,n){n(null,"ficha-"+e.params.codigo+".pdf")}}),limits:{fileSize:1e6},fileFilter:function(e,t,n){t.originalname.match(/\.(pdf)$/)||n(new Error("Please upload PDF only!")),n(void 0,!0)}})),O=function(e,t,n){var r=e.file;if(!r){var a=new Error("Please upload a file");return a.httpStatusCode=400,n(a)}e.uploadInfo={statusCode:200,status:"success",uploadedFile:r},n()},G=function(){var e=_(regeneratorRuntime.mark((function e(t,n,r){var a,o,s,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.file){e.next=6;break}return(o=new Error("Please upload a file")).httpStatusCode=400,e.abrupt("return",r(o));case 6:return s=a.key.split("."),e.next=9,j.getObject({Bucket:m.a.production.bucket,Key:a.key}).promise();case 9:return u=e.sent,e.next=12,i.a.buffer(u.Body,{plugins:[c()({quality:50})]});case 12:return d=e.sent,e.next=15,j.upload({Key:"".concat(s[0],".webp"),CacheControl:"max-age=604800",ACL:"public-read",ContentType:"image/webp",Body:d,Bucket:m.a.production.bucket}).promise();case 15:t.fileName=a.key,t.uploadInfo={statusCode:200,status:"success",uploadedFile:a},r(),e.next=23;break;case 20:return e.prev=20,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t,n,r){return e.apply(this,arguments)}}()},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return i}));var r=n(3),a=new r.Schema({name:{type:String},nameSecond:{type:String},cantidadDisponible:{type:Number},cantidadVenta:{type:Number}},{_id:!1}),o=new r.Schema({codigo:{type:String,required:!0,trim:!0},tipo:{type:String,trim:!0,default:"producto"},name:{type:String,trim:!0},descripcion:{type:String,trim:!0},priceIGV:{type:Number,required:!0,trim:!0},priceNoIGV:{type:Number,required:!0,trim:!0},priceCosto:{type:Number,default:0},cantidad:{type:Number,required:!0,trim:!0,min:0},cantidadSC:{type:[a],default:[]},totalPrice:{type:Number},totalPriceNoIGV:{type:Number},unidadDeMedida:{type:String},photo:{type:String},ventaCod:{type:String}},{_id:!1}),i=new r.Schema({type:{type:String,required:!0},name:{type:String,trim:!0,default:""},codigo:{type:Number,trim:!0},direccion:{type:String}},{_id:!1})},function(e,t){e.exports=require("bcrypt")},function(e,t,n){"use strict";n.d(t,"a",(function(){return y})),n.d(t,"c",(function(){return $})),n.d(t,"b",(function(){return w}));var r=n(16),a=n(17),o=n.n(a),i=n(1);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t,n,r,a,o,i,s,c,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.unidad_de_medida=t,this.codigo=n,this.descripcion=r,this.cantidad=a,this.valor_unitario=o,this.precio_unitario=i,this.subtotal=s,this.tipo_de_igv=1,this.igv=c,this.total=u}var t,n,r;return t=e,(n=[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"toJSON",value:function(e){var t={},n=e||this;Object.getOwnPropertyNames(n).forEach((function(e){var r=n[e];"toJSON"!==e&&"constructor"!==e&&(t[e]="function"!=typeof r?r:r.bind(t))}));var r=Object.getPrototypeOf(n);return null!==r&&Object.keys(this.toJSON(r)).forEach((function(e){t[e]||"constructor"===e||"toJSON"===e||("function"!=typeof r[e]?t[e]=r[e]:t[e]=r[e].bind(t))})),t}}])&&s(t.prototype,n),r&&s(t,r),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.operacion="generar_comprobante",this.tipo_de_comprobante=t.tipo_de_comprobante,1===this.tipo_de_comprobante?(this.cliente_tipo_de_documento="6",this.serie="FFF1"):(this.cliente_tipo_de_documento="1",this.serie="BBB1"),this.numero=t.numero,this.sunat_transaction=1,this.cliente_numero_de_documento=t.cliente_numero_de_documento,this.cliente_denominacion=t.cliente_denominacion,this.cliente_direccion=t.cliente_direccion||"",this.cliente_email=t.cliente_email||"",this.fecha_de_emision=t.fecha_de_emision,this.moneda=1,this.porcentaje_de_igv=18,this.total_gravada=t.total_gravada,this.total_igv=t.total_igv,this.total=t.total,this.detraccion=!1,this.enviar_automaticamente_a_la_sunat=!0,this.enviar_automaticamente_al_cliente=!1,this.formato_de_pdf="A4",this.items=t.items||[],this.guias=t.guias||[],this.codigo_unico=t.codigo_unico||"",this.cliente_email=t.cliente_email||"",this.enviar_automaticamente_al_cliente=t.enviar_automaticamente_al_cliente||!1,this.medio_de_pago=t.medio_de_pago}var t,n,r;return t=e,(n=[{key:"toString",value:function(){return Object.keys(this)}},{key:"toJSON",value:function(e){var t={},n=e||this;Object.getOwnPropertyNames(n).forEach((function(e){var r=n[e];"toJSON"!==e&&"constructor"!==e&&(t[e]="function"!=typeof r?r:r.bind(t))}));var r=Object.getPrototypeOf(n);return null!==r&&Object.keys(this.toJSON(r)).forEach((function(e){t[e]||"constructor"===e||"toJSON"===e||("function"!=typeof r[e]?t[e]=r[e]:t[e]=r[e].bind(t))})),t}}])&&u(t.prototype,n),r&&u(t,r),e}();function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t,n,r,a,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tipo_de_comprobante=t,this.numero=n,this.cliente_numero_de_documento=r,this.cliente_denominacion=a,this.fecha_de_emision=this.getNowDate(),this.items=[],this.guias=[],this.codigo_unico=o,this.medio_de_pago=i}var t,n,a;return t=e,(n=[{key:"getNowDate",value:function(){var e=r.DateTime.local().setZone("UTC-5").toLocaleString().split("/"),t=e[0];return e[0]=e[1],e[1]=t,console.log(e.join("-")),e.join("-")}},{key:"addDireccion",value:function(e){this.cliente_direccion=e}},{key:"addPrecios",value:function(e,t,n){this.total=n,this.total_gravada=e,this.total_igv=t}},{key:"addItem",value:function(e){this.items.push(e)}},{key:"addGuide",value:function(e){this.guias.push(e)}},{key:"build",value:function(){return new d(this)}},{key:"addEmail",value:function(e){this.enviar_automaticamente_al_cliente=!0,this.cliente_email=e}}])&&l(t.prototype,n),a&&l(t,a),e}(),m=n(43);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){v(o,r,a,i,s,"next",e)}function s(e){v(o,r,a,i,s,"throw",e)}i(void 0)}))}}i.a.production.log();var y=function(){var e=b(regeneratorRuntime.mark((function e(){var t,n,r,a,s,c,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:1,n=u.length>1&&void 0!==u[1]?u[1]:"",r=u.length>2&&void 0!==u[2]?u[2]:0,a=u.length>3&&void 0!==u[3]?u[3]:"",e.prev=4,s={operacion:"generar_anulacion",tipo_de_comprobante:t,serie:n,numero:r,motivo:a},e.next=8,o()("https://api.nubefact.com/api/v1/9e79db57-8322-4c1a-ac73-fa5093668c3c",{method:"post",headers:{"Content-Type":"application/json",Authorization:i.a.production.nbfToken},body:JSON.stringify(s)}).then((function(e){return e.json()}));case 8:return c=e.sent,e.abrupt("return",c.enlace_del_pdf);case 12:throw e.prev=12,e.t0=e.catch(4),e.t0;case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=r.DateTime.local().setZone("UTC-5").toLocaleString().split("/"),t=e[0];return e[0]=e[1],e[1]=t,e.join("-")},$=function(e,t,n){if(!e.body.venta.guia)return n();var r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},m);r.numero=e.countGuia+1,"factura"===e.ventResult.documento.type?r.cliente_tipo_de_documento=6:"boleta"===e.ventResult.documento.type&&(r.cliente_tipo_de_documento=1);var a=7===e.ventResult.documento.codigo.toString().length||10===e.ventResult.documento.codigo.toString().length?"0"+e.ventResult.documento.codigo.toString():e.ventResult.documento.codigo;r.cliente_numero_de_documento=a,r.cliente_denominacion=e.ventResult.documento.name,r.cliente_direccion=e.ventResult.documento.direccion||"",r.fecha_de_emision=h(),r.fecha_de_inicio_de_traslado=h(),r.numero_de_bultos=e.body.venta.bultos,r.peso_bruto_total=e.body.venta.peso,8===e.body.venta.transportista_codigo.length?(r.transportista_documento_tipo=1,r.tipo_de_transporte="02"):(r.transportista_documento_tipo=6,r.tipo_de_transporte="01"),r.transportista_documento_numero=e.body.venta.transportista_codigo,r.transportista_denominacion=e.body.venta.transportista_nombre,r.transportista_placa_numero=e.body.venta.transportista_placa,r.conductor_documento_tipo=r.transportista_documento_tipo,r.conductor_documento_numero=r.transportista_documento_numero,r.conductor_denominacion=r.transportista_denominacion,r.punto_de_partida_ubigeo=e.body.venta.partida_ubigeo,r.punto_de_partida_direccion=e.body.venta.partida_direccion,r.punto_de_llegada_ubigeo=e.body.venta.llegada_ubigeo,r.punto_de_llegada_direccion=e.body.venta.llegada_direccion,r.formato_de_pdf="A4",r.cliente_email=e.ventResult.cliente_email||"",r.enviar_automaticamente_a_la_sunat=!0,r.enviar_automaticamente_al_cliente=!0,e.ventResult.itemsVendidos.forEach((function(e){var t={unidad_de_medida:"NIU",codigo:e.codigo,descripcion:e.name+" | "+e.descripcion,cantidad:e.cantidad};"UND"===e.unidadDeMedida?t.unidad_de_medida="NIU":"PAR"===e.unidadDeMedida?t.unidad_de_medida="PR":"CAJA"===e.unidadDeMedida&&(t.unidad_de_medida="BX"),r.items.push(t)})),o()("https://api.nubefact.com/api/v1/9e79db57-8322-4c1a-ac73-fa5093668c3c",{method:"post",headers:{"Content-Type":"application/json",Authorization:i.a.production.nbfToken},body:JSON.stringify(r)}).then((function(e){return e.json()})).then((function(t){e.sunat_guia=t,t.errors&&console.log("HANDLE"),n()})).catch((function(e){return t.status(e.status).json(e)}))},x=function(e){var t=e.medio_de_pago.split("|")[0],n=e.medio_de_pago.split("|")[1],r="";switch(t){case"efectivo":r="Efectivo";break;case"tarjeta":r="Tarjeta: "+n;break;case"yape":r="Yape: "+n;break;case"otro":r=n}return r},w=function(e,t,n){var r={};if("boleta"===e.ventResult.documento.type)r=function(e,t,n){var r="";if(e.documento.codigo.toString().length<8)for(var a=0;a<8-e.documento.codigo.toString().length;a++)r+="0";var o=e.documento.codigo.toString().length<8?r+e.documento.codigo.toString():e.documento.codigo,i=new p(2,1+t,o,e.documento.name,e.codigo,x(e));return i.addPrecios(e.totalPriceNoIGV,e.totalPrice-e.totalPriceNoIGV,e.totalPrice),e.cliente_email&&i.addEmail(e.cliente_email),e.itemsVendidos.forEach((function(e){var t=new c("NIU",e.codigo,e.name+" | "+e.descripcion,e.cantidad,e.priceNoIGV,e.priceIGV,e.totalPriceNoIGV,e.totalPrice-e.totalPriceNoIGV,e.totalPrice);"UND"===e.unidadDeMedida?t.unidad_de_medida="NIU":"PAR"===e.unidadDeMedida?t.unidad_de_medida="PR":"CAJA"===e.unidadDeMedida&&(t.unidad_de_medida="BX"),i.addItem(t.toJSON())})),e.guia&&i.addGuide({guia_tipo:1,guia_serie_numero:n.serie.toString()+"-"+n.numero}),i.build().toJSON()}(e.ventResult,e.count,e.sunat_guia);else{if("factura"!==e.ventResult.documento.type)return t.json({message:"Succes||".concat(e.ventResult.codigo),_sunat:null});r=function(e,t,n){var r="";if(e.documento.codigo.toString().length<11)for(var a=0;a<11-e.documento.codigo.toString().length;a++)r+="0";var o=e.documento.codigo.toString().length<11?r+e.documento.codigo.toString():e.documento.codigo,i=new p(1,1+t,o,e.documento.name,e.codigo,x(e));return i.addPrecios(e.totalPriceNoIGV,e.totalPrice-e.totalPriceNoIGV,e.totalPrice),e.cliente_email&&i.addEmail(e.cliente_email),e.itemsVendidos.forEach((function(e){var t=new c("NIU",e.codigo,e.name+" | "+e.descripcion,e.cantidad,e.priceNoIGV,e.priceIGV,e.totalPriceNoIGV,e.totalPrice-e.totalPriceNoIGV,e.totalPrice);"UND"===e.unidadDeMedida?t.unidad_de_medida="NIU":"PAR"===e.unidadDeMedida?t.unidad_de_medida="PR":"CAJA"===e.unidadDeMedida&&(t.unidad_de_medida="BX"),i.addItem(t.toJSON())})),i.addDireccion(e.documento.direccion),e.guia&&i.addGuide({guia_tipo:1,guia_serie_numero:n.serie.toString()+"-"+n.numero}),i.build().toJSON()}(e.ventResult,e.count,e.sunat_guia)}o()("https://api.nubefact.com/api/v1/9e79db57-8322-4c1a-ac73-fa5093668c3c",{method:"post",headers:{"Content-Type":"application/json",Authorization:i.a.production.nbfToken},body:JSON.stringify(r)}).then((function(e){return e.json()})).then((function(t){e.sunat=t,n()})).catch((function(n){t.status(n.status||500).json({message:"Succes||".concat(e.ventResult.codigo),_sunat:null})}))}},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(3),a=n(8),o=n.n(a);function i(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}var s=new r.Schema({username:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0},hashPassword:{type:String},type:{type:String,required:!0,trim:!0},created_date:{type:Date,default:Date.now},displayName:{type:String,required:!0,trim:!0},email:{type:String,trim:!0,unique:!0},dirOne:{type:String,trim:!0},dirTwo:{type:String,trim:!0},reference:{type:String,trim:!0},ciudad:{type:String,trim:!0},nombre:{type:String,trim:!0},apellido:{type:String,trim:!0},nomape:{type:String},googleCod:{type:String,unique:!0},documento:{type:String,trim:!0},tipoPersona:{type:String},verified:{type:Boolean,default:!1},celular:{type:String},ventaActiva:{type:[String],default:[]},carrito:{type:String,default:"not"}});s.methods.comparePassword=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.a.compare(t,n);case 3:return r=e.sent,e.abrupt("return",r);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,c,"next",e)}function c(e){i(o,r,a,s,c,"throw",e)}s(void 0)}))});return function(e,n){return t.apply(this,arguments)}}()},function(e,t,n){"use strict";var r=n(3),a=n(7),o=new r.Schema({user:{type:String,trim:!0},rating:{type:Number,default:0},date:{type:Date,default:Date.now}},{_id:!1}),i=new r.Schema({name:{type:String,trim:!0,required:!0},nameSecond:{type:String,trim:!0},cantidad:{type:Number,min:0}},{_id:!1}),s=new r.Schema({name:{type:String,trim:!0,required:!0},nameSecond:{type:String,trim:!0},order:{type:[i]}},{_id:!1}),c=new r.Schema({date:{type:Date,default:Date.now},cantidad:{type:Number,default:0,min:0},tipo:{type:Boolean,default:!1},comentario:{type:String,trim:!0},costoVar:{type:Number},cantidadSC:{type:[a.a],default:[]},usuario:{type:String,default:"desconocido"}},{_id:!1}),u=new r.Schema({name:{type:String,required:!0,trim:!0,unique:!0},nameLowerCase:{type:String,trim:!0,lowercase:!0},priceIGV:{type:Number,required:!0},priceNoIGV:{type:Number},cantidad:{type:Number,default:0,min:0},subConteo:{type:s},variaciones:{type:[c]},codigo:{type:String,required:!0,trim:!0,unique:!0},tipo:{type:String,required:!0,trim:!0},subTipo:{type:String,default:"noone",trim:!0},unidadDeMedida:{type:String,default:"UND",trim:!0},oferta:{type:Number,default:0},date:{type:Date,default:Date.now},description:{type:String,trim:!0},photo:{type:String,trim:!0,default:"noPhoto.jpg"},ficha:{type:Boolean,default:!1},marca:{type:String,default:"noone"},costoPropio:{type:Number},multiSearchParams:{type:String,trim:!0},deleted:{type:Boolean,default:!1},tags:{type:[String],default:[]},caracteristicas:{type:[String],default:[]},orderNumber:{type:Number,default:-1},reviews:{type:[o],default:[]},googleCategory:{type:String,default:"2047"}});u.index({nameLowerCase:"text",tipo:"text",subTipo:"text",marca:"text",description:"text",tags:"text"}),t.a=u},function(e,t,n){"use strict";var r=n(3),a=n(7),o=new r.Schema({codigo:{type:String,required:!0,trim:!0,unique:!0},totalPrice:{type:Number,trim:!0,required:!0},totalPriceNoIGV:{type:Number,trim:!0,required:!0},estado:{type:String,trim:!0,required:!0},documento:{type:a.b},itemsVendidos:{type:[a.c],required:!0},date:{type:Date,default:Date.now},vendedor:{type:String},tipoVendedor:{type:String,default:"admin"},medio_de_pago:{type:String},linkComprobante:{type:String},serie:{type:String},tipoComprobante:{type:String},numero:{type:Number},cliente_email:{type:String},guia_serie:{type:String},guia_numero:{type:String},guia:{type:Boolean,default:!1},guia_link:{type:String},carrito_venta:{type:Boolean,default:!1},estado_carrito_comprando:{type:Boolean,default:!1}});t.a=o},function(e,t){e.exports=require("aws-sdk")},function(e,t){e.exports=require("excel4node")},function(e,t){e.exports=require("luxon")},function(e,t){e.exports=require("node-fetch")},function(e,t){e.exports=require("tinify")},function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return g}));var r=n(36),a=n(37),o=n.n(a),i=n(10),s=n.n(i),c=n(38);function u(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){u(o,r,a,i,s,"next",e)}function s(e){u(o,r,a,i,s,"throw",e)}i(void 0)}))}}var l=n(1).a.production,p=Object(c.promisify)(r.readFile),m=o.a.createTransport({host:l.BHOST,port:l.BPORT,secure:!1,auth:{user:l.BUSER,pass:l.BPASS}}),f=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p(s.a.resolve("server/lib/emailContacto.html"),{encoding:"utf8"});case 3:return r=e.sent,a=r.replace("#replaceWithLinkOne","Mensaje de ".concat(t.body.nombre," ").concat(t.body.apellido,", su correo es: ").concat(t.body.email)),o=a.replace("#replaceWithLinkTwo",t.body.mensaje),e.next=8,m.sendMail({from:"siriodinar-no-replay@siriodinar.com",to:l.BUSER,subject:"Mensaje Contacto",html:o});case 8:n.json({enviado:!0}),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p(s.a.resolve("server/lib/email.html"),{encoding:"utf8"});case 3:return r=e.sent,t.savedUSer.hashPassword=void 0,a="".concat(l.link,"auth/confirmacion/").concat(t.savedUSer._id),o=r.replace("#replaceWithLink",'<a style="width: 400px; font-size: 20px; text-align: center; margin-top: 0.67em" href="'.concat(a,'" target="_blank">').concat(a,"</a>")),e.next=9,m.sendMail({from:"siriodinar-no-replay@siriodinar.com",to:t.savedUSer.email,subject:"Confimar registro de cuenta en Sirio Dinar",html:o});case 9:n.json(t.savedUSer),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({link:!1}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}()}).call(this,"/")},function(e,t,n){"use strict";(function(e){var r=n(32),a=n.n(r),o=n(33),i=n.n(o),s=n(26),c=n.n(s),u=n(5),d=n.n(u),l=n(34),p=n.n(l),m=n(6),f=n.n(m),g=n(10),v=n.n(g),b=n(18),y=n.n(b),h=n(1),$=n(35),x=n(48),w=n(45),S=n(42),V=n(46),k=n(47);y.a.key=h.a.production.tinyKey;var _=d()(),j=h.a.production.log();_.use(p()()),_.use(a()()),_.use(i()()),_.options("*",c()({credentials:!0,origin:h.a.production.origin})),_.use(c()({credentials:!0,origin:h.a.production.origin})),_.use(d.a.json()),_.use(d.a.urlencoded({extended:!0})),_.use((function(e,t,n){if(e.headers&&e.headers.authorization&&"JWT"===e.headers.authorization.split(" ")[0]){var r=e.headers.authorization;f.a.verify(r.split(" ")[1],h.a.production.jwtKey,{audience:r.split(" ")[2]+" "+r.split(" ")[3]},(function(r,a){if(r)return e.user=void 0,t.status(401).json({message:"Usuario No Autorizado"});e.user=a,n()}))}else e.user=void 0,n()})),_.use("/inventario",V.a),_.use("/carrito",x.a),_.use("/auth",$.a),_.use("/ventas",k.a),_.use("/email",S.a),_.use("/coti",w.a),_.use("/static",d.a.static(v.a.join(e,"uploads"))),_.use((function(e,t,n,r){return n.status(e.status||500),j.error(e),j.info(e),n.json({error:{message:e.message}})})),t.a=_}).call(this,"/")},function(e,t){e.exports=require("imagemin")},function(e,t){e.exports=require("imagemin-webp")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("multer-s3")},function(e){e.exports=JSON.parse('{"name":"inv-mannager","version":"1.7.0","description":"Manejo General De Inventario De Sirio Dinar","main":"index.js","scripts":{"build":"webpack -p","start":"node ./dist/main.js","dev:start":"nodemon --exec babel-node ./bin/www.js | bunyan"},"keywords":["inventario","siriodinar"],"author":"Tac Etarip","license":"ISC","devDependencies":{"@babel/core":"^7.10.2","@babel/node":"^7.10.1","@babel/preset-env":"^7.10.2","babel-loader":"^8.1.0","eslint":"^7.30.0","webpack":"^4.43.0","webpack-cli":"^3.3.12","webpack-node-externals":"^2.5.0"},"dependencies":{"aws-sdk":"^2.713.0","axios":"^0.21.1","babel-polyfill":"^6.26.0","bcrypt":"^5.0.0","body-parser":"^1.19.0","bunyan":"^1.8.14","compression":"^1.7.4","cookie-parser":"^1.4.5","cors":"^2.8.5","dotenv":"^8.2.0","excel4node":"^1.7.2","express":"^4.17.1","helmet":"^3.23.3","imagemin":"^7.0.1","imagemin-webp":"^6.0.0","jsonwebtoken":"^8.5.1","luxon":"^1.26.0","mongoose":"^5.12.14","multer":"^1.4.2","multer-s3":"^2.9.0","node-fetch":"^2.6.1","nodemailer":"^6.4.17","passport":"^0.4.1","passport-google-oauth":"^2.0.0","passport-google-oauth20":"^2.0.0","pdfkit":"^0.11.0","pdfmake":"^0.1.70","replace-in-file":"^6.1.0","sitemap":"^7.0.0","throng":"^5.0.0","tinify":"^1.6.0-beta.2"},"engines":{"node":"12.18.x"}}')},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("throng")},function(e,t){e.exports=require("bunyan")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("helmet")},function(e,t,n){"use strict";var r=n(5),a=n(19),o=n(0),i=new r.Router;i.use(o.x.initialize()),i.post("/cambiarContrasena",o.f,o.g),i.post("/confirmarContr",o.f,o.h),i.put("/actCelular",o.f,o.a),i.put("/actCelular",o.f,o.a),i.post("/agregarDireccion",o.f,o.c),i.post("/agregarDocumento",o.f,o.d),i.post("/register",o.y),i.get("/google/callback",o.x.authenticate("google",{failureRedirect:"/failed",session:!1}),o.q,o.t),i.get("/google",o.x.authenticate("google",{scope:["profile","email"],session:!1})),i.post("/login",o.s),i.get("/userEx/:username",o.D),i.get("/emailEx/:email",o.k),i.post("/registerlow",o.z,a.a),i.post("/isValid",o.r),i.get("/confirmacion/:idUser",o.i),i.post("/loginfast",o.u,o.j),i.post("/loginGoogleRegistro",o.A),i.post("/getLoginInfoFromToken",o.l),i.get("/getUserInfo/:username",o.f,o.n),i.get("/getOwnUser",o.f,o.m),t.a=i},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("passport-google-oauth20")},function(e,t){e.exports=require("pdfmake")},function(e,t,n){"use strict";var r=n(5),a=n.n(r),o=n(19),i=a.a.Router();i.post("/enviarMensaje",o.b),t.a=i},function(e){e.exports=JSON.parse('{"operacion":"generar_guia","tipo_de_comprobante":7,"serie":"TTT1","numero":1800,"cliente_tipo_de_documento":6,"cliente_numero_de_documento":"20517738701","cliente_denominacion":"CLINICA JESUS DEL NORTE S.A.C","cliente_direccion":"","cliente_email":"","cliente_email_1":"","cliente_email_2":"","fecha_de_emision":"2020-12-16T00:00:00","observaciones":"","motivo_de_traslado":"01","peso_bruto_total":0,"numero_de_bultos":10,"tipo_de_transporte":"02","fecha_de_inicio_de_traslado":"2020-12-16T00:00:00","transportista_documento_tipo":6,"transportista_documento_numero":"20538260674","transportista_denominacion":"AQUALIV SAC","transportista_placa_numero":"AVD-798","conductor_documento_tipo":1,"conductor_documento_numero":"40513206","conductor_denominacion":"DIAZ RIVERA HELMER","punto_de_partida_ubigeo":"PROV0008","punto_de_partida_direccion":"AV. PROLONGACION CHILLON MZ B LT 1 INT 1","punto_de_llegada_ubigeo":"PROV0008","punto_de_llegada_direccion":"AV. CARLOS IZAGUIRRE NRO. 153 Z.I. NORTE LIMA - LIMA - INDE","enviar_automaticamente_a_la_sunat":true,"enviar_automaticamente_al_cliente":true,"codigo_unico":"","formato_de_pdf":"","items":[]}')},function(e,t){e.exports=require("pdfkit")},function(e,t,n){"use strict";var r=n(5),a=n(14),o=n.n(a),i=n(3),s=n.n(i),c=n(1),u=n(15),d=n.n(u);function l(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}var f=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n,r,a,o,i,s){var c,u,l,p,m,f,y,h,$,x=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(c=x.length>7&&void 0!==x[7]?x[7]:[],e.prev=1,u=new d.a.Workbook,l=u.addWorksheet(t,{sheetFormat:{defaultRowHeight:20,defaultColWidth:20},pageSetup:{orientation:"portrait"}}),p=u.createStyle({font:{color:"black",size:12,bold:!0},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"},top:{style:"thin",color:"#15181C"}},alignment:{vertical:"center",wrapText:!0},numberFormat:"[$S/-es-PE]#,##0.00"}),m=u.createStyle({font:{color:"black",size:12,bold:!0},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"}},alignment:{vertical:"center",wrapText:!0},numberFormat:"[$S/-es-PE]#,##0.00",fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),l.column(1).setWidth(5),l.column(2).setWidth(15),l.column(3).setWidth(15),l.column(4).setWidth(15),l.column(5).setWidth(60),l.column(6).setWidth(15),l.column(7).setWidth(15),l.column(8).setWidth(15),f=15,y=b(l,a.itemsVendidos,f,p,m,f,s),v(u,l,r,f-1),g(u,l,n,a,i.observaciones),l.cell(y,7).string("Sub Total").style(p).style({font:{size:14,bold:!0,color:"white"},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),l.cell(y,8).formula("SUBTOTAL(9,H5:H".concat(y-1,")")).style(p).style({font:{size:14,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),l.cell(y+1,7).string("IGV").style(p),l.cell(y+1,8).formula("H".concat(y," * ",.18)).style(p),l.cell(y+2,7).string("Envio").style(p).style({font:{size:14,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),l.cell(y+2,8).number(i.envio||0).style(p).style({font:{size:12,bold:!1,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),l.cell(y+3,7).string("Otro").style(p).style({font:{size:14,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),l.cell(y+3,8).number(i.otro||0).style(p).style({font:{size:12,bold:!1,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),l.cell(y+4,7).string("Total").style(p).style({font:{size:14,bold:!0,color:"white"},fill:{type:"pattern",patternType:"solid",fgColor:"#005087"}}),l.cell(y+4,8).formula("H".concat(y," + H").concat(y+1," + H").concat(y+2," + H").concat(y+3)).style(p).style({font:{size:14,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),l.cell(y+1,1,y+1,5,!0).style(p).string("BCP - SOLES: 570-2650880-0-39").style({font:{size:12,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),l.cell(y+2,1,y+2,5,!0).style(p).string("C.C.I. - SOLES: 002-57000265088003903").style({font:{size:12,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),i.porPagar&&l.cell(y+3,1,y+3,5,!0).style(p).string("SALDO A CANCELAR S/"+(i.porPagar.toString()||"")).style({font:{size:12,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"#f1a054"}}),l.row(y).setHeight(20),l.row(y+1).setHeight(20),l.row(y+2).setHeight(20),l.row(y+3).setHeight(20),l.row(y+4).setHeight(20),h=1;h<f-1;h++)l.row(h).setHeight(20);return l.setPrintArea(1,1,y+4,8),l.addImage({image:o,type:"picture",position:{type:"absoluteAnchor",x:"1.5mm",y:"1.5mm"}}),s&&c.forEach((function(e,t){l.addImage({image:e.Body,type:"picture",position:{type:"twoCellAnchor",from:{col:2,colOff:"1mm",row:f+t,rowOff:"1mm"},to:{col:2,colOff:"35mm",row:f+t,rowOff:"35mm"}}})})),e.next=42,u.writeToBuffer();case 42:return $=e.sent,e.abrupt("return",$);case 46:throw e.prev=46,e.t0=e.catch(1),new Error(e.t0);case 49:case"end":return e.stop()}}),e,null,[[1,46]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){m(o,r,a,i,s,"next",e)}function s(e){m(o,r,a,i,s,"throw",e)}i(void 0)}))});return function(e,n,r,a,o,i,s){return t.apply(this,arguments)}}(),g=function(e,t,n,r,a){var o=e.createStyle({font:{color:"white",size:16,bold:!0},alignment:{horizontal:"center",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#005087"}});t.cell(4,5,4,8,!0).string(r.codigo).style(o).style({font:{color:"black",size:12,bold:!1},fill:{fgColor:"white"}});var i=new Date(r.date);t.cell(5,5,5,8,!0).date(i.toLocaleDateString()).style(o).style({font:{color:"black",size:14,bold:!1},fill:{fgColor:"white"}}).style({numberFormat:"dd-mm-yyy"}),t.cell(6,5,6,8,!0).string("Sirio Dinar - RUC: 20605746587").style(o).style({font:{color:"#005087",size:12,bold:!0},fill:{fgColor:"white"}}),t.cell(7,5,7,8,!0).link("https://inventario.siriodinar.com").style(o).style({font:{color:"#e87200",size:12,bold:!0},fill:{fgColor:"white"}}),t.cell(9,5,9,8,!0).string("Observaciones:").style(o).style({font:{color:"white",size:12,bold:!0},alignment:{horizontal:"left"},fill:{fgColor:"#005087"},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"},top:{style:"thin",color:"#15181C"}}}),t.cell(10,5,13,8,!0).string(a||"").style(o).style({font:{color:"black",size:12,bold:!1},fill:{fgColor:"white"},alignment:{horizontal:"left",vertical:"center"},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"},top:{style:"thin",color:"#15181C"}}}),t.cell(10,1,10,4,!0).string("Enviar a:").style(o).style({font:{color:"white",size:12,bold:!0},alignment:{horizontal:"left"},fill:{fgColor:"#005087"},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"},top:{style:"thin",color:"#15181C"}}}),t.cell(11,1,13,4,!0).string("".concat(r.documento.name," | ").concat(r.documento.codigo," ").concat(r.cliente_email?"\nemail: "+r.cliente_email:""," ").concat(r.celular_cliente?"\nCelular: "+r.celular_cliente:"")).style(o).style({font:{color:"black",size:12,bold:!1},fill:{fgColor:"white"},alignment:{horizontal:"left",vertical:"center",wrapText:!0},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"},top:{style:"thin",color:"#15181C"}}}),t.cell(7,1,7,4,!0).string("Jr. Pardo y Aliaga Nro. 207. Trujillo - Perú").style(o).style({font:{color:"black",size:12,bold:!0},fill:{fgColor:"white"},alignment:{horizontal:"left"}}),t.cell(8,1,8,4,!0).string("+51 977 426 349 | +51 922 412 404").style(o).style({font:{color:"black",size:12,bold:!0},fill:{fgColor:"white"},alignment:{horizontal:"left"}})},v=function(e,t,n,r){var a,o=e.createStyle({font:{color:"white",size:12,bold:!0},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"}},alignment:{horizontal:"center",vertical:"center",wrapText:!0},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),i=1,s=l(n);try{for(s.s();!(a=s.n()).done;){var c=a.value;t.cell(r,i).string(c).style(o),i++}}catch(e){s.e(e)}finally{s.f()}t.row(r).filter({firstColumn:1,lastColumn:n.length}),t.row(r).setHeight(40)},b=function e(t,n,r,a,o,i,s){var c,u=r-i;if(u>=n.length)return i;s?t.row(r).setHeight(85):t.row(r).setHeight(35),c=r%2==0?o:a,t.cell(r,1).number(u+1).style(c).style({numberFormat:"0"}).style({alignment:{horizontal:"center"}}),t.cell(r,2).string("").style(c).style({alignment:{wrapText:!0}}),t.cell(r,3).string(n[u].unidadDeMedida||"UND").style(c).style({alignment:{wrapText:!0,horizontal:"center"}}),t.cell(r,4).string(n[u].name).style(c).style({alignment:{horizontal:"center",wrapText:!0}});var d=n[u].descripcion||"";if(n[u].cantidadSC&&n[u].cantidadSC.length>0){d+=". Detalle:";for(var l=0;l<n[u].cantidadSC.length;l++)n[u].cantidadSC[l].cantidadVenta>0&&(d=d+" ".concat(n[u].cantidadSC[l].name," ").concat(n[u].cantidadSC[l].nameSecond?"- ".concat(n[u].cantidadSC[l].nameSecond,": "):": ")+n[u].cantidadSC[l].cantidadVenta+"".concat(n[u].cantidadSC.length+1<l?",":"."))}return t.cell(r,5).string(d).style(c).style({alignment:{wrapText:!0}}),t.cell(r,6).number(n[u].cantidad).style(c).style({numberFormat:"0"}).style({alignment:{horizontal:"center"}}),t.cell(r,7).number(n[u].priceNoIGV).style(c),t.cell(r,8).formula("F".concat(r," * G").concat(r)).style(c),1+e(t,n,r+1,a,o,i,s)},y=n(41),h=n.n(y),$=(n(10),n(16)),x=void 0;function w(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||V(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=V(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function V(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}new o.a.S3({accessKeyId:c.a.production.awsID,secretAccessKey:c.a.production.awsKey,Bucket:c.a.production.bucket,region:"us-east-1"});var _=new h.a({Courier:{normal:"Courier",bold:"Courier-Bold",italics:"Courier-Oblique",bolditalics:"Courier-BoldOblique"},Helvetica:{normal:"Helvetica",bold:"Helvetica-Bold",italics:"Helvetica-Oblique",bolditalics:"Helvetica-BoldOblique"},Times:{normal:"Times-Roman",bold:"Times-Bold",italics:"Times-Italic",bolditalics:"Times-BoldItalic"},Symbol:{normal:"Symbol"},ZapfDingbats:{normal:"ZapfDingbats"}}),j={pageMargins:[40,40,40,50],content:[{style:"tableEnviar",table:{widths:["*","*"],body:[[{image:"",width:100,border:[!1,!1,!1,!1],style:"headerTitle"},{text:[{text:"",fontSize:18,bold:!0},{text:"\nSirio Dinar - RUC: 20605746587",color:"darkblue",fontSize:12},{text:"\ninventario.siriodinar.com",color:"orange",fontSize:12}],rowSpan:2,alignment:"center",style:"headerTitlePrinc",border:[!0,!0,!0,!1]}],[{text:"Jr. Pardo y Aliaga Nro. 207. Trujillo - Perú \n +51 977 426 349 | +51 922 412 404",width:100,height:100,border:[!1,!1,!1,!1],style:"headerTitle"}]]}},{style:"tableEnviar",table:{heights:[15,60],widths:[165,331],body:[[{text:"Enviar a:",fillColor:"#005087",bold:!0,color:"#EAF6FF",style:"tableMargin"},{text:"Observaciones:",fillColor:"#005087",bold:!0,color:"#EAF6FF",style:"tableMargin"}],[{text:"",border:[!0,!0,!0,!1],style:"tableMargin"},{text:"RR",border:[!0,!0,!0,!1],style:"tableMargin"}]]}},{style:"tableHeader",table:{heights:[15],widths:[15,97,35,70,120,35,35,35],body:[[{text:"Nº",style:"tableMarginSH"},{text:"IMAGÉN",style:"tableMarginSH"},{text:"UDM",style:"tableMarginSH"},{text:"NOMBRE",style:"tableMarginSH"},{text:"DESCRIPCIÓN",style:"tableMarginSH"},{text:"CANT.",style:"tableMarginSH"},{text:"P/CU",style:"tableMarginSH"},{text:"TOTAL",style:"tableMarginSH"}]]}},{layout:{paddingTop:function(e,t){return C(t,e,"center"),0}},style:{fontSize:10,bold:!1,alignment:"center"},table:{dontBreakRows:!0,heights:40,widths:[15,97,35,70,120,35,35,35],body:[]}},{style:"totales",table:{dontBreakRows:!0,heights:15,widths:[79,79],body:[[{text:"Sub Total:",border:[!0,!1,!1,!0],fillColor:"#E87100",color:"white",style:"totalesMargin"},{text:"S/ 111.00",border:[!0,!1,!0,!0],alignment:"right",style:"totalesMargin"}],[{text:"IGV:",color:"grey",style:"totalesMargin"},{text:"S/ 111.00",alignment:"right",color:"grey",style:"totalesMargin"}],[{text:"Envio:",color:"grey",style:"totalesMargin"},{text:"S/ 111.00",alignment:"right",color:"grey",style:"totalesMargin"}],[{text:"Otro:",color:"grey",style:"totalesMargin"},{text:"S/ 111.00",alignment:"right",color:"grey",style:"totalesMargin"}],[{text:"Total:",fillColor:"#005087",color:"white",style:"totalesMargin"},{text:"S/ 111.00",alignment:"right",style:"totalesMargin"}]]}}],styles:{totalesMargin:{margin:[0,5,0,0]},tableMarginSH:{margin:[0,5,0,0],fillColor:"#E87100",color:"#EAF6FF"},tableMargin:{fontSize:10,margin:[2,5,2,2]},headerTitlePrinc:{margin:[0,40,0,0],fontSize:14},headerTitle:{margin:[0,0,0,5]},header:{fontSize:18,bold:!0,margin:[10,10,10,10]},subheader:{fontSize:16,bold:!0,margin:[0,10,10,10]},tableEnviar:{margin:[0,0,0,0]},tableHeader:{bold:!0,fontSize:10,alignment:"center"},totales:{margin:[338,0,0,0]},marginSN:{margin:[2,12,2,6]}},defaultStyle:{font:"Helvetica",lineHeight:1.2}},C=function(e,t,n){var r=e.table.body[t].map((function(t,n){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=function(e){if(void 0===e)return{height:0,width:0};var r,a=0,o=S(e);try{for(o.s();!(r=o.n()).done;){var i=r.value;(n+=i.width)>t?(a+=i.height,n=i.width):a=Math.max(i.height,a)}}catch(e){o.e(e)}finally{o.f()}return{height:a,width:n}};if(e._offsets&&(n+=e._offsets.total),e._inlines&&e._inlines.length)return r(e._inlines);if(e.stack&&e.stack[0])return e.stack.map((function(e){return r(e._inlines)})).reduce((function(e,t){return{height:e.height+t.height,width:Math.max(e.width+t.width)}}));if(e.table){var a,o=0,i=S(e.table.body);try{for(i.s();!(a=i.n()).done;){var s=a.value,c=s.map((function(e){var r=x.findInlineHeight(e,t,n);return n=r.width,r.height}));o=Math.max.apply(Math,w(c).concat([o]))}}catch(e){i.e(e)}finally{i.f()}return{height:o,width:n}}return e._height?(n+=e._width,{height:e._height,width:n}):{height:null,width:n}}(t,e.table.widths[n]._calcWidth).height})),a=Math.max.apply(Math,w(r));e.table.body[t].forEach((function(e,t){var o;r[t]&&a>r[t]&&("bottom"===n?o=a-r[t]:"center"===n&&(o=(a-r[t])/2),e._margin?e._margin[1]=o:e._margin=[0,o,0,0])}))},R=function(e,t,n,r,a){I(e,t,n),a?(j.content[2].table={heights:[15],widths:[15,97,35,70,120,35,35,35],body:[[{text:"Nº",style:"tableMarginSH"},{text:"IMAGÉN",style:"tableMarginSH"},{text:"UDM",style:"tableMarginSH"},{text:"NOMBRE",style:"tableMarginSH"},{text:"DESCRIPCIÓN",style:"tableMarginSH"},{text:"CANT.",style:"tableMarginSH"},{text:"P/CU",style:"tableMarginSH"},{text:"TOTAL",style:"tableMarginSH"}]]},j.content[3].table={dontBreakRows:!0,heights:40,widths:[15,97,35,70,120,35,35,35],body:[]}):(j.content[2].table={heights:[15],widths:[20,35,83,193,40,40,40],body:[[{text:"Nº",style:"tableMarginSH"},{text:"UDM",style:"tableMarginSH"},{text:"NOMBRE",style:"tableMarginSH"},{text:"DESCRIPCIÓN",style:"tableMarginSH"},{text:"CANT.",style:"tableMarginSH"},{text:"P/CU",style:"tableMarginSH"},{text:"TOTAL",style:"tableMarginSH"}]]},j.content[3].table={heights:50,dontBreakRows:!0,widths:[20,35,83,193,40,40,40],body:[]}),P(t,r,a);var o=0;n.envio&&(o=n.envio);var i=0;return n.otro&&(i=n.otroR),j.content[4].table.body[0][1].text="S/ "+t.totalPriceNoIGV.toFixed(2),j.content[4].table.body[1][1].text="S/ "+(Math.round(100*(t.totalPrice-t.totalPriceNoIGV))/100).toFixed(2),j.content[4].table.body[2][1].text="S/ "+o.toFixed(2),j.content[4].table.body[3][1].text="S/ "+i.toFixed(2),j.content[4].table.body[4][1].text="S/ "+((n.otro||0)+(n.envio||0)+t.totalPrice).toFixed(2),_.createPdfKitDocument(j)},I=function(e,t,n){var r=$.DateTime.fromJSDate(t.date).toFormat("c LL yyyy").toLocaleString();j.content[0].table.body[0][0].image=e,j.content[0].table.body[0][1].text[0].text="".concat(t.codigo,"\n").concat(r.split(" ").join("/")),j.content[1].table.body[1][1].text=n.observaciones,j.content[1].table.body[1][0].text="".concat(t.documento.name," | ").concat(t.documento.codigo).concat(t.cliente_email?"\nemail: ".concat(t.cliente_email):"").concat("+51"===t.celular_cliente?"":"\nCelular:".concat(t.celular_cliente))},P=function(e,t,n){var r=[];e.itemsVendidos.forEach((function(e,a){var o=e.descripcion||"";if(e.cantidadSC&&e.cantidadSC.length>0){o+=". Detalle:";for(var i=0;i<e.cantidadSC.length;i++)e.cantidadSC[i].cantidadVenta>0&&(o=o+" ".concat(e.cantidadSC[i].name," ").concat(e.cantidadSC[i].nameSecond?"- ".concat(e.cantidadSC[i].nameSecond,": "):": ")+e.cantidadSC[i].cantidadVenta+"".concat(e.cantidadSC.length+1<i?",":"."))}n?r.push([{text:a+1,style:"tableMarginN"},{image:t[a].Body,width:95,height:95},{text:e.unidadDeMedida,style:"tableMarginN"},{text:e.name,style:"tableMarginN"},{text:o,alignment:"justify"},{text:e.cantidad.toString(),style:"tableMarginN"},{text:"S/"+e.priceNoIGV.toString(),style:"tableMarginN"},{text:"S/"+e.totalPriceNoIGV.toString(),style:"tableMarginN"}]):r.push([{text:a+1,style:"marginSN"},{text:e.unidadDeMedida,style:"marginSN"},{text:e.name,style:"marginSN"},{text:o,alignment:"justify",style:"marginSN"},{text:e.cantidad.toString(),style:"marginSN"},{text:"S/"+e.priceNoIGV.toString(),style:"marginSN"},{text:"S/"+e.totalPriceNoIGV.toString(),style:"marginSN"}]),j.content[3].table.body=r}))},T=n(7),A=new i.Schema({codigo:{type:String,required:!0,trim:!0,unique:!0},totalPrice:{type:Number,trim:!0,required:!0},totalPriceNoIGV:{type:Number,trim:!0,required:!0},estado:{type:String,trim:!0,required:!0},documento:{type:T.b},itemsVendidos:{type:[T.c],required:!0},date:{type:Date,default:Date.now},vendedor:{type:String},tipoVendedor:{type:String,default:"admin"},cliente_email:{type:String,trim:!0},celular_cliente:{type:String,trim:!0}});function N(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){N(o,r,a,i,s,"next",e)}function s(e){N(o,r,a,i,s,"throw",e)}i(void 0)}))}}var G=s.a.model("Cotizacion",A),M=new o.a.S3({accessKeyId:c.a.production.awsID,secretAccessKey:c.a.production.awsKey,Bucket:c.a.production.bucket,region:"us-east-1"}),E=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.body.venta._id=void 0,t.body.venta.codigo=void 0,r=new G(t.body.venta),e.next=6,U();case 6:return r.codigo=e.sent,r.celular_cliente=q(t.body.venta.celular_cliente),e.next=10,r.save();case 10:a=e.sent,n.json({message:"Cotización generada con el codigo: ".concat(a.codigo),coti:a}),e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,n){return e.apply(this,arguments)}}(),D=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noone"!==t.body.dateOne&&"noone"!==t.body.dateTwo){e.next=7;break}return e.next=4,G.find({estado:t.body.estado}).skip(parseInt(t.body.skip)).limit(parseInt(t.body.limit));case 4:r=e.sent,e.next=10;break;case 7:return e.next=9,G.find({estado:t.body.estado,date:{$gte:new Date(t.body.dateOne),$lt:new Date(t.body.dateTwo)}}).skip(parseInt(t.body.skip)).limit(parseInt(t.body.limit));case 9:r=e.sent;case 10:n.json(r),e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}(),U=function(){var e=O(regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G.countDocuments({});case 3:for(e.t0=e.sent,t=e.t0+1,n="COTSD01-000000",r=0;r<t.toString().length;r++)n=n.slice(0,-1);return a=n+t.toString(),e.abrupt("return",a);case 11:return e.prev=11,e.t1=e.catch(0),e.abrupt("return",res.status(500).json({errorMSG:e.t1}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split(" ").join("");return e.startsWith("+")||(t="+51"+e.split(" ").join("")),t},F=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G.findOne({codigo:t.params.cotiCod});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),L=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G.aggregate([{$match:{codigo:t.body.codCoti}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}},{$match:{$or:[{"cantidadSC.cantidadVenta":{$gt:0}},{cantidadSC:null}]}}]);case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),B=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G.aggregate([{$match:{codigo:t.body.codigoCoti}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}},{$count:"thisItem"}]);case 3:if(0===e.sent.length){e.next=14;break}return e.next=7,G.aggregate([{$match:{codigo:t.body.codigoCoti}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}}]);case 7:return r=e.sent,a=Math.round(100*(r[0].totalPrice-t.body.itemVendido.totalPrice+Number.EPSILON))/100*-1,o=Math.round(100*(r[0].totalPriceNoIGV-t.body.itemVendido.totalPriceNoIGV+Number.EPSILON))/100*-1,e.next=12,G.findOneAndUpdate({codigo:t.body.codigoCoti,itemsVendidos:{$elemMatch:{codigo:t.body.itemVendido.codigo}}},{$set:{"itemsVendidos.$":t.body.itemVendido},$inc:{totalPrice:a,totalPriceNoIGV:o}},{useFindAndModify:!1,new:!0});case 12:return i=e.sent,e.abrupt("return",n.json({message:"Cantidades actualizadas",coti:i}));case 14:return e.next=16,G.findOneAndUpdate({codigo:t.body.codigoCoti},{$push:{itemsVendidos:t.body.itemVendido},$inc:{totalPrice:t.body.itemVendido.totalPrice,totalPriceNoIGV:t.body.itemVendido.totalPriceNoIGV}},{useFindAndModify:!1,new:!0});case 16:s=e.sent,n.json({message:"Item agregado correctamente",coti:s}),e.next=23;break;case 20:return e.prev=20,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t,n){return e.apply(this,arguments)}}(),z=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G.findOneAndUpdate({codigo:t.body.codigo},{$inc:{totalPrice:-1*t.body.totalPrice,totalPriceNoIGV:-1*t.body.totalPriceNoIGV},$pull:{itemsVendidos:{codigo:t.body.codigoItem}}},{useFindAndModify:!1,new:!0});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),H=function(){var e=O(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G.findOneAndUpdate({codigo:t.body.codigo},{estado:"eliminada"});case 3:n.json({eliminada:!0}),e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}(),K=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.getObject({Bucket:c.a.production.bucket,Key:"sirio-logo-small.png"}).promise();case 3:return r=e.sent,e.next=6,G.findOne({codigo:t.body.codigo});case 6:if(a=e.sent,o=[],!t.body.imagen){e.next=19;break}i=0;case 10:if(!(i<a.itemsVendidos.length)){e.next=19;break}return e.t0=o,e.next=14,M.getObject({Bucket:c.a.production.bucket,Key:a.itemsVendidos[i].photo}).promise();case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:i++,e.next=10;break;case 19:return e.next=21,f("Cotización","Temp Coti",["Nº","IMAGÉN","UNIDAD DE MEDIDA","NOMBRE","DESCRIPCIÓN","CANTIDAD","P/CU","TOTAL"],a,r.Body,t.body.extra,t.body.imagen,o);case 21:s=e.sent,n.writeHead(200,{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":"attachment; filename=".concat(a.codigo,".xlsx")}),n.write(s,"binary"),n.end(null,"binary"),e.next=30;break;case 27:return e.prev=27,e.t2=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t2}));case 30:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t,n){return e.apply(this,arguments)}}(),W=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G.findOne({codigo:t.body.codigo});case 3:return r=e.sent,e.next=6,M.getObject({Bucket:c.a.production.bucket,Key:"sirio-logo-small.png"}).promise();case 6:if(a=e.sent,o=[],!t.body.imagen){e.next=19;break}i=0;case 10:if(!(i<r.itemsVendidos.length)){e.next=19;break}return e.t0=o,e.next=14,M.getObject({Bucket:c.a.production.bucket,Key:r.itemsVendidos[i].photo}).promise();case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:i++,e.next=10;break;case 19:s=R(a.Body,r,t.body.extra,o,t.body.imagen),n.setHeader("Content-Type","application/pdf"),n.setHeader("Content-Disposition","attachment; filename=quote.pdf"),s.pipe(n),s.end(),e.next=29;break;case 26:return e.prev=26,e.t2=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t2}));case 29:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(t,n){return e.apply(this,arguments)}}(),J=n(0),Q=new r.Router;Q.post("/generarCoti",J.C,E),Q.post("/getPendientes",J.C,D),Q.get("/obtenerCoti/:cotiCod",J.C,F),Q.post("/cotiForCard",J.C,L),Q.post("/agregarItemCoti",J.C,B),Q.post("/eliminarItemCoti",J.C,z),Q.put("/eliminarCoti",J.C,H),Q.post("/getPdfCoti",J.C,W),Q.post("/getExcelCoti",J.C,K);t.a=Q},function(e,t,n){"use strict";var r=n(5),a=n(2),o=n(3),i=n.n(o),s=n(12),c=new o.Schema({name:{type:String,required:!0,unique:!0,trim:!0},date:{type:Date,default:Date.now},codigo:{type:String},subTipo:{type:[String],trim:!0},subTipoLink:{type:[String],trim:!0},deleted:{type:Boolean,default:!1},link:{type:String,default:"noPhoto.jpg"},order:{type:Number,default:-1}});function u(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){u(o,r,a,i,s,"next",e)}function s(e){u(o,r,a,i,s,"throw",e)}i(void 0)}))}}var l=i.a.model("Tipo",c),p=i.a.model("Item",s.a),m=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=new Date).setDate(r.getDate()-7),e.next=5,l.find({deleted:!1});case 5:return a=e.sent,e.next=8,p.find({deleted:!1});case 8:for(o=e.sent,i=[{url:"store/main",priority:1,changefreq:"monthly"},{url:"servicio-al-cliente/contactanos",priority:.8,changefreq:"monthly"},{url:"carrito",priority:.7,changefreq:"monthly"},{url:"servicio-al-cliente/terminos-y-condiciones",priority:.3,changefreq:"monthly"},{url:"servicio-al-cliente/politica-de-privacidad",priority:.3,changefreq:"monthly"},{url:"servicio-al-cliente/politica-de-devolucion",priority:.3,changefreq:"monthly"},{url:"servicio-al-cliente/politica-de-envio",priority:.3,changefreq:"monthly"},{url:"/",priority:1,changefreq:"monthly"},{url:"store/categorias",priority:.9,changefreq:"weekly"}],s=0;s<a.length;s++)for(i.push({url:"store/categorias/"+a[s].name,priority:.7,changefreq:"daily"}),c=0;c<a[s].subTipo.length;c++)i.push({url:"store/categorias/"+a[s].name+"/"+a[s].subTipo[c],priority:.6,changefreq:"daily"});for(u=0;u<o.length;u++)i.push({url:"store/categorias/"+o[u].tipo+"/"+o[u].subTipo+"/"+o[u].codigo,priority:.5,changefreq:"daily"});n.json(i),e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",n.status(500).end());case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=new l(t.body)).codigo=Date.now().toString(),r.subTipo=[],e.next=6,r.save();case 6:return a=e.sent,e.abrupt("return",n.json(a));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.findOne({name:t.body.codigo});case 3:if(!((r=e.sent).subTipo.indexOf(t.body.subTipo)>-1)){e.next=6;break}return e.abrupt("return",n.json(null));case 6:return e.next=8,l.updateOne({codigo:r.codigo},{$push:{subTipo:t.body.subTipo,subTipoLink:"noPhoto.jpg"}});case 8:return e.abrupt("return",n.json({message:"succes"}));case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}(),v=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.find({deleted:!1}).sort({order:1});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),b=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.findOne({name:t.params.tipoCod}).select("subTipo -_id");case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.findOne({name:t.params.codigo});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),h=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.startSession();case 2:return(r=e.sent).startTransaction(),e.prev=4,e.next=7,l.findOne({codigo:t.body.codigo});case 7:return a=e.sent,t.beforeName=a.name,e.next=11,l.findOneAndUpdate({codigo:t.body.codigo},{name:t.body.tipoName},{new:!0,useFindAndModify:!1});case 11:return o=e.sent,t.newTipo=o,e.next=15,p.updateMany({tipo:t.beforeName},{tipo:t.body.tipoName},{new:!0,useFindAndModify:!1,runValidators:!0});case 15:return e.next=17,r.commitTransaction();case 17:r.endSession(),n.json(t.newTipo),e.next=27;break;case 21:return e.prev=21,e.t0=e.catch(4),e.next=25,r.abortTransaction();case 25:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 27:case"end":return e.stop()}}),e,null,[[4,21]])})));return function(t,n){return e.apply(this,arguments)}}(),$=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.startSession();case 2:return(r=e.sent).startTransaction(),e.prev=4,e.next=7,l.findOne({name:t.body.codigo});case 7:if(!((a=e.sent).subTipo.indexOf(t.body.newSubName)>-1)){e.next=10;break}return e.abrupt("return",n.json(null));case 10:return o=a.subTipo.indexOf(t.body.antiguoSubName),a.subTipo[o]=t.body.newSubName,e.next=14,l.findOneAndUpdate({name:t.body.codigo},{subTipo:a.subTipo},{new:!0,useFindAndModify:!1});case 14:return e.next=16,p.updateMany({subTipo:t.body.antiguoSubName},{subTipo:t.body.newSubName},{new:!0,useFindAndModify:!1});case 16:return s=e.sent,e.next=19,r.commitTransaction();case 19:r.endSession(),n.json(s),e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(4),e.next=27,r.abortTransaction();case 27:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 29:case"end":return e.stop()}}),e,null,[[4,23]])})));return function(t,n){return e.apply(this,arguments)}}(),x=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.startSession();case 2:return(r=e.sent).startTransaction(),e.prev=4,e.next=7,l.findOne({name:t.params.codigo});case 7:return a=e.sent,o=a.subTipo.indexOf(t.params.subTipoName),a.subTipo.splice(o,1),e.next=12,l.findOneAndUpdate({name:t.params.codigo},{subTipo:a.subTipo},{new:!0,useFindAndModify:!1});case 12:return e.next=14,p.updateMany({subTipo:t.params.subTipoName},{deleted:!0});case 14:return s=e.sent,e.next=17,r.commitTransaction();case 17:return r.endSession(),e.abrupt("return",n.json(s));case 21:return e.prev=21,e.t0=e.catch(4),e.next=25,r.abortTransaction();case 25:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 27:case"end":return e.stop()}}),e,null,[[4,21]])})));return function(t,n){return e.apply(this,arguments)}}(),w=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.findOneAndUpdate({codigo:t.params.codigo},{link:t.fileName},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.status(200).json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),S=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.findOne({name:t.params.codigo});case 3:return r=e.sent,a=r.subTipo.findIndex((function(e){return e===t.params.subCat})),r.subTipoLink[a]=t.fileName,e.next=8,l.findOneAndUpdate({name:t.params.codigo},{subTipoLink:r.subTipoLink},{new:!0,useFindAndModify:!1});case 8:e.sent,n.status(200).json({newPhoto:r.subTipoLink[a]}),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),V=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.startSession();case 2:return(r=e.sent).startTransaction(),e.prev=4,e.next=7,l.findOneAndUpdate({codigo:t.params.codigo},{deleted:!0},{new:!0,useFindAndModify:!1});case 7:return a=e.sent,t.tipoDeleted=a,e.next=11,p.updateMany({tipo:t.tipoDeleted.name},{deleted:!0});case 11:return e.next=13,r.commitTransaction();case 13:r.endSession(),n.json(t.tipoDeleted),e.next=23;break;case 17:return e.prev=17,e.t0=e.catch(4),e.next=21,r.abortTransaction();case 21:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 23:case"end":return e.stop()}}),e,null,[[4,17]])})));return function(t,n){return e.apply(this,arguments)}}(),k=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.startSession();case 2:return(r=e.sent).startTransaction(),e.prev=4,e.next=7,l.countDocuments({deleted:!1});case 7:if(e.sent===t.body.tiposReOrder.length){e.next=10;break}throw"Variacion Invalida";case 10:a=0;case 11:if(!(a<t.body.tiposReOrder.length)){e.next=17;break}return e.next=14,l.findOneAndUpdate({codigo:t.body.tiposReOrder[a].codigo},{order:a},{useFindAndModify:!1});case 14:a++,e.next=11;break;case 17:return e.next=19,r.commitTransaction();case 19:r.endSession(),n.json({message:"done"}),e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(4),e.next=27,r.abortTransaction();case 27:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 29:case"end":return e.stop()}}),e,null,[[4,23]])})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.findOne({name:t.body.tipoCodigo});case 3:if(e.sent.subTipo.length===t.body.subTipoList.length){e.next=6;break}throw"Variacion Invalida";case 6:return e.next=8,l.findOneAndUpdate({name:t.body.tipoCodigo},{subTipoLink:t.body.linksList,subTipo:t.body.subTipoList},{useFindAndModify:!1,new:!0});case 8:r=e.sent,n.json(r),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.startSession();case 2:return(r=e.sent).startTransaction(),e.prev=4,e.next=7,p.findOneAndUpdate({codigo:t.body.codigo},{subTipo:t.body.newSubTipo,tipo:t.body.newTipo,orderNumber:-2},{useFindAndModify:!1,new:!0});case 7:return a=e.sent,e.next=10,l.findOne({name:t.body.newTipo});case 10:if(null!==(o=e.sent)){e.next=13;break}throw"Tipo Ya No Existe";case 13:if(-1!==o.subTipo.indexOf(t.body.newSubTipo)){e.next=15;break}throw"Sub Tipo Ya No Existe";case 15:return e.next=17,r.commitTransaction();case 17:r.endSession(),n.json(a),e.next=27;break;case 21:return e.prev=21,e.t0=e.catch(4),e.next=25,r.abortTransaction();case 25:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 27:case"end":return e.stop()}}),e,null,[[4,21]])})));return function(t,n){return e.apply(this,arguments)}}(),C=n(4),R=n(0),I=new r.Router;I.get("/testCodeCount",a.k),I.post("/addItemReview",R.f,a.b),I.get("/getSiteMap",m),I.get("/getTableInfItem",R.w,a.O),I.get("/getTopFiveIngresosGananciasGastos",R.w,a.Q),I.get("/getItemVentasPorMes/:codigoItem",R.w,a.hb),I.get("/getItemGIC/:codigoItem",R.w,a.C),I.get("/getItemMayorGananciaPosible",R.w,a.u),I.get("/getItemsLowStock",R.w,a.I),I.get("/getItemsNoStock",R.w,a.K),I.post("/changeFolder",R.C,j),I.post("/reorderItems",R.C,a.V),I.post("/reorderTipos",R.C,k),I.post("/reorderSubTipos",R.C,_),I.get("/searchItem/:searchTerms",a.X),I.post("/addCaracteristica",R.C,a.a),I.post("/deteleCaracteristicas",R.C,a.n),I.get("/getTags",a.P),I.post("/deteleTags",R.C,a.q),I.post("/addTag",R.C,a.g),I.get("/getClienteConMasCompras",R.w,a.B),I.get("/getItemsMasVendido",R.w,a.J),I.get("/getGananciasTotalesSNS",R.w,a.D),I.get("/gananciasInvercionTotal",R.w,a.S),I.get("/getPeorMejorItem",R.w,a.M),I.get("/getVariacionPosnegAll",R.w,a.T),I.get("/ventasPotenciales",R.w,a.U),I.post("/getListOfItemsFilteredByRegex",a.r),I.post("/getListOfTagsFilteredByRegex",a.s),I.get("/getItemsDestacados",a.H),I.get("/getItemsRelacionados/:tipo/:codigo",a.N),I.get("/getItemsSearch/:searchTerms",a.Y),I.get("/getItemBalance/:codigo",R.w,a.F),I.get("/getItemReport/:codigo",R.w,a.G),I.post("/addItem",a.e),I.post("/toFavorite",R.C,a.l),I.post("/toUnFavorite",R.C,a.m),I.get("/getItems",a.w),I.get("/getItemsByType/:tipo",a.y),I.get("/getItem/:tipo/:codigo",a.E),I.get("/getAllItemsSort/:subORtipo/:filtro/:tipoBusqueda/:tipoSort/:limit",a.x),I.get("/getTipo/:codigo",y),I.get("/getItemsSubTipo/:tipo/:subTipo",a.z),I.put("/uploadVariationSC",R.C,a.Z),I.put("/uploadVariationSimple",R.C,a.i),I.put("/modCant/:tipo",R.C,a.ab),I.put("/updateItem",R.C,a.bb),I.put("/updateTipo",R.C,h),I.delete("/deleteItem/:codigo",R.b,a.o,C.b),I.delete("/deleteTipo/:codigo",R.b,V),I.delete("/deleteSupTipo/:codigo/:subTipoName",R.b,x),I.put("/addSubTipo",R.C,g),I.put("/offer/add",R.C,a.f),I.put("/offer/remove",R.C,a.W),I.post("/addTipo",R.C,f),I.get("/getTipos",v),I.get("/getSubTipos/:tipoCod",b),I.get("/marcas/getAll",a.L),I.delete("/marcas/delete/:deleteString",R.C,a.p),I.post("/marcas/add",R.C,a.d),I.put("/uptateSupTipos",R.C,$),I.post("/uploads/image/:codigo",R.C,C.g.single("img"),C.f,C.a,a.cb),I.post("/uploads/imageCat/:codigo",R.C,C.g.single("img"),C.f,C.a,w),I.post("/uploads/imageSubCat/:codigo/:subCat",R.C,C.g.single("img"),C.f,C.a,S),I.post("/uploads/ficha/:codigo",R.C,C.h.single("pdf"),C.c,a.j),I.get("/image/:imgName",C.d),I.get("/pdf/:pdfName",C.e);t.a=I},function(e,t,n){"use strict";var r=n(5),a=n(2),o=n(9),i=n(0),s=n(27),c=n.n(s),u=n(3),d=n.n(u),l=n(1),p=n(15),m=n.n(p);function f(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}var b=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n,r,a){var o,i,s,c,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=new m.a.Workbook,i=o.addWorksheet(t,{sheetFormat:{defaultRowHeight:20,defaultColWidth:20}}),s=o.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00"}),c=o.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00",fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),i.row(2).setHeight(40),i.row(4).setHeight(20),i.column(1).setWidth(10),i.column(4).setWidth(60),y(o,i,n),h(o,i,r),u=$(i,a,5,s,c),i.cell(u,6).string("Total").style(s).style({font:{size:14,bold:!0,color:"white"},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),i.cell(u,7).formula("SUBTOTAL(9,F5:F".concat(u-1,")")).style(s).style({font:{size:14,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),e.next=16,o.writeToBuffer();case 16:return d=e.sent,e.abrupt("return",d);case 20:throw e.prev=20,e.t0=e.catch(0),new Error(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){v(o,r,a,i,s,"next",e)}function s(e){v(o,r,a,i,s,"throw",e)}i(void 0)}))});return function(e,n,r,a){return t.apply(this,arguments)}}(),y=function(e,t,n){var r=e.createStyle({font:{color:"white",size:16,bold:!0},alignment:{horizontal:"center",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#005087"}});t.cell(2,2,2,7,!0).string(n).style(r),t.row(3).setHeight(10)},h=function(e,t,n){var r,a=e.createStyle({font:{color:"white",size:14},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{horizontal:"left",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),o=2,i=f(n);try{for(i.s();!(r=i.n()).done;){var s=r.value;t.cell(4,o).string(s).style(a),o++}}catch(e){i.e(e)}finally{i.f()}t.row(4).filter({firstColumn:2,lastColumn:7})},$=function e(t,n,r,a,o){var i,s=r-5;if(s>=n.length)return 5;t.row(r).setHeight(20),i=r%2==0?o:a;var c=new Date(n[s].date);t.cell(r,2).date(c.toLocaleDateString()).style(i).style({numberFormat:"dd-mm-yyy",alignment:{horizontal:"left",vertical:"center"}}),t.cell(r,3).string(n[s].codigo).style(i);var u="";return n[s].documento.name&&(u=n[s].documento.name+" | "+n[s].documento.codigo),t.cell(r,4).string(u).style(i),t.cell(r,5).string(n[s].vendedor).style(i),t.cell(r,6).number(n[s].totalPriceNoIGV).style(i),t.cell(r,7).number(n[s].totalPrice).style(i),1+e(t,n,r+1,a,o)},x=n(13);function w(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function V(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function k(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){V(o,r,a,i,s,"next",e)}function s(e){V(o,r,a,i,s,"throw",e)}i(void 0)}))}}var _=l.a.production.sunatToken,j=d.a.model("Venta",x.a),C=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.findOne({codigo:t.ventaCod});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),R=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new RegExp(t.params.vendedor,"i"),e.next=4,j.find({vendedor:r}).sort({date:-1}).limit(20);case 4:a=e.sent,n.json(a),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),I=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s,c,u,d,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.findOne({codigo:t.body.codigo});case 3:r=e.sent,a=Math.round(100*(r.totalPrice-t.body.totalPriceSC+Number.EPSILON))/100,o=T(a),i=0,s=0,c=w(r.itemsVendidos),e.prev=9,c.s();case 11:if((u=c.n()).done){e.next=19;break}if(d=u.value,t.body.itemCodigo!==d.codigo){e.next=17;break}return i=Math.round(100*(d.totalPrice-t.body.totalPriceSC+Number.EPSILON))/100,s=T(i),e.abrupt("break",19);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),c.e(e.t0);case 24:return e.prev=24,c.f(),e.finish(24);case 27:return e.next=29,j.findOneAndUpdate({codigo:t.body.codigo,itemsVendidos:{$elemMatch:{codigo:t.body.itemCodigo}}},{$pull:{"itemsVendidos.$.cantidadSC":{name:t.body.name,nameSecond:t.body.nameSecond}},$inc:{"itemsVendidos.$.cantidad":-t.body.cantidadVenta},$set:{"itemsVendidos.$.totalPrice":i,"itemsVendidos.$.totalPriceNoIGV":s,totalPrice:a,totalPriceNoIGV:o}},{new:!0,useFindAndModify:!1});case 29:l=e.sent,n.json(l),e.next=36;break;case 33:return e.prev=33,e.t1=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 36:case"end":return e.stop()}}),e,null,[[0,33],[9,21,24,27]])})));return function(t,n){return e.apply(this,arguments)}}(),P=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.findOne({codigo:t.body.codigo});case 3:if(r=e.sent,-1!==r.itemsVendidos.findIndex((function(e){return e.codigo===t.body.itemCodigo}))){e.next=7;break}return e.abrupt("return",n.status(409).json({errorMSG:"El item ya a sido eliminado"}));case 7:return a=Math.round(100*(r.totalPrice-t.body.totalItemPrice+Number.EPSILON))/100,o=T(a),e.next=11,j.findOneAndUpdate({codigo:t.body.codigo},{$pull:{itemsVendidos:{codigo:t.body.itemCodigo}},$set:{totalPrice:a,totalPriceNoIGV:o}},{new:!0,useFindAndModify:!1});case 11:return i=e.sent,e.abrupt("return",n.json(i));case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}(),T=function(e){var t=e/1.18;return Math.round(100*(t+Number.EPSILON))/100},A=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.findOne({codigo:t.params.ventaCod});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.find({estado:"pendiente",vendedor:t.user.aud.split(" ")[0]});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),O=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(a={})[t.body.orden]=t.body.ordenOrden,o=new RegExp(t.body.busqueda||"","gi"),i=new RegExp(t.body.busquedaItemCodigo||"","gi"),s=new RegExp(t.body.busquedaUsername||"","gi"),"noone"!==t.body.dateOne&&"noone"!==t.body.dateTwo){e.next=12;break}return e.next=9,j.find({estado:{$in:t.body.estado},"itemsVendidos.codigo":{$regex:i},vendedor:{$regex:s},$or:[{"documento.name":{$regex:o}},{"documento.codigo":Number(t.body.busqueda)||-1}],"documento.type":{$in:t.body.tipo}}).skip(parseInt(t.body.skip)).limit(parseInt(t.body.limit)).sort(a);case 9:r=e.sent,e.next=15;break;case 12:return e.next=14,j.find({estado:{$in:t.body.estado},"itemsVendidos.codigo":{$regex:i},vendedor:{$regex:s},$or:[{"documento.name":{$regex:o}},{"documento.codigo":Number(t.body.busqueda)||-1}],"documento.type":{$in:t.body.tipo},date:{$gte:new Date(t.body.dateOne),$lte:new Date(t.body.dateTwo)}}).skip(parseInt(t.body.skip)).limit(parseInt(t.body.limit)).sort(a);case 14:r=e.sent;case 15:n.json(r),e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,n){return e.apply(this,arguments)}}(),G=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=new RegExp(t.body.busqueda||"","gi"),o=new RegExp(t.body.busquedaItemCodigo||"","gi"),i=new RegExp(t.body.busquedaUsername||"","gi"),"noone"!==t.body.dateOne&&"noone"!==t.body.dateTwo){e.next=10;break}return e.next=7,j.aggregate([{$match:{estado:{$in:t.body.estado},"itemsVendidos.codigo":{$regex:o},vendedor:{$regex:i},$or:[{"documento.name":{$regex:a}},{"documento.codigo":Number(t.body.busqueda)||-1}],"documento.type":{$in:t.body.tipo}}},{$count:"cantidadVentas"}]);case 7:r=e.sent,e.next=13;break;case 10:return e.next=12,j.aggregate([{$match:{estado:{$in:t.body.estado},"itemsVendidos.codigo":{$regex:o},vendedor:{$regex:i},$or:[{"documento.name":{$regex:a}},{"documento.codigo":Number(t.body.busqueda)||-1}],"documento.type":{$in:t.body.tipo},date:{$gte:new Date(t.body.dateOne),$lt:new Date(t.body.dateTwo)}}},{$count:"cantidadVentas"}]);case 12:r=e.sent;case 13:n.json(r[0]),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),M=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.a.post("https://api.migo.pe/api/v1/dni",{token:_,dni:t.params.dni});case 3:r=e.sent,n.json(r.data),e.next=19;break;case 7:if(e.prev=7,e.t0=e.catch(0),console.log(e.t0),422!==e.t0.response.status){e.next=14;break}return e.abrupt("return",n.status(422).json({errorMSG:"Numero Invalido"}));case 14:if(404!==e.t0.response.status){e.next=18;break}return e.abrupt("return",n.status(404).json({errorMSG:"Documento No Encontrado"}));case 18:return e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),E=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.a.post("https://api.migo.pe/api/v1/ruc",{token:_,ruc:t.params.ruc});case 3:r=e.sent,n.json(r.data),e.next=18;break;case 7:if(e.prev=7,e.t0=e.catch(0),422!==e.t0.response.status){e.next=13;break}return e.abrupt("return",n.status(422).json({errorMSG:"Numero Invalido"}));case 13:if(404!==e.t0.response.status){e.next=17;break}return e.abrupt("return",n.status(404).json({errorMSG:"Documento No Encontrado"}));case 17:return e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),D=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new RegExp(t.body.busqueda||"","gi"),a=new RegExp(t.body.busquedaItemCodigo||"","gi"),o=new RegExp(t.body.busquedaUsername||"","gi"),e.next=6,j.find({estado:{$in:t.body.estado},"documento.type":{$in:t.body.tipo},"itemsVendidos.codigo":{$regex:a},vendedor:{$regex:o},date:{$gte:new Date(t.body.dateOne),$lte:new Date(t.body.dateTwo)},$or:[{"documento.name":{$regex:r}},{"documento.codigo":Number(t.body.busqueda)||-1}]});case 6:return i=e.sent,e.next=9,b("Ventas","Reporte De Ventas",["Fecha","Codigo","Para","Vendido Por","Precio No IGV","Precio"],i);case 9:s=e.sent,n.writeHead(200,{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":"attachment; filename=reporte.xlsx"}),n.write(s,"binary"),n.end(null,"binary"),e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}(),U=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new j(t.body),e.next=4,q();case 4:return r.codigo=e.sent,e.next=7,r.save();case 7:a=e.sent,n.json(a),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}(),q=function(){var e=k(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.countDocuments({});case 3:e.t0=e.sent,n=e.t0+1,r="SD01-000000",e.t1=t,e.next="factura"===e.t1?9:"boleta"===e.t1?11:13;break;case 9:return r="E002-000000",e.abrupt("break",14);case 11:return r="EB02-000000",e.abrupt("break",14);case 13:return e.abrupt("break",14);case 14:for(a=0;a<n.toString().length;a++)r=r.slice(0,-1);return o=r+n.toString(),e.abrupt("return",o);case 19:return e.prev=19,e.t2=e.catch(0),e.abrupt("return",res.status(500).json({errorMSG:e.t2}));case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$project:{codigo:"$documento.codigo",name:"$documento.name",_id:0,totalPrice:1}},{$group:{_id:"$name",value:{$sum:"$totalPrice"}}},{$match:{_id:{$ne:null,$exists:!0}}},{$match:{_id:{$ne:""}}},{$project:{_id:0,name:"$_id",value:1}},{$sort:{value:-1}},{$limit:4}]);case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),L=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.aggregate([{$match:{estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$match:{"itemsVendidos.codigo":t.params.codigoItem}},{$group:{_id:null,totalVenta:{$sum:{$multiply:["$itemsVendidos.priceIGV","$itemsVendidos.cantidad"]}},totalGasto:{$sum:{$multiply:["$itemsVendidos.priceCosto","$itemsVendidos.cantidad"]}}}},{$project:{_id:0,totalVenta:1,value:{$subtract:["$totalVenta","$totalGasto"]}}}]);case 3:r=e.sent,n.json(r[0]?r[0]:{value:0,totalVenta:0}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),B=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.aggregate([{$match:{estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$match:{"itemsVendidos.codigo":t.params.codigoItem}},{$set:{mesVenta:{$dateToString:{format:"%Y-%m",date:"$date",timezone:"-05:00"}}}},{$group:{_id:"$mesVenta",totalVenta:{$sum:{$multiply:["$itemsVendidos.priceIGV","$itemsVendidos.cantidad"]}},totalGasto:{$sum:{$multiply:["$itemsVendidos.priceCosto","$itemsVendidos.cantidad"]}}}},{$project:{name:"$_id",_id:0,value:{$trunc:[{$subtract:["$totalVenta","$totalGasto"]},0]}}},{$sort:{name:1}}]);case 3:return r=e.sent,e.next=6,j.aggregate([{$match:{estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$match:{"itemsVendidos.codigo":t.params.codigoItem}},{$set:{mesVenta:{$dateToString:{format:"%Y-%m",date:"$date",timezone:"-05:00"}}}},{$group:{_id:"$mesVenta",totalVenta:{$sum:{$multiply:["$itemsVendidos.priceIGV","$itemsVendidos.cantidad"]}},totalGasto:{$sum:{$multiply:["$itemsVendidos.priceCosto","$itemsVendidos.cantidad"]}}}},{$project:{name:"$_id",_id:0,value:"$totalVenta"}},{$sort:{name:1}}]);case 6:a=e.sent,o=[{name:"Ingresos",series:a},{name:"Ganancia",series:r}],n.json(o),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}(),z=function(){var e=k(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$group:{_id:"$codigo",totalVenta:{$sum:{$multiply:["$priceIGV","$cantidad"]}},totalGasto:{$sum:{$multiply:["$priceCosto","$cantidad"]}}}},{$project:{name:"$_id",_id:0,totalVenta:1,value:{$trunc:[{$subtract:["$totalVenta","$totalGasto"]},0]}}},{$sort:{value:-1}}]);case 3:a=e.sent,t.gananciaPorItem=a,r(),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n,r){return e.apply(this,arguments)}}(),H=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$project:{month:{$dateToString:{format:"%Y-%m",date:"$date",timezone:"-05:00"}},date:1,totalPrice:1,totalPriceNoIGV:1}},{$group:{_id:"$month",value:{$sum:"$totalPrice"}}},{$project:{_id:0,value:{$trunc:["$value",0]},name:"$_id"}},{$sort:{name:1}}]);case 3:return r=e.sent,e.next=6,j.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$project:{month:{$dateToString:{format:"%Y-%m",date:"$date",timezone:"-05:00"}},itemsVendidos:1}},{$unwind:"$itemsVendidos"},{$group:{_id:"$month",itemsVendidosPorMes:{$push:{$subtract:[{$multiply:["$itemsVendidos.cantidad","$itemsVendidos.priceIGV"]},{$multiply:["$itemsVendidos.cantidad","$itemsVendidos.priceCosto"]}]}}}},{$project:{_id:0,value:{$trunc:[{$sum:"$itemsVendidosPorMes"},0]},name:"$_id"}},{$sort:{name:1}}]);case 6:return a=e.sent,o=[{name:"Ventas",series:r},{name:"Ganancias",series:a}],e.abrupt("return",n.json(o));case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}(),K=function(){var e=k(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=W(parseInt(t.params.month),parseInt(t.params.year)),e.next=4,j.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$project:{_id:0,codigo:1,totalPrice:1,day:{$dayOfMonth:"$date"},gastosVenta:{$sum:{$map:{input:"$itemsVendidos",as:"itemVendido",in:{$multiply:["$$itemVendido.cantidad","$$itemVendido.priceCosto"]}}}},year:{$year:"$date"},month:{$month:"$date"}}},{$match:{year:parseInt(t.params.year),month:parseInt(t.params.month)}},{$project:{_id:0,codigo:1,totalPrice:1,day:1,gastosVenta:1,gananciasVenta:{$subtract:["$totalPrice","$gastosVenta"]}}},{$group:{_id:"$day",ganancias:{$sum:"$gananciasVenta"},ventas:{$sum:"$totalPrice"}}},{$sort:{_id:1}}]);case 4:a=e.sent,o=[],i=0,s=0,c=0;case 9:if(!(c<r)){e.next=22;break}if((u=a[s]?a[s]._id:-1)!==c+1){e.next=16;break}"ganancia"===t.params.calcular?i+=a[s].ganancias:"venta"===t.params.calcular&&(i+=a[s].ventas),s++,e.next=18;break;case 16:if(-1!==u){e.next=18;break}return e.abrupt("break",22);case 18:o.push({name:c+1,value:i.toFixed(2)});case 19:c++,e.next=9;break;case 22:n.json(o),e.next=28;break;case 25:return e.prev=25,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 28:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(t,n){return e.apply(this,arguments)}}(),W=function(e,t){return new Date(t,e,0).getDate()},J=new r.Router;J.get("/getLastVentas/:vendedor",i.f,R),J.get("/getGananciaTotalPorItem/:codigoItem",i.w,L),J.get("/getItemGananciaIngreso/:codigoItem",i.w,B),J.get("/getVentasPorDiaMes/:month/:year/:calcular",i.w,K),J.get("/getMejoresClientes",i.w,F),J.get("/getItemsGanancias",i.w,z,a.t),J.get("/getInfoToPlotVentasOverTime",i.w,H),J.post("/generarVenta",i.C,U),J.put("/eliminarItemVenta",i.C,P),J.put("/eliminarItemSCVenta",i.C,I),J.put("/anularVentaPost",i.C,a.eb),J.get("/dni/:dni",i.f,M),J.post("/createExcelReport",i.w,D),J.post("/getEjecutadas",i.w,O),J.post("/getCantidadVentas",i.w,G),J.get("/testTotal",i.w,a.A),J.get("/ruc/:ruc",i.f,E),J.get("/obtenerVenta/:ventaCod",i.w,A),J.post("/ventaSimple",i.C,a.gb,o.c,o.b,a.c),J.post("/agregarVenta",i.C,i.B,a.v,i.e),J.get("/ventasPendientes",i.w,i.o,C),J.get("/ventasActivasFull",i.w,N),J.get("/ventasActivasList",i.w,i.p),J.post("/agregarItemVenta",i.C,a.h),J.post("/ventasForCard",i.w,a.R),J.post("/ejecutarVenta",i.C,a.fb,o.c,o.b,a.c),J.put("/anularVenta",i.C,a.db);t.a=J},function(e,t,n){"use strict";var r=n(5),a=n(3),o=n.n(a),i=n(12),s=n(11),c=n(13);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){p(o,r,a,i,s,"next",e)}function s(e){p(o,r,a,i,s,"throw",e)}i(void 0)}))}}var f=o.a.model("Item",i.a),g=o.a.model("Venta",c.a),v=o.a.model("User",s.a),b=[{cod:0,mensaje:"Item Eliminado"},{cod:1,mensaje:"Cambio de precio"},{cod:2,mensaje:"Cantidad agotada"}],y=function(){var e=m(regeneratorRuntime.mark((function e(t,n){var r,a,i,s,c,u,d,l,p,m,b,y,$,x,w,S,V,k,_,j,C,R,I,P;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.startSession();case 2:return(r=e.sent).startTransaction(),e.prev=4,e.next=7,v.findOne({username:t.user.aud.split(" ")[0]});case 7:return a=e.sent,e.next=10,f.findOne({codigo:t.body.codigo});case 10:if((i=e.sent).subConteo&&(s=""!==i.subConteo.nameSecond?i.subConteo.order.find((function(e){return e.name===t.body.orderToAdd.name&&e.nameSecond===t.body.orderToAdd.nameSecond})):i.subConteo.order.find((function(e){return e.name===t.body.orderToAdd.name}))),!i.deleted){e.next=19;break}return e.next=15,r.abortTransaction();case 15:return r.endSession(),e.abrupt("return",n.status(410).json({errorMSG:"El item ha sido elminado"}));case 19:if(i.priceIGV===t.body.priceIGV){e.next=26;break}return e.next=22,r.abortTransaction();case 22:return r.endSession(),e.abrupt("return",n.status(409).json({errorMSG:"El precio del producto ha cambiado"}));case 26:if(!(i.cantidad<t.body.cantidad)){e.next=33;break}return e.next=29,r.abortTransaction();case 29:return r.endSession(),e.abrupt("return",n.status(409).json({errorMSG:"Ya no contamos con la cantidad deseada"}));case 33:if(!i.subConteo){e.next=39;break}if(!(s.cantidad<t.body.cantidad)){e.next=39;break}return e.next=37,r.abortTransaction();case 37:return r.endSession(),e.abrupt("return",n.status(409).json({errorMSG:"Ya no contamos con la cantidad deseada"}));case 39:if("not"!==a.carrito){e.next=54;break}return(c=new g({totalPrice:t.body.cantidad*i.priceIGV,totalPriceNoIGV:t.body.cantidad*i.priceNoIGV,estado:"pendiente",vendedor:t.user.aud.split(" ")[0],tipoVendedor:"low",medio_de_pago:"efectivo",cliente_email:a.email,itemsVendidos:[],carrito_venta:!0})).itemsVendidos.push({codigo:i.codigo,tipo:"producto",descripcion:i.description,name:i.name,priceIGV:i.priceIGV,priceNoIGV:i.priceNoIGV,priceCosto:i.costoPropio,cantidad:t.body.cantidad,cantidadSC:[],totalPrice:t.body.cantidad*i.priceIGV,totalPriceNoIGV:t.body.cantidad*i.priceNoIGV,unidadDeMedida:i.unidadDeMedida,photo:i.photo}),i.subConteo&&(""!==i.subConteo.nameSecond?c.itemsVendidos[0].cantidadSC.push({name:s.name,nameSecond:s.nameSecond,cantidadDisponible:s.cantidad,cantidadVenta:t.body.cantidad}):c.itemsVendidos[0].cantidadSC.push({name:s.name,nameSecond:void 0,cantidadDisponible:s.cantidad,cantidadVenta:t.body.cantidad})),e.next=45,h();case 45:return u=e.sent,c.codigo=u,e.next=49,c.save();case 49:return t.ventaGenerada=e.sent,e.next=52,v.findOneAndUpdate({username:t.user.aud.split(" ")[0]},{carrito:t.ventaGenerada.codigo},{useFindAndModify:!1,new:!0});case 52:e.next=100;break;case 54:return e.next=56,g.findOne({codigo:a.carrito});case 56:if(d=e.sent,-1!==(l=d.itemsVendidos.findIndex((function(e){return e.codigo===i.codigo})))){e.next=66;break}return p={codigo:i.codigo,tipo:"producto",descripcion:i.description,name:i.name,priceIGV:i.priceIGV,priceNoIGV:i.priceNoIGV,priceCosto:i.costoPropio,cantidad:t.body.cantidad,cantidadSC:[],totalPrice:t.body.cantidad*i.priceIGV,totalPriceNoIGV:t.body.cantidad*i.priceNoIGV,unidadDeMedida:i.unidadDeMedida,photo:i.photo},i.subConteo&&(""!==i.subConteo.nameSecond?p.cantidadSC.push({name:s.name,nameSecond:s.nameSecond,cantidadDisponible:s.cantidad,cantidadVenta:t.body.cantidad}):p.cantidadSC.push({name:s.name,nameSecond:void 0,cantidadDisponible:s.cantidad,cantidadVenta:t.body.cantidad})),e.next=63,g.findOneAndUpdate({codigo:a.carrito},{$push:{itemsVendidos:p},$inc:{totalPrice:p.totalPrice,totalPriceNoIGV:p.totalPriceNoIGV}},{useFindAndModify:!1,new:!0});case 63:t.ventaGenerada=e.sent,e.next=100;break;case 66:if(!(l>-1)){e.next=100;break}if(!i.subConteo){e.next=93;break}if(m=-1,-1!==(m=""===i.subConteo.nameSecond?d.itemsVendidos[l].cantidadSC.findIndex((function(e){return e.name===s.name})):d.itemsVendidos[l].cantidadSC.findIndex((function(e){return e.name===s.name&&e.nameSecond===s.nameSecond})))){e.next=81;break}return b=d.itemsVendidos[l].cantidad+t.body.cantidad,y=i.priceIGV*b,$=i.priceNoIGV*b,x=d.totalPrice-d.itemsVendidos[l].totalPrice+y,w=d.totalPriceNoIGV-d.itemsVendidos[l].totalPriceNoIGV+$,e.next=78,g.findOneAndUpdate({codigo:a.carrito,"itemsVendidos.codigo":i.codigo},{totalPrice:x,totalPriceNoIGV:w,$set:{"itemsVendidos.$.priceIGV":i.priceIGV,"itemsVendidos.$.priceNoIGV":i.priceNoIGV,"itemsVendidos.$.priceCosto":i.costoPropio,"itemsVendidos.$.cantidad":b,"itemsVendidos.$.totalPriceNoIGV":$,"itemsVendidos.$.totalPrice":y},$push:{"itemsVendidos.$.cantidadSC":{name:s.name,nameSecond:s.nameSecond||void 0,cantidadDisponible:s.cantidad,cantidadVenta:t.body.cantidad}}},{useFindAndModify:!1,new:!0});case 78:t.ventaGenerada=e.sent,e.next=91;break;case 81:return S=d.itemsVendidos[l].cantidad-d.itemsVendidos[l].cantidadSC[m].cantidadVenta+t.body.cantidad,V=i.priceIGV*S,k=i.priceNoIGV*S,_=d.totalPrice-d.itemsVendidos[l].totalPrice+V,j=d.totalPriceNoIGV-d.itemsVendidos[l].totalPriceNoIGV+k,d.itemsVendidos[l].cantidadSC[m].cantidadDisponible=s.cantidad,d.itemsVendidos[l].cantidadSC[m].cantidadVenta=t.body.cantidad,e.next=90,g.findOneAndUpdate({codigo:a.carrito,"itemsVendidos.codigo":i.codigo},{totalPrice:_,totalPriceNoIGV:j,$set:{"itemsVendidos.$.priceIGV":i.priceIGV,"itemsVendidos.$.priceNoIGV":i.priceNoIGV,"itemsVendidos.$.priceCosto":i.costoPropio,"itemsVendidos.$.cantidad":S,"itemsVendidos.$.totalPriceNoIGV":k,"itemsVendidos.$.totalPrice":V,"itemsVendidos.$.cantidadSC":d.itemsVendidos[l].cantidadSC}},{useFindAndModify:!1,new:!0});case 90:t.ventaGenerada=e.sent;case 91:e.next=100;break;case 93:return C=t.body.cantidad*i.priceIGV,R=t.body.cantidad*i.priceNoIGV,I=d.totalPrice-d.itemsVendidos[l].totalPrice+C,P=d.totalPriceNoIGV-d.itemsVendidos[l].totalPriceNoIGV+R,e.next=99,g.findOneAndUpdate({codigo:a.carrito,"itemsVendidos.codigo":i.codigo},{totalPrice:I,totalPriceNoIGV:P,$set:{"itemsVendidos.$.priceIGV":i.priceIGV,"itemsVendidos.$.priceNoIGV":i.priceNoIGV,"itemsVendidos.$.priceCosto":i.costoPropio,"itemsVendidos.$.cantidad":t.body.cantidad,"itemsVendidos.$.totalPriceNoIGV":R,"itemsVendidos.$.totalPrice":C}},{useFindAndModify:!1,new:!0});case 99:t.ventaGenerada=e.sent;case 100:return e.next=102,r.commitTransaction();case 102:return r.endSession(),e.abrupt("return",n.json(t.ventaGenerada));case 106:return e.prev=106,e.t0=e.catch(4),e.next=110,r.abortTransaction();case 110:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 112:case"end":return e.stop()}}),e,null,[[4,106]])})));return function(t,n){return e.apply(this,arguments)}}(),h=function(){var e=m(regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.countDocuments({});case 3:for(e.t0=e.sent,t=e.t0+1,n="SD01-000000",r=0;r<t.toString().length;r++)n=n.slice(0,-1);return a=n+t.toString(),e.abrupt("return",a);case 11:return e.prev=11,e.t1=e.catch(0),e.abrupt("return",res.status(500).json({errorMSG:e.t1}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),$=function(){var e=m(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.startSession();case 2:return(r=e.sent).startTransaction(),e.prev=4,e.delegateYield(regeneratorRuntime.mark((function e(){var a,o,i,s,c,u,l,p,m,v,b,y,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.aggregate([{$match:{codigo:t.carrito_codigo}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}},{$sort:{codigo:-1}}]);case 2:for(a=e.sent,o=[{cod:0,mensaje:"Item Eliminado"},{cod:1,mensaje:"Cambio de precio"}],i=[],s=[],c="",u=0;u<a.length;u++)a[u].codigo!==c&&s.push(a[u].codigo),c=a[u].codigo;return e.next=10,f.aggregate([{$match:{codigo:{$in:s}}},{$sort:{codigo:-1}}]);case 10:l=e.sent,p=[],m=0,v="",b="",y=regeneratorRuntime.mark((function e(n){var r,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l[m].deleted){e.next=8;break}if(v===l[m].codigo){e.next=6;break}return v=l[m].codigo,i.push(d(d({},o[0]),{},{item_cod:l[m].codigo,item_name:l[m].name})),e.next=6,g.findOneAndUpdate({codigo:t.carrito_codigo},{$inc:{totalPrice:-a[n].cantidad*a[n].priceIGV,totalPriceNoIGV:-a[n].cantidad*a[n].priceNoIGV},$pull:{itemsVendidos:{codigo:v}}},{useFindAndModify:!1,new:!0});case 6:e.next=20;break;case 8:if(l[m].priceIGV===a[n].priceIGV||b===l[m].codigo){e.next=15;break}return b=l[m].codigo,i.push(d(d({},o[1]),{},{item_cod:l[m].codigo,item_name:l[m].name})),r=l[m].priceIGV*a[n].cantidad,s=l[m].priceNoIGV*a[n].cantidad,e.next=15,g.findOneAndUpdate({codigo:t.carrito_codigo,"itemsVendidos.codigo":l[m].codigo},{$inc:{totalPrice:r-a[n].totalPrice,totalPriceNoIGV:s-a[n].totalPriceNoIGV},$set:{"itemsVendidos.$.totalPrice":r,"itemsVendidos.$.totalPriceNoIGV":s,"itemsVendidos.$.priceIGV":l[m].priceIGV,"itemsVendidos.$.priceNoIGV":l[m].priceNoIGV}},{useFindAndModify:!1,new:!0});case 15:a[n].priceIGV=l[m].priceIGV,a[n].priceNoIGV=l[m].priceNoIGV,a[n].totalPrice=l[m].priceIGV*a[n].cantidad,a[n].totalPriceNoIGV=l[m].priceNoIGV*a[n].cantidad,l[m].subConteo?(c=a[n],u=l[m].subConteo.order.find((function(e){return e.name===c.cantidadSC.name&&e.nameSecond===a[n].cantidadSC.nameSecond})),p.push(d(d({},a[n]),{},{cantidadDisponible:u.cantidad,codVent:t.carrito_codigo}))):p.push(d(d({},a[n]),{},{cantidadDisponible:l[m].cantidad,codVent:t.carrito_codigo}));case 20:a[n].codigo!==(a[n+1]?a[n+1].codigo:"xxxxx")&&m++;case 21:case"end":return e.stop()}}),e)})),h=0;case 17:if(!(h<a.length)){e.next=22;break}return e.delegateYield(y(h),"t0",19);case 19:h++,e.next=17;break;case 22:return e.next=24,r.commitTransaction();case 24:r.endSession(),n.json({carrito:p,cod_carrito:t.carrito_codigo,estado_carrito:t.estadoCarrito,alerts:i});case 26:case"end":return e.stop()}}),e)}))(),"t0",6);case 6:e.next=14;break;case 8:return e.prev=8,e.t1=e.catch(4),e.next=12,r.abortTransaction();case 12:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 14:case"end":return e.stop()}}),e,null,[[4,8]])})));return function(t,n){return e.apply(this,arguments)}}(),x=function(){var e=m(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!((a=t.carritoActual[0]).cantidadSC&&a.cantidad-a.cantidadSC.cantidadVenta>0)){e.next=8;break}return e.next=5,g.findOneAndUpdate({codigo:t.body.codVent,"itemsVendidos.codigo":t.body.codigo},{$inc:{totalPrice:-a.cantidadSC.cantidadVenta*a.priceIGV,totalPriceNoIGV:-a.cantidadSC.cantidadVenta*a.priceNoIGV,"itemsVendidos.$.cantidad":-a.cantidadSC.cantidadVenta,"itemsVendidos.$.totalPrice":-a.cantidadSC.cantidadVenta*a.priceIGV,"itemsVendidos.$.totalPriceNoIGV":-a.cantidadSC.cantidadVenta*a.priceNoIGV},$pull:{"itemsVendidos.$.cantidadSC":{name:a.cantidadSC.name,nameSecond:a.cantidadSC.nameSecond}}},{useFindAndModify:!1,new:!0});case 5:r=e.sent,e.next=11;break;case 8:return e.next=10,g.findOneAndUpdate({codigo:t.body.codVent},{$inc:{totalPrice:-a.cantidad*a.priceIGV,totalPriceNoIGV:-a.cantidad*a.priceNoIGV},$pull:{itemsVendidos:{codigo:a.codigo}}},{useFindAndModify:!1,new:!0});case 10:r=e.sent;case 11:t.newCarrito=r,n.json(r),e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}(),w=function(){var e=m(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.findOne({username:t.user.aud.split(" ")[0]});case 3:a=e.sent,t.carrito_codigo=a.carrito,r(),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n,r){return e.apply(this,arguments)}}(),S=function(){var e=m(regeneratorRuntime.mark((function e(t,n,r){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.findOne({codigo:t.body.codVent});case 3:if(a=e.sent,t.estadoCarrito=a.estado_carrito_comprando,!t.body.cantidadSC){e.next=11;break}return e.next=8,g.aggregate([{$match:{codigo:t.body.codVent}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}},{$match:{codigo:t.body.codigo}},{$match:{"cantidadSC.name":t.body.cantidadSC.name}},{$match:{"cantidadSC.nameSecond":t.body.cantidadSC.nameSecond}},{$sort:{codigo:-1}}]);case 8:o=e.sent,e.next=14;break;case 11:return e.next=13,g.aggregate([{$match:{codigo:t.body.codVent}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}},{$match:{codigo:t.body.codigo}}]);case 13:o=e.sent;case 14:if(0!==o.length){e.next=16;break}return e.abrupt("return",n.status(409).json());case 16:t.carritoActual=o,r(),e.next=23;break;case 20:return e.prev=20,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t,n,r){return e.apply(this,arguments)}}(),V=function(){var e=m(regeneratorRuntime.mark((function e(t,n){var r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.findOne({username:t.user.aud.split(" ")[0]});case 3:return r=e.sent,t.carrito_codigo=r.carrito,a=[],t.body.carrito.forEach((function(e){a.push(e.codigo)})),e.next=9,f.aggregate([{$match:{codigo:{$in:a}}},{$sort:{codigo:-1}}]);case 9:o=e.sent,i=k([],o,t.body.carrito),n.json(i),e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,n){return e.apply(this,arguments)}}(),k=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(n[o].deleted&&t.push(d(d({},b[0]),{},{item_cod:n[o].codigo,item_name:n[o].name})),n[o].priceIGV!==r[a].priceIGV&&t.push(d(d({},b[1]),{},{item_cod:n[o].codigo,item_name:n[o].name})),r[a].cantidadSC){var i=n[o].subConteo.order.find((function(e){return e.name===r[a].cantidadSC.name&&e.nameSecond===r[a].cantidadSC.nameSecond}));i.cantidad-r[a].cantidadSC.cantidad<0&&t.push(d(d({},b[2]),{},{item_cod:n[o].codigo,item_name:n[o].name+" | "+i.carrito[a].cantidadSC.name+" "+i.carrito[a].cantidadSC.nameSecond}))}else n[o].cantidad-r[a].cantidad<0&&t.push(d(d({},b[2]),{},{item_cod:n[o].codigo,item_name:n[o].name}));return r[a].codigo!==(r[a+1]?r[a+1].codigo:"xxxxx")&&o++,a+1===r.length?t:(a++,e(t,n,r,a,o))},_=n(0),j=new r.Router;j.post("/agregarItem",_.v,y),j.post("/removeProductoDeCarrito",_.v,S,x),j.post("/iniciarCompra",_.v,V),j.get("/getCarrito",_.v,w,$);t.a=j},function(e,t,n){n(50),e.exports=n(51)},function(e,t){e.exports=require("babel-polyfill")},function(e,t,n){"use strict";n.r(t);var r=n(29),a=n.n(r),o=n(30),i=n.n(o),s=n(1),c=n(20),u=n(3),d=n.n(u);function l(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}var p=s.a.production.log(),m=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.a.connect(t,{useNewUrlParser:!0,useUnifiedTopology:!0,useCreateIndex:!0});case 3:return e.abrupt("return",p.info("Connected To DataBase"));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",p.error(e.t0));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){l(o,r,a,i,s,"next",e)}function s(e){l(o,r,a,i,s,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}();n(28).config();var f=a.a.createServer(c.a),g=s.a.production.PORT,v=s.a.production.log(),b=process.env.WEB_CONCURRENCY||1;c.a.set("port",g);i()({worker:function(e,t){v.info("Id Worker ".concat(e)),f.listen(g||0),m(s.a.production.mongoKey)},count:b}),f.on("listening",(function(){v.info("Hi there! I'm listening on port ".concat(f.address().port," in ").concat(c.a.get("env")," mode."))}))}]);