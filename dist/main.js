!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=41)}([function(e,t,n){"use strict";n.d(t,"u",(function(){return y})),n.d(t,"w",(function(){return x})),n.d(t,"p",(function(){return S})),n.d(t,"i",(function(){return k})),n.d(t,"s",(function(){return _})),n.d(t,"j",(function(){return j})),n.d(t,"x",(function(){return R})),n.d(t,"k",(function(){return O})),n.d(t,"o",(function(){return N})),n.d(t,"r",(function(){return C})),n.d(t,"l",(function(){return I})),n.d(t,"b",(function(){return P})),n.d(t,"t",(function(){return T})),n.d(t,"f",(function(){return A})),n.d(t,"v",(function(){return V})),n.d(t,"q",(function(){return G})),n.d(t,"m",(function(){return M})),n.d(t,"a",(function(){return E})),n.d(t,"c",(function(){return D})),n.d(t,"d",(function(){return U})),n.d(t,"h",(function(){return $})),n.d(t,"g",(function(){return L})),n.d(t,"e",(function(){return B})),n.d(t,"n",(function(){return F}));var r=n(3),a=n.n(r),o=n(8),i=n.n(o),u=n(6),s=n.n(u),c=n(33),d=n.n(c),p=n(34),l=n.n(p),f=(n(18),n(14)),m=n(1);n(11);function v(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){v(o,r,a,i,u,"next",e)}function u(e){v(o,r,a,i,u,"throw",e)}i(void 0)}))}}var b=a.a.model("User",f.a),h=l.a.Strategy,y=d.a.use(new h({clientID:m.a.production.googleClientID,clientSecret:m.a.production.googleClientSecret,callbackURL:m.a.production.callBackUrl},(function(e,t,n,r){return r(null,n)}))),w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split(" ").join("");return e.startsWith("+")||(t="+51"+e.split(" ").join("")),t},x=function(){var e=g(regeneratorRuntime.mark((function e(t,n,r){var a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.body.displayName.toLowerCase(),(o=new b(t.body)).celular=w(t.body.celular),o.username=a,e.next=7,i.a.hash(t.body.password,10);case 7:return o.hashPassword=e.sent,o.type="low",o.nombre=t.body.nombre.toUpperCase(),o.apellido=t.body.apellido.toUpperCase(),e.next=13,o.save();case 13:(u=e.sent).hashPassword=void 0,t.savedUSer=u,r(),e.next=22;break;case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,n,r){return e.apply(this,arguments)}}(),S=function(){var e=g(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findById(t.body.idUser);case 3:if(!1!==e.sent.verified){e.next=6;break}return e.abrupt("return",n.json({reload:!1}));case 6:return e.abrupt("return",n.json({reload:!0}));case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),k=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findById(t.params.idUser);case 3:if(!1!==(r=e.sent).verified){e.next=9;break}return a=s.a.sign({_id:r._id},m.a.production.jwtLogin,{expiresIn:"120s"}),e.next=8,b.findByIdAndUpdate(r._id,{verified:!0},{useFindAndModify:!1});case 8:return e.abrupt("return",n.redirect("".concat(m.a.production.link_front,"login/auto/").concat(a)));case 9:return e.abrupt("return",n.status(202).send("<h1>Este usuario ya esta verificado.</h1>"));case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=g(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.a.verify(t.body.loginToken,m.a.production.jwtLogin,(function(e,a){if(e)return"TokenExpiredError"===e.name?n.status(400).json({error:"Token Expirado"}):n.status(500).json({error:e.message});t.logintoken=a,r()}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),j=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findById(t.logintoken._id);case 3:return r=e.sent,e.abrupt("return",n.json({displayName:r.displayName,username:r.username,success:!0,message:"Success",type:r.type,token:s.a.sign({aud:r.username+" "+r.type,_id:r.id},m.a.production.jwtKey)}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),R=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.exists({username:t.params.username.toLowerCase()});case 3:return r=e.sent,e.abrupt("return",n.json({exists:r}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),O=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.exists({email:t.params.email.toLowerCase()});case 3:return r=e.sent,e.abrupt("return",n.json({exists:r}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=g(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.exists({email:t.user._json.email});case 3:if(!e.sent){e.next=6;break}return e.abrupt("return",r());case 6:return a=s.a.sign(t.user._json,m.a.production.jwtGoogleLogin,{expiresIn:"30s"}),e.abrupt("return",n.redirect("".concat(m.a.production.link_front,"login/registro/").concat(a)));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),C=function(){var e=g(regeneratorRuntime.mark((function e(t,n,r){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOne({email:t.user._json.email});case 3:return a=e.sent,o=s.a.sign({_id:a._id},m.a.production.jwtLogin,{expiresIn:"120s"}),e.next=7,b.findByIdAndUpdate(a._id,{verified:!0},{useFindAndModify:!1});case 7:return e.abrupt("return",n.redirect("".concat(m.a.production.link_front,"login/auto/").concat(o)));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),I=function(){var e=g(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.a.verify(t.body.loginToken,m.a.production.jwtGoogleLogin,(function(e,t){return e?"TokenExpiredError"===e.name?n.status(400).json({error:"Token Expirado"}):n.status(500).json({error:e.message}):n.json(t)}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),P=function(e,t,n){if(!e.user||"admin"!==e.user.aud.split(" ")[1])return t.status(401).json({message:"Usuario No Autorizado"});n()},T=function(e,t,n){if(!e.user||"vent"!==e.user.aud.split(" ")[1]&&"admin"!==e.user.aud.split(" ")[1])return t.status(401).json({message:"Usuario No Autorizado"});n()},A=function(e,t,n){if(!e.user)return t.status(401).json({message:"Usuario No Autorizado"});n()},V=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.body.username,(a=new b(t.body)).displayName=r,a.username=r.toLowerCase(),e.next=7,i.a.hash(t.body.password,10);case 7:return a.hashPassword=e.sent,e.next=10,a.save();case 10:return(o=e.sent).hashPassword=void 0,e.abrupt("return",n.json(o));case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",n.status(e.t0.status||400).send({message:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}(),G=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOne({username:t.body.username.toLowerCase()});case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",n.status(400).json({username:t.body.username,success:!1,message:"Authenticacion failed. No user found!",token:null}));case 6:return e.next=8,r.comparePassword(t.body.password,r.hashPassword);case 8:if(e.sent){e.next=12;break}return e.abrupt("return",n.status(400).json({username:t.body.username,success:!1,message:"Authenticacion failed. Incorrect Password!",token:null}));case 12:return e.abrupt("return",n.json({displayName:r.displayName,username:r.username,success:!0,message:"Success",type:r.type,token:s.a.sign({aud:r.username+" "+r.type,_id:r.id},m.a.production.jwtKey)}));case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),e.t0;case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}(),M=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOne({username:t.params.username.toLowerCase()});case 3:(r=e.sent).hashPassword=void 0,n.json(r),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),E=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOneAndUpdate({_id:t.body.id},{celular:w(t.body.celular)},{useFindAndModify:!1,new:!0});case 3:(r=e.sent).hashPassword=void 0,n.json(r),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),D=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOneAndUpdate({_id:t.body.id},{dirOne:t.body.dirOne,dirTwo:t.body.dirTwo||"",reference:t.body.reference,city:"Trujillo, La Libertad. Perú"},{useFindAndModify:!1,new:!0});case 3:(r=e.sent).hashPassword=void 0,n.json(r),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),U=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOneAndUpdate({_id:t.body.id},{documento:t.body.documento,tipoPersona:t.body.dirTwo},{useFindAndModify:!1,new:!0});case 3:(r=e.sent).hashPassword=void 0,n.json(r),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),$=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findById(t.body.id);case 3:return r=e.sent,e.next=6,r.comparePassword(t.body.oldPassword,r.hashPassword);case 6:if(e.sent){e.next=8;break}return e.abrupt("return",n.json({valid:!1}));case 8:n.json({valid:!0}),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}(),L=function(){var e=g(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findById(t.body.id);case 3:return r=e.sent,e.next=6,r.comparePassword(t.body.passwordOld,r.hashPassword);case 6:if(e.sent){e.next=8;break}return e.abrupt("return",n.json({changed:!1}));case 8:return e.next=10,i.a.hash(t.body.password,10);case 10:return a=e.sent,e.next=13,b.findByIdAndUpdate(t.body.id,{hashPassword:a},{new:!0,useFindAndModify:!1});case 13:return e.abrupt("return",n.json({changed:!0}));case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),B=function(){var e=g(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOneAndUpdate({username:t.user.aud.split(" ")[0]},{ventaActiva:t.saveResult.codigo},{useFindAndModify:!1});case 3:e.sent,n.json({message:"Venta generada con el codigo: ".concat(t.saveResult.codigo),venta:t.saveResult}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),F=function(){var e=g(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.findOne({username:t.user.aud.split(" ")[0]});case 3:a=e.sent,t.ventaCod=a.ventaActiva,r(),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n,r){return e.apply(this,arguments)}}()},function(e,t,n){"use strict";var r=n(27),a=n.n(r),o=n(19);n(24).config();var i=o.name,u=o.version,s=function(e,t,n){return a.a.createLogger({name:"".concat(e,":").concat(t),level:n})},c={development:{PORT:process.env.PORT,mongoKey:process.env.MONGO_KEY,tinyKey:process.env.TINY_KEY,jwtKey:process.env.JWT_KEY,jwtLogin:process.env.JWT_LOGIN,jwtGoogleLogin:process.env.JWT_GOOGLE_LOGIN,awsID:process.env.AWS_ID,awsKey:process.env.AWS_KEY,bucket:process.env.S3_BUCKET_TEST,sunatToken:process.env.SUNAT_TOKEN,googleClientID:process.env.GOOGLE_CLIENT_ID,googleClientSecret:process.env.GOOGLE_CLIENT_SECRET,callBackUrl:process.env.CALLBACK_URL_TEST,BHOST:process.env.HOST_SENDIBLUE,BPORT:process.env.PORT_SENDIBLUE,BUSER:process.env.USER_SENDIBLUE,BPASS:process.env.PASSWORD_SENDIBLUE,nbfToken:process.env.NBF_TOKEN,emailFrom:"loginmanager@siriodinar.com",link:"http://localhost:5000/",link_front:"http://localhost:4200/",origin:["http://localhost:4200","http://localhost:4201"],log:function(){return s(i,u,"debug")}},production:{PORT:process.env.PORT,mongoKey:process.env.MONGO_KEY,tinyKey:process.env.TINY_KEY,jwtKey:process.env.JWT_KEY,jwtLogin:process.env.JWT_LOGIN,jwtGoogleLogin:process.env.JWT_GOOGLE_LOGIN,awsID:process.env.AWS_ID,awsKey:process.env.AWS_KEY,bucket:process.env.S3_BUCKET,sunatToken:process.env.SUNAT_TOKEN,googleClientID:process.env.GOOGLE_CLIENT_ID,googleClientSecret:process.env.GOOGLE_CLIENT_SECRET,callBackUrl:process.env.CALLBACK_URL,BHOST:process.env.HOST_SENDIBLUE,BPORT:process.env.PORT_SENDIBLUE,BUSER:process.env.USER_SENDIBLUE,BPASS:process.env.PASSWORD_SENDIBLUE,nbfToken:process.env.NBF_TOKEN,emailFrom:"loginmanager@siriodinar.com",link:"https://inventario-sirio-dinar.herokuapp.com/",link_front:"https://inventario.siriodinar.com/",origin:["https://inventario.siriodinar.com","https://sirio-inventario-front.herokuapp.com"],log:function(){return s(i,u,"debug")}}};t.a=c},function(e,t,n){"use strict";n.d(t,"w",(function(){return T})),n.d(t,"y",(function(){return A})),n.d(t,"B",(function(){return V})),n.d(t,"u",(function(){return G})),n.d(t,"v",(function(){return E})),n.d(t,"D",(function(){return D})),n.d(t,"z",(function(){return U})),n.d(t,"e",(function(){return $})),n.d(t,"n",(function(){return L})),n.d(t,"K",(function(){return B})),n.d(t,"M",(function(){return F})),n.d(t,"L",(function(){return q})),n.d(t,"J",(function(){return z})),n.d(t,"a",(function(){return K})),n.d(t,"f",(function(){return W})),n.d(t,"C",(function(){return J})),n.d(t,"b",(function(){return Y})),n.d(t,"s",(function(){return Z})),n.d(t,"m",(function(){return Q})),n.d(t,"x",(function(){return X})),n.d(t,"c",(function(){return ee})),n.d(t,"o",(function(){return ne})),n.d(t,"h",(function(){return re})),n.d(t,"i",(function(){return ae})),n.d(t,"p",(function(){return oe})),n.d(t,"q",(function(){return ie})),n.d(t,"r",(function(){return ue})),n.d(t,"t",(function(){return se})),n.d(t,"E",(function(){return ce})),n.d(t,"F",(function(){return de})),n.d(t,"G",(function(){return pe})),n.d(t,"H",(function(){return le})),n.d(t,"j",(function(){return fe})),n.d(t,"l",(function(){return me})),n.d(t,"k",(function(){return ve})),n.d(t,"d",(function(){return ge})),n.d(t,"A",(function(){return be})),n.d(t,"I",(function(){return he})),n.d(t,"g",(function(){return we}));var r=n(3),a=n.n(r),o=new r.Schema({name:{type:String},nameSecond:{type:String},cantidadDisponible:{type:Number},cantidadVenta:{type:Number}},{_id:!1}),i=new r.Schema({name:{type:String,trim:!0,required:!0},nameSecond:{type:String,trim:!0},cantidad:{type:Number}},{_id:!1}),u=new r.Schema({name:{type:String,trim:!0,required:!0},nameSecond:{type:String,trim:!0},order:{type:[i]}},{_id:!1}),s=new r.Schema({date:{type:Date,default:Date.now},cantidad:{type:Number,default:0},tipo:{type:Boolean,default:!1},comentario:{type:String,trim:!0},costoVar:{type:Number},cantidadSC:{type:[o],default:[]}},{_id:!1}),c=new r.Schema({name:{type:String,required:!0,trim:!0,unique:!0},nameLowerCase:{type:String,trim:!0,lowercase:!0},priceIGV:{type:Number,required:!0},priceNoIGV:{type:Number},cantidad:{type:Number,default:0},subConteo:{type:u},variaciones:{type:[s]},codigo:{type:String,required:!0,trim:!0,unique:!0},tipo:{type:String,required:!0,trim:!0},subTipo:{type:String,default:"noone",trim:!0},unidadDeMedida:{type:String,default:"UND",trim:!0},oferta:{type:Number,default:0},date:{type:Date,default:Date.now},description:{type:String,trim:!0},photo:{type:String,trim:!0,default:"noPhoto.jpg"},ficha:{type:Boolean,default:!1},marca:{type:String,default:"noone"},costoPropio:{type:Number},multiSearchParams:{type:String,trim:!0}});c.index({nameLowerCase:"text",tipo:"text",subTipo:"text",marca:"text",description:"text"});var d=c,p=new r.Schema({name:{type:String,required:!0,unique:!0},codigo:{type:String,required:!0,unique:!0},ruc:{type:Number}}),l=n(13),f=n(14),m=n(4),v=n(15),g=n.n(v);function b(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}var h=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var n,r,a,o,i,u,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new g.a.Workbook,r={sheetFormat:{defaultRowHeight:20,defaultColWidth:20}},a=n.addWorksheet("Gastos",r),o=n.addWorksheet("Ventas",r),i=n.addWorksheet("Balance",r),u=n.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00"}),s=n.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00",fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),a.row(2).setHeight(40),a.column(1).setWidth(10),a.column(5).setWidth(60),o.row(2).setHeight(40),o.column(1).setWidth(10),o.column(5).setWidth(60),i.row(2).setHeight(40),i.column(1).setWidth(10),i.column(5).setWidth(60),y(n,a,o,i,t.name),w(n,a,o),x(a,t,5,u,s,0),S(o,t,5,u,s,0),e.next=23,n.writeToBuffer();case 23:return c=e.sent,e.abrupt("return",c);case 27:throw e.prev=27,e.t0=e.catch(0),new Error(e.t0);case 30:case"end":return e.stop()}}),e,null,[[0,27]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){b(o,r,a,i,u,"next",e)}function u(e){b(o,r,a,i,u,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),y=function(e,t,n,r,a){var o=e.createStyle({font:{color:"white",size:16,bold:!0},alignment:{horizontal:"center",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#005087"}});t.cell(2,2,2,6,!0).string("Gastos | ".concat(a)).style(o),n.cell(2,2,2,6,!0).string("Ganancias | ".concat(a)).style(o),r.cell(2,2,2,6,!0).string("Balance | ".concat(a)).style(o),t.row(3).setHeight(10),n.row(3).setHeight(10),r.row(3).setHeight(10)},w=function(e,t,n){for(var r=e.createStyle({font:{color:"white",size:14},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{horizontal:"left",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),a=2,o=0,i=["Fecha","Comentario","Cantidad","Sub Cantidad","Costo"];o<i.length;o++){var u=i[o];t.cell(4,a).string(u).style(r),n.cell(4,a).string(u).style(r),a++}t.row(4).filter({firstColumn:2,lastColumn:3}),n.row(4).filter({firstColumn:2,lastColumn:3})},x=function e(t,n,r,a,o,i){var u,s=r-5;if((s+=i)>=n.variaciones.length)return 5;if(!1===n.variaciones[s].tipo)return 0+e(t,n,r,a,o,i+1);u=r%2==0?o:a;var c=n.variaciones[s],d=new Date(c.date);t.cell(r,2).date(d.toLocaleDateString()).style(u).style({numberFormat:"dd-mm-yyy",alignment:{horizontal:"left",vertical:"center"}}),t.cell(r,4).string(c.cantidad.toString()).style(u);var p="";c.cantidadSC&&(c.cantidadSC.forEach((function(e){var t=e.cantidadVenta;"new item"===c.comentario&&(t=e.cantidadDisponible);var n="";e.nameSecond&&(n="-"+e.nameSecond),p=p+e.name+n+": "+t+", "})),p.length>1&&(p=p.slice(0,-2))),t.cell(r,5).string(p).style(u);var l=c.costoVar;t.cell(r,6).number(l).style(u);var f=c.comentario;return"new item"===c.comentario?f="Nuevo Item":"anular"===c.comentario.split("|")[0]&&(f="Anulada "+c.comentario.split("|")[1]),t.cell(r,3).string(f).style(u),1+e(t,n,r+1,a,o,i)},S=function e(t,n,r,a,o,i){var u,s=r-5;if((s+=i)>=n.variaciones.length)return 5;if(!0===n.variaciones[s].tipo)return 0+e(t,n,r,a,o,i+1);u=r%2==0?o:a;var c=n.variaciones[s],d=new Date(c.date);t.cell(r,2).date(d.toLocaleDateString()).style(u).style({numberFormat:"dd-mm-yyy",alignment:{horizontal:"left",vertical:"center"}}),t.cell(r,4).string(c.cantidad.toString()).style(u);var p="";c.cantidadSC&&(c.cantidadSC.forEach((function(e){var t=e.cantidadVenta;"new item"===c.comentario&&(t=e.cantidadDisponible);var n="";e.nameSecond&&(n="-"+e.nameSecond),p=p+e.name+n+": "+t+", "})),p.length>1&&(p=p.slice(0,-2))),t.cell(r,5).string(p).style(u);var l=c.costoVar;t.cell(r,6).number(l).style(u);var f=c.comentario;return"venta"===c.comentario.split("|")[0]&&(f="Venta "+c.comentario.split("|")[1]),t.cell(r,3).string(f).style(u),1+e(t,n,r+1,a,o,i)},k=n(7);function _(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function R(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){R(o,r,a,i,u,"next",e)}function u(e){R(o,r,a,i,u,"throw",e)}i(void 0)}))}}var N=a.a.model("Item",d),C=a.a.model("Marca",p),I=a.a.model("Venta",l.a),P=a.a.model("User",f.a),T=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.find({oferta:{$gt:0}});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.find({tipo:t.params.tipo,codigo:{$ne:t.params.codigo}}).limit(8);case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),V=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new RegExp(t.params.searchTerms,"gi"),e.next=4,N.find({nameLowerCase:r});case 4:a=e.sent,n.json(a),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),G=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOne({codigo:t.params.codigo});case 3:r=e.sent,a=M(r.variaciones),n.json({message:a}),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),M=function(e){try{var t,n=0,r=0,a=_(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;!0===o.tipo?r+=o.costoVar:n+=o.costoVar}}catch(e){a.e(e)}finally{a.f()}return Math.round(100*(n-r+Number.EPSILON))/100}catch(e){throw new Error(e)}},E=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOne({codigo:t.params.codigo});case 3:return r=e.sent,e.next=6,h(r);case 6:a=e.sent,n.writeHead(200,{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":"attachment; filename=reporteItem-".concat(r.codigo,".xlsx")}),n.write(a,"binary"),n.end(null,"binary"),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),D=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.find({codigo:{$in:["0SDTT2","2SDeT3"]}});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),U=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.aggregate([{$match:{codigo:t.body.codVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}}]);case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),$=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.aggregate([{$match:{codigo:t.body.codigoVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}},{$count:"thisItem"}]);case 3:if(0===e.sent.length){e.next=13;break}return e.next=7,I.aggregate([{$match:{codigo:t.body.codigoVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}}]);case 7:return r=e.sent,a=Math.round(100*(r[0].totalPrice-t.body.itemVendido.totalPrice+Number.EPSILON))/100*-1,o=Math.round(100*(r[0].totalPriceNoIGV-t.body.itemVendido.totalPriceNoIGV+Number.EPSILON))/100*-1,e.next=12,I.findOneAndUpdate({codigo:t.body.codigoVenta,itemsVendidos:{$elemMatch:{codigo:t.body.itemVendido.codigo}}},{$set:{"itemsVendidos.$":t.body.itemVendido},$inc:{totalPrice:a,totalPriceNoIGV:o}},{useFindAndModify:!1});case 12:return e.abrupt("return",n.json({message:"Cantidades actualizadas"}));case 13:return e.next=15,I.findOneAndUpdate({codigo:t.body.codigoVenta},{$push:{itemsVendidos:t.body.itemVendido},$inc:{totalPrice:t.body.itemVendido.totalPrice,totalPriceNoIGV:t.body.itemVendido.totalPriceNoIGV}},{useFindAndModify:!1});case 15:n.json({message:"Item agregado correctamente"}),e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,n){return e.apply(this,arguments)}}(),L=function(){var e=O(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=new I(t.body.venta),e.next=4,H(a.documento.type);case 4:return a.codigo=e.sent,e.next=7,a.save();case 7:t.saveResult=e.sent,r(),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n,r){return e.apply(this,arguments)}}(),B=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,o,i,u,s,c,d,p,l,f,m,v,g,b,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.startSession();case 2:(r=e.sent).startTransaction(),e.prev=4,o=[],i=[],u=_(t.body.itemsVendidos);try{for(u.s();!(s=u.n()).done;)c=s.value,i.push(c.codigo),o.push({date:Date.now(),cantidad:c.cantidad,tipo:!0,comentario:"anular|"+t.body.codigo,costoVar:c.totalPrice,cantidadSC:c.cantidadSC})}catch(e){u.e(e)}finally{u.f()}d=0,p=_(t.body.itemsVendidos),e.prev=11,p.s();case 13:if((l=p.n()).done){e.next=38;break}f=l.value,m=_(f.cantidadSC),e.prev=16,m.s();case 18:if((v=m.n()).done){e.next=25;break}if(!((g=v.value).cantidadVenta>0)){e.next=23;break}return e.next=23,N.findOneAndUpdate({codigo:f.codigo,"subConteo.order":{$elemMatch:{name:g.name,nameSecond:g.nameSecond}}},{$inc:{"subConteo.order.$.cantidad":g.cantidadVenta}},{useFindAndModify:!1,new:!0,session:r});case 23:e.next=18;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(16),m.e(e.t0);case 30:return e.prev=30,m.f(),e.finish(30);case 33:return e.next=35,N.findOneAndUpdate({codigo:f.codigo},{$inc:{cantidad:f.cantidad},$push:{variaciones:o[d]}},{new:!0,useFindAndModify:!1,session:r});case 35:d++;case 36:e.next=13;break;case 38:e.next=43;break;case 40:e.prev=40,e.t1=e.catch(11),p.e(e.t1);case 43:return e.prev=43,p.f(),e.finish(43);case 46:if(b="","noone"===t.body.documento.type){e.next=56;break}if("factura"!==t.body.documento.type){e.next=52;break}return e.next=51,Object(k.a)(1,t.body.serie,t.body.numero,"Anulación de venta");case 51:b=e.sent;case 52:if("boleta"!==t.body.documento.type){e.next=56;break}return e.next=55,Object(k.a)(2,t.body.serie,t.body.numero,"Anulación de venta");case 55:b=e.sent;case 56:return e.next=58,I.findOneAndUpdate({codigo:t.body.codigo},{estado:"anuladaPost",linkComprobante:b},{useFindAndModify:!1,new:!0,session:r});case 58:return h=e.sent,e.next=61,r.commitTransaction();case 61:r.endSession(),n.json({message:"succes||".concat(h.codigo)}),e.next=71;break;case 65:return e.prev=65,e.t2=e.catch(4),e.next=69,r.abortTransaction();case 69:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t2}));case 71:case"end":return e.stop()}}),e,null,[[4,65],[11,40,43,46],[16,27,30,33]])})));return function(t,n){return e.apply(this,arguments)}}(),F=function(){var e=O(regeneratorRuntime.mark((function e(t,n,r){var o,i,u,s,c,d,p,l,f,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.startSession();case 2:return(o=e.sent).startTransaction(),e.prev=4,e.next=7,H(t.body.venta.documento.type);case 7:return i=e.sent,e.next=10,N.findOne({codigo:t.body.venta.itemsVendidos[0].codigo});case 10:if(u=e.sent,s={date:Date.now(),cantidad:t.body.venta.itemsVendidos[0].cantidad,tipo:!1,comentario:"venta|"+i,costoVar:t.body.venta.totalPrice,cantidadSC:t.body.venta.itemsVendidos[0].cantidadSC},0===t.body.venta.itemsVendidos[0].cantidadSC.length){e.next=42;break}c=_(t.body.venta.itemsVendidos[0].cantidadSC),e.prev=14,c.s();case 16:if((d=c.n()).done){e.next=34;break}if(!((p=d.value).cantidadVenta>0)){e.next=32;break}return e.next=21,N.findOneAndUpdate({codigo:t.body.venta.itemsVendidos[0].codigo,"subConteo.order":{$elemMatch:{name:p.name,nameSecond:p.nameSecond}}},{$inc:{"subConteo.order.$.cantidad":-p.cantidadVenta}},{useFindAndModify:!1,new:!0,session:o});case 21:l=e.sent,f=0;case 23:if(!(f<l.subConteo.order.length)){e.next=32;break}if(!(l.subConteo.order[f].cantidad<0)){e.next=29;break}return e.next=27,o.abortTransaction();case 27:return o.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado",item:u}));case 29:f++,e.next=23;break;case 32:e.next=16;break;case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(14),c.e(e.t0);case 39:return e.prev=39,c.f(),e.finish(39);case 42:return e.next=44,N.findOneAndUpdate({codigo:t.body.venta.itemsVendidos[0].codigo},{$inc:{cantidad:-t.body.venta.itemsVendidos[0].cantidad},$push:{variaciones:s}},{new:!0,useFindAndModify:!1,session:o});case 44:if(!(e.sent.cantidad<0)){e.next=50;break}return e.next=48,o.abortTransaction();case 48:return o.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado",item:u}));case 50:return(v=new I(t.body.venta)).codigo=i,e.next=54,v.save({session:o});case 54:if(t.ventResult=e.sent,"factura"!==v.documento.type){e.next=61;break}return e.next=58,I.countDocuments({tipoComprobante:{$eq:1}});case 58:t.count=e.sent,e.next=65;break;case 61:if("boleta"!==v.documento.type){e.next=65;break}return e.next=64,I.countDocuments({tipoComprobante:{$eq:2}});case 64:t.count=e.sent;case 65:if(!t.body.venta.guia){e.next=69;break}return e.next=68,I.countDocuments({guia:{$eq:!0}});case 68:t.countGuia=e.sent;case 69:return e.next=71,Object(m.i)(v);case 71:return e.next=73,o.commitTransaction();case 73:o.endSession(),r(),e.next=83;break;case 77:return e.prev=77,e.t1=e.catch(4),e.next=81,o.abortTransaction();case 81:return o.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 83:case"end":return e.stop()}}),e,null,[[4,77],[14,36,39,42]])})));return function(t,n,r){return e.apply(this,arguments)}}(),q=function(){var e=O(regeneratorRuntime.mark((function e(t,n,r){var o,i,u,s,c,d,p,l,f,v,g,b,h,y,w,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.startSession();case 2:(o=e.sent).startTransaction(),e.prev=4,i=[],u=[],s=_(t.body.venta.itemsVendidos);try{for(s.s();!(c=s.n()).done;)d=c.value,u.push(d.codigo),i.push({date:Date.now(),cantidad:d.cantidad,tipo:!1,comentario:"venta|"+t.body.venta.codigo,costoVar:d.totalPrice,cantidadSC:d.cantidadSC})}catch(e){s.e(e)}finally{s.f()}p=0,l=_(t.body.venta.itemsVendidos),e.prev=11,l.s();case 13:if((f=l.n()).done){e.next=55;break}v=f.value,g=_(v.cantidadSC),e.prev=16,g.s();case 18:if((b=g.n()).done){e.next=36;break}if(!((h=b.value).cantidadVenta>0)){e.next=34;break}return e.next=23,N.findOneAndUpdate({codigo:v.codigo,"subConteo.order":{$elemMatch:{name:h.name,nameSecond:h.nameSecond}}},{$inc:{"subConteo.order.$.cantidad":-h.cantidadVenta}},{useFindAndModify:!1,new:!0,session:o});case 23:y=e.sent,w=0;case 25:if(!(w<y.subConteo.order.length)){e.next=34;break}if(!(y.subConteo.order[w].cantidad<0)){e.next=31;break}return e.next=29,o.abortTransaction();case 29:return o.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado"}));case 31:w++,e.next=25;break;case 34:e.next=18;break;case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(16),g.e(e.t0);case 41:return e.prev=41,g.f(),e.finish(41);case 44:return e.next=46,N.findOneAndUpdate({codigo:v.codigo},{$inc:{cantidad:-v.cantidad},$push:{variaciones:i[p]}},{new:!0,useFindAndModify:!1,session:o});case 46:if(!(e.sent.cantidad<0)){e.next=52;break}return e.next=50,o.abortTransaction();case 50:return o.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado"}));case 52:p++;case 53:e.next=13;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(11),l.e(e.t1);case 60:return e.prev=60,l.f(),e.finish(60);case 63:return e.next=65,I.findOneAndUpdate({codigo:t.body.venta.codigo},t.body.venta,{useFindAndModify:!1,new:!0,session:o});case 65:if(x=e.sent,t.ventResult=x,"factura"!==x.documento.type){e.next=73;break}return e.next=70,I.countDocuments({tipoComprobante:{$eq:1}});case 70:t.count=e.sent,e.next=77;break;case 73:if("boleta"!==x.documento.type){e.next=77;break}return e.next=76,I.countDocuments({tipoComprobante:{$eq:2}});case 76:t.count=e.sent;case 77:if(!t.body.venta.guia){e.next=81;break}return e.next=80,I.countDocuments({guia:{$eq:!0}});case 80:t.countGuia=e.sent;case 81:return e.next=83,P.findOneAndUpdate({username:t.user.aud.split(" ")[0]},{ventaActiva:""},{useFindAndModify:!1});case 83:return e.next=85,Object(m.i)(x);case 85:return e.next=87,o.commitTransaction();case 87:o.endSession(),r(),e.next=97;break;case 91:return e.prev=91,e.t2=e.catch(4),e.next=95,o.abortTransaction();case 95:return o.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t2}));case 97:case"end":return e.stop()}}),e,null,[[4,91],[11,57,60,63],[16,38,41,44]])})));return function(t,n,r){return e.apply(this,arguments)}}(),z=function(){var e=O(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.findOneAndUpdate({codigo:t.body.venta.codigo},{estado:"anulada"},{useFindAndModify:!0});case 3:return e.next=5,P.findOneAndUpdate({username:t.user.aud.split(" ")[0]},{ventaActiva:""},{useFindAndModify:!1});case 5:n.json({message:"succes"}),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),K=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.sunat_guia||(t.sunat_guia=""),e.next=4,I.findByIdAndUpdate(t.ventResult._id,{linkComprobante:t.sunat.enlace_del_pdf,numero:t.sunat.numero,guia_link:t.sunat_guia.enlace_del_pdf,serie:t.sunat.serie,tipoComprobante:t.sunat.tipo_de_comprobante},{new:!0,useFindAndModify:!1});case 4:r=e.sent,n.json({item:r,message:"Succes||".concat(t.ventResult.codigo),_sunat:t.sunat}),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),H=function(){var e=O(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.countDocuments({});case 3:e.t0=e.sent,n=e.t0+1,r="SD01-000000",e.t1=t,e.next="factura"===e.t1?9:"boleta"===e.t1?11:13;break;case 9:return r="E002-000000",e.abrupt("break",14);case 11:return r="EB02-000000",e.abrupt("break",14);case 13:return e.abrupt("break",14);case 14:for(a=0;a<n.toString().length;a++)r=r.slice(0,-1);return o=r+n.toString(),e.abrupt("return",o);case 19:return e.prev=19,e.t2=e.catch(0),e.abrupt("return",res.status(500).json({errorMSG:e.t2}));case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),W=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.body.cantidadNueva>=t.body.cantidadAntigua,r=t.body.cantidadNueva-t.body.cantidadAntigua,o={date:Date.now(),cantidad:r,tipo:a,comentario:t.body.comentario,costoVar:t.body.costoVar,cantidadSC:[]},e.next=6,N.findOneAndUpdate({codigo:t.body.codigo},{cantidad:t.body.cantidadNueva,$push:{variaciones:o}},{new:!0,useFindAndModify:!1});case 6:i=e.sent,n.json(i),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),J=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,u,s,c,d,p,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOne({codigo:t.body.codigo});case 3:o=e.sent,a=t.body.cantidadNueva>=t.body.cantidadAntigua,r=t.body.cantidadNueva-t.body.cantidadAntigua,i={date:Date.now(),cantidad:r,tipo:a,comentario:t.body.comentario,costoVar:t.body.costoVar,cantidadSC:[]},u=0,s=_(t.body.subConteo.order);try{for(s.s();!(c=s.n()).done;)d=c.value,p=0,o.subConteo.order[u]&&(p=o.subConteo.order[u].cantidad),i.cantidadSC.push({cantidad:r,name:d.name,nameSecond:d.nameSecond,cantidadDisponible:p,cantidadVenta:-1*(p-d.cantidad)}),u++}catch(e){s.e(e)}finally{s.f()}return e.next=12,N.findOneAndUpdate({codigo:t.body.codigo},{subConteo:t.body.subConteo,cantidad:t.body.cantidadNueva,$push:{variaciones:i}},{new:!0,useFindAndModify:!1});case 12:l=e.sent,n.json(l),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),Y=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=new C(t.body)).codigo=Date.now().toString(),e.next=5,r.save();case 5:return a=e.sent,e.abrupt("return",n.json(a));case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),Z=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.aggregate([{$match:{codigo:"4SDtT4"}},{$project:{cantidadTotal:{$sum:"$subConteo.order.cantidad"}}}]);case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Q=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.params.deleteString.split("_"),e.next=4,C.deleteMany({name:{$in:r}});case 4:n.json({message:"succes"}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),X=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C.find({});case 3:r=e.sent,n.json(r),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ee=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=new N(t.body)).priceNoIGV=ye(r.priceIGV),e.next=5,te(r.name,r.tipo);case 5:if(r.codigo=e.sent,r.nameLowerCase=r.name,a={date:Date.now(),cantidad:r.cantidad,tipo:!0,comentario:"new item",costoVar:Math.round(100*(r.costoPropio*r.cantidad+Number.EPSILON))/100,cantidadSC:[]},r.subConteo){o=_(r.subConteo.order);try{for(o.s();!(i=o.n()).done;)u=i.value,a.cantidadSC.push({name:u.name,nameSecond:u.nameSecond,cantidadDisponible:u.cantidad,cantidadVenta:0})}catch(e){o.e(e)}finally{o.f()}}return r.variaciones=[a],e.next=12,r.save();case 12:return s=e.sent,e.abrupt("return",n.json(s));case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),te=function(){var e=O(regeneratorRuntime.mark((function e(){var t,n,r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"",n=a.length>1&&void 0!==a[1]?a[1]:"",e.prev=2,e.next=5,N.countDocuments({});case 5:return r=e.sent,e.abrupt("return",r.toString()+"SD"+t.charAt(0)+n.charAt(0)+Math.floor(10*Math.random()).toString());case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",new Error(e.t0));case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.find({});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),re=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOneAndUpdate({codigo:t.body.codigo},{oferta:1},{new:!0,useFindAndModify:!1});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ae=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOneAndUpdate({codigo:t.body.codigo},{oferta:0},{new:!0,useFindAndModify:!1});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),oe=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,u,s,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=0,"asc"===t.params.tipoSort?r=1:"dsc"===t.params.tipoSort&&(r=-1),a=t.params.subORtipo,o=t.params.tipoBusqueda,i=t.params.filtro,u=parseInt(t.params.limit),s=u-12,c={},"all"!==t.params.filtro&&("destacado"===i.toLowerCase()?c={oferta:{$gt:0}}:"sub"===a?c={subTipo:i}:"tipo"===a&&(c={tipo:i})),e.t0=o,e.next="date"===e.t0?13:"name"===e.t0?17:"priceIGV"===e.t0?21:25;break;case 13:return e.next=15,N.find(c).collation({locale:"en",strength:2}).sort({date:-1*r}).skip(s).limit(u);case 15:return d=e.sent,e.abrupt("break",26);case 17:return e.next=19,N.find(c).collation({locale:"en",strength:2}).sort({name:r}).skip(s).limit(u);case 19:return d=e.sent,e.abrupt("break",26);case 21:return e.next=23,N.find(c).collation({locale:"en",strength:2}).sort({priceIGV:r}).skip(s).limit(u);case 23:return d=e.sent,e.abrupt("break",26);case 25:return e.abrupt("break",26);case 26:return e.abrupt("return",n.json(d));case 29:return e.prev=29,e.t1=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 32:case"end":return e.stop()}}),e,null,[[0,29]])})));return function(t,n){return e.apply(this,arguments)}}(),ie=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.find({tipo:t.params.tipo});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ue=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.find({subTipo:t.params.subTipo});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),se=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={},e.prev=1,e.t0=t.params.tipo,e.next="cod"===e.t0?5:"name"===e.t0?9:"tipo"===e.t0?13:17;break;case 5:return e.next=7,N.findOne({codigo:t.params.codigo});case 7:return r=e.sent,e.abrupt("break",19);case 9:return e.next=11,N.find({name:t.body.name});case 11:return r=e.sent,e.abrupt("break",19);case 13:return e.next=15,N.find({tipo:t.body.tipo});case 15:return r=e.sent,e.abrupt("break",19);case 17:return r={message:"Not A Type Of Search"},e.abrupt("break",19);case 19:return e.abrupt("return",n.json(r));case 22:return e.prev=22,e.t1=e.catch(1),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 25:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t,n){return e.apply(this,arguments)}}(),ce=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r={},a=0,o=0,"redu"!==t.params.tipo){e.next=19;break}return e.next=7,N.findOne({codigo:t.body.codigo});case 7:if(r=e.sent,!((a=r.cantidad)>=t.body.cantidad)){e.next=16;break}return o=a-t.body.cantidad,e.next=13,N.findOneAndUpdate({codigo:t.body.codigo},{cantidad:o},{new:!0,useFindAndModify:!1});case 13:r=e.sent,e.next=17;break;case 16:return e.abrupt("return",n.status(409).json({message:"No Hay Los Suficientes Items En Stock"}));case 17:e.next=32;break;case 19:if("aume"!==t.params.tipo){e.next=31;break}return e.next=22,N.findOne({codigo:t.body.codigo});case 22:if(r=e.sent,!((a=r.cantidad)>=t.body.cantidadRedu)){e.next=29;break}return o=a+t.body.cantidadRedu,e.next=28,N.findOneAndUpdate({codigo:t.body.codigo},{cantidad:o},{new:!0,useFindAndModify:!1});case 28:r=e.sent;case 29:e.next=32;break;case 31:return e.abrupt("return",n.json({message:"Not An opc"}));case 32:return e.abrupt("return",n.json(r));case 35:return e.prev=35,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 38:case"end":return e.stop()}}),e,null,[[0,35]])})));return function(t,n){return e.apply(this,arguments)}}(),de=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=t.body).priceIGV&&(r.priceNoIGV=ye(r.priceIGV)),e.next=5,N.findOneAndUpdate({codigo:t.body.codigo},r,{new:!0,useFindAndModify:!1});case 5:a=e.sent,n.json(a),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),pe=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.updateMany({subTipo:t.body.antiguoSubName},{subTipo:t.body.newSubName},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),le=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.updateMany({tipo:t.beforeName},{tipo:t.body.name},{new:!0,useFindAndModify:!1,runValidators:!0});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),fe=function(){var e=O(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOneAndDelete({codigo:t.params.codigo});case 3:a=e.sent,t.photNameToDelete=a.photo,r(),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n,r){return e.apply(this,arguments)}}(),me=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.deleteMany({tipo:t.tipoName});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ve=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.deleteMany({subTipo:t.params.subTipoName});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ge=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOneAndUpdate({codigo:t.body.codigo},{oferta:t.body.ofertaNum},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),be=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOneAndUpdate({codigo:t.body.codigo},{oferta:0},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.status(200).json({res:r,uploadInfo:t.uploadInfo}),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),n.status(500).json({errorMSG:e.t0});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),he=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOneAndUpdate({codigo:t.params.codigo},{photo:t.fileName},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.status(200).json({res:r,uploadInfo:t.uploadInfo}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ye=function(e){var t=e/1.18;return Math.round(100*(t+Number.EPSILON))/100},we=function(){var e=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOneAndUpdate({codigo:t.params.codigo},{ficha:!0},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.status(200).json({res:r,uploadInfo:t.uploadInfo}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()},function(e,t){e.exports=require("mongoose")},function(e,t,n){"use strict";n.d(t,"i",(function(){return _})),n.d(t,"d",(function(){return j})),n.d(t,"a",(function(){return R})),n.d(t,"b",(function(){return O})),n.d(t,"e",(function(){return N})),n.d(t,"g",(function(){return C})),n.d(t,"h",(function(){return I})),n.d(t,"c",(function(){return P})),n.d(t,"f",(function(){return T}));var r=n(21),a=n.n(r),o=n(22),i=n.n(o),u=n(30),s=n.n(u),c=(n(12),n(31)),d=n.n(c),p=function(e,t){var n=new d.a({size:"A4",margin:50});return l(n,t),f(n,e),b(n,e),h(n),n},l=function(e,t){e.image(t,50,30,{width:70}).fillColor("#444444").fontSize(20).fontSize(10).text("Sirio Dinar | RUC: 20605746587",200,50,{align:"right"}).text("Jr. Felipe Pardo Y Aliaga 213, Trujillo.",200,65,{align:"right"}).text("+51 977-426-349",200,80,{align:"right"}).moveDown()},f=function(e,t){e.fillColor("#444444").fontSize(20).text("Comprobante",50,160),m(e,185);e.fontSize(10).text("Codigo:",50,200).font("Helvetica-Bold").text(t.codigo,150,200).font("Helvetica").text("Fecha de emisión:",50,240).text(g(new Date),150,240).font("Helvetica-Bold").text(t.documento.name,300,200).font("Helvetica").text(t.documento.codigo,300,240).moveDown(),m(e,260)},m=function(e,t){e.strokeColor("#aaaaaa").lineWidth(1).moveTo(50,t).lineTo(550,t).stroke()},v=function(e){return"S/"+e.toFixed(2)},g=function(e){var t=e.getDate(),n=e.getMonth()+1;return e.getFullYear()+"/"+n+"/"+t},b=function(e,t){var n,r=307;for(e.fontSize(8).font("Helvetica-Bold"),y(e,r,"Cod","Nombre","Descripcion","Precio","Cantidad","Total"),m(e,(r=300)+25),e.font("Helvetica"),n=0;n<t.itemsVendidos.length;n++){var a=t.itemsVendidos[n],o=a.descripcion;a.cantidadSC.length>0&&(o+="\nCantidades: ");for(var i=0;i<a.cantidadSC.length;i++)a.cantidadSC[i].cantidadVenta>0&&(o=o+a.cantidadSC[i].name+" - "+a.cantidadSC[i].nameSecond+": "+a.cantidadSC[i].cantidadVenta+", ");a.cantidadSC.length>0&&(o=o.slice(0,-2)+".");var u=r+30*(2*n+1);y(e,u,a.codigo,a.name,o,v(a.priceNoIGV),a.cantidad,v(a.totalPriceNoIGV)),m(e,u+55)}var s=r+31*(2*n+1);y(e,s,"","","","","Subtotal",v(t.totalPriceNoIGV));var c=s+15;y(e,c,"","","","","IGV 18%",v(t.totalPrice-t.totalPriceNoIGV));var d=c+15;e.font("Helvetica-Bold"),y(e,d,"","","","","Total",v(t.totalPrice)),e.font("Helvetica")},h=function(e){e.fontSize(10).text("siriodinar.com",50,780,{align:"center",width:500})},y=function(e,t,n,r,a,o,i,u){e.fontSize(8).text(n,50,t,{width:40}).text(r,100,t,{width:100}).text(a,210,t,{width:180}).text(o,400,t,{width:35,align:"right"}).text(i,460,t,{width:35,align:"right"}).text(u,0,t,{align:"right"})},w=n(1);function x(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){x(o,r,a,i,u,"next",e)}function u(e){x(o,r,a,i,u,"throw",e)}i(void 0)}))}}var k=new s.a.S3({accessKeyId:w.a.production.awsID,secretAccessKey:w.a.production.awsKey,Bucket:w.a.production.bucket,region:"us-east-1"}),_=function(){var e=S(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.getObject({Bucket:w.a.production.bucket,Key:"sirio-logo.png"}).promise();case 3:return n=e.sent,(r=p(t,n.Body)).end(),e.next=8,k.upload({Bucket:w.a.production.bucket,Key:"".concat(t.codigo,".pdf"),Body:r,ContentType:"application/pdf"}).promise();case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(0),w.a.production.log().error(e.t0),e.abrupt("return",e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.getObject({Bucket:w.a.production.bucket,Key:t.params.imgName}).promise();case 3:r=e.sent,n.writeHead(200,{"Content-Type":"image/jpeg"}),n.write(r.Body,"binary"),n.end(null,"binary"),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),R=function(){var e=S(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noPhoto.jpg"===t.body.oldPhoto){e.next=4;break}return e.next=4,k.deleteObject({Bucket:w.a.production.bucket,Key:t.body.oldPhoto}).promise();case 4:r(),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),O=function(){var e=S(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noPhoto.jpg"===t.photNameToDelete){e.next=4;break}return e.next=4,k.deleteObject({Bucket:w.a.production.bucket,Key:t.photNameToDelete}).promise();case 4:n.json({message:"Succes"}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),N=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.getObject({Bucket:w.a.production.bucket,Key:t.params.pdfName}).promise();case 3:r=e.sent,n.writeHead(200,{"Content-Type":"aplication/pdf"}),n.write(r.Body,"binary"),n.end(null,"binary"),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),C=a()({storage:i()({s3:k,bucket:w.a.production.bucket,metadata:function(e,t,n){n(null,Object.assign({},e.body))},key:function(e,t,n){var r=t.originalname.split(".")[1];n(null,t.fieldname+"-"+e.params.codigo+"-"+Date.now().toString()+"."+r)}}),limits:{fileSize:1e6},fileFilter:function(e,t,n){t.originalname.match(/\.(jpg|jpeg|png)$/)||n(new Error("Please upload JPG and PNG images only!")),t.size>1e6&&n(new Error("Please upload JPG and PNG images only!")),n(void 0,!0)}}),I=a()({storage:i()({s3:k,bucket:w.a.production.bucket,metadata:function(e,t,n){n(null,Object.assign({},e.body))},key:function(e,t,n){n(null,"ficha-"+e.params.codigo+".pdf")}}),limits:{fileSize:1e6},fileFilter:function(e,t,n){t.originalname.match(/\.(pdf)$/)||n(new Error("Please upload PDF only!")),n(void 0,!0)}}),P=function(e,t,n){var r=e.file;if(!r){var a=new Error("Please upload a file");return a.httpStatusCode=400,n(a)}e.uploadInfo={statusCode:200,status:"success",uploadedFile:r},n()},T=function(e,t,n){var r=e.file;if(!r){var a=new Error("Please upload a file");return a.httpStatusCode=400,n(a)}e.fileName=r.key,e.uploadInfo={statusCode:200,status:"success",uploadedFile:r},n()}},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return b})),n.d(t,"c",(function(){return y})),n.d(t,"b",(function(){return x}));var a=function(){function e(t,n,r,a,o,i,u,s,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.unidad_de_medida=t,this.codigo=n,this.descripcion=r,this.cantidad=a,this.valor_unitario=o,this.precio_unitario=i,this.subtotal=u,this.tipo_de_igv=1,this.igv=s,this.total=c}var t,n,a;return t=e,(n=[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"toJSON",value:function(e){var t={},n=e||this;Object.getOwnPropertyNames(n).forEach((function(e){var r=n[e];"toJSON"!==e&&"constructor"!==e&&(t[e]="function"!=typeof r?r:r.bind(t))}));var r=Object.getPrototypeOf(n);return null!==r&&Object.keys(this.toJSON(r)).forEach((function(e){t[e]||"constructor"===e||"toJSON"===e||("function"!=typeof r[e]?t[e]=r[e]:t[e]=r[e].bind(t))})),t}}])&&r(t.prototype,n),a&&r(t,a),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.operacion="generar_comprobante",this.tipo_de_comprobante=t.tipo_de_comprobante,1===this.tipo_de_comprobante?(this.cliente_tipo_de_documento="6",this.serie="FFF1"):(this.cliente_tipo_de_documento="1",this.serie="BBB1"),this.numero=t.numero,this.sunat_transaction=1,this.cliente_numero_de_documento=t.cliente_numero_de_documento,this.cliente_denominacion=t.cliente_denominacion,this.cliente_direccion=t.cliente_direccion||"",this.cliente_email=t.cliente_email||"",this.fecha_de_emision=t.fecha_de_emision,this.moneda=1,this.porcentaje_de_igv=18,this.total_gravada=t.total_gravada,this.total_igv=t.total_igv,this.total=t.total,this.detraccion=!1,this.enviar_automaticamente_a_la_sunat=!0,this.enviar_automaticamente_al_cliente=!1,this.formato_de_pdf="A4",this.items=t.items||[],this.guias=t.guias||[],this.codigo_unico=t.codigo_unico||"",this.cliente_email=t.cliente_email||"",this.enviar_automaticamente_al_cliente=t.enviar_automaticamente_al_cliente||!1,this.medio_de_pago=t.medio_de_pago}var t,n,r;return t=e,(n=[{key:"toString",value:function(){return Object.keys(this)}},{key:"toJSON",value:function(e){var t={},n=e||this;Object.getOwnPropertyNames(n).forEach((function(e){var r=n[e];"toJSON"!==e&&"constructor"!==e&&(t[e]="function"!=typeof r?r:r.bind(t))}));var r=Object.getPrototypeOf(n);return null!==r&&Object.keys(this.toJSON(r)).forEach((function(e){t[e]||"constructor"===e||"toJSON"===e||("function"!=typeof r[e]?t[e]=r[e]:t[e]=r[e].bind(t))})),t}}])&&o(t.prototype,n),r&&o(t,r),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t,n,r,a,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tipo_de_comprobante=t,this.numero=n,this.cliente_numero_de_documento=r,this.cliente_denominacion=a,this.fecha_de_emision=this.getNowDate(),this.items=[],this.guias=[],this.codigo_unico=o,this.medio_de_pago=i}var t,n,r;return t=e,(n=[{key:"getNowDate",value:function(){var e=(new Date).toLocaleDateString("es-PE").split("/"),t=e[0];return e[0]=e[1],e[1]=t,e.join("-")}},{key:"addDireccion",value:function(e){this.cliente_direccion=e}},{key:"addPrecios",value:function(e,t,n){this.total=n,this.total_gravada=e,this.total_igv=t}},{key:"addItem",value:function(e){this.items.push(e)}},{key:"addGuide",value:function(e){this.guias.push(e)}},{key:"build",value:function(){return new i(this)}},{key:"addEmail",value:function(e){this.enviar_automaticamente_al_cliente=!0,this.cliente_email=e}}])&&u(t.prototype,n),r&&u(t,r),e}(),c=n(1),d=n(10),p=n.n(d),l=n(32);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){v(o,r,a,i,u,"next",e)}function u(e){v(o,r,a,i,u,"throw",e)}i(void 0)}))}}var b=function(){var e=g(regeneratorRuntime.mark((function e(){var t,n,r,a,o,i,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:1,n=u.length>1&&void 0!==u[1]?u[1]:"",r=u.length>2&&void 0!==u[2]?u[2]:0,a=u.length>3&&void 0!==u[3]?u[3]:"",e.prev=4,o={operacion:"generar_anulacion",tipo_de_comprobante:t,serie:n,numero:r,motivo:a},e.next=8,p()("https://api.nubefact.com/api/v1/9e79db57-8322-4c1a-ac73-fa5093668c3c",{method:"post",headers:{"Content-Type":"application/json",Authorization:c.a.production.nbfToken},body:JSON.stringify(o)}).then((function(e){return e.json()}));case 8:return i=e.sent,e.abrupt("return",i.enlace_del_pdf);case 12:throw e.prev=12,e.t0=e.catch(4),e.t0;case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(new Date).toLocaleDateString("es-PE").split("/"),t=e[0];return e[0]=e[1],e[1]=t,e.join("-")},y=function(e,t,n){if(!e.body.venta.guia)return n();var r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},l);r.numero=e.countGuia+1,"factura"===e.ventResult.documento.type?r.cliente_tipo_de_documento=6:"boleta"===e.ventResult.documento.type&&(r.cliente_tipo_de_documento=1),r.cliente_numero_de_documento=e.ventResult.documento.codigo,r.cliente_denominacion=e.ventResult.documento.name,r.cliente_direccion=e.ventResult.documento.direccion||"",r.fecha_de_emision=h(),r.fecha_de_inicio_de_traslado=h(),r.numero_de_bultos=e.body.venta.bultos,r.peso_bruto_total=e.body.venta.peso,8===e.body.venta.transportista_codigo.length?(r.transportista_documento_tipo=1,r.tipo_de_transporte="02"):(r.transportista_documento_tipo=6,r.tipo_de_transporte="01"),r.transportista_documento_numero=e.body.venta.transportista_codigo,r.transportista_denominacion=e.body.venta.transportista_nombre,r.transportista_placa_numero=e.body.venta.transportista_placa,r.conductor_documento_tipo=r.transportista_documento_tipo,r.conductor_documento_numero=r.transportista_documento_numero,r.conductor_denominacion=r.transportista_denominacion,r.punto_de_partida_ubigeo=e.body.venta.partida_ubigeo,r.punto_de_partida_direccion=e.body.venta.partida_direccion,r.punto_de_llegada_ubigeo=e.body.venta.llegada_ubigeo,r.punto_de_llegada_direccion=e.body.venta.llegada_direccion,r.formato_de_pdf="A4",r.cliente_email=e.ventResult.cliente_email||"",r.enviar_automaticamente_a_la_sunat=!0,r.enviar_automaticamente_al_cliente=!0,p()("https://api.nubefact.com/api/v1/9e79db57-8322-4c1a-ac73-fa5093668c3c",{method:"post",headers:{"Content-Type":"application/json",Authorization:c.a.production.nbfToken},body:JSON.stringify(r)}).then((function(e){return e.json()})).then((function(t){e.sunat_guia=t,t.errors&&console.log("HANDLE"),n()})).catch((function(e){return t.status(e.status).json(e)}))},w=function(e){var t=e.medio_de_pago.split("|")[0],n=e.medio_de_pago.split("|")[1],r="";switch(t){case"efectivo":r="Efectivo";break;case"tarjeta":r="Tarjeta: "+n;break;case"yape":r="Yape: "+n;break;case"otro":r=n}return r},x=function(e,t,n){var r,o,i,u,d={};if("boleta"===e.ventResult.documento.type)r=e.ventResult,o=e.count,i=e.sunat_guia,(u=new s(2,1+o,r.documento.codigo,r.documento.name,r.codigo,w(r))).addPrecios(r.totalPriceNoIGV,r.totalPrice-r.totalPriceNoIGV,r.totalPrice),r.cliente_email&&u.addEmail(r.cliente_email),r.itemsVendidos.forEach((function(e){var t=new a("NIU",e.codigo,e.name+" | "+e.descripcion,e.cantidad,e.priceNoIGV,e.priceIGV,e.totalPriceNoIGV,e.totalPrice-e.totalPriceNoIGV,e.totalPrice);u.addItem(t.toJSON())})),r.guia&&u.addGuide({guia_tipo:1,guia_serie_numero:i.serie.toString()+"-"+i.numero}),d=u.build().toJSON();else{if("factura"!==e.ventResult.documento.type)return t.json({message:"Succes||".concat(e.ventResult.codigo),_sunat:null});d=function(e,t,n){var r=new s(1,1+t,e.documento.codigo,e.documento.name,e.codigo,w(e));return r.addPrecios(e.totalPriceNoIGV,e.totalPrice-e.totalPriceNoIGV,e.totalPrice),e.cliente_email&&r.addEmail(e.cliente_email),e.itemsVendidos.forEach((function(e){var t=new a("NIU",e.codigo,e.name+" | "+e.descripcion,e.cantidad,e.priceNoIGV,e.priceIGV,e.totalPriceNoIGV,e.totalPrice-e.totalPriceNoIGV,e.totalPrice);r.addItem(t.toJSON())})),r.addDireccion(e.documento.direccion),e.guia&&r.addGuide({guia_tipo:1,guia_serie_numero:n.serie.toString()+"-"+n.numero}),r.build().toJSON()}(e.ventResult,e.count,e.sunat_guia)}p()("https://api.nubefact.com/api/v1/9e79db57-8322-4c1a-ac73-fa5093668c3c",{method:"post",headers:{"Content-Type":"application/json",Authorization:c.a.production.nbfToken},body:JSON.stringify(d)}).then((function(e){return e.json()})).then((function(t){e.sunat=t,n()})).catch((function(n){return t.status(n.status||500).json({message:"Succes||".concat(e.ventResult.codigo),_sunat:null})}))}},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("node-fetch")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("tinify")},function(e,t,n){"use strict";var r=n(3),a=new r.Schema({name:{type:String},nameSecond:{type:String},cantidadDisponible:{type:Number},cantidadVenta:{type:Number}}),o=new r.Schema({type:{type:String,required:!0},name:{type:String,trim:!0},codigo:{type:Number,trim:!0},direccion:{type:String}},{_id:!1}),i=new r.Schema({codigo:{type:String,required:!0,trim:!0},name:{type:String,trim:!0},descripcion:{type:String,trim:!0},priceIGV:{type:Number,required:!0,trim:!0},priceNoIGV:{type:Number,required:!0,trim:!0},cantidad:{type:Number,required:!0,trim:!0,min:0},cantidadSC:{type:[a],default:[]},totalPrice:{type:Number},totalPriceNoIGV:{type:Number}},{_id:!1}),u=new r.Schema({codigo:{type:String,required:!0,trim:!0,unique:!0},totalPrice:{type:Number,trim:!0,required:!0},totalPriceNoIGV:{type:Number,trim:!0,required:!0},estado:{type:String,trim:!0,required:!0},documento:{type:o},itemsVendidos:{type:[i],required:!0},date:{type:Date,default:Date.now},vendedor:{type:String},tipoVendedor:{type:String,default:"admin"},medio_de_pago:{type:String},linkComprobante:{type:String},serie:{type:String},tipoComprobante:{type:String},numero:{type:Number},cliente_email:{type:String},guia_serie:{type:String},guia_numero:{type:String},guia:{type:Boolean,default:!1},guia_link:{type:String}});t.a=u},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(3),a=n(8),o=n.n(a);function i(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}var u=new r.Schema({username:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0},hashPassword:{type:String},type:{type:String,required:!0,trim:!0},created_date:{type:Date,default:Date.now},displayName:{type:String,required:!0,trim:!0},email:{type:String,trim:!0,unique:!0},dirOne:{type:String,trim:!0},dirTwo:{type:String,trim:!0},reference:{type:String,trim:!0},ciudad:{type:String,trim:!0},nombre:{type:String,trim:!0},apellido:{type:String,trim:!0},nomape:{type:String},googleCod:{type:String,unique:!0},documento:{type:String,trim:!0},tipoPersona:{type:String},verified:{type:Boolean,default:!1},celular:{type:String},ventaActiva:{type:String}});u.methods.comparePassword=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.a.compare(t,n);case 3:return r=e.sent,e.abrupt("return",r);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function u(e){i(o,r,a,u,s,"next",e)}function s(e){i(o,r,a,u,s,"throw",e)}u(void 0)}))});return function(e,n){return t.apply(this,arguments)}}()},function(e,t){e.exports=require("excel4node")},function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return m})),n.d(t,"a",(function(){return v}));var r=n(36),a=n.n(r),o=(n(43),n(18)),i=n(37),u=n(9),s=n.n(u);function c(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){c(o,r,a,i,u,"next",e)}function u(e){c(o,r,a,i,u,"throw",e)}i(void 0)}))}}var p=n(1).a.production,l=Object(o.promisify)(i.readFile),f=a.a.createTransport({host:p.BHOST,port:p.BPORT,secure:!1,auth:{user:p.BUSER,pass:p.BPASS}}),m=function(){var t=d(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,l(s.a.resolve(e,"../lib/email.html"),{encoding:"utf8"});case 3:return a=t.sent,t.next=6,f.sendMail({from:"siriodinar-no-replay@siriodinar.com",to:"hu3rtas@gmail.comdw",subject:"Confimar registro de cuenta en Sirio Dinar",html:a});case 6:t.sent,r.json({emailresult:"send"}),t.next=13;break;case 10:return t.prev=10,t.t0=t.catch(0),t.abrupt("return",r.status(500).json({errorMSG:t.t0}));case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e,n){return t.apply(this,arguments)}}(),v=function(){var t=d(regeneratorRuntime.mark((function t(n,r){var a,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,l(s.a.resolve(e,"../lib/email.html"),{encoding:"utf8"});case 3:return a=t.sent,n.savedUSer.hashPassword=void 0,o="".concat(p.link,"auth/confirmacion/").concat(n.savedUSer._id),i=a.replace("#replaceWithLink",'<a style="width: 100%; font-size: 20px; text-align: center; margin-top: 0.67em" href="'.concat(o,'" target="_blank">').concat(o,"</a>")),t.next=9,f.sendMail({from:"siriodinar-no-replay@siriodinar.com",to:n.savedUSer.email,subject:"Confimar registro de cuenta en Sirio Dinar",html:i});case 9:r.json(n.savedUSer),t.next=15;break;case 12:return t.prev=12,t.t0=t.catch(0),t.abrupt("return",r.status(500).json({link:!1}));case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e,n){return t.apply(this,arguments)}}()}).call(this,"/")},function(e,t,n){"use strict";(function(e){var r=n(9),a=n.n(r),o=n(5),i=n.n(o),u=n(11),s=n.n(u),c=n(28),d=n.n(c),p=n(29),l=n.n(p),f=n(20),m=n.n(f),v=n(12),g=n.n(v),b=n(6),h=n.n(b),y=n(39),w=n(35),x=n(40),S=n(38),k=n(1);g.a.key=k.a.production.tinyKey;var _=i()(),j=k.a.production.log();_.use(d()()),_.use(l()()),_.options("*",m()({credentials:!0,origin:k.a.production.origin})),_.use(m()({credentials:!0,origin:k.a.production.origin})),_.use(s.a.json()),_.use(s.a.urlencoded({extended:!0})),_.use((function(e,t,n){if(e.headers&&e.headers.authorization&&"JWT"===e.headers.authorization.split(" ")[0]){var r=e.headers.authorization;h.a.verify(r.split(" ")[1],k.a.production.jwtKey,{audience:r.split(" ")[2]+" "+r.split(" ")[3]},(function(t,r){e.user=t?void 0:r,n()}))}else e.user=void 0,n()})),_.use("/inventario",y.a),_.use("/auth",w.a),_.use("/ventas",x.a),_.use("/email",S.a),_.use("/static",i.a.static(a.a.join(e,"uploads"))),_.use((function(e,t,n,r){return n.status(e.status||500),j.error(e),n.json({error:{message:e.message}})})),t.a=_}).call(this,"/")},function(e,t){e.exports=require("util")},function(e){e.exports=JSON.parse('{"name":"inv-mannager","version":"1.5.0","description":"Manejo General De Inventario De Sirio Dinar","main":"index.js","scripts":{"build":"webpack -p","start":"node ./dist/main.js","dev:start":"nodemon --exec babel-node ./bin/www.js | bunyan"},"keywords":["inventario","siriodinar"],"author":"Tac Etarip","license":"ISC","devDependencies":{"@babel/core":"^7.10.2","@babel/node":"^7.10.1","@babel/preset-env":"^7.10.2","babel-loader":"^8.1.0","webpack":"^4.43.0","webpack-cli":"^3.3.12","webpack-node-externals":"^2.5.0"},"dependencies":{"aws-sdk":"^2.713.0","axios":"^0.21.1","babel-polyfill":"^6.26.0","bcrypt":"^5.0.0","body-parser":"^1.19.0","bunyan":"^1.8.14","compression":"^1.7.4","cors":"^2.8.5","dotenv":"^8.2.0","excel4node":"^1.7.2","express":"^4.17.1","helmet":"^3.23.3","jsonwebtoken":"^8.5.1","mongoose":"^5.9.18","multer":"^1.4.2","multer-s3":"^2.9.0","node-fetch":"^2.6.1","nodemailer":"^6.4.17","passport":"^0.4.1","passport-google-oauth":"^2.0.0","passport-google-oauth20":"^2.0.0","pdfkit":"^0.11.0","replace-in-file":"^6.1.0","throng":"^5.0.0","tinify":"^1.6.0-beta.2"},"engines":{"node":"12.18.x"}}')},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("multer-s3")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("throng")},function(e,t){e.exports=require("bunyan")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("aws-sdk")},function(e,t){e.exports=require("pdfkit")},function(e){e.exports=JSON.parse('{"operacion":"generar_guia","tipo_de_comprobante":7,"serie":"TTT1","numero":1800,"cliente_tipo_de_documento":6,"cliente_numero_de_documento":"20517738701","cliente_denominacion":"CLINICA JESUS DEL NORTE S.A.C","cliente_direccion":"","cliente_email":"","cliente_email_1":"","cliente_email_2":"","fecha_de_emision":"2020-12-16T00:00:00","observaciones":"","motivo_de_traslado":"01","peso_bruto_total":0,"numero_de_bultos":10,"tipo_de_transporte":"02","fecha_de_inicio_de_traslado":"2020-12-16T00:00:00","transportista_documento_tipo":6,"transportista_documento_numero":"20538260674","transportista_denominacion":"AQUALIV SAC","transportista_placa_numero":"AVD-798","conductor_documento_tipo":1,"conductor_documento_numero":"40513206","conductor_denominacion":"DIAZ RIVERA HELMER","punto_de_partida_ubigeo":"PROV0008","punto_de_partida_direccion":"AV. PROLONGACION CHILLON MZ B LT 1 INT 1","punto_de_llegada_ubigeo":"PROV0008","punto_de_llegada_direccion":"AV. CARLOS IZAGUIRRE NRO. 153 Z.I. NORTE LIMA - LIMA - INDE","enviar_automaticamente_a_la_sunat":true,"enviar_automaticamente_al_cliente":true,"codigo_unico":"","formato_de_pdf":"","items":[{"unidad_de_medida":"NIU","codigo":"02","descripcion":"BIDONES DE AGUA OZONIZADA POR 20 LT C/ENVASE","cantidad":10}]}')},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("passport-google-oauth20")},function(e,t,n){"use strict";var r=n(5),a=n(0),o=n(16),i=new r.Router;i.use(a.u.initialize()),i.post("/cambiarContrasena",a.f,a.g),i.post("/confirmarContr",a.f,a.h),i.put("/actCelular",a.f,a.a),i.put("/actCelular",a.f,a.a),i.post("/agregarDireccion",a.f,a.c),i.post("/agregarDocumento",a.f,a.d),i.post("/register",a.v),i.get("/google/callback",a.u.authenticate("google",{failureRedirect:"/failed",session:!1}),a.o,a.r),i.get("/google",a.u.authenticate("google",{scope:["profile","email"],session:!1})),i.post("/login",a.q),i.get("/userEx/:username",a.x),i.get("/emailEx/:email",a.k),i.post("/registerlow",a.w,o.a),i.post("/isValid",a.p),i.get("/confirmacion/:idUser",a.i),i.post("/loginfast",a.s,a.j),i.post("/getLoginInfoFromToken",a.l),i.get("/getUserInfo/:username",a.f,a.m),t.a=i},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var r=n(5),a=n.n(r),o=n(16),i=a.a.Router();i.get("/testSend",o.b),t.a=i},function(e,t,n){"use strict";var r=n(5),a=n(2),o=n(3),i=n.n(o),u=new o.Schema({name:{type:String,required:!0,unique:!0,trim:!0},date:{type:Date,default:Date.now},codigo:{type:String},subTipo:{type:[String],trim:!0}});function s(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){s(o,r,a,i,u,"next",e)}function u(e){s(o,r,a,i,u,"throw",e)}i(void 0)}))}}var d=i.a.model("Tipo",u),p=function(){var e=c(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=new d(t.body)).codigo=Date.now().toString(),r.subTipo=[],e.next=6,r.save();case 6:return a=e.sent,e.abrupt("return",n.json(a));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),l=function(){var e=c(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.updateOne({codigo:t.body.codigo},{$push:{subTipo:t.body.subTipo}});case 3:return e.abrupt("return",n.json({message:"succes"}));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=c(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.find({}).select("name codigo -_id");case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=c(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.params.tipoCod}).select("subTipo -_id");case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),v=function(){var e=c(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.params.codigo});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=c(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.body.codigo});case 3:return a=e.sent,t.beforeName=a.name,e.next=7,d.findOneAndUpdate({codigo:t.body.codigo},{name:t.body.name},{new:!0,useFindAndModify:!1});case 7:r(),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),b=function(){var e=c(regeneratorRuntime.mark((function e(t,n,r){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.body.codigo});case 3:return a=e.sent,o=a.subTipo.indexOf(t.body.antiguoSubName),a.subTipo[o]=t.body.newSubName,e.next=8,d.findOneAndUpdate({codigo:t.body.codigo},{subTipo:a.subTipo},{new:!0,useFindAndModify:!1});case 8:r(),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n,r){return e.apply(this,arguments)}}(),h=function(){var e=c(regeneratorRuntime.mark((function e(t,n,r){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.params.codigo});case 3:return a=e.sent,o=a.subTipo.indexOf(t.params.subTipoName),a.subTipo.splice(o,1),e.next=8,d.findOneAndUpdate({codigo:t.params.codigo},{subTipo:a.subTipo},{new:!0,useFindAndModify:!1});case 8:r(),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n,r){return e.apply(this,arguments)}}(),y=function(){var e=c(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.params.codigo});case 3:return a=e.sent,e.next=6,d.findOneAndDelete({codigo:t.params.codigo});case 6:t.tipoName=a.name,r(),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),w=n(4),x=n(0),S=new r.Router;S.get("/getItemsDestacados",a.w),S.get("/getItemsRelacionados/:tipo/:codigo",a.y),S.get("/getItemsSearch/:searchTerms",a.B),S.get("/getItemBalance/:codigo",x.t,a.u),S.get("/getItemReport/:codigo",x.t,a.v),S.get("/testFind",a.D),S.post("/addItem",x.t,a.c),S.post("/toFavorite",x.t,a.h),S.post("/toUnFavorite",x.t,a.i),S.get("/getItems",a.o),S.get("/getItemsByType/:tipo",a.q),S.get("/getItem/:tipo/:codigo",a.t),S.get("/getAllItemsSort/:subORtipo/:filtro/:tipoBusqueda/:tipoSort/:limit",a.p),S.get("/getTipo/:codigo",v),S.get("/getItemsSubTipo/:subTipo",a.r),S.put("/uploadVariationSC",x.t,a.C),S.put("/uploadVariationSimple",x.t,a.f),S.put("/modCant/:tipo",x.t,a.E),S.put("/updateItem",x.t,a.F),S.put("/updateTipo",x.t,g,a.H),S.delete("/deleteItem/:codigo",x.b,a.j,w.b),S.delete("/deleteTipo/:codigo",x.t,y,a.l),S.delete("/deleteSupTipo/:codigo/:subTipoName",x.t,h,a.k),S.put("/addSubTipo",x.t,l),S.put("/offer/add",x.t,a.d),S.put("/offer/remove",x.t,a.A),S.post("/addTipo",x.t,p),S.get("/getTipos",f),S.get("/getSubTipos/:tipoCod",m),S.get("/marcas/getAll",a.x),S.delete("/marcas/delete/:deleteString",x.t,a.m),S.post("/marcas/add",x.t,a.b),S.put("/uptateSupTipos",x.t,b,a.G),S.post("/uploads/image/:codigo",x.t,w.g.single("img"),w.f,w.a,a.I),S.post("/uploads/ficha/:codigo",x.t,w.h.single("pdf"),w.c,a.g),S.get("/image/:imgName",w.d),S.get("/pdf/:pdfName",w.e);t.a=S},function(e,t,n){"use strict";var r=n(5),a=n(3),o=n.n(a),i=n(13),u=n(23),s=n.n(u),c=n(1),d=n(15),p=n.n(d);function l(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}var v=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n,r,a){var o,i,u,s,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=new p.a.Workbook,i=o.addWorksheet(t,{sheetFormat:{defaultRowHeight:20,defaultColWidth:20}}),u=o.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00"}),s=o.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00",fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),i.row(2).setHeight(40),i.column(1).setWidth(10),i.column(4).setWidth(60),g(o,i,n),b(o,i,r),c=h(i,a,5,u,s),i.cell(c,5).string("Total").style(u).style({font:{size:14,bold:!0,color:"white"},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),i.cell(c,6).formula("SUBTOTAL(9,F5:F".concat(c-1,")")).style(u).style({font:{size:14,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),e.next=15,o.writeToBuffer();case 15:return d=e.sent,e.abrupt("return",d);case 19:throw e.prev=19,e.t0=e.catch(0),new Error(e.t0);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){m(o,r,a,i,u,"next",e)}function u(e){m(o,r,a,i,u,"throw",e)}i(void 0)}))});return function(e,n,r,a){return t.apply(this,arguments)}}(),g=function(e,t,n){var r=e.createStyle({font:{color:"white",size:16,bold:!0},alignment:{horizontal:"center",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#005087"}});t.cell(2,2,2,6,!0).string(n).style(r),t.row(3).setHeight(10)},b=function(e,t,n){var r,a=e.createStyle({font:{color:"white",size:14},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{horizontal:"left",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),o=2,i=l(n);try{for(i.s();!(r=i.n()).done;){var u=r.value;t.cell(4,o).string(u).style(a),o++}}catch(e){i.e(e)}finally{i.f()}t.row(4).filter({firstColumn:2,lastColumn:6})},h=function e(t,n,r,a,o){var i,u=r-5;if(u>=n.length)return 5;i=r%2==0?o:a;var s=new Date(n[u].date);t.cell(r,2).date(s.toLocaleDateString()).style(i).style({numberFormat:"dd-mm-yyy",alignment:{horizontal:"left",vertical:"center"}}),t.cell(r,3).string(n[u].codigo).style(i);var c="";return n[u].documento.name&&(c=n[u].documento.name+" | "+n[u].documento.codigo),t.cell(r,4).string(c).style(i),t.cell(r,5).number(n[u].totalPriceNoIGV).style(i),t.cell(r,6).number(n[u].totalPrice).style(i),1+e(t,n,r+1,a,o)};function y(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){x(o,r,a,i,u,"next",e)}function u(e){x(o,r,a,i,u,"throw",e)}i(void 0)}))}}var k=c.a.production.sunatToken,_=o.a.model("Venta",i.a),j=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.findOne({codigo:t.ventaCod});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),R=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,u,s,c,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.findOne({codigo:t.body.codigo});case 3:r=e.sent,a=Math.round(100*(r.totalPrice-t.body.totalPriceSC+Number.EPSILON))/100,o=N(a),i=0,u=0,s=y(r.itemsVendidos),e.prev=9,s.s();case 11:if((c=s.n()).done){e.next=19;break}if(d=c.value,t.body.itemCodigo!==d.codigo){e.next=17;break}return i=Math.round(100*(d.totalPrice-t.body.totalPriceSC+Number.EPSILON))/100,u=N(i),e.abrupt("break",19);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),s.e(e.t0);case 24:return e.prev=24,s.f(),e.finish(24);case 27:return e.next=29,_.findOneAndUpdate({codigo:t.body.codigo,itemsVendidos:{$elemMatch:{codigo:t.body.itemCodigo}}},{$pull:{"itemsVendidos.$.cantidadSC":{name:t.body.name,nameSecond:t.body.nameSecond}},$inc:{"itemsVendidos.$.cantidad":-t.body.cantidadVenta},$set:{"itemsVendidos.$.totalPrice":i,"itemsVendidos.$.totalPriceNoIGV":u,totalPrice:a,totalPriceNoIGV:o}},{new:!0,useFindAndModify:!1});case 29:p=e.sent,n.json(p),e.next=36;break;case 33:return e.prev=33,e.t1=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 36:case"end":return e.stop()}}),e,null,[[0,33],[9,21,24,27]])})));return function(t,n){return e.apply(this,arguments)}}(),O=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.findOne({codigo:t.body.codigo});case 3:return r=e.sent,a=Math.round(100*(r.totalPrice-t.body.totalItemPrice+Number.EPSILON))/100,o=N(a),e.next=8,_.findOneAndUpdate({codigo:t.body.codigo},{$pull:{itemsVendidos:{codigo:t.body.itemCodigo}},$set:{totalPrice:a,totalPriceNoIGV:o}},{new:!0,useFindAndModify:!1});case 8:i=e.sent,n.json(i),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),N=function(e){var t=e/1.18;return Math.round(100*(t+Number.EPSILON))/100},C=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.findOne({codigo:t.params.ventaCod});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),I=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noone"!==t.params.dateOne&&"noone"!==t.params.dateTwo){e.next=7;break}return e.next=4,_.find({estado:{$in:["ejecutada","anuladaPost"]}}).skip(parseInt(t.params.skip)).limit(parseInt(t.params.limit));case 4:r=e.sent,e.next=10;break;case 7:return e.next=9,_.find({estado:{$in:["ejecutada","anuladaPost"]},date:{$gte:new Date(t.params.dateOne),$lt:new Date(t.params.dateTwo)}}).skip(parseInt(t.params.skip)).limit(parseInt(t.params.limit));case 9:r=e.sent;case 10:n.json(r),e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}(),P=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noone"!==t.params.dateOne&&"noone"!==t.params.dateTwo){e.next=7;break}return e.next=4,_.aggregate([{$match:{estado:{$in:["ejecutada","anuladaPost"]}}},{$count:"cantidadVentas"}]);case 4:r=e.sent,e.next=10;break;case 7:return e.next=9,_.aggregate([{$match:{estado:{$in:["ejecutada","anuladaPost"]},date:{$gte:new Date(t.params.dateOne),$lt:new Date(t.params.dateTwo)}}},{$count:"cantidadVentas"}]);case 9:r=e.sent;case 10:n.json(r[0]),e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}(),T=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.post("https://api.migo.pe/api/v1/dni",{token:k,dni:t.params.dni});case 3:r=e.sent,n.json(r.data),e.next=18;break;case 7:if(e.prev=7,e.t0=e.catch(0),422!==e.t0.response.status){e.next=13;break}return e.abrupt("return",n.status(422).json({errorMSG:"Numero Invalido"}));case 13:if(404!==e.t0.response.status){e.next=17;break}return e.abrupt("return",n.status(404).json({errorMSG:"Documento No Encontrado"}));case 17:return e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.post("https://api.migo.pe/api/v1/ruc",{token:k,ruc:t.params.ruc});case 3:r=e.sent,n.json(r.data),e.next=18;break;case 7:if(e.prev=7,e.t0=e.catch(0),422!==e.t0.response.status){e.next=13;break}return e.abrupt("return",n.status(422).json({errorMSG:"Numero Invalido"}));case 13:if(404!==e.t0.response.status){e.next=17;break}return e.abrupt("return",n.status(404).json({errorMSG:"Documento No Encontrado"}));case 17:return e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),V=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.find({estado:"ejecutada",date:{$gte:new Date(t.params.dateOne),$lt:new Date(t.params.dateTwo)}});case 3:return r=e.sent,e.next=6,v("Ventas","Reporte De Ventas",["Fecha","Codigo","Para","Precio No IGV","Precio"],r);case 6:a=e.sent,n.writeHead(200,{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":"attachment; filename=reporte.xlsx"}),n.write(a,"binary"),n.end(null,"binary"),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),G=function(){var e=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new _(t.body),e.next=4,M();case 4:return r.codigo=e.sent,e.next=7,r.save();case 7:a=e.sent,n.json(a),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}(),M=function(){var e=S(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.countDocuments({});case 3:n=e.sent,r="SD01-000000",e.t0=t,e.next="factura"===e.t0?8:"boleta"===e.t0?10:12;break;case 8:return r="E002-000000",e.abrupt("break",13);case 10:return r="EB02-000000",e.abrupt("break",13);case 12:return e.abrupt("break",13);case 13:for(a=0;a<n.toString().length;a++)r=r.slice(0,-1);return o=r+n.toString(),e.abrupt("return",o);case 18:return e.prev=18,e.t1=e.catch(0),e.abrupt("return",res.status(500).json({errorMSG:e.t1}));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t){return e.apply(this,arguments)}}(),E=n(2),D=n(0),U=n(7),$=new r.Router;$.post("/generarVenta",D.t,G),$.put("/eliminarItemVenta",D.t,O),$.put("/eliminarItemSCVenta",D.t,R),$.put("/anularVentaPost",D.t,E.K),$.get("/dni/:dni",D.f,T),$.get("/createExcelReport/:dateOne/:dateTwo",D.t,V),$.get("/getEjecutadas/:skip/:limit/:dateOne/:dateTwo",D.t,I),$.get("/getCantidadVentas/:estado/:dateOne/:dateTwo",D.t,P),$.get("/testTotal",D.t,E.s),$.get("/ruc/:ruc",D.f,A),$.get("/obtenerVenta/:ventaCod",D.t,C),$.post("/ventaSimple",D.t,E.M,U.c,U.b,E.a),$.post("/agregarVenta",D.t,E.n,D.e),$.get("/ventasPendientes",D.t,D.n,j),$.post("/agregarItemVenta",D.t,E.e),$.post("/ventasForCard",D.t,E.z),$.post("/ejecutarVenta",D.t,E.L,U.c,U.b,E.a),$.put("/anularVenta",D.t,E.J);t.a=$},function(e,t,n){n(42),e.exports=n(44)},function(e,t){e.exports=require("babel-polyfill")},function(e,t){e.exports=require("replace-in-file")},function(e,t,n){"use strict";n.r(t);var r=n(25),a=n.n(r),o=n(26),i=n.n(o),u=n(3),s=n.n(u),c=n(1);function d(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}var p=c.a.production.log(),l=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.connect(t,{useNewUrlParser:!0,useUnifiedTopology:!0,useCreateIndex:!0});case 3:return e.abrupt("return",p.info("Connected To DataBase"));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",p.error(e.t0));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){d(o,r,a,i,u,"next",e)}function u(e){d(o,r,a,i,u,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),f=n(17);n(24).config();var m=a.a.createServer(f.a),v=c.a.production.PORT,g=c.a.production.log(),b=process.env.WEB_CONCURRENCY||1;f.a.set("port",v);i()({worker:function(e,t){g.info("Id Worker ".concat(e)),m.listen(v||0),l(c.a.production.mongoKey)},count:b}),m.on("listening",(function(){g.info("Hi there! I'm listening on port ".concat(m.address().port," in ").concat(f.a.get("env")," mode."))}))}]);