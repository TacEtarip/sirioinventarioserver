/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={212:(e,t,r)=>{const n=require("http");var o=r.n(n);const a=require("throng");var i=r.n(a);const s=require("bunyan");var c=r.n(s);const u=JSON.parse('{"u2":"inv-mannager","i8":"1.7.0"}');r(142).config();var d=u.u2,p=u.i8,l=function(e,t,r){return c().createLogger({name:"".concat(e,":").concat(t),level:r})};const f={development:{PORT:process.env.PORT,mongoKey:process.env.MONGO_KEY,tinyKey:process.env.TINY_KEY,jwtKey:process.env.JWT_KEY,jwtLogin:process.env.JWT_LOGIN,jwtGoogleLogin:process.env.JWT_GOOGLE_LOGIN,awsID:process.env.AWS_ID,awsKey:process.env.AWS_KEY,bucket:process.env.S3_BUCKET,sunatToken:process.env.SUNAT_TOKEN,googleClientID:process.env.GOOGLE_CLIENT_ID,googleClientSecret:process.env.GOOGLE_CLIENT_SECRET,callBackUrl:process.env.CALLBACK_URL_TEST,BHOST:process.env.HOST_SENDIBLUE,BPORT:process.env.PORT_SENDIBLUE,BUSER:process.env.USER_SENDIBLUE,BPASS:process.env.PASSWORD_SENDIBLUE,nbfToken:process.env.NBF_TOKEN,reToken:process.env.RE_TOKEN,emailFrom:"loginmanager@siriodinar.com",version:p,link:"http://localhost:5000/",link_front:"http://localhost:4000/",origin:["http://localhost:4200","http://localhost:4000"],log:function(){return l(d,p,"debug")}},production:{PORT:process.env.PORT,mongoKey:process.env.MONGO_KEY,tinyKey:process.env.TINY_KEY,jwtKey:process.env.JWT_KEY,jwtLogin:process.env.JWT_LOGIN,jwtGoogleLogin:process.env.JWT_GOOGLE_LOGIN,awsID:process.env.AWS_ID,awsKey:process.env.AWS_KEY,bucket:process.env.S3_BUCKET,sunatToken:process.env.SUNAT_TOKEN,googleClientID:process.env.GOOGLE_CLIENT_ID,googleClientSecret:process.env.GOOGLE_CLIENT_SECRET,callBackUrl:process.env.CALLBACK_URL,BHOST:process.env.HOST_SENDIBLUE,BPORT:process.env.PORT_SENDIBLUE,BUSER:process.env.USER_SENDIBLUE,BPASS:process.env.PASSWORD_SENDIBLUE,nbfToken:process.env.NBF_TOKEN,reToken:process.env.RE_TOKEN,version:p,emailFrom:"loginmanager@siriodinar.com",link:"https://inventario-sirio-dinar.herokuapp.com/",link_front:"https://inventario.siriodinar.com/",origin:["https://inventario.siriodinar.com","https://sirio-inventario-front.herokuapp.com"],log:function(){return l(d,p,"debug")}}},m=require("compression");var h=r.n(m);const y=require("cookie-parser");var g=r.n(y);const v=require("cors");var b=r.n(v);const w=require("express");var x=r.n(w);const S=require("helmet");var $=r.n(S);const j=require("jsonwebtoken");var O=r.n(j);const k=require("path");var T=r.n(k);const _=require("tinify");var E=r.n(_);const C=require("fs"),N=require("nodemailer");var V=r.n(N);const L=require("util");function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function I(){I=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==P(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(P(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function A(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function G(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){A(a,n,o,i,s,"next",e)}function s(e){A(a,n,o,i,s,"throw",e)}i(void 0)}))}}var M=f.production,q=(0,L.promisify)(C.readFile),D=V().createTransport({host:M.BHOST,port:M.BPORT,secure:!1,auth:{user:M.BUSER,pass:M.BPASS}}),R=function(){var e=G(I().mark((function e(t,r){var n,o,a;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,q(T().resolve("server/lib/emailContacto.html"),{encoding:"utf8"});case 3:return n=e.sent,o=n.replace("#replaceWithLinkOne","Mensaje de ".concat(t.body.nombre," ").concat(t.body.apellido,", su correo es: ").concat(t.body.email)),a=o.replace("#replaceWithLinkTwo",t.body.mensaje),e.next=8,D.sendMail({from:"siriodinar-no-replay@siriodinar.com",to:M.BUSER,subject:"Mensaje Contacto",html:a});case 8:r.json({enviado:!0}),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}(),F=function(){var e=G(I().mark((function e(t,r){var n,o,a;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,q(T().resolve("server/lib/email.html"),{encoding:"utf8"});case 3:return n=e.sent,t.savedUSer.hashPassword=void 0,o="".concat(M.link,"auth/confirmacion/").concat(t.savedUSer._id),a=n.replace("#replaceWithLink",'<a style="width: 400px; font-size: 20px; text-align: center; margin-top: 0.67em" href="'.concat(o,'" target="_blank">').concat(o,"</a>")),e.next=9,D.sendMail({from:"siriodinar-no-replay@siriodinar.com",to:t.savedUSer.email,subject:"Confimar registro de cuenta en Sirio Dinar",html:a});case 9:r.json(t.savedUSer),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({link:!1}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r){return e.apply(this,arguments)}}();const U=require("bcrypt");var B=r.n(U);const z=require("mongoose");var W=r.n(z);const K=require("passport");var J=r.n(K);const H=require("passport-google-oauth20");var Y=r.n(H);function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function Z(){Z=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==Q(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Q(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function X(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var ee=new z.Schema({username:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0},hashPassword:{type:String},type:{type:String,required:!0,trim:!0},created_date:{type:Date,default:Date.now},displayName:{type:String,required:!0,trim:!0},email:{type:String,trim:!0,unique:!0},dirOne:{type:String,trim:!0},dirTwo:{type:String,trim:!0},reference:{type:String,trim:!0},ciudad:{type:String,trim:!0},nombre:{type:String,trim:!0},apellido:{type:String,trim:!0},nomape:{type:String},googleCod:{type:String,unique:!0},documento:{type:String,trim:!0},tipoPersona:{type:String},verified:{type:Boolean,default:!1},celular:{type:String},ventaActiva:{type:[String],default:[]},carrito:{type:String,default:"not"}});function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function re(){re=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==te(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(te(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function ne(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function oe(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ne(a,n,o,i,s,"next",e)}function s(e){ne(a,n,o,i,s,"throw",e)}i(void 0)}))}}ee.methods.comparePassword=function(){var e,t=(e=Z().mark((function e(t,r){var n;return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,B().compare(t,r);case 3:return n=e.sent,e.abrupt("return",n);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){X(a,n,o,i,s,"next",e)}function s(e){X(a,n,o,i,s,"throw",e)}i(void 0)}))});return function(e,r){return t.apply(this,arguments)}}();var ae=W().model("User",ee),ie=Y().Strategy,se=J().use(new ie({clientID:f.production.googleClientID,clientSecret:f.production.googleClientSecret,callbackURL:f.production.callBackUrl},(function(e,t,r,n){return n(null,r)}))),ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split(" ").join("");return e.startsWith("+")||(t="+51"+e.split(" ").join("")),t},ue=function(){var e=oe(re().mark((function e(t,r,n){var o,a,i;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=t.body.displayName.toLowerCase(),(a=new ae(t.body)).celular=ce(t.body.celular),a.username=o,e.next=7,B().hash(t.body.password,10);case 7:return a.hashPassword=e.sent,a.type="low",a.nombre=t.body.nombre.toUpperCase(),a.apellido=t.body.apellido.toUpperCase(),e.next=13,a.save();case 13:(i=e.sent).hashPassword=void 0,t.savedUSer=i,n(),e.next=22;break;case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,r,n){return e.apply(this,arguments)}}(),de=function(){var e=oe(re().mark((function e(t,r){return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findById(t.body.idUser);case 3:if(!1!==e.sent.verified){e.next=6;break}return e.abrupt("return",r.json({reload:!1}));case 6:return e.abrupt("return",r.json({reload:!0}));case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),pe=function(){var e=oe(re().mark((function e(t,r){var n,o;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findById(t.params.idUser);case 3:if(!1!==(n=e.sent).verified){e.next=9;break}return o=O().sign({_id:n._id},f.production.jwtLogin,{expiresIn:"120s"}),e.next=8,ae.findByIdAndUpdate(n._id,{verified:!0},{useFindAndModify:!1});case 8:return e.abrupt("return",r.redirect("".concat(f.production.link_front,"login/auto/").concat(o)));case 9:return e.abrupt("return",r.status(202).send("<h1>Este usuario ya esta verificado.</h1>"));case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r){return e.apply(this,arguments)}}(),le=function(){var e=oe(re().mark((function e(t,r,n){return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O().verify(t.body.loginToken,f.production.jwtLogin,(function(e,o){if(e)return"TokenExpiredError"===e.name?r.status(400).json({error:"Token Expirado"}):r.status(500).json({error:e.message});t.logintoken=o,n()}));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),fe=function(){var e=oe(re().mark((function e(t,r){var n;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findById(t.logintoken._id);case 3:return n=e.sent,e.abrupt("return",r.json({displayName:n.displayName,username:n.username,success:!0,message:"Success",type:n.type,token:O().sign({aud:n.username+" "+n.type,_id:n.id},f.production.jwtKey)}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),me=function(){var e=oe(re().mark((function e(t,r){var n;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.exists({username:t.params.username.toLowerCase()});case 3:return n=e.sent,e.abrupt("return",r.json({exists:n}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),he=function(){var e=oe(re().mark((function e(t,r){var n;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.exists({email:t.params.email.toLowerCase()});case 3:return n=e.sent,e.abrupt("return",r.json({exists:n}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),ye=function(){var e=oe(re().mark((function e(t,r,n){var o;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.exists({email:t.user._json.email});case 3:if(!e.sent){e.next=6;break}return e.abrupt("return",n());case 6:return o=O().sign(t.user._json,f.production.jwtGoogleLogin,{expiresIn:"30s"}),e.abrupt("return",r.redirect("".concat(f.production.link_front,"login/registro/").concat(o)));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ge=function(){var e=oe(re().mark((function e(t,r,n){var o,a;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findOneAndUpdate({email:t.user._json.email},{verified:!0},{new:!0,useFindAndModify:!1});case 3:return o=e.sent,a=O().sign({_id:o._id},f.production.jwtLogin,{expiresIn:"120s"}),e.next=7,ae.findByIdAndUpdate(o._id,{verified:!0},{useFindAndModify:!1});case 7:return e.abrupt("return",r.redirect("".concat(f.production.link_front,"login/auto/").concat(a)));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r,n){return e.apply(this,arguments)}}(),ve=function(){var e=oe(re().mark((function e(t,r){return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O().verify(t.body.loginToken,f.production.jwtGoogleLogin,(function(e,t){return e?"TokenExpiredError"===e.name?r.status(400).json({error:"Token Expirado"}):r.status(500).json({error:e.message}):r.json(t)}));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),be=function(e,t,r){if(!e.user||"admin"!==e.user.aud.split(" ")[1])return t.status(401).json({message:"Usuario No Autorizado"});r()},we=function(e,t,r){if(!e.user||"low"!==e.user.aud.split(" ")[1])return t.status(401).json({message:"Usuario No Autorizado"});r()},xe=function(e,t,r){if(!e.user||"vent"!==e.user.aud.split(" ")[1]&&"admin"!==e.user.aud.split(" ")[1]&&"contador"!==e.user.aud.split(" ")[1])return t.status(401).json({message:"Usuario No Autorizado"});r()},Se=function(e,t,r){if(!e.user||"vent"!==e.user.aud.split(" ")[1]&&"admin"!==e.user.aud.split(" ")[1])return t.status(401).json({message:"Usuario No Autorizado"});r()},$e=function(e,t,r){if(!e.user)return t.status(401).json({message:"Usuario No Autorizado"});r()},je=function(){var e=oe(re().mark((function e(t,r){var n,o,a;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body.username,(o=new ae(t.body)).displayName=n,o.username=n.toLowerCase(),e.next=7,B().hash(t.body.password,10);case 7:return o.hashPassword=e.sent,e.next=10,o.save();case 10:return(a=e.sent).hashPassword=void 0,e.abrupt("return",r.json(a));case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",r.status(e.t0.status||400).send({message:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),Oe=function(){var e=oe(re().mark((function e(t,r){var n;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findOne({username:t.body.username.toLowerCase()});case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).json({username:t.body.username,success:!1,message:"Authenticacion failed. No user found!",token:null}));case 6:return e.next=8,n.comparePassword(t.body.password,n.hashPassword);case 8:if(e.sent){e.next=12;break}return e.abrupt("return",r.status(400).json({username:t.body.username,success:!1,message:"Authenticacion failed. Incorrect Password!",token:null}));case 12:return e.abrupt("return",r.json({displayName:n.displayName,username:n.username,success:!0,message:"Success",type:n.type,token:O().sign({aud:n.username+" "+n.type,_id:n.id},f.production.jwtKey)}));case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),e.t0;case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),ke=function(){var e=oe(re().mark((function e(t,r){var n;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findOne({username:t.params.username.toLowerCase()});case 3:(n=e.sent).hashPassword=void 0,r.json(n),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Te=function(){var e=oe(re().mark((function e(t,r){var n;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findOne({username:t.user.aud.split(" ")[0]});case 3:(n=e.sent).hashPassword=void 0,r.json(n),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),_e=function(){var e=oe(re().mark((function e(t,r){var n;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findOneAndUpdate({_id:t.body.id},{celular:ce(t.body.celular)},{useFindAndModify:!1,new:!0});case 3:(n=e.sent).hashPassword=void 0,r.json(n),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Ee=function(){var e=oe(re().mark((function e(t,r){var n;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findOneAndUpdate({_id:t.body.id},{dirOne:t.body.dirOne,dirTwo:t.body.dirTwo||"",reference:t.body.reference,city:"Trujillo, La Libertad. Perú"},{useFindAndModify:!1,new:!0});case 3:(n=e.sent).hashPassword=void 0,r.json(n),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Ce=function(){var e=oe(re().mark((function e(t,r){var n;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findOneAndUpdate({_id:t.body.id},{documento:t.body.documento,tipoPersona:t.body.tipoPersona},{useFindAndModify:!1,new:!0});case 3:(n=e.sent).hashPassword=void 0,r.json(n),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Ne=function(){var e=oe(re().mark((function e(t,r){var n;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findById(t.body.id);case 3:return n=e.sent,e.next=6,n.comparePassword(t.body.oldPassword,n.hashPassword);case 6:if(e.sent){e.next=8;break}return e.abrupt("return",r.json({valid:!1}));case 8:r.json({valid:!0}),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}(),Ve=function(){var e=oe(re().mark((function e(t,r){var n,o;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findById(t.body.id);case 3:return n=e.sent,e.next=6,n.comparePassword(t.body.passwordOld,n.hashPassword);case 6:if(e.sent){e.next=8;break}return e.abrupt("return",r.json({changed:!1}));case 8:return e.next=10,B().hash(t.body.password,10);case 10:return o=e.sent,e.next=13,ae.findByIdAndUpdate(t.body.id,{hashPassword:o},{new:!0,useFindAndModify:!1});case 13:return e.abrupt("return",r.json({changed:!0}));case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,r){return e.apply(this,arguments)}}(),Le=function(){var e=oe(re().mark((function e(t,r){return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findOneAndUpdate({username:t.user.aud.split(" ")[0]},{$push:{ventaActiva:t.saveResult.codigo}},{useFindAndModify:!1});case 3:r.json({message:"Venta generada con el codigo: ".concat(t.saveResult.codigo),venta:t.saveResult}),e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}(),Pe=function(){var e=oe(re().mark((function e(t,r,n){var o;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findOne({username:t.user.aud.split(" ")[0]});case 3:o=e.sent,r.json(o.ventaActiva),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ie=function(){var e=oe(re().mark((function e(t,r,n){var o;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae.findOne({username:t.user.aud.split(" ")[0]});case 3:if(!((o=e.sent).ventaActiva.lenght>4)){e.next=6;break}return e.abrupt("return",r.status(409).json({message:"Ya tienes 5 ventas activas."}));case 6:t.ventaCod=o.ventaActiva,n(),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ae=function(){var e=oe(re().mark((function e(t,r,n){var o,a,i;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=t.body.displayName.toLowerCase(),(a=new ae(t.body)).celular=ce(t.body.celular),a.username=o,e.next=7,B().hash(t.body.password,10);case 7:return a.hashPassword=e.sent,a.type="low",a.nombre=t.body.nombre.toUpperCase(),a.apellido=t.body.apellido.toUpperCase(),a.verified=!0,e.next=14,a.save();case 14:return(i=e.sent).hashPassword=void 0,e.abrupt("return",r.json({displayName:i.displayName,username:i.username,success:!0,message:"Success",type:i.type,token:O().sign({aud:i.username+" "+i.type,_id:i.id},f.production.jwtKey)}));case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ge=new w.Router;Ge.use(se.initialize()),Ge.post("/cambiarContrasena",$e,Ve),Ge.post("/confirmarContr",$e,Ne),Ge.put("/actCelular",$e,_e),Ge.post("/agregarDireccion",$e,Ee),Ge.post("/agregarDocumento",$e,Ce),Ge.post("/register",je),Ge.get("/google/callback",se.authenticate("google",{failureRedirect:"/failed",session:!1}),ye,ge),Ge.get("/google",se.authenticate("google",{scope:["profile","email"],session:!1})),Ge.post("/login",Oe),Ge.get("/userEx/:username",me),Ge.get("/emailEx/:email",he),Ge.post("/registerlow",ue,F),Ge.post("/isValid",de),Ge.get("/confirmacion/:idUser",pe),Ge.post("/loginfast",le,fe),Ge.post("/loginGoogleRegistro",Ae),Ge.post("/getLoginInfoFromToken",ve),Ge.get("/getUserInfo/:username",$e,ke),Ge.get("/getOwnUser",$e,Te);const Me=Ge;var qe=new z.Schema({name:{type:String},nameSecond:{type:String},cantidadDisponible:{type:Number},cantidadVenta:{type:Number}},{_id:!1}),De=new z.Schema({codigo:{type:String,required:!0,trim:!0},tipo:{type:String,trim:!0,default:"producto"},name:{type:String,trim:!0},descripcion:{type:String,trim:!0},priceIGV:{type:Number,required:!0,trim:!0},priceNoIGV:{type:Number,required:!0,trim:!0},priceCosto:{type:Number,default:0},cantidad:{type:Number,required:!0,trim:!0,min:0},cantidadSC:{type:[qe],default:[]},totalPrice:{type:Number},totalPriceNoIGV:{type:Number},unidadDeMedida:{type:String},photo:{type:String},ventaCod:{type:String}},{_id:!1}),Re=new z.Schema({type:{type:String,required:!0},name:{type:String,trim:!0,default:""},codigo:{type:Number,trim:!0},direccion:{type:String}},{_id:!1}),Fe=new z.Schema({user:{type:String,trim:!0},rating:{type:Number,default:0},date:{type:Date,default:Date.now}},{_id:!1}),Ue=new z.Schema({name:{type:String,trim:!0,required:!0},nameSecond:{type:String,trim:!0},cantidad:{type:Number,min:0}},{_id:!1}),Be=new z.Schema({name:{type:String,trim:!0,required:!0},nameSecond:{type:String,trim:!0},order:{type:[Ue]}},{_id:!1}),ze=new z.Schema({date:{type:Date,default:Date.now},cantidad:{type:Number,default:0,min:0},tipo:{type:Boolean,default:!1},comentario:{type:String,trim:!0},costoVar:{type:Number},cantidadSC:{type:[qe],default:[]},usuario:{type:String,default:"desconocido"}},{_id:!1}),We=new z.Schema({name:{type:String,required:!0,trim:!0,unique:!0},nameLowerCase:{type:String,trim:!0,lowercase:!0},priceIGV:{type:Number,required:!0},priceNoIGV:{type:Number},cantidad:{type:Number,default:0,min:0},subConteo:{type:Be},variaciones:{type:[ze]},codigo:{type:String,required:!0,trim:!0,unique:!0},tipo:{type:String,required:!0,trim:!0},subTipo:{type:String,default:"noone",trim:!0},unidadDeMedida:{type:String,default:"UND",trim:!0},oferta:{type:Number,default:0},date:{type:Date,default:Date.now},description:{type:String,trim:!0},photo:{type:String,trim:!0,default:"noPhoto.jpg"},ficha:{type:Boolean,default:!1},marca:{type:String,default:"noone"},costoPropio:{type:Number},multiSearchParams:{type:String,trim:!0},deleted:{type:Boolean,default:!1},tags:{type:[String],default:[]},caracteristicas:{type:[String],default:[]},orderNumber:{type:Number,default:-1},reviews:{type:[Fe],default:[]},googleCategory:{type:String,default:"2047"}});We.index({nameLowerCase:"text",tipo:"text",subTipo:"text",marca:"text",description:"text",tags:"text"});const Ke=We,Je=new z.Schema({codigo:{type:String,required:!0,trim:!0,unique:!0},totalPrice:{type:Number,trim:!0,required:!0},totalPriceNoIGV:{type:Number,trim:!0,required:!0},estado:{type:String,trim:!0,required:!0},documento:{type:Re},itemsVendidos:{type:[De],required:!0},date:{type:Date,default:Date.now},vendedor:{type:String},tipoVendedor:{type:String,default:"admin"},medio_de_pago:{type:String},linkComprobante:{type:String},serie:{type:String},tipoComprobante:{type:String},numero:{type:Number},cliente_email:{type:String},guia_serie:{type:String},guia_numero:{type:String},guia:{type:Boolean,default:!1},guia_link:{type:String},carrito_venta:{type:Boolean,default:!1},estado_carrito_comprando:{type:Boolean,default:!1}});function He(e){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},He(e)}function Ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(r),!0).forEach((function(t){var n,o,a;n=e,o=t,a=r[t],(o=function(e){var t=function(e,t){if("object"!==He(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==He(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===He(t)?t:String(t)}(o))in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ye(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ze(){Ze=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==He(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(He(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Xe(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function et(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Xe(a,n,o,i,s,"next",e)}function s(e){Xe(a,n,o,i,s,"throw",e)}i(void 0)}))}}var tt=W().model("Item",Ke),rt=W().model("Venta",Je),nt=W().model("User",ee),ot=[{cod:0,mensaje:"Item Eliminado"},{cod:1,mensaje:"Cambio de precio"},{cod:2,mensaje:"Cantidad agotada"}],at=function(){var e=et(Ze().mark((function e(t,r){var n,o,a,i,s,c,u,d,p,l,f,m,h,y,g,v,b,w,x,S,$,j,O,k;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(n=e.sent).startTransaction(),e.prev=4,e.next=7,nt.findOne({username:t.user.aud.split(" ")[0]});case 7:return o=e.sent,e.next=10,tt.findOne({codigo:t.body.codigo});case 10:if((a=e.sent).subConteo&&(i=""!==a.subConteo.nameSecond?a.subConteo.order.find((function(e){return e.name===t.body.orderToAdd.name&&e.nameSecond===t.body.orderToAdd.nameSecond})):a.subConteo.order.find((function(e){return e.name===t.body.orderToAdd.name}))),!a.deleted){e.next=19;break}return e.next=15,n.abortTransaction();case 15:return n.endSession(),e.abrupt("return",r.status(410).json({errorMSG:"El item ha sido elminado"}));case 19:if(a.priceIGV===t.body.priceIGV){e.next=26;break}return e.next=22,n.abortTransaction();case 22:return n.endSession(),e.abrupt("return",r.status(409).json({errorMSG:"El precio del producto ha cambiado"}));case 26:if(!(a.cantidad<t.body.cantidad)){e.next=33;break}return e.next=29,n.abortTransaction();case 29:return n.endSession(),e.abrupt("return",r.status(409).json({errorMSG:"Ya no contamos con la cantidad deseada"}));case 33:if(!a.subConteo){e.next=39;break}if(!(i.cantidad<t.body.cantidad)){e.next=39;break}return e.next=37,n.abortTransaction();case 37:return n.endSession(),e.abrupt("return",r.status(409).json({errorMSG:"Ya no contamos con la cantidad deseada"}));case 39:if("not"!==o.carrito){e.next=54;break}return(s=new rt({totalPrice:t.body.cantidad*a.priceIGV,totalPriceNoIGV:t.body.cantidad*a.priceNoIGV,estado:"pendiente",vendedor:t.user.aud.split(" ")[0],tipoVendedor:"low",medio_de_pago:"efectivo",cliente_email:o.email,itemsVendidos:[],carrito_venta:!0})).itemsVendidos.push({codigo:a.codigo,tipo:"producto",descripcion:a.description,name:a.name,priceIGV:a.priceIGV,priceNoIGV:a.priceNoIGV,priceCosto:a.costoPropio,cantidad:t.body.cantidad,cantidadSC:[],totalPrice:t.body.cantidad*a.priceIGV,totalPriceNoIGV:t.body.cantidad*a.priceNoIGV,unidadDeMedida:a.unidadDeMedida,photo:a.photo}),a.subConteo&&(""!==a.subConteo.nameSecond?s.itemsVendidos[0].cantidadSC.push({name:i.name,nameSecond:i.nameSecond,cantidadDisponible:i.cantidad,cantidadVenta:t.body.cantidad}):s.itemsVendidos[0].cantidadSC.push({name:i.name,nameSecond:void 0,cantidadDisponible:i.cantidad,cantidadVenta:t.body.cantidad})),e.next=45,it();case 45:return c=e.sent,s.codigo=c,e.next=49,s.save();case 49:return t.ventaGenerada=e.sent,e.next=52,nt.findOneAndUpdate({username:t.user.aud.split(" ")[0]},{carrito:t.ventaGenerada.codigo},{useFindAndModify:!1,new:!0});case 52:e.next=100;break;case 54:return e.next=56,rt.findOne({codigo:o.carrito});case 56:if(u=e.sent,-1!==(d=u.itemsVendidos.findIndex((function(e){return e.codigo===a.codigo})))){e.next=66;break}return p={codigo:a.codigo,tipo:"producto",descripcion:a.description,name:a.name,priceIGV:a.priceIGV,priceNoIGV:a.priceNoIGV,priceCosto:a.costoPropio,cantidad:t.body.cantidad,cantidadSC:[],totalPrice:t.body.cantidad*a.priceIGV,totalPriceNoIGV:t.body.cantidad*a.priceNoIGV,unidadDeMedida:a.unidadDeMedida,photo:a.photo},a.subConteo&&(""!==a.subConteo.nameSecond?p.cantidadSC.push({name:i.name,nameSecond:i.nameSecond,cantidadDisponible:i.cantidad,cantidadVenta:t.body.cantidad}):p.cantidadSC.push({name:i.name,nameSecond:void 0,cantidadDisponible:i.cantidad,cantidadVenta:t.body.cantidad})),e.next=63,rt.findOneAndUpdate({codigo:o.carrito},{$push:{itemsVendidos:p},$inc:{totalPrice:p.totalPrice,totalPriceNoIGV:p.totalPriceNoIGV}},{useFindAndModify:!1,new:!0});case 63:t.ventaGenerada=e.sent,e.next=100;break;case 66:if(!(d>-1)){e.next=100;break}if(!a.subConteo){e.next=93;break}if(l=-1,-1!==(l=""===a.subConteo.nameSecond?u.itemsVendidos[d].cantidadSC.findIndex((function(e){return e.name===i.name})):u.itemsVendidos[d].cantidadSC.findIndex((function(e){return e.name===i.name&&e.nameSecond===i.nameSecond})))){e.next=81;break}return f=u.itemsVendidos[d].cantidad+t.body.cantidad,m=a.priceIGV*f,h=a.priceNoIGV*f,y=u.totalPrice-u.itemsVendidos[d].totalPrice+m,g=u.totalPriceNoIGV-u.itemsVendidos[d].totalPriceNoIGV+h,e.next=78,rt.findOneAndUpdate({codigo:o.carrito,"itemsVendidos.codigo":a.codigo},{totalPrice:y,totalPriceNoIGV:g,$set:{"itemsVendidos.$.priceIGV":a.priceIGV,"itemsVendidos.$.priceNoIGV":a.priceNoIGV,"itemsVendidos.$.priceCosto":a.costoPropio,"itemsVendidos.$.cantidad":f,"itemsVendidos.$.totalPriceNoIGV":h,"itemsVendidos.$.totalPrice":m},$push:{"itemsVendidos.$.cantidadSC":{name:i.name,nameSecond:i.nameSecond||void 0,cantidadDisponible:i.cantidad,cantidadVenta:t.body.cantidad}}},{useFindAndModify:!1,new:!0});case 78:t.ventaGenerada=e.sent,e.next=91;break;case 81:return v=u.itemsVendidos[d].cantidad-u.itemsVendidos[d].cantidadSC[l].cantidadVenta+t.body.cantidad,b=a.priceIGV*v,w=a.priceNoIGV*v,x=u.totalPrice-u.itemsVendidos[d].totalPrice+b,S=u.totalPriceNoIGV-u.itemsVendidos[d].totalPriceNoIGV+w,u.itemsVendidos[d].cantidadSC[l].cantidadDisponible=i.cantidad,u.itemsVendidos[d].cantidadSC[l].cantidadVenta=t.body.cantidad,e.next=90,rt.findOneAndUpdate({codigo:o.carrito,"itemsVendidos.codigo":a.codigo},{totalPrice:x,totalPriceNoIGV:S,$set:{"itemsVendidos.$.priceIGV":a.priceIGV,"itemsVendidos.$.priceNoIGV":a.priceNoIGV,"itemsVendidos.$.priceCosto":a.costoPropio,"itemsVendidos.$.cantidad":v,"itemsVendidos.$.totalPriceNoIGV":w,"itemsVendidos.$.totalPrice":b,"itemsVendidos.$.cantidadSC":u.itemsVendidos[d].cantidadSC}},{useFindAndModify:!1,new:!0});case 90:t.ventaGenerada=e.sent;case 91:e.next=100;break;case 93:return $=t.body.cantidad*a.priceIGV,j=t.body.cantidad*a.priceNoIGV,O=u.totalPrice-u.itemsVendidos[d].totalPrice+$,k=u.totalPriceNoIGV-u.itemsVendidos[d].totalPriceNoIGV+j,e.next=99,rt.findOneAndUpdate({codigo:o.carrito,"itemsVendidos.codigo":a.codigo},{totalPrice:O,totalPriceNoIGV:k,$set:{"itemsVendidos.$.priceIGV":a.priceIGV,"itemsVendidos.$.priceNoIGV":a.priceNoIGV,"itemsVendidos.$.priceCosto":a.costoPropio,"itemsVendidos.$.cantidad":t.body.cantidad,"itemsVendidos.$.totalPriceNoIGV":j,"itemsVendidos.$.totalPrice":$}},{useFindAndModify:!1,new:!0});case 99:t.ventaGenerada=e.sent;case 100:return e.next=102,n.commitTransaction();case 102:return n.endSession(),e.abrupt("return",r.json(t.ventaGenerada));case 106:return e.prev=106,e.t0=e.catch(4),e.next=110,n.abortTransaction();case 110:return n.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 112:case"end":return e.stop()}}),e,null,[[4,106]])})));return function(t,r){return e.apply(this,arguments)}}(),it=function(){var e=et(Ze().mark((function e(){var t,r,n,o;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,rt.countDocuments({});case 3:for(e.t0=e.sent,t=e.t0+1,r="SD01-000000",n=0;n<t.toString().length;n++)r=r.slice(0,-1);return o=r+t.toString(),e.abrupt("return",o);case 11:return e.prev=11,e.t1=e.catch(0),e.abrupt("return",res.status(500).json({errorMSG:e.t1}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),st=function(){var e=et(Ze().mark((function e(t,r){var n,o,a,i,s,c,u,d,p,l,f,m,h,y;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(n=e.sent).startTransaction(),e.prev=4,e.next=7,rt.aggregate([{$match:{codigo:t.carrito_codigo}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}},{$sort:{codigo:-1}}]);case 7:for(o=e.sent,a=[{cod:0,mensaje:"Item Eliminado"},{cod:1,mensaje:"Cambio de precio"}],i=[],s=[],c="",u=0;u<o.length;u++)o[u].codigo!==c&&s.push(o[u].codigo),c=o[u].codigo;return e.next=15,tt.aggregate([{$match:{codigo:{$in:s}}},{$sort:{codigo:-1}}]);case 15:d=e.sent,p=[],l=0,f="",m="",h=Ze().mark((function e(r){var n,s,c,u;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d[l].deleted){e.next=8;break}if(f===d[l].codigo){e.next=6;break}return f=d[l].codigo,i.push(Qe(Qe({},a[0]),{},{item_cod:d[l].codigo,item_name:d[l].name})),e.next=6,rt.findOneAndUpdate({codigo:t.carrito_codigo},{$inc:{totalPrice:-o[r].cantidad*o[r].priceIGV,totalPriceNoIGV:-o[r].cantidad*o[r].priceNoIGV},$pull:{itemsVendidos:{codigo:f}}},{useFindAndModify:!1,new:!0});case 6:e.next=20;break;case 8:if(d[l].priceIGV===o[r].priceIGV||m===d[l].codigo){e.next=15;break}return m=d[l].codigo,i.push(Qe(Qe({},a[1]),{},{item_cod:d[l].codigo,item_name:d[l].name})),n=d[l].priceIGV*o[r].cantidad,s=d[l].priceNoIGV*o[r].cantidad,e.next=15,rt.findOneAndUpdate({codigo:t.carrito_codigo,"itemsVendidos.codigo":d[l].codigo},{$inc:{totalPrice:n-o[r].totalPrice,totalPriceNoIGV:s-o[r].totalPriceNoIGV},$set:{"itemsVendidos.$.totalPrice":n,"itemsVendidos.$.totalPriceNoIGV":s,"itemsVendidos.$.priceIGV":d[l].priceIGV,"itemsVendidos.$.priceNoIGV":d[l].priceNoIGV}},{useFindAndModify:!1,new:!0});case 15:o[r].priceIGV=d[l].priceIGV,o[r].priceNoIGV=d[l].priceNoIGV,o[r].totalPrice=d[l].priceIGV*o[r].cantidad,o[r].totalPriceNoIGV=d[l].priceNoIGV*o[r].cantidad,d[l].subConteo?(c=o[r],u=d[l].subConteo.order.find((function(e){return e.name===c.cantidadSC.name&&e.nameSecond===o[r].cantidadSC.nameSecond})),p.push(Qe(Qe({},o[r]),{},{cantidadDisponible:u.cantidad,codVent:t.carrito_codigo}))):p.push(Qe(Qe({},o[r]),{},{cantidadDisponible:d[l].cantidad,codVent:t.carrito_codigo}));case 20:o[r].codigo!==(o[r+1]?o[r+1].codigo:"xxxxx")&&l++;case 21:case"end":return e.stop()}}),e)})),y=0;case 22:if(!(y<o.length)){e.next=27;break}return e.delegateYield(h(y),"t0",24);case 24:y++,e.next=22;break;case 27:return e.next=29,n.commitTransaction();case 29:n.endSession(),r.json({carrito:p,cod_carrito:t.carrito_codigo,estado_carrito:t.estadoCarrito,alerts:i}),e.next=39;break;case 33:return e.prev=33,e.t1=e.catch(4),e.next=37,n.abortTransaction();case 37:return n.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t1}));case 39:case"end":return e.stop()}}),e,null,[[4,33]])})));return function(t,r){return e.apply(this,arguments)}}(),ct=function(){var e=et(Ze().mark((function e(t,r){var n,o;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!((o=t.carritoActual[0]).cantidadSC&&o.cantidad-o.cantidadSC.cantidadVenta>0)){e.next=8;break}return e.next=5,rt.findOneAndUpdate({codigo:t.body.codVent,"itemsVendidos.codigo":t.body.codigo},{$inc:{totalPrice:-o.cantidadSC.cantidadVenta*o.priceIGV,totalPriceNoIGV:-o.cantidadSC.cantidadVenta*o.priceNoIGV,"itemsVendidos.$.cantidad":-o.cantidadSC.cantidadVenta,"itemsVendidos.$.totalPrice":-o.cantidadSC.cantidadVenta*o.priceIGV,"itemsVendidos.$.totalPriceNoIGV":-o.cantidadSC.cantidadVenta*o.priceNoIGV},$pull:{"itemsVendidos.$.cantidadSC":{name:o.cantidadSC.name,nameSecond:o.cantidadSC.nameSecond}}},{useFindAndModify:!1,new:!0});case 5:n=e.sent,e.next=11;break;case 8:return e.next=10,rt.findOneAndUpdate({codigo:t.body.codVent},{$inc:{totalPrice:-o.cantidad*o.priceIGV,totalPriceNoIGV:-o.cantidad*o.priceNoIGV},$pull:{itemsVendidos:{codigo:o.codigo}}},{useFindAndModify:!1,new:!0});case 10:n=e.sent;case 11:t.newCarrito=n,r.json(n),e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),ut=function(){var e=et(Ze().mark((function e(t,r,n){var o;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,nt.findOne({username:t.user.aud.split(" ")[0]});case 3:o=e.sent,t.carrito_codigo=o.carrito,n(),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),dt=function(){var e=et(Ze().mark((function e(t,r,n){var o,a;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,rt.findOne({codigo:t.body.codVent});case 3:if(o=e.sent,t.estadoCarrito=o.estado_carrito_comprando,!t.body.cantidadSC){e.next=11;break}return e.next=8,rt.aggregate([{$match:{codigo:t.body.codVent}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}},{$match:{codigo:t.body.codigo}},{$match:{"cantidadSC.name":t.body.cantidadSC.name}},{$match:{"cantidadSC.nameSecond":t.body.cantidadSC.nameSecond}},{$sort:{codigo:-1}}]);case 8:a=e.sent,e.next=14;break;case 11:return e.next=13,rt.aggregate([{$match:{codigo:t.body.codVent}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}},{$match:{codigo:t.body.codigo}}]);case 13:a=e.sent;case 14:if(0!==a.length){e.next=16;break}return e.abrupt("return",r.status(409).json());case 16:t.carritoActual=a,n(),e.next=23;break;case 20:return e.prev=20,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t,r,n){return e.apply(this,arguments)}}(),pt=function(){var e=et(Ze().mark((function e(t,r){var n,o,a,i;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,nt.findOne({username:t.user.aud.split(" ")[0]});case 3:return n=e.sent,t.carrito_codigo=n.carrito,o=[],t.body.carrito.forEach((function(e){o.push(e.codigo)})),e.next=9,tt.aggregate([{$match:{codigo:{$in:o}}},{$sort:{codigo:-1}}]);case 9:a=e.sent,i=lt([],a,t.body.carrito),r.json(i),e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,r){return e.apply(this,arguments)}}(),lt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(r[a].deleted&&t.push(Qe(Qe({},ot[0]),{},{item_cod:r[a].codigo,item_name:r[a].name})),r[a].priceIGV!==n[o].priceIGV&&t.push(Qe(Qe({},ot[1]),{},{item_cod:r[a].codigo,item_name:r[a].name})),n[o].cantidadSC){var i=r[a].subConteo.order.find((function(e){return e.name===n[o].cantidadSC.name&&e.nameSecond===n[o].cantidadSC.nameSecond}));i.cantidad-n[o].cantidadSC.cantidad<0&&t.push(Qe(Qe({},ot[2]),{},{item_cod:r[a].codigo,item_name:r[a].name+" | "+i.carrito[o].cantidadSC.name+" "+i.carrito[o].cantidadSC.nameSecond}))}else r[a].cantidad-n[o].cantidad<0&&t.push(Qe(Qe({},ot[2]),{},{item_cod:r[a].codigo,item_name:r[a].name}));return n[o].codigo!==(n[o+1]?n[o+1].codigo:"xxxxx")&&a++,o+1===n.length?t:(o++,e(t,r,n,o,a))},ft=new w.Router;ft.post("/agregarItem",we,at),ft.post("/removeProductoDeCarrito",we,dt,ct),ft.post("/iniciarCompra",we,pt),ft.get("/getCarrito",we,ut,st);const mt=ft,ht=require("@aws-sdk/client-s3"),yt=require("excel4node");var gt=r.n(yt);function vt(e){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vt(e)}function bt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function wt(){wt=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==vt(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(vt(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function xt(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var St=function(){var e,t=(e=wt().mark((function e(t,r,n,o,a,i,s){var c,u,d,p,l,f,m,h,y=arguments;return wt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(c=y.length>7&&void 0!==y[7]?y[7]:[],e.prev=1,u=new(gt().Workbook),d=u.addWorksheet(t,{sheetFormat:{defaultRowHeight:20,defaultColWidth:20},pageSetup:{orientation:"portrait"}}),p=u.createStyle({font:{color:"black",size:12,bold:!0},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"},top:{style:"thin",color:"#15181C"}},alignment:{vertical:"center",wrapText:!0},numberFormat:"[$S/-es-PE]#,##0.00"}),l=u.createStyle({font:{color:"black",size:12,bold:!0},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"}},alignment:{vertical:"center",wrapText:!0},numberFormat:"[$S/-es-PE]#,##0.00",fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),d.column(1).setWidth(5),d.column(2).setWidth(15),d.column(3).setWidth(15),d.column(4).setWidth(15),d.column(5).setWidth(60),d.column(6).setWidth(15),d.column(7).setWidth(15),d.column(8).setWidth(15),15,f=Ot(d,o.itemsVendidos,15,p,l,15,s),jt(u,d,n,14),$t(u,d,r,o,i.observaciones),d.cell(f,7).string("Sub Total").style(p).style({font:{size:14,bold:!0,color:"white"},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),d.cell(f,8).formula("SUBTOTAL(9,H5:H".concat(f-1,")")).style(p).style({font:{size:14,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),d.cell(f+1,7).string("IGV").style(p),d.cell(f+1,8).formula("H".concat(f," * ",.18)).style(p),d.cell(f+2,7).string("Envio").style(p).style({font:{size:14,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),d.cell(f+2,8).number(i.envio||0).style(p).style({font:{size:12,bold:!1,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),d.cell(f+3,7).string("Otro").style(p).style({font:{size:14,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),d.cell(f+3,8).number(i.otro||0).style(p).style({font:{size:12,bold:!1,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),d.cell(f+4,7).string("Total").style(p).style({font:{size:14,bold:!0,color:"white"},fill:{type:"pattern",patternType:"solid",fgColor:"#005087"}}),d.cell(f+4,8).formula("H".concat(f," + H").concat(f+1," + H").concat(f+2," + H").concat(f+3)).style(p).style({font:{size:14,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),d.cell(f+1,1,f+1,5,!0).style(p).string("BCP - SOLES: 570-2650880-0-39").style({font:{size:12,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),d.cell(f+2,1,f+2,5,!0).style(p).string("C.C.I. - SOLES: 002-57000265088003903").style({font:{size:12,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),i.porPagar&&d.cell(f+3,1,f+3,5,!0).style(p).string("SALDO A CANCELAR S/"+(i.porPagar.toString()||"")).style({font:{size:12,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"#f1a054"}}),d.row(f).setHeight(20),d.row(f+1).setHeight(20),d.row(f+2).setHeight(20),d.row(f+3).setHeight(20),d.row(f+4).setHeight(20),m=1;m<14;m++)d.row(m).setHeight(20);return d.setPrintArea(1,1,f+4,8),d.addImage({image:a,type:"picture",position:{type:"absoluteAnchor",x:"1.5mm",y:"1.5mm"}}),s&&c.forEach((function(e,t){d.addImage({image:e.Body,type:"picture",position:{type:"twoCellAnchor",from:{col:2,colOff:"1mm",row:15+t,rowOff:"1mm"},to:{col:2,colOff:"35mm",row:15+t,rowOff:"35mm"}}})})),e.next=42,u.writeToBuffer();case 42:return h=e.sent,e.abrupt("return",h);case 46:throw e.prev=46,e.t0=e.catch(1),new Error(e.t0);case 49:case"end":return e.stop()}}),e,null,[[1,46]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){xt(a,n,o,i,s,"next",e)}function s(e){xt(a,n,o,i,s,"throw",e)}i(void 0)}))});return function(e,r,n,o,a,i,s){return t.apply(this,arguments)}}(),$t=function(e,t,r,n,o){var a=e.createStyle({font:{color:"white",size:16,bold:!0},alignment:{horizontal:"center",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#005087"}});t.cell(4,5,4,8,!0).string(n.codigo).style(a).style({font:{color:"black",size:12,bold:!1},fill:{fgColor:"white"}});var i=new Date(n.date);t.cell(5,5,5,8,!0).date(i.toLocaleDateString()).style(a).style({font:{color:"black",size:14,bold:!1},fill:{fgColor:"white"}}).style({numberFormat:"dd-mm-yyy"}),t.cell(6,5,6,8,!0).string("Sirio Dinar - RUC: 20605746587").style(a).style({font:{color:"#005087",size:12,bold:!0},fill:{fgColor:"white"}}),t.cell(7,5,7,8,!0).link("https://inventario.siriodinar.com").style(a).style({font:{color:"#e87200",size:12,bold:!0},fill:{fgColor:"white"}}),t.cell(9,5,9,8,!0).string("Observaciones:").style(a).style({font:{color:"white",size:12,bold:!0},alignment:{horizontal:"left"},fill:{fgColor:"#005087"},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"},top:{style:"thin",color:"#15181C"}}}),t.cell(10,5,13,8,!0).string(o||"").style(a).style({font:{color:"black",size:12,bold:!1},fill:{fgColor:"white"},alignment:{horizontal:"left",vertical:"center"},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"},top:{style:"thin",color:"#15181C"}}}),t.cell(10,1,10,4,!0).string("Enviar a:").style(a).style({font:{color:"white",size:12,bold:!0},alignment:{horizontal:"left"},fill:{fgColor:"#005087"},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"},top:{style:"thin",color:"#15181C"}}}),t.cell(11,1,13,4,!0).string("".concat(n.documento.name," | ").concat(n.documento.codigo," ").concat(n.cliente_email?"\nemail: "+n.cliente_email:""," ").concat(n.celular_cliente?"\nCelular: "+n.celular_cliente:"")).style(a).style({font:{color:"black",size:12,bold:!1},fill:{fgColor:"white"},alignment:{horizontal:"left",vertical:"center",wrapText:!0},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"},top:{style:"thin",color:"#15181C"}}}),t.cell(7,1,7,4,!0).string("Jr. Pardo y Aliaga Nro. 207. Trujillo - Perú").style(a).style({font:{color:"black",size:12,bold:!0},fill:{fgColor:"white"},alignment:{horizontal:"left"}}),t.cell(8,1,8,4,!0).string("+51 977 426 349 | +51 922 412 404").style(a).style({font:{color:"black",size:12,bold:!0},fill:{fgColor:"white"},alignment:{horizontal:"left"}})},jt=function(e,t,r,n){var o,a=e.createStyle({font:{color:"white",size:12,bold:!0},border:{right:{style:"thin",color:"#15181C"},left:{style:"thin",color:"#15181C"},bottom:{style:"thin",color:"#15181C"}},alignment:{horizontal:"center",vertical:"center",wrapText:!0},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),i=1,s=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return bt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?bt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}(r);try{for(s.s();!(o=s.n()).done;){var c=o.value;t.cell(n,i).string(c).style(a),i++}}catch(e){s.e(e)}finally{s.f()}t.row(n).filter({firstColumn:1,lastColumn:r.length}),t.row(n).setHeight(40)},Ot=function e(t,r,n,o,a,i,s){var c,u=n-i;if(u>=r.length)return i;s?t.row(n).setHeight(85):t.row(n).setHeight(35),c=n%2==0?a:o,t.cell(n,1).number(u+1).style(c).style({numberFormat:"0"}).style({alignment:{horizontal:"center"}}),t.cell(n,2).string("").style(c).style({alignment:{wrapText:!0}}),t.cell(n,3).string(r[u].unidadDeMedida||"UND").style(c).style({alignment:{wrapText:!0,horizontal:"center"}}),t.cell(n,4).string(r[u].name).style(c).style({alignment:{horizontal:"center",wrapText:!0}});var d=r[u].descripcion||"";if(r[u].cantidadSC&&r[u].cantidadSC.length>0){d+=". Detalle:";for(var p=0;p<r[u].cantidadSC.length;p++)r[u].cantidadSC[p].cantidadVenta>0&&(d=d+" ".concat(r[u].cantidadSC[p].name," ").concat(r[u].cantidadSC[p].nameSecond?"- ".concat(r[u].cantidadSC[p].nameSecond,": "):": ")+r[u].cantidadSC[p].cantidadVenta+"".concat(r[u].cantidadSC.length+1<p?",":"."))}return t.cell(n,5).string(d).style(c).style({alignment:{wrapText:!0}}),t.cell(n,6).number(r[u].cantidad).style(c).style({numberFormat:"0"}).style({alignment:{horizontal:"center"}}),t.cell(n,7).number(r[u].priceNoIGV).style(c),t.cell(n,8).formula("F".concat(n," * G").concat(n)).style(c),1+e(t,r,n+1,o,a,i,s)};const kt=require("luxon"),Tt=require("pdfmake");function _t(e){return function(e){if(Array.isArray(e))return Nt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ct(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ct(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function Ct(e,t){if(e){if("string"==typeof e)return Nt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Nt(e,t):void 0}}function Nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Vt=new(r.n(Tt)())({Courier:{normal:"Courier",bold:"Courier-Bold",italics:"Courier-Oblique",bolditalics:"Courier-BoldOblique"},Helvetica:{normal:"Helvetica",bold:"Helvetica-Bold",italics:"Helvetica-Oblique",bolditalics:"Helvetica-BoldOblique"},Times:{normal:"Times-Roman",bold:"Times-Bold",italics:"Times-Italic",bolditalics:"Times-BoldItalic"},Symbol:{normal:"Symbol"},ZapfDingbats:{normal:"ZapfDingbats"}}),Lt={pageMargins:[40,40,40,50],content:[{style:"tableEnviar",table:{widths:["*","*"],body:[[{image:"",width:100,border:[!1,!1,!1,!1],style:"headerTitle"},{text:[{text:"",fontSize:18,bold:!0},{text:"\nSirio Dinar - RUC: 20605746587",color:"darkblue",fontSize:12},{text:"\ninventario.siriodinar.com",color:"orange",fontSize:12}],rowSpan:2,alignment:"center",style:"headerTitlePrinc",border:[!0,!0,!0,!1]}],[{text:"Jr. Pardo y Aliaga Nro. 207. Trujillo - Perú \n +51 977 426 349 | +51 922 412 404",width:100,height:100,border:[!1,!1,!1,!1],style:"headerTitle"}]]}},{style:"tableEnviar",table:{heights:[15,60],widths:[165,331],body:[[{text:"Enviar a:",fillColor:"#005087",bold:!0,color:"#EAF6FF",style:"tableMargin"},{text:"Observaciones:",fillColor:"#005087",bold:!0,color:"#EAF6FF",style:"tableMargin"}],[{text:"",border:[!0,!0,!0,!1],style:"tableMargin"},{text:"RR",border:[!0,!0,!0,!1],style:"tableMargin"}]]}},{style:"tableHeader",table:{heights:[15],widths:[15,97,35,70,120,35,35,35],body:[[{text:"Nº",style:"tableMarginSH"},{text:"IMAGÉN",style:"tableMarginSH"},{text:"UDM",style:"tableMarginSH"},{text:"NOMBRE",style:"tableMarginSH"},{text:"DESCRIPCIÓN",style:"tableMarginSH"},{text:"CANT.",style:"tableMarginSH"},{text:"P/CU",style:"tableMarginSH"},{text:"TOTAL",style:"tableMarginSH"}]]}},{layout:{paddingTop:function(e,t){return Pt(t,e,"center"),0}},style:{fontSize:10,bold:!1,alignment:"center"},table:{dontBreakRows:!0,heights:40,widths:[15,97,35,70,120,35,35,35],body:[]}},{style:"totales",table:{dontBreakRows:!0,heights:15,widths:[79,79],body:[[{text:"Sub Total:",border:[!0,!1,!1,!0],fillColor:"#E87100",color:"white",style:"totalesMargin"},{text:"S/ 111.00",border:[!0,!1,!0,!0],alignment:"right",style:"totalesMargin"}],[{text:"IGV:",color:"grey",style:"totalesMargin"},{text:"S/ 111.00",alignment:"right",color:"grey",style:"totalesMargin"}],[{text:"Envio:",color:"grey",style:"totalesMargin"},{text:"S/ 111.00",alignment:"right",color:"grey",style:"totalesMargin"}],[{text:"Otro:",color:"grey",style:"totalesMargin"},{text:"S/ 111.00",alignment:"right",color:"grey",style:"totalesMargin"}],[{text:"Total:",fillColor:"#005087",color:"white",style:"totalesMargin"},{text:"S/ 111.00",alignment:"right",style:"totalesMargin"}]]}}],styles:{totalesMargin:{margin:[0,5,0,0]},tableMarginSH:{margin:[0,5,0,0],fillColor:"#E87100",color:"#EAF6FF"},tableMargin:{fontSize:10,margin:[2,5,2,2]},headerTitlePrinc:{margin:[0,40,0,0],fontSize:14},headerTitle:{margin:[0,0,0,5]},header:{fontSize:18,bold:!0,margin:[10,10,10,10]},subheader:{fontSize:16,bold:!0,margin:[0,10,10,10]},tableEnviar:{margin:[0,0,0,0]},tableHeader:{bold:!0,fontSize:10,alignment:"center"},totales:{margin:[338,0,0,0]},marginSN:{margin:[2,12,2,6]}},defaultStyle:{font:"Helvetica",lineHeight:1.2}},Pt=function(e,t,r){var n=e.table.body[t].map((function(t,r){var n=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=function(e){if(void 0===e)return{height:0,width:0};var n,o=0,a=Et(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;(r+=i.width)>t?(o+=i.height,r=i.width):o=Math.max(i.height,o)}}catch(e){a.e(e)}finally{a.f()}return{height:o,width:r}};if(e._offsets&&(r+=e._offsets.total),e._inlines&&e._inlines.length)return n(e._inlines);if(e.stack&&e.stack[0])return e.stack.map((function(e){return n(e._inlines)})).reduce((function(e,t){return{height:e.height+t.height,width:Math.max(e.width+t.width)}}));if(e.table){var o,a=0,i=Et(e.table.body);try{for(i.s();!(o=i.n()).done;){var s=o.value.map((function(e){var n=undefined.findInlineHeight(e,t,r);return r=n.width,n.height}));a=Math.max.apply(Math,_t(s).concat([a]))}}catch(e){i.e(e)}finally{i.f()}return{height:a,width:r}}return e._height?(r+=e._width,{height:e._height,width:r}):{height:null,width:r}}(t,e.table.widths[r]._calcWidth);return n.height})),o=Math.max.apply(Math,_t(n));e.table.body[t].forEach((function(e,t){var a;n[t]&&o>n[t]&&("bottom"===r?a=o-n[t]:"center"===r&&(a=(o-n[t])/2),e._margin?e._margin[1]=a:e._margin=[0,a,0,0])}))},It=function(e,t,r,n,o){At(e,t,r),o?(Lt.content[2].table={heights:[15],widths:[15,97,35,70,120,35,35,35],body:[[{text:"Nº",style:"tableMarginSH"},{text:"IMAGÉN",style:"tableMarginSH"},{text:"UDM",style:"tableMarginSH"},{text:"NOMBRE",style:"tableMarginSH"},{text:"DESCRIPCIÓN",style:"tableMarginSH"},{text:"CANT.",style:"tableMarginSH"},{text:"P/CU",style:"tableMarginSH"},{text:"TOTAL",style:"tableMarginSH"}]]},Lt.content[3].table={dontBreakRows:!0,heights:40,widths:[15,97,35,70,120,35,35,35],body:[]}):(Lt.content[2].table={heights:[15],widths:[20,35,83,193,40,40,40],body:[[{text:"Nº",style:"tableMarginSH"},{text:"UDM",style:"tableMarginSH"},{text:"NOMBRE",style:"tableMarginSH"},{text:"DESCRIPCIÓN",style:"tableMarginSH"},{text:"CANT.",style:"tableMarginSH"},{text:"P/CU",style:"tableMarginSH"},{text:"TOTAL",style:"tableMarginSH"}]]},Lt.content[3].table={heights:50,dontBreakRows:!0,widths:[20,35,83,193,40,40,40],body:[]}),Gt(t,n,o);var a=0;r.envio&&(a=r.envio);var i=0;return r.otro&&(i=r.otroR),Lt.content[4].table.body[0][1].text="S/ "+t.totalPriceNoIGV.toFixed(2),Lt.content[4].table.body[1][1].text="S/ "+(Math.round(100*(t.totalPrice-t.totalPriceNoIGV))/100).toFixed(2),Lt.content[4].table.body[2][1].text="S/ "+a.toFixed(2),Lt.content[4].table.body[3][1].text="S/ "+i.toFixed(2),Lt.content[4].table.body[4][1].text="S/ "+((r.otro||0)+(r.envio||0)+t.totalPrice).toFixed(2),Vt.createPdfKitDocument(Lt)},At=function(e,t,r){var n=kt.DateTime.fromJSDate(t.date).toFormat("c LL yyyy").toLocaleString();Lt.content[0].table.body[0][0].image=e,Lt.content[0].table.body[0][1].text[0].text="".concat(t.codigo,"\n").concat(n.split(" ").join("/")),Lt.content[1].table.body[1][1].text=r.observaciones,Lt.content[1].table.body[1][0].text="".concat(t.documento.name," | ").concat(t.documento.codigo).concat(t.cliente_email?"\nemail: ".concat(t.cliente_email):"").concat("+51"===t.celular_cliente?"":"\nCelular:".concat(t.celular_cliente))},Gt=function(e,t,r){var n=[];e.itemsVendidos.forEach((function(e,o){var a=e.descripcion||"";if(e.cantidadSC&&e.cantidadSC.length>0){a+=". Detalle:";for(var i=0;i<e.cantidadSC.length;i++)e.cantidadSC[i].cantidadVenta>0&&(a=a+" ".concat(e.cantidadSC[i].name," ").concat(e.cantidadSC[i].nameSecond?"- ".concat(e.cantidadSC[i].nameSecond,": "):": ")+e.cantidadSC[i].cantidadVenta+"".concat(e.cantidadSC.length+1<i?",":"."))}r?n.push([{text:o+1,style:"tableMarginN"},{image:t[o].Body,width:95,height:95},{text:e.unidadDeMedida,style:"tableMarginN"},{text:e.name,style:"tableMarginN"},{text:a,alignment:"justify"},{text:e.cantidad.toString(),style:"tableMarginN"},{text:"S/"+e.priceNoIGV.toString(),style:"tableMarginN"},{text:"S/"+e.totalPriceNoIGV.toString(),style:"tableMarginN"}]):n.push([{text:o+1,style:"marginSN"},{text:e.unidadDeMedida,style:"marginSN"},{text:e.name,style:"marginSN"},{text:a,alignment:"justify",style:"marginSN"},{text:e.cantidad.toString(),style:"marginSN"},{text:"S/"+e.priceNoIGV.toString(),style:"marginSN"},{text:"S/"+e.totalPriceNoIGV.toString(),style:"marginSN"}]),Lt.content[3].table.body=n}))};const Mt=new z.Schema({codigo:{type:String,required:!0,trim:!0,unique:!0},totalPrice:{type:Number,trim:!0,required:!0},totalPriceNoIGV:{type:Number,trim:!0,required:!0},estado:{type:String,trim:!0,required:!0},documento:{type:Re},itemsVendidos:{type:[De],required:!0},date:{type:Date,default:Date.now},vendedor:{type:String},tipoVendedor:{type:String,default:"admin"},cliente_email:{type:String,trim:!0},celular_cliente:{type:String,trim:!0}});function qt(e){return qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qt(e)}function Dt(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Rt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Rt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function Rt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ft(){Ft=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==qt(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(qt(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Ut(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Bt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Ut(a,n,o,i,s,"next",e)}function s(e){Ut(a,n,o,i,s,"throw",e)}i(void 0)}))}}var zt=W().model("Cotizacion",Mt),Wt=new ht.S3Client({credentials:{accessKeyId:f.production.awsID,secretAccessKey:f.production.awsKey},region:"us-east-1"}),Kt=function(){var e=Bt(Ft().mark((function e(t,r){var n,o;return Ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.body.venta._id=void 0,t.body.venta.codigo=void 0,n=new zt(t.body.venta),e.next=6,Ht();case 6:return n.codigo=e.sent,n.celular_cliente=Yt(t.body.venta.celular_cliente),e.next=10,n.save();case 10:o=e.sent,r.json({message:"Cotización generada con el codigo: ".concat(o.codigo),coti:o}),e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,r){return e.apply(this,arguments)}}(),Jt=function(){var e=Bt(Ft().mark((function e(t,r){var n;return Ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noone"!==t.body.dateOne&&"noone"!==t.body.dateTwo){e.next=7;break}return e.next=4,zt.find({estado:t.body.estado}).skip(parseInt(t.body.skip)).limit(parseInt(t.body.limit));case 4:n=e.sent,e.next=10;break;case 7:return e.next=9,zt.find({estado:t.body.estado,date:{$gte:new Date(t.body.dateOne),$lt:new Date(t.body.dateTwo)}}).skip(parseInt(t.body.skip)).limit(parseInt(t.body.limit));case 9:n=e.sent;case 10:r.json(n),e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,r){return e.apply(this,arguments)}}(),Ht=function(){var e=Bt(Ft().mark((function e(){var t,r,n,o;return Ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,zt.countDocuments({});case 3:for(e.t0=e.sent,t=e.t0+1,r="COTSD01-000000",n=0;n<t.toString().length;n++)r=r.slice(0,-1);return o=r+t.toString(),e.abrupt("return",o);case 11:return e.prev=11,e.t1=e.catch(0),e.abrupt("return",res.status(500).json({errorMSG:e.t1}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),Yt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split(" ").join("");return e.startsWith("+")||(t="+51"+e.split(" ").join("")),t},Qt=function(){var e=Bt(Ft().mark((function e(t,r){var n;return Ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,zt.findOne({codigo:t.params.cotiCod});case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Zt=function(){var e=Bt(Ft().mark((function e(t,r){var n;return Ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,zt.aggregate([{$match:{codigo:t.body.codCoti}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}},{$match:{$or:[{"cantidadSC.cantidadVenta":{$gt:0}},{cantidadSC:null}]}}]);case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Xt=function(){var e=Bt(Ft().mark((function e(t,r){var n,o,a,i,s;return Ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,zt.aggregate([{$match:{codigo:t.body.codigoCoti}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}},{$count:"thisItem"}]);case 3:if(0===e.sent.length){e.next=14;break}return e.next=7,zt.aggregate([{$match:{codigo:t.body.codigoCoti}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}}]);case 7:return n=e.sent,o=Math.round(100*(n[0].totalPrice-t.body.itemVendido.totalPrice+Number.EPSILON))/100*-1,a=Math.round(100*(n[0].totalPriceNoIGV-t.body.itemVendido.totalPriceNoIGV+Number.EPSILON))/100*-1,e.next=12,zt.findOneAndUpdate({codigo:t.body.codigoCoti,itemsVendidos:{$elemMatch:{codigo:t.body.itemVendido.codigo}}},{$set:{"itemsVendidos.$":t.body.itemVendido},$inc:{totalPrice:o,totalPriceNoIGV:a}},{useFindAndModify:!1,new:!0});case 12:return i=e.sent,e.abrupt("return",r.json({message:"Cantidades actualizadas",coti:i}));case 14:return e.next=16,zt.findOneAndUpdate({codigo:t.body.codigoCoti},{$push:{itemsVendidos:t.body.itemVendido},$inc:{totalPrice:t.body.itemVendido.totalPrice,totalPriceNoIGV:t.body.itemVendido.totalPriceNoIGV}},{useFindAndModify:!1,new:!0});case 16:s=e.sent,r.json({message:"Item agregado correctamente",coti:s}),e.next=23;break;case 20:return e.prev=20,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t,r){return e.apply(this,arguments)}}(),er=function(){var e=Bt(Ft().mark((function e(t,r){var n;return Ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,zt.findOneAndUpdate({codigo:t.body.codigo},{$inc:{totalPrice:-1*t.body.totalPrice,totalPriceNoIGV:-1*t.body.totalPriceNoIGV},$pull:{itemsVendidos:{codigo:t.body.codigoItem}}},{useFindAndModify:!1,new:!0});case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),tr=function(){var e=Bt(Ft().mark((function e(t,r){return Ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,zt.findOneAndUpdate({codigo:t.body.codigo},{estado:"eliminada"});case 3:r.json({eliminada:!0}),e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}(),rr=function(){var e=Bt(Ft().mark((function e(t,r){var n,o,a,i,s,c,u,d,p,l;return Ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new ht.GetObjectCommand({Bucket:f.production.bucket,Key:"sirio-logo-small.png"}),e.next=4,Wt.send(n);case 4:return o=e.sent,e.next=7,zt.findOne({codigo:t.body.codigo});case 7:if(a=e.sent,i=[],!t.body.imagen){e.next=30;break}s=Dt(a.itemsVendidos),e.prev=11,s.s();case 13:if((c=s.n()).done){e.next=22;break}return u=c.value,d=new ht.GetObjectCommand({Bucket:f.production.bucket,Key:u.photo}),e.next=18,Wt.send(d);case 18:p=e.sent,i.push(p);case 20:e.next=13;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(11),s.e(e.t0);case 27:return e.prev=27,s.f(),e.finish(27);case 30:return e.next=32,St("Cotización","Temp Coti",["Nº","IMAGÉN","UNIDAD DE MEDIDA","NOMBRE","DESCRIPCIÓN","CANTIDAD","P/CU","TOTAL"],a,o.Body,t.body.extra,t.body.imagen,i);case 32:l=e.sent,r.writeHead(200,{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":"attachment; filename=".concat(a.codigo,".xlsx")}),r.write(l,"binary"),r.end(null,"binary"),e.next=41;break;case 38:return e.prev=38,e.t1=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t1}));case 41:case"end":return e.stop()}}),e,null,[[0,38],[11,24,27,30]])})));return function(t,r){return e.apply(this,arguments)}}(),nr=function(){var e=Bt(Ft().mark((function e(t,r){var n,o,a,i,s,c,u,d,p,l;return Ft().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,zt.findOne({codigo:t.body.codigo});case 3:return n=e.sent,o=new ht.GetObjectCommand({Bucket:f.production.bucket,Key:"sirio-logo-small.png"}),e.next=7,Wt.send(o);case 7:if(a=e.sent,i=[],!t.body.imagen){e.next=30;break}s=Dt(n.itemsVendidos),e.prev=11,s.s();case 13:if((c=s.n()).done){e.next=22;break}return u=c.value,d=new ht.GetObjectCommand({Bucket:f.production.bucket,Key:u.photo}),e.next=18,Wt.send(d);case 18:p=e.sent,i.push(p);case 20:e.next=13;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(11),s.e(e.t0);case 27:return e.prev=27,s.f(),e.finish(27);case 30:l=It(a.Body,n,t.body.extra,i,t.body.imagen),r.setHeader("Content-Type","application/pdf"),r.setHeader("Content-Disposition","attachment; filename=quote.pdf"),l.pipe(r),l.end(),e.next=40;break;case 37:return e.prev=37,e.t1=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t1}));case 40:case"end":return e.stop()}}),e,null,[[0,37],[11,24,27,30]])})));return function(t,r){return e.apply(this,arguments)}}(),or=new w.Router;or.post("/generarCoti",Se,Kt),or.post("/getPendientes",Se,Jt),or.get("/obtenerCoti/:cotiCod",Se,Qt),or.post("/cotiForCard",Se,Zt),or.post("/agregarItemCoti",Se,Xt),or.post("/eliminarItemCoti",Se,er),or.put("/eliminarCoti",Se,tr),or.post("/getPdfCoti",Se,nr),or.post("/getExcelCoti",Se,rr);const ar=or;var ir=x().Router();ir.post("/enviarMensaje",R);const sr=ir,cr=require("node-fetch");var ur=r.n(cr);function dr(e){return dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dr(e)}function pr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==dr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==dr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===dr(o)?o:String(o)),n)}var o}var lr=function(){function e(t,r,n,o,a,i,s,c,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.unidad_de_medida=t,this.codigo=r,this.descripcion=n,this.cantidad=o,this.valor_unitario=a,this.precio_unitario=i,this.subtotal=s,this.tipo_de_igv=1,this.igv=c,this.total=u}var t,r;return t=e,(r=[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"toJSON",value:function(e){var t={},r=e||this;Object.getOwnPropertyNames(r).forEach((function(e){var n=r[e];"toJSON"!==e&&"constructor"!==e&&(t[e]="function"!=typeof n?n:n.bind(t))}));var n=Object.getPrototypeOf(r);return null!==n&&Object.keys(this.toJSON(n)).forEach((function(e){t[e]||"constructor"===e||"toJSON"===e||("function"!=typeof n[e]?t[e]=n[e]:t[e]=n[e].bind(t))})),t}}])&&pr(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function fr(e){return fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fr(e)}function mr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==fr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==fr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===fr(o)?o:String(o)),n)}var o}var hr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.operacion="generar_comprobante",this.tipo_de_comprobante=t.tipo_de_comprobante,1===this.tipo_de_comprobante?(this.cliente_tipo_de_documento="6",this.serie="FFF1"):(this.cliente_tipo_de_documento="1",this.serie="BBB1"),this.numero=t.numero,this.sunat_transaction=1,this.cliente_numero_de_documento=t.cliente_numero_de_documento,this.cliente_denominacion=t.cliente_denominacion,this.cliente_direccion=t.cliente_direccion||"",this.cliente_email=t.cliente_email||"",this.fecha_de_emision=t.fecha_de_emision,this.moneda=1,this.porcentaje_de_igv=18,this.total_gravada=t.total_gravada,this.total_igv=t.total_igv,this.total=t.total,this.detraccion=!1,this.enviar_automaticamente_a_la_sunat=!0,this.enviar_automaticamente_al_cliente=!1,this.formato_de_pdf="A4",this.items=t.items||[],this.guias=t.guias||[],this.codigo_unico=t.codigo_unico||"",this.cliente_email=t.cliente_email||"",this.enviar_automaticamente_al_cliente=t.enviar_automaticamente_al_cliente||!1,this.medio_de_pago=t.medio_de_pago}var t,r;return t=e,(r=[{key:"toString",value:function(){return Object.keys(this)}},{key:"toJSON",value:function(e){var t={},r=e||this;Object.getOwnPropertyNames(r).forEach((function(e){var n=r[e];"toJSON"!==e&&"constructor"!==e&&(t[e]="function"!=typeof n?n:n.bind(t))}));var n=Object.getPrototypeOf(r);return null!==n&&Object.keys(this.toJSON(n)).forEach((function(e){t[e]||"constructor"===e||"toJSON"===e||("function"!=typeof n[e]?t[e]=n[e]:t[e]=n[e].bind(t))})),t}}])&&mr(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function yr(e){return yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yr(e)}function gr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==yr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==yr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===yr(o)?o:String(o)),n)}var o}var vr=function(){function e(t,r,n,o,a,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tipo_de_comprobante=t,this.numero=r,this.cliente_numero_de_documento=n,this.cliente_denominacion=o,this.fecha_de_emision=this.getNowDate(),this.items=[],this.guias=[],this.codigo_unico=a,this.medio_de_pago=i}var t,r;return t=e,(r=[{key:"getNowDate",value:function(){var e=kt.DateTime.local().setZone("UTC-5").toLocaleString().split("/"),t=e[0];return e[0]=e[1],e[1]=t,console.log(e.join("-")),e.join("-")}},{key:"addDireccion",value:function(e){this.cliente_direccion=e}},{key:"addPrecios",value:function(e,t,r){this.total=r,this.total_gravada=e,this.total_igv=t}},{key:"addItem",value:function(e){this.items.push(e)}},{key:"addGuide",value:function(e){this.guias.push(e)}},{key:"build",value:function(){return new hr(this)}},{key:"addEmail",value:function(e){this.enviar_automaticamente_al_cliente=!0,this.cliente_email=e}}])&&gr(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const br=JSON.parse('{"operacion":"generar_guia","tipo_de_comprobante":7,"serie":"TTT1","numero":1800,"cliente_tipo_de_documento":6,"cliente_numero_de_documento":"20517738701","cliente_denominacion":"CLINICA JESUS DEL NORTE S.A.C","cliente_direccion":"","cliente_email":"","cliente_email_1":"","cliente_email_2":"","fecha_de_emision":"2020-12-16T00:00:00","observaciones":"","motivo_de_traslado":"01","peso_bruto_total":0,"numero_de_bultos":10,"tipo_de_transporte":"02","fecha_de_inicio_de_traslado":"2020-12-16T00:00:00","transportista_documento_tipo":6,"transportista_documento_numero":"20538260674","transportista_denominacion":"AQUALIV SAC","transportista_placa_numero":"AVD-798","conductor_documento_tipo":1,"conductor_documento_numero":"40513206","conductor_denominacion":"DIAZ RIVERA HELMER","punto_de_partida_ubigeo":"PROV0008","punto_de_partida_direccion":"AV. PROLONGACION CHILLON MZ B LT 1 INT 1","punto_de_llegada_ubigeo":"PROV0008","punto_de_llegada_direccion":"AV. CARLOS IZAGUIRRE NRO. 153 Z.I. NORTE LIMA - LIMA - INDE","enviar_automaticamente_a_la_sunat":true,"enviar_automaticamente_al_cliente":true,"codigo_unico":"","formato_de_pdf":"","items":[]}');function wr(e){return wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wr(e)}function xr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Sr(){Sr=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==wr(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(wr(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function $r(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var jr=f.production.log(),Or=function(){var e,t=(e=Sr().mark((function e(){var t,r,n,o,a,i,s=arguments;return Sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:1,r=s.length>1&&void 0!==s[1]?s[1]:"",n=s.length>2&&void 0!==s[2]?s[2]:0,o=s.length>3&&void 0!==s[3]?s[3]:"",e.prev=4,a={operacion:"generar_anulacion",tipo_de_comprobante:t,serie:r,numero:n,motivo:o},e.next=8,ur()("https://api.nubefact.com/api/v1/9e79db57-8322-4c1a-ac73-fa5093668c3c",{method:"post",headers:{"Content-Type":"application/json",Authorization:f.production.nbfToken},body:JSON.stringify(a)}).then((function(e){return e.json()}));case 8:return i=e.sent,e.abrupt("return",i.enlace_del_pdf);case 12:throw e.prev=12,e.t0=e.catch(4),e.t0;case 15:case"end":return e.stop()}}),e,null,[[4,12]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){$r(a,n,o,i,s,"next",e)}function s(e){$r(a,n,o,i,s,"throw",e)}i(void 0)}))});return function(){return t.apply(this,arguments)}}(),kr=function(){var e=kt.DateTime.local().setZone("UTC-5").toLocaleString().split("/"),t=e[0];return e[0]=e[1],e[1]=t,e.join("-")},Tr=function(e,t,r){if(!e.body.venta.guia)return r();var n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xr(Object(r),!0).forEach((function(t){var n,o,a;n=e,o=t,a=r[t],(o=function(e){var t=function(e,t){if("object"!==wr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==wr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===wr(t)?t:String(t)}(o))in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},br);n.numero=e.countGuia+1,"factura"===e.ventResult.documento.type?n.cliente_tipo_de_documento=6:"boleta"===e.ventResult.documento.type&&(n.cliente_tipo_de_documento=1);var o=7===e.ventResult.documento.codigo.toString().length||10===e.ventResult.documento.codigo.toString().length?"0"+e.ventResult.documento.codigo.toString():e.ventResult.documento.codigo;n.cliente_numero_de_documento=o,n.cliente_denominacion=e.ventResult.documento.name,n.cliente_direccion=e.ventResult.documento.direccion||"",n.fecha_de_emision=kr(),n.fecha_de_inicio_de_traslado=kr(),n.numero_de_bultos=e.body.venta.bultos,n.peso_bruto_total=e.body.venta.peso,8===e.body.venta.transportista_codigo.length?(n.transportista_documento_tipo=1,n.tipo_de_transporte="02"):(n.transportista_documento_tipo=6,n.tipo_de_transporte="01"),n.transportista_documento_numero=e.body.venta.transportista_codigo,n.transportista_denominacion=e.body.venta.transportista_nombre,n.transportista_placa_numero=e.body.venta.transportista_placa,n.conductor_documento_tipo=n.transportista_documento_tipo,n.conductor_documento_numero=n.transportista_documento_numero,n.conductor_denominacion=n.transportista_denominacion,n.punto_de_partida_ubigeo=e.body.venta.partida_ubigeo,n.punto_de_partida_direccion=e.body.venta.partida_direccion,n.punto_de_llegada_ubigeo=e.body.venta.llegada_ubigeo,n.punto_de_llegada_direccion=e.body.venta.llegada_direccion,n.formato_de_pdf="A4",n.cliente_email=e.ventResult.cliente_email||"",n.enviar_automaticamente_a_la_sunat=!0,n.enviar_automaticamente_al_cliente=!0,e.ventResult.itemsVendidos.forEach((function(e){var t={unidad_de_medida:"NIU",codigo:e.codigo,descripcion:e.name+" | "+e.descripcion,cantidad:e.cantidad};"UND"===e.unidadDeMedida?t.unidad_de_medida="NIU":"PAR"===e.unidadDeMedida?t.unidad_de_medida="PR":"CAJA"===e.unidadDeMedida&&(t.unidad_de_medida="BX"),n.items.push(t)})),ur()("https://api.nubefact.com/api/v1/9e79db57-8322-4c1a-ac73-fa5093668c3c",{method:"post",headers:{"Content-Type":"application/json",Authorization:f.production.nbfToken},body:JSON.stringify(n)}).then((function(e){return e.json()})).then((function(t){e.sunat_guia=t,t.errors&&console.log("HANDLE"),r()})).catch((function(e){return t.status(e.status).json(e)}))},_r=function(e){var t=e.medio_de_pago.split("|")[0],r=e.medio_de_pago.split("|")[1],n="";switch(t){case"efectivo":n="Efectivo";break;case"tarjeta":n="Tarjeta: "+r;break;case"yape":n="Yape: "+r;break;case"otro":n=r}return n},Er=function(e,t,r){var n={};if(jr.info(e.ventResult.documento),console.log("xxcomprobante",e.count),"boleta"===e.ventResult.documento.type)n=function(e,t,r){var n="";if(e.documento.codigo.toString().length<8)for(var o=0;o<8-e.documento.codigo.toString().length;o++)n+="0";var a=e.documento.codigo.toString().length<8?n+e.documento.codigo.toString():e.documento.codigo,i=new vr(2,1+t,a,e.documento.name,e.codigo,_r(e));return i.addPrecios(e.totalPriceNoIGV,e.totalPrice-e.totalPriceNoIGV,e.totalPrice),e.cliente_email&&i.addEmail(e.cliente_email),e.itemsVendidos.forEach((function(e){var t=new lr("NIU",e.codigo,e.name+" | "+e.descripcion,e.cantidad,e.priceNoIGV,e.priceIGV,e.totalPriceNoIGV,e.totalPrice-e.totalPriceNoIGV,e.totalPrice);"UND"===e.unidadDeMedida?t.unidad_de_medida="NIU":"PAR"===e.unidadDeMedida?t.unidad_de_medida="PR":"CAJA"===e.unidadDeMedida&&(t.unidad_de_medida="BX"),i.addItem(t.toJSON())})),e.guia&&i.addGuide({guia_tipo:1,guia_serie_numero:r.serie.toString()+"-"+r.numero}),i.build().toJSON()}(e.ventResult,e.count,e.sunat_guia);else{if("factura"!==e.ventResult.documento.type)return t.json({message:"Succes||".concat(e.ventResult.codigo),_sunat:null});n=function(e,t,r){var n="";if(e.documento.codigo.toString().length<11)for(var o=0;o<11-e.documento.codigo.toString().length;o++)n+="0";var a=e.documento.codigo.toString().length<11?n+e.documento.codigo.toString():e.documento.codigo;console.log(t);var i=new vr(1,1+t,a,e.documento.name,e.codigo,_r(e));return i.addPrecios(e.totalPriceNoIGV,e.totalPrice-e.totalPriceNoIGV,e.totalPrice),e.cliente_email&&i.addEmail(e.cliente_email),e.itemsVendidos.forEach((function(e){var t=new lr("NIU",e.codigo,e.name+" | "+e.descripcion,e.cantidad,e.priceNoIGV,e.priceIGV,e.totalPriceNoIGV,e.totalPrice-e.totalPriceNoIGV,e.totalPrice);"UND"===e.unidadDeMedida?t.unidad_de_medida="NIU":"PAR"===e.unidadDeMedida?t.unidad_de_medida="PR":"CAJA"===e.unidadDeMedida&&(t.unidad_de_medida="BX"),i.addItem(t.toJSON())})),i.addDireccion(e.documento.direccion),e.guia&&i.addGuide({guia_tipo:1,guia_serie_numero:r.serie.toString()+"-"+r.numero}),i.build().toJSON()}(e.ventResult,e.count,e.sunat_guia)}jr.info(n),function n(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};console.log("countretry",o),ur()(process.env.NUBE_FACT_API_URL||"https://api.nubefact.com/api/v1/9e79db57-8322-4c1a-ac73-fa5093668c3c",{method:"post",headers:{"Content-Type":"application/json",Authorization:f.production.nbfToken},body:JSON.stringify(a)}).then((function(e){return e.json()})).then((function(t){if((23===t.codigo||"23"===t.codigo)&&o<3)return a.numero=t.numero+1,n(o+1,a);e.sunat=t,r()})).catch((function(r){jr.error(r),t.status(r.status||500).json({message:"Succes||".concat(e.ventResult.codigo),_sunat:null})}))}(0,n)};function Cr(e){return Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cr(e)}function Nr(){Nr=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==Cr(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Cr(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Vr(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var Lr=function(){var e,t=(e=Nr().mark((function e(t){var r,n,o,a,i,s,c,u;return Nr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new(gt().Workbook),n={sheetFormat:{defaultRowHeight:20,defaultColWidth:20}},o=r.addWorksheet("Gastos",n),a=r.addWorksheet("Ventas",n),i=r.addWorksheet("Balance",n),s=r.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00"}),c=r.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00",fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),o.row(2).setHeight(40),o.column(1).setWidth(10),o.column(5).setWidth(60),a.row(2).setHeight(40),a.column(1).setWidth(10),a.column(5).setWidth(60),i.row(2).setHeight(40),i.column(1).setWidth(10),i.column(5).setWidth(60),Pr(r,o,a,i,t.name),Ir(r,o,a),Ar(o,t,5,s,c,0),Gr(a,t,5,s,c,0),e.next=23,r.writeToBuffer();case 23:return u=e.sent,e.abrupt("return",u);case 27:throw e.prev=27,e.t0=e.catch(0),new Error(e.t0);case 30:case"end":return e.stop()}}),e,null,[[0,27]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Vr(a,n,o,i,s,"next",e)}function s(e){Vr(a,n,o,i,s,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),Pr=function(e,t,r,n,o){var a=e.createStyle({font:{color:"white",size:16,bold:!0},alignment:{horizontal:"center",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#005087"}});t.cell(2,2,2,6,!0).string("Gastos | ".concat(o)).style(a),r.cell(2,2,2,6,!0).string("Ganancias | ".concat(o)).style(a),n.cell(2,2,2,6,!0).string("Balance | ".concat(o)).style(a),t.row(3).setHeight(10),r.row(3).setHeight(10),n.row(3).setHeight(10)},Ir=function(e,t,r){for(var n=e.createStyle({font:{color:"white",size:14},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{horizontal:"left",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),o=2,a=0,i=["Fecha","Comentario","Cantidad","Sub Cantidad","Costo"];a<i.length;a++){var s=i[a];t.cell(4,o).string(s).style(n),r.cell(4,o).string(s).style(n),o++}t.row(4).filter({firstColumn:2,lastColumn:3}),r.row(4).filter({firstColumn:2,lastColumn:3})},Ar=function e(t,r,n,o,a,i){var s,c=n-5;if((c+=i)>=r.variaciones.length)return 5;if(!1===r.variaciones[c].tipo)return 0+e(t,r,n,o,a,i+1);s=n%2==0?a:o;var u=r.variaciones[c],d=new Date(u.date);t.cell(n,2).date(d.toLocaleDateString()).style(s).style({numberFormat:"dd-mm-yyy",alignment:{horizontal:"left",vertical:"center"}}),t.cell(n,4).string(u.cantidad.toString()).style(s);var p="";u.cantidadSC&&(u.cantidadSC.forEach((function(e){var t=e.cantidadVenta;"new item"===u.comentario&&(t=e.cantidadDisponible);var r="";e.nameSecond&&(r="-"+e.nameSecond),p=p+e.name+r+": "+t+", "})),p.length>1&&(p=p.slice(0,-2))),t.cell(n,5).string(p).style(s);var l=u.costoVar;t.cell(n,6).number(l).style(s);var f=u.comentario;return"new item"===u.comentario?f="Nuevo Item":"anular"===u.comentario.split("|")[0]&&(f="Anulada "+u.comentario.split("|")[1]),t.cell(n,3).string(f).style(s),1+e(t,r,n+1,o,a,i)},Gr=function e(t,r,n,o,a,i){var s,c=n-5;if((c+=i)>=r.variaciones.length)return 5;if(!0===r.variaciones[c].tipo)return 0+e(t,r,n,o,a,i+1);s=n%2==0?a:o;var u=r.variaciones[c],d=new Date(u.date);t.cell(n,2).date(d.toLocaleDateString()).style(s).style({numberFormat:"dd-mm-yyy",alignment:{horizontal:"left",vertical:"center"}}),t.cell(n,4).string(u.cantidad.toString()).style(s);var p="";u.cantidadSC&&(u.cantidadSC.forEach((function(e){var t=e.cantidadVenta;"new item"===u.comentario&&(t=e.cantidadDisponible);var r="";e.nameSecond&&(r="-"+e.nameSecond),p=p+e.name+r+": "+t+", "})),p.length>1&&(p=p.slice(0,-2))),t.cell(n,5).string(p).style(s);var l=u.costoVar;t.cell(n,6).number(l).style(s);var f=u.comentario;return"venta"===u.comentario.split("|")[0]&&(f="Venta "+u.comentario.split("|")[1]),t.cell(n,3).string(f).style(s),1+e(t,r,n+1,o,a,i)};const Mr=new z.Schema({name:{type:String,required:!0,unique:!0},codigo:{type:String,required:!0,unique:!0},ruc:{type:Number}}),qr=new z.Schema({name:{type:String,required:!0,unique:!0},deleted:{type:Boolean,default:!1}}),Dr=require("imagemin");var Rr=r.n(Dr);const Fr=require("imagemin-webp");var Ur=r.n(Fr);const Br=require("multer");var zr=r.n(Br);const Wr=require("multer-s3");var Kr=r.n(Wr);const Jr=require("pdfkit");var Hr=r.n(Jr),Yr=function(e,t){var r=new(Hr())({size:"A4",margin:50});return Qr(r,t),Zr(r,e),rn(r,e),nn(r),r},Qr=function(e,t){e.image(t,50,30,{width:70}).fillColor("#444444").fontSize(20).fontSize(10).text("Sirio Dinar | RUC: 20605746587",200,50,{align:"right"}).text("Jr. Felipe Pardo Y Aliaga 213, Trujillo.",200,65,{align:"right"}).text("+51 977-426-349",200,80,{align:"right"}).moveDown()},Zr=function(e,t){e.fillColor("#444444").fontSize(20).text("Comprobante",50,160),Xr(e,185);e.fontSize(10).text("Codigo:",50,200).font("Helvetica-Bold").text(t.codigo,150,200).font("Helvetica").text("Fecha de emisión:",50,240).text(tn(new Date),150,240).font("Helvetica-Bold").text(t.documento.name,300,200).font("Helvetica").text(t.documento.codigo,300,240).moveDown(),Xr(e,260)},Xr=function(e,t){e.strokeColor("#aaaaaa").lineWidth(1).moveTo(50,t).lineTo(550,t).stroke()},en=function(e){return"S/"+e.toFixed(2)},tn=function(e){var t=e.getDate(),r=e.getMonth()+1;return e.getFullYear()+"/"+r+"/"+t},rn=function(e,t){var r,n=307;for(e.fontSize(8).font("Helvetica-Bold"),on(e,n,"Cod","Nombre","Descripcion","Precio","Cantidad","Total"),Xr(e,25+(n=300)),e.font("Helvetica"),r=0;r<t.itemsVendidos.length;r++){var o=t.itemsVendidos[r],a=o.descripcion;o.cantidadSC.length>0&&(a+="\nCantidades: ");for(var i=0;i<o.cantidadSC.length;i++)o.cantidadSC[i].cantidadVenta>0&&(a=a+o.cantidadSC[i].name+" - "+o.cantidadSC[i].nameSecond+": "+o.cantidadSC[i].cantidadVenta+", ");o.cantidadSC.length>0&&(a=a.slice(0,-2)+".");var s=n+30*(2*r+1);on(e,s,o.codigo,o.name,a,en(o.priceNoIGV),o.cantidad,en(o.totalPriceNoIGV)),Xr(e,s+55)}var c=n+31*(2*r+1);on(e,c,"","","","","Subtotal",en(t.totalPriceNoIGV));var u=c+15;on(e,u,"","","","","IGV 18%",en(t.totalPrice-t.totalPriceNoIGV));var d=u+15;e.font("Helvetica-Bold"),on(e,d,"","","","","Total",en(t.totalPrice)),e.font("Helvetica")},nn=function(e){e.fontSize(10).text("siriodinar.com",50,780,{align:"center",width:500})},on=function(e,t,r,n,o,a,i,s){e.fontSize(8).text(r,50,t,{width:40}).text(n,100,t,{width:100}).text(o,210,t,{width:180}).text(a,400,t,{width:35,align:"right"}).text(i,460,t,{width:35,align:"right"}).text(s,0,t,{align:"right"})};function an(e){return an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},an(e)}function sn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function cn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?sn(Object(r),!0).forEach((function(t){var n,o,a;n=e,o=t,a=r[t],(o=function(e){var t=function(e,t){if("object"!==an(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==an(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===an(t)?t:String(t)}(o))in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function un(){un=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==an(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(an(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function dn(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function pn(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){dn(a,n,o,i,s,"next",e)}function s(e){dn(a,n,o,i,s,"throw",e)}i(void 0)}))}}var ln=new ht.S3Client({credentials:{accessKeyId:f.production.awsID,secretAccessKey:f.production.awsKey},region:"us-east-1"}),fn=function(){var e=pn(un().mark((function e(t){var r,n,o,a;return un().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new ht.GetObjectCommand({Bucket:f.production.bucket,Key:"sirio-logo.png"}),e.next=4,ln.send(r);case 4:return n=e.sent,(o=Yr(t,n.Body)).end(),a=new ht.PutObjectCommand({Bucket:f.production.bucket,Key:"".concat(t.codigo,".pdf"),Body:o,ContentType:"application/pdf"}),e.next=10,ln.send(a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(0),f.production.log().error(e.t0),e.abrupt("return",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),mn=function(){var e=pn(un().mark((function e(t,r,n){var o,a,i;return un().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noPhoto.jpg"===t.body.oldPhoto){e.next=9;break}return o=new ht.DeleteObjectCommand({Bucket:f.production.bucket,Key:t.body.oldPhoto}),e.next=5,ln.send(o);case 5:return a=t.body.oldPhoto.split("."),i=new ht.DeleteObjectCommand({Bucket:f.production.bucket,Key:"".concat(a[0],".webp")}),e.next=9,ln.send(i);case 9:n(),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),hn=function(){var e=pn(un().mark((function e(t,r,n){var o;return un().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noPhoto.jpg"===t.photNameToDelete){e.next=5;break}return o=new ht.DeleteObjectCommand({Bucket:f.production.bucket,Key:t.photNameToDelete}),e.next=5,ln.send(o);case 5:r.json(t.result),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),yn=function(){var e=pn(un().mark((function e(t,r){var n,o;return un().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new ht.GetObjectCommand({Bucket:f.production.bucket,Key:t.params.pdfName}),e.next=4,ln.send(n);case 4:o=e.sent,r.writeHead(200,{"Content-Type":"aplication/pdf"}),r.write(o.Body,"binary"),r.end(null,"binary"),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}(),gn=zr()({storage:Kr()({s3:ln,bucket:f.production.bucket,metadata:function(e,t,r){r(null,cn({},e.body))},key:function(e,t,r){var n=t.originalname.split(".")[1];r(null,"IMG-"+Date.now().toString()+"."+n)}}),limits:{fileSize:2e6},fileFilter:function(e,t,r){t.originalname.match(/\.(jpg|jpeg|png)$/)||r(new Error("Please upload JPG and PNG images only!")),t.size>2e6&&r(new Error("Tamaño Exedido!")),r(void 0,!0)}}),vn=(zr()({storage:Kr()({s3:ln,bucket:f.production.bucket,metadata:function(e,t,r){r(null,cn({},e.body))},key:function(e,t,r){var n=t.originalname.split(".")[1];r(null,"STI_".concat(e.params.codigo,"_").concat(e.params.subCat),"."+n)}}),limits:{fileSize:2e6},fileFilter:function(e,t,r){t.originalname.match(/\.(jpg|jpeg|png)$/)||r(new Error("Please upload JPG and PNG images only!")),t.size>2e6&&r(new Error("Tamaño Exedido!")),r(void 0,!0)}}),zr()({storage:Kr()({s3:ln,bucket:f.production.bucket,metadata:function(e,t,r){r(null,cn({},e.body))},key:function(e,t,r){r(null,"ficha-"+e.params.codigo+".pdf")}}),limits:{fileSize:1e6},fileFilter:function(e,t,r){t.originalname.match(/\.(pdf)$/)||r(new Error("Please upload PDF only!")),r(void 0,!0)}})),bn=function(){var e=pn(un().mark((function e(t,r,n){var o,a,i,s,c,u,d;return un().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o=t.file){e.next=6;break}return(a=new Error("Please upload a file")).httpStatusCode=400,e.abrupt("return",n(a));case 6:return i=o.key.split("."),s=new ht.GetObjectCommand({Bucket:f.production.bucket,Key:o.key}),e.next=10,ln.send(s);case 10:return c=e.sent,e.next=13,Rr().buffer(c.Body,{plugins:[Ur()({quality:50})]});case 13:return u=e.sent,d=new ht.PutObjectCommand({Bucket:f.production.bucket,Key:"".concat(i[0],".webp"),Body:u,ACL:"public-read",CacheControl:"max-age=604800",ContentType:"image/webp"}),e.next=17,ln.send(d);case 17:t.fileName=o.key,t.uploadInfo={statusCode:200,status:"success",uploadedFile:o},n(),e.next=25;break;case 22:return e.prev=22,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:"Ocurrio un error inesperado. Intentelo denuevo"}));case 25:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t,r,n){return e.apply(this,arguments)}}();function wn(e){return wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wn(e)}function xn(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Sn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Sn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function Sn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $n(){$n=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==wn(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(wn(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function jn(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function On(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){jn(a,n,o,i,s,"next",e)}function s(e){jn(a,n,o,i,s,"throw",e)}i(void 0)}))}}var kn=W().model("Item",Ke),Tn=W().model("Marca",Mr),_n=W().model("Venta",Je),En=W().model("User",ee),Cn=W().model("Tag",qr),Nn=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new RegExp(t.body.value+"+[a-z0-9._ ]*$","ig"),e.next=4,kn.find({name:{$regex:n},deleted:!1}).limit(t.body.limit);case 4:o=e.sent,r.json(o),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Vn=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new RegExp(t.body.value+"+[a-z0-9._ ]*$","ig"),e.next=4,Cn.find({name:{$regex:n},deleted:!1}).limit(t.body.limit);case 4:o=e.sent,r.json(o),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Ln=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.find({oferta:{$gt:0},deleted:!1});case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Pn=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.find({tipo:t.params.tipo,codigo:{$ne:t.params.codigo},deleted:!1}).limit(8);case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),In=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new RegExp(t.params.searchTerms+"+[a-z0-9._ ]*$","ig"),e.next=4,kn.find({name:{$regex:n},deleted:!1}).limit(8);case 4:o=e.sent,r.json(o),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),An=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.findOne({codigo:t.params.codigo});case 3:n=e.sent,o=Gn(n.variaciones),r.json({message:o}),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Gn=function(e){try{var t,r=0,n=0,o=xn(e);try{for(o.s();!(t=o.n()).done;){var a=t.value;!0===a.tipo?n+=a.costoVar:r+=a.costoVar}}catch(e){o.e(e)}finally{o.f()}return Math.round(100*(r-n+Number.EPSILON))/100}catch(e){throw new Error(e)}},Mn=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.findOne({codigo:t.params.codigo});case 3:return n=e.sent,e.next=6,Lr(n);case 6:o=e.sent,r.writeHead(200,{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":"attachment; filename=reporteItem-".concat(n.codigo,".xlsx")}),r.write(o,"binary"),r.end(null,"binary"),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r){return e.apply(this,arguments)}}(),qn=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_n.aggregate([{$match:{codigo:t.body.codVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}}]);case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Dn=function(){var e=On($n().mark((function e(t,r){var n,o,a,i,s;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.body.itemVendido.ventaCod=t.body.codigoVenta,e.next=4,_n.aggregate([{$match:{codigo:t.body.codigoVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}},{$count:"thisItem"}]);case 4:if(0===e.sent.length){e.next=15;break}return e.next=8,_n.aggregate([{$match:{codigo:t.body.codigoVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}}]);case 8:return n=e.sent,o=Math.round(100*(n[0].totalPrice-t.body.itemVendido.totalPrice+Number.EPSILON))/100*-1,a=Math.round(100*(n[0].totalPriceNoIGV-t.body.itemVendido.totalPriceNoIGV+Number.EPSILON))/100*-1,e.next=13,_n.findOneAndUpdate({codigo:t.body.codigoVenta,itemsVendidos:{$elemMatch:{codigo:t.body.itemVendido.codigo}}},{$set:{"itemsVendidos.$":t.body.itemVendido},$inc:{totalPrice:o,totalPriceNoIGV:a}},{useFindAndModify:!1,new:!0});case 13:return i=e.sent,e.abrupt("return",r.json({message:"Cantidades actualizadas",venta:i}));case 15:return e.next=17,_n.findOneAndUpdate({codigo:t.body.codigoVenta},{$push:{itemsVendidos:t.body.itemVendido},$inc:{totalPrice:t.body.itemVendido.totalPrice,totalPriceNoIGV:t.body.itemVendido.totalPriceNoIGV}},{useFindAndModify:!1,new:!0});case 17:s=e.sent,r.json({message:"Item agregado correctamente",venta:s}),e.next=24;break;case 21:return e.prev=21,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({message:e.t0}));case 24:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t,r){return e.apply(this,arguments)}}(),Rn=function(){var e=On($n().mark((function e(t,r,n){var o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=new _n(t.body.venta),e.next=4,Kn(o.documento.type);case 4:return o.codigo=e.sent,o.itemsVendidos[0].ventaCod=o.codigo,o.vendedor=t.user.aud.split(" ")[0],e.next=9,o.save();case 9:t.saveResult=e.sent,n(),e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Fn=function(){var e=On($n().mark((function e(t,r){var n,o,a,i,s,c,u,d,p,l,f,m,h,y,g;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(n=e.sent).startTransaction(),e.prev=4,e.next=7,_n.findOne({codigo:t.body.codigo});case 7:if("anuladaPost"!==e.sent.estado){e.next=13;break}return e.next=11,n.abortTransaction();case 11:return n.endSession(),e.abrupt("return",r.status(409).json({errorMSG:"Ya anulada"}));case 13:o=[],a=[],i=xn(t.body.itemsVendidos);try{for(i.s();!(s=i.n()).done;)c=s.value,a.push(c.codigo),o.push({date:Date.now(),cantidad:c.cantidad,tipo:!0,comentario:"anular|"+t.body.codigo,costoVar:c.totalPrice,usuario:t.user.aud.split(" ")[0],cantidadSC:c.cantidadSC})}catch(e){i.e(e)}finally{i.f()}u=0,d=xn(t.body.itemsVendidos),e.prev=19,d.s();case 21:if((p=d.n()).done){e.next=46;break}l=p.value,f=xn(l.cantidadSC),e.prev=24,f.s();case 26:if((m=f.n()).done){e.next=33;break}if(!((h=m.value).cantidadVenta>0)){e.next=31;break}return e.next=31,kn.findOneAndUpdate({codigo:l.codigo,"subConteo.order":{$elemMatch:{name:h.name,nameSecond:h.nameSecond}}},{$inc:{"subConteo.order.$.cantidad":h.cantidadVenta}},{useFindAndModify:!1,new:!0,session:n});case 31:e.next=26;break;case 33:e.next=38;break;case 35:e.prev=35,e.t0=e.catch(24),f.e(e.t0);case 38:return e.prev=38,f.f(),e.finish(38);case 41:return e.next=43,kn.findOneAndUpdate({codigo:l.codigo},{$inc:{cantidad:l.cantidad},$push:{variaciones:o[u]}},{new:!0,useFindAndModify:!1,session:n});case 43:u++;case 44:e.next=21;break;case 46:e.next=51;break;case 48:e.prev=48,e.t1=e.catch(19),d.e(e.t1);case 51:return e.prev=51,d.f(),e.finish(51);case 54:if(y="","noone"===t.body.documento.type){e.next=64;break}if("factura"!==t.body.documento.type){e.next=60;break}return e.next=59,Or(1,t.body.serie,t.body.numero,"Anulación de venta");case 59:y=e.sent;case 60:if("boleta"!==t.body.documento.type){e.next=64;break}return e.next=63,Or(2,t.body.serie,t.body.numero,"Anulación de venta");case 63:y=e.sent;case 64:return e.next=66,_n.findOneAndUpdate({codigo:t.body.codigo},{estado:"anuladaPost",linkComprobante:y},{useFindAndModify:!1,new:!0,session:n});case 66:return g=e.sent,e.next=69,n.commitTransaction();case 69:return n.endSession(),e.abrupt("return",r.json({message:"success||".concat(g.codigo)}));case 73:return e.prev=73,e.t2=e.catch(4),e.next=77,n.abortTransaction();case 77:return n.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t2}));case 79:case"end":return e.stop()}}),e,null,[[4,73],[19,48,51,54],[24,35,38,41]])})));return function(t,r){return e.apply(this,arguments)}}(),Un=function(){var e=On($n().mark((function e(t,r,n){var o,a,i,s,c,u,d,p,l,f,m,h;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(o=e.sent).startTransaction(),e.prev=4,e.next=7,Kn(t.body.venta.documento.type);case 7:return a=e.sent,t.body.venta.itemsVendidos[0].ventaCod=a,e.next=11,kn.findOne({codigo:t.body.venta.itemsVendidos[0].codigo});case 11:if(i=e.sent,s={date:Date.now(),cantidad:t.body.venta.itemsVendidos[0].cantidad,tipo:!1,comentario:"venta|"+a,usuario:t.user.aud.split(" ")[0],costoVar:t.body.venta.totalPrice,cantidadSC:t.body.venta.itemsVendidos[0].cantidadSC},0===t.body.venta.itemsVendidos[0].cantidadSC.length){e.next=43;break}c=xn(t.body.venta.itemsVendidos[0].cantidadSC),e.prev=15,c.s();case 17:if((u=c.n()).done){e.next=35;break}if(!((d=u.value).cantidadVenta>0)){e.next=33;break}return e.next=22,kn.findOneAndUpdate({codigo:t.body.venta.itemsVendidos[0].codigo,"subConteo.order":{$elemMatch:{name:d.name,nameSecond:d.nameSecond}}},{$inc:{"subConteo.order.$.cantidad":-d.cantidadVenta}},{useFindAndModify:!1,new:!0,session:o});case 22:p=e.sent,l=0;case 24:if(!(l<p.subConteo.order.length)){e.next=33;break}if(!(p.subConteo.order[l].cantidad<0)){e.next=30;break}return e.next=28,o.abortTransaction();case 28:return o.endSession(),e.abrupt("return",r.status(202).json({message:"La Cantidad Ha Cambiado",item:i}));case 30:l++,e.next=24;break;case 33:e.next=17;break;case 35:e.next=40;break;case 37:e.prev=37,e.t0=e.catch(15),c.e(e.t0);case 40:return e.prev=40,c.f(),e.finish(40);case 43:return e.next=45,kn.findOneAndUpdate({codigo:t.body.venta.itemsVendidos[0].codigo},{$inc:{cantidad:-t.body.venta.itemsVendidos[0].cantidad},$push:{variaciones:s}},{new:!0,useFindAndModify:!1,session:o});case 45:if(!(e.sent.cantidad<0)){e.next=51;break}return e.next=49,o.abortTransaction();case 49:return o.endSession(),e.abrupt("return",r.status(202).json({message:"La Cantidad Ha Cambiado",item:i}));case 51:return(f=new _n(t.body.venta)).codigo=a,f.vendedor=t.user.aud.split(" ")[0],e.next=56,f.save({session:o});case 56:if(t.ventResult=e.sent,"factura"!==f.documento.type){e.next=65;break}return e.next=60,_n.findOne({tipoComprobante:{$eq:1},numero:{$ne:null}}).sort({$natural:-1}).limit(1);case 60:m=e.sent,console.log(m),t.count=m.nubeCountNumber||0,e.next=71;break;case 65:if("boleta"!==f.documento.type){e.next=71;break}return e.next=68,_n.findOne({tipoComprobante:{$eq:2},numero:{$ne:null}}).sort({$natural:-1}).limit(1);case 68:h=e.sent,console.log("ultimaBoleta",h),t.count=h.nubeCountNumber||0;case 71:if(!t.body.venta.guia){e.next=75;break}return e.next=74,_n.countDocuments({guia:{$eq:!0}});case 74:t.countGuia=e.sent;case 75:return e.next=77,fn(f);case 77:return e.next=79,o.commitTransaction();case 79:o.endSession(),n(),e.next=89;break;case 83:return e.prev=83,e.t1=e.catch(4),e.next=87,o.abortTransaction();case 87:return o.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t1}));case 89:case"end":return e.stop()}}),e,null,[[4,83],[15,37,40,43]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Bn=function(){var e=On($n().mark((function e(t,r,n){var o,a,i,s,c,u,d,p,l,f,m,h,y,g,v,b,w,x,S;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(o=e.sent).startTransaction(),e.prev=4,a=[],i=[],e.next=9,_n.findOne({codigo:t.body.venta.codigo});case 9:if("ejecutada"!==(s=e.sent).estado){e.next=15;break}return e.next=13,o.abortTransaction();case 13:return o.endSession(),e.abrupt("return",r.status(409).json({errorMSG:"La venta ya ha sido ejecutada."}));case 15:c=xn(s.itemsVendidos);try{for(c.s();!(u=c.n()).done;)"N"!==(d=u.value).codigo.charAt(2)&&"I"!==d.codigo.charAt(3)&&(i.push(d.codigo),a.push({date:Date.now(),cantidad:d.cantidad,tipo:!1,comentario:"venta|"+s.codigo,costoVar:d.totalPrice,usuario:t.user.aud.split(" ")[0],cantidadSC:d.cantidadSC}))}catch(e){c.e(e)}finally{c.f()}p=0,l=xn(s.itemsVendidos),e.prev=19,l.s();case 21:if((f=l.n()).done){e.next=64;break}if("N"===(m=f.value).codigo.charAt(2)||"I"===m.codigo.charAt(3)){e.next=62;break}h=xn(m.cantidadSC),e.prev=25,h.s();case 27:if((y=h.n()).done){e.next=45;break}if(!((g=y.value).cantidadVenta>0)){e.next=43;break}return e.next=32,kn.findOneAndUpdate({codigo:m.codigo,"subConteo.order":{$elemMatch:{name:g.name,nameSecond:g.nameSecond}}},{$inc:{"subConteo.order.$.cantidad":-g.cantidadVenta}},{useFindAndModify:!1,new:!0,session:o});case 32:v=e.sent,b=0;case 34:if(!(b<v.subConteo.order.length)){e.next=43;break}if(!(v.subConteo.order[b].cantidad<0)){e.next=40;break}return e.next=38,o.abortTransaction();case 38:return o.endSession(),e.abrupt("return",r.status(202).json({message:"La Cantidad Ha Cambiado"}));case 40:b++,e.next=34;break;case 43:e.next=27;break;case 45:e.next=50;break;case 47:e.prev=47,e.t0=e.catch(25),h.e(e.t0);case 50:return e.prev=50,h.f(),e.finish(50);case 53:return e.next=55,kn.findOneAndUpdate({codigo:m.codigo},{$inc:{cantidad:-m.cantidad},$push:{variaciones:a[p]}},{new:!0,useFindAndModify:!1,session:o});case 55:if(!(e.sent.cantidad<0)){e.next=61;break}return e.next=59,o.abortTransaction();case 59:return o.endSession(),e.abrupt("return",r.status(202).json({message:"La Cantidad Ha Cambiado"}));case 61:p++;case 62:e.next=21;break;case 64:e.next=69;break;case 66:e.prev=66,e.t1=e.catch(19),l.e(e.t1);case 69:return e.prev=69,l.f(),e.finish(69);case 72:return e.next=74,_n.findOneAndUpdate({codigo:t.body.venta.codigo},{estado:"ejecutada",documento:t.body.venta.documento,guia:t.body.venta.guia,cliente_email:t.body.venta.cliente_email,medio_de_pago:t.body.venta.medio_de_pago},{useFindAndModify:!1,new:!0,session:o});case 74:if(w=e.sent,t.ventResult=w,"factura"!==w.documento.type){e.next=84;break}return e.next=79,_n.findOne({tipoComprobante:{$eq:1},numero:{$ne:null}}).sort({$natural:-1}).limit(1);case 79:x=e.sent,console.log(x),t.count=x.numero||0,e.next=90;break;case 84:if("boleta"!==w.documento.type){e.next=90;break}return e.next=87,_n.findOne({tipoComprobante:{$eq:2},numero:{$ne:null}}).sort({$natural:-1}).limit(1);case 87:S=e.sent,console.log("ultimaBoleta",S),t.count=S.numero||0;case 90:if(!t.body.venta.guia){e.next=94;break}return e.next=93,_n.countDocuments({guia:{$eq:!0}});case 93:t.countGuia=e.sent;case 94:return e.next=96,En.findOneAndUpdate({username:t.user.aud.split(" ")[0]},{$pull:{ventaActiva:t.body.venta.codigo}},{useFindAndModify:!1});case 96:return e.next=98,fn(w);case 98:return e.next=100,o.commitTransaction();case 100:o.endSession(),n(),e.next=111;break;case 104:return e.prev=104,e.t2=e.catch(4),console.log(e.t2),e.next=109,o.abortTransaction();case 109:return o.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t2}));case 111:case"end":return e.stop()}}),e,null,[[4,104],[19,66,69,72],[25,47,50,53]])})));return function(t,r,n){return e.apply(this,arguments)}}(),zn=function(){var e=On($n().mark((function e(t,r){return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_n.findOneAndUpdate({codigo:t.body.venta.codigo},{estado:"anulada"},{useFindAndModify:!1});case 3:return e.next=5,En.findOneAndUpdate({username:t.user.aud.split(" ")[0]},{$pull:{ventaActiva:t.body.venta.codigo}},{useFindAndModify:!1});case 5:r.json({message:"success"}),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Wn=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.sunat_guia||(t.sunat_guia=""),e.next=4,_n.findByIdAndUpdate(t.ventResult._id,{linkComprobante:t.sunat.enlace_del_pdf,numero:t.sunat.numero,guia_link:t.sunat_guia.enlace_del_pdf,serie:t.sunat.serie,tipoComprobante:t.sunat.tipo_de_comprobante},{new:!0,useFindAndModify:!1});case 4:n=e.sent,r.json({venta:n,message:"Success||".concat(t.ventResult.codigo),_sunat:t.sunat}),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(0),console.log("showerr",e.t0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Kn=function(){var e=On($n().mark((function e(t){var r,n,o,a;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_n.countDocuments({});case 3:e.t0=e.sent,r=e.t0+1,n="SD01-000000",e.t1=t,e.next="factura"===e.t1?9:"boleta"===e.t1?11:13;break;case 9:return n="E002-000000",e.abrupt("break",14);case 11:return n="EB02-000000",e.abrupt("break",14);case 13:return e.abrupt("break",14);case 14:for(o=0;o<r.toString().length;o++)n=n.slice(0,-1);return a=n+r.toString(),e.abrupt("return",a);case 19:return e.prev=19,e.t2=e.catch(0),e.abrupt("return",res.status(500).json({errorMSG:e.t2}));case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),Jn=function(){var e=On($n().mark((function e(t,r){var n,o,a,i;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.findOne({codigo:t.body.codigo});case 3:if(n=e.sent,t.body.tipo){e.next=8;break}if(!(n.cantidad-t.body.cantidad<0)){e.next=8;break}throw"Cantidad Invalidad";case 8:return o=t.body.cantidad,a={date:Date.now(),cantidad:o,tipo:t.body.tipo,comentario:t.body.tipo?"agregar|"+t.body.comentario:"quitar|"+t.body.comentario,costoVar:t.body.costoVar*o,cantidadSC:[]},e.next=12,kn.findOneAndUpdate({codigo:t.body.codigo},{$inc:{cantidad:t.body.tipo?t.body.cantidad:-1*t.body.cantidad},$push:{variaciones:a}},{new:!0,useFindAndModify:!1});case 12:i=e.sent,r.json(i),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,r){return e.apply(this,arguments)}}(),Hn=function(){var e=On($n().mark((function e(t,r){var n,o,a,i,s,c,u,d,p,l,f;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=0,e.next=4,kn.findOne({codigo:t.body.codigo});case 4:o=e.sent,n=t.body.cantidad,a={date:Date.now(),cantidad:n,tipo:t.body.tipo,comentario:t.body.tipo?"agregar|"+t.body.comentario:"quitar|"+t.body.comentario,costoVar:t.body.costoVar*n,cantidadSC:[]},i=[],s=xn(o.subConteo.order),e.prev=9,u=$n().mark((function e(){var r;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=c.value,-1!==t.body.subConteo.order.findIndex((function(e){return e.name===r.name&&e.nameSecond===r.nameSecond}))&&i.push(r);case 3:case"end":return e.stop()}}),e)})),s.s();case 12:if((c=s.n()).done){e.next=16;break}return e.delegateYield(u(),"t0",14);case 14:e.next=12;break;case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(9),s.e(e.t1);case 21:return e.prev=21,s.f(),e.finish(21);case 24:o.subConteo.order=i,d=xn(t.body.subConteo.order),e.prev=26,l=$n().mark((function e(){var r,n,i;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.value,n=o.subConteo.order.findIndex((function(e){return e.name===r.name&&e.nameSecond===r.nameSecond})),i=n>-1?o.subConteo.order[n].cantidad:0,!(n>-1)){e.next=13;break}if(!t.body.tipo){e.next=8;break}o.subConteo.order[n].cantidad+=r.cantidad,e.next=11;break;case 8:if(o.subConteo.order[n].cantidad-=r.cantidad,!(o.subConteo.order[n].cantidad<0)){e.next=11;break}throw"Cantidad Invalidad";case 11:e.next=14;break;case 13:o.subConteo.order.push({cantidad:r.cantidad,name:r.name,nameSecond:r.nameSecond||void 0});case 14:a.cantidadSC.push({name:r.name,nameSecond:r.nameSecond,cantidadDisponible:i,cantidadVenta:r.cantidad});case 15:case"end":return e.stop()}}),e)})),d.s();case 29:if((p=d.n()).done){e.next=33;break}return e.delegateYield(l(),"t2",31);case 31:e.next=29;break;case 33:e.next=38;break;case 35:e.prev=35,e.t3=e.catch(26),d.e(e.t3);case 38:return e.prev=38,d.f(),e.finish(38);case 41:if(t.body.tipo){e.next=45;break}if(!(o.cantidad-t.body.cantidad<0)){e.next=45;break}return e.abrupt("return",r.status(400).json({errorMSG:"Cantidad Invalidad"}));case 45:return e.next=47,kn.findOneAndUpdate({codigo:t.body.codigo},{subConteo:o.subConteo,$inc:{cantidad:t.body.tipo?t.body.cantidad:-1*t.body.cantidad},$push:{variaciones:a}},{new:!0,useFindAndModify:!1});case 47:f=e.sent,r.json(f),e.next=54;break;case 51:return e.prev=51,e.t4=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t4}));case 54:case"end":return e.stop()}}),e,null,[[0,51],[9,18,21,24],[26,35,38,41]])})));return function(t,r){return e.apply(this,arguments)}}(),Yn=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new Cn(t.body),e.next=4,n.save();case 4:return o=e.sent,e.abrupt("return",r.json(o));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Qn=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Cn.updateMany({name:{$in:t.body}},{deleted:!0});case 3:return n=e.sent,e.abrupt("return",r.json(n));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Zn=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Cn.find({deleted:!1});case 3:return n=e.sent,e.abrupt("return",r.json(n));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Xn=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(n=new Tn(t.body)).codigo=Date.now().toString(),e.next=5,n.save();case 5:return o=e.sent,e.abrupt("return",r.json(o));case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),eo=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.aggregate([{$match:{codigo:"4SDtT4"}},{$project:{cantidadTotal:{$sum:"$subConteo.order.cantidad"}}}]);case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),to=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.params.deleteString.split("_"),e.next=4,Tn.deleteMany({name:{$in:n}});case 4:r.json({message:"success"}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),ro=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Tn.find({});case 3:n=e.sent,r.json(n),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),no=function(){var e=On($n().mark((function e(t,r){var n,o,a,i,s,c;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(n=new kn(t.body)).priceNoIGV=ho(n.priceIGV),e.next=5,oo(n.name,n.tipo);case 5:if(n.codigo=e.sent,n.nameLowerCase=n.name,o={date:Date.now(),cantidad:n.cantidad,tipo:!0,comentario:"new item",costoVar:Math.round(100*(n.costoPropio*n.cantidad+Number.EPSILON))/100,cantidadSC:[]},n.subConteo){a=xn(n.subConteo.order);try{for(a.s();!(i=a.n()).done;)s=i.value,o.cantidadSC.push({name:s.name,nameSecond:s.nameSecond,cantidadDisponible:s.cantidad,cantidadVenta:0})}catch(e){a.e(e)}finally{a.f()}}return n.variaciones=[o],e.next=12,n.save();case 12:return c=e.sent,e.abrupt("return",r.json(c));case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,r){return e.apply(this,arguments)}}(),oo=function(){var e=On($n().mark((function e(){var t,r,n,o=arguments;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:"",r=o.length>1&&void 0!==o[1]?o[1]:"",e.prev=2,e.next=5,kn.countDocuments({});case 5:return n=e.sent,e.abrupt("return",n.toString()+"SD"+t.charAt(0)+r.charAt(0)+Math.floor(10*Math.random()).toString());case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",new Error(e.t0));case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),ao=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.find({deleted:!1}).sort({orderNumber:1});case 3:return n=e.sent,e.abrupt("return",r.json(n));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),io=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.findOneAndUpdate({codigo:t.body.codigo},{oferta:1},{new:!0,useFindAndModify:!1});case 3:return n=e.sent,e.abrupt("return",r.json(n));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),so=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.findOneAndUpdate({codigo:t.body.codigo},{oferta:0},{new:!0,useFindAndModify:!1});case 3:return n=e.sent,e.abrupt("return",r.json(n));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),co=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.find({tipo:t.params.tipo,deleted:!1});case 3:return n=e.sent,e.abrupt("return",r.json(n));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),uo=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.find({subTipo:t.params.subTipo,tipo:t.params.tipo,deleted:!1}).sort({orderNumber:1});case 3:return n=e.sent,e.abrupt("return",r.json(n));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),po=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},e.prev=1,e.t0=t.params.tipo,e.next="cod"===e.t0?5:"name"===e.t0?9:"tipo"===e.t0?13:17;break;case 5:return e.next=7,kn.findOne({codigo:t.params.codigo});case 7:case 11:case 15:return n=e.sent,e.abrupt("break",19);case 9:return e.next=11,kn.find({name:t.body.name});case 13:return e.next=15,kn.find({tipo:t.body.tipo});case 17:return n={message:"Not A Type Of Search"},e.abrupt("break",19);case 19:return e.abrupt("return",r.json(n));case 22:return e.prev=22,e.t1=e.catch(1),e.abrupt("return",r.status(500).json({errorMSG:e.t1}));case 25:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t,r){return e.apply(this,arguments)}}(),lo=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(n=t.body).priceIGV&&(n.priceNoIGV=ho(n.priceIGV)),e.next=5,kn.findOneAndUpdate({codigo:t.body.codigo},n,{new:!0,useFindAndModify:!1});case 5:o=e.sent,r.json(o),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),fo=function(){var e=On($n().mark((function e(t,r,n){var o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.findOneAndUpdate({codigo:t.params.codigo},{deleted:!0},{new:!0,useFindAndModify:!1});case 3:o=e.sent,t.result=o,t.photNameToDelete=o.photo,n(),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),mo=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.findOneAndUpdate({codigo:t.params.codigo},{photo:t.fileName},{new:!0,useFindAndModify:!1});case 3:n=e.sent,r.status(200).json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),ho=function(e){var t=e/1.18;return Math.round(100*(t+Number.EPSILON))/100},yo=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.findOneAndUpdate({codigo:t.params.codigo},{ficha:!0},{new:!0,useFindAndModify:!1});case 3:n=e.sent,r.status(200).json({res:n,uploadInfo:t.uploadInfo}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),go=function(){var e=On($n().mark((function e(t,r){var n,o,a,i,s;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=[],o=t.gananciaPorItem.filter((function(e){return!(6===e.name.length&&"N"===e.name.split("")[2]&&"I"===e.name.split("")[3])})).slice(0,4),-1!==(a=o.findIndex((function(e){return"3SDKP7"===e.name})))?o.splice(a,1):o.pop(),i=0;case 6:if(!(i<o.length)){e.next=15;break}return e.next=9,kn.findOne({codigo:o[i].name});case 9:s=e.sent,o[i].name=s.name,n.push({name:o[i].name,series:[{name:"Ventas",value:o[i].totalVenta},{name:"Ganancias",value:o[i].value}]});case 12:i++,e.next=6;break;case 15:r.json(n),e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,r){return e.apply(this,arguments)}}(),vo=function(){var e=On($n().mark((function e(t,r){var n,o,a,i;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!1}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"quitar"}},{$group:{_id:null,totalVarQuitar:{$sum:"$variaciones.costoVar"}}}]);case 3:return n=e.sent,e.next=6,kn.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!0}},{$group:{_id:{codigo:"$codigo",name:"$name"},posVar:{$sum:"$variaciones.costoVar"}}},{$project:{_id:0,codigo:"$_id.codigo",name:"$_id.name",posVar:1}},{$sort:{name:1}},{$group:{_id:null,totalVarPos:{$sum:"$posVar"}}}]);case 6:return o=e.sent,e.next=9,kn.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!1}},{$group:{_id:{codigo:"$codigo",name:"$name"},posVar:{$sum:"$variaciones.costoVar"}}},{$project:{_id:0,codigo:"$_id.codigo",name:"$_id.name",posVar:1}},{$sort:{name:1}},{$group:{_id:null,totalVarNeg:{$sum:"$posVar"}}}]);case 9:return a=e.sent,e.next=12,kn.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!0}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"anular"}},{$group:{_id:null,totalVarAnular:{$sum:"$variaciones.costoVar"}}}]);case 12:i=e.sent,r.json({gastosInventario:o[0].totalVarPos-((n[0]?n[0].totalVarQuitar:0)+(i[0]?i[0].totalVarAnular:0)),gananciasInventario:a[0].totalVarNeg-((n[0]?n[0].totalVarQuitar:0)+(i[0]?i[0].totalVarAnular:0))}),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,r){return e.apply(this,arguments)}}(),bo=function(){var e=On($n().mark((function e(t,r){var n,o,a,i,s;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!1}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"quitar"}},{$group:{_id:null,totalVarQuitar:{$sum:"$variaciones.costoVar"}}}]);case 3:return n=e.sent,e.next=6,kn.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!0}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"anular"}},{$group:{_id:null,totalVarAnular:{$sum:"$variaciones.costoVar"}}}]);case 6:return o=e.sent,e.next=9,kn.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!0}},{$group:{_id:{codigo:"$codigo",name:"$name"},posVar:{$sum:"$variaciones.costoVar"}}},{$project:{_id:0,codigo:"$_id.codigo",name:"$_id.name",posVar:1}},{$sort:{name:1}},{$group:{_id:null,totalVarPos:{$sum:"$posVar"}}}]);case 9:return a=e.sent,e.next=12,_n.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$project:{codigo:1,codArray:{$split:["$codigo","NI"]},totalPrice:1,codSize:{$strLenCP:"$codigo"},costoTotalPropio:{$multiply:["$priceCosto","$cantidad"]}}},{$match:{codSize:6}},{$set:{arrayCodSize:{$size:"$codArray"}}},{$match:{arrayCodSize:2}},{$project:{codigo:1,costoTotalPropio:1,totalPrice:1,primeraParteLen:{$strLenCP:{$arrayElemAt:["$codArray",0]}},segundaParteLen:{$strLenCP:{$arrayElemAt:["$codArray",0]}}}},{$match:{primeraParteLen:2,segundaParteLen:2}},{$group:{_id:null,costoTotalPropio:{$sum:"$costoTotalPropio"},ingresoTotal:{$sum:"$totalPrice"}}}]);case 12:return i=e.sent,e.next=15,kn.aggregate([{$match:{deleted:!1}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!1}},{$group:{_id:{codigo:"$codigo",name:"$name"},posVar:{$sum:"$variaciones.costoVar"}}},{$project:{_id:0,codigo:"$_id.codigo",name:"$_id.name",posVar:1}},{$sort:{name:1}},{$group:{_id:null,totalVarNeg:{$sum:"$posVar"}}}]);case 15:s=e.sent,r.json({gastoTotalHistorico:a[0].totalVarPos-((n[0]?n[0].totalVarQuitar:0)+(o[0]?o[0].totalVarAnular:0))+i[0].costoTotalPropio,ingresoTotalHistorico:s[0].totalVarNeg-((n[0]?n[0].totalVarQuitar:0)+(o[0]?o[0].totalVarAnular:0))+i[0].ingresoTotal}),e.next=22;break;case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,r){return e.apply(this,arguments)}}(),wo=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.aggregate([{$match:{deleted:!1}},{$project:{_id:0,cantidad:1,priceIGV:1,total:{$multiply:["$priceIGV","$cantidad"]}}},{$group:{_id:null,totalPotencial:{$sum:"$total"}}}]);case 3:return n=e.sent,e.next=6,kn.aggregate([{$match:{deleted:!1}},{$project:{_id:0,cantidad:1,costoPropio:1,total:{$multiply:["$costoPropio","$cantidad"]}}},{$group:{_id:null,totalPotencial:{$sum:"$total"}}}]);case 6:o=e.sent,r.json({ventasPosibles:n[0].totalPotencial,costoPropioTotalAprox:o[0].totalPotencial,gananciaAprox:n[0].totalPotencial-o[0].totalPotencial}),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}(),xo=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.aggregate([{$match:{deleted:!1}},{$unwind:"$variaciones"},{$project:{_id:0,codigo:1,name:1,variaciones:1,costoVarTrue:{$cond:[{$eq:["$variaciones.tipo",!0]},"$variaciones.costoVar",0]},costoVarFalse:{$cond:[{$eq:["$variaciones.tipo",!1]},"$variaciones.costoVar",0]}}},{$group:{_id:{name:"$name",codigo:"$codigo"},totalTrue:{$sum:"$costoVarTrue"},totalFalse:{$sum:"$costoVarFalse"}}},{$project:{_id:0,name:"$_id.name",codigo:"$_id.codigo",totalTrue:1,totalFalse:1,balance:{$subtract:["$totalFalse","$totalTrue"]}}},{$sort:{balance:1}}]);case 3:n=e.sent,r.json({peor:n[0],mejor:n[n.length-1]}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),So=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.aggregate([{$match:{deleted:!1}},{$project:{codigo:1,name:1,cantidad:1,costoPropio:1,priceIGV:1,totalIngreso:{$multiply:["$cantidad","$priceIGV"]},totalCosto:{$multiply:["$cantidad","$costoPropio"]}}},{$project:{codigo:1,name:1,cantidad:1,costoPropio:1,priceIGV:1,balance:{$subtract:["$totalIngreso","$totalCosto"]}}}]).sort({balance:-1}).limit(1);case 3:n=e.sent,r.json(n[0]),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),$o=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_n.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$project:{codigo:1,codArray:{$split:["$codigo","NI"]},totalPrice:1,codSize:{$strLenCP:"$codigo"},costoTotalPropio:{$multiply:["$priceCosto","$cantidad"]}}},{$match:{codSize:6}},{$set:{arrayCodSize:{$size:"$codArray"}}},{$match:{arrayCodSize:2}},{$project:{codigo:1,costoTotalPropio:1,totalPrice:1,primeraParteLen:{$strLenCP:{$arrayElemAt:["$codArray",0]}},segundaParteLen:{$strLenCP:{$arrayElemAt:["$codArray",1]}}}},{$match:{primeraParteLen:2,segundaParteLen:2}},{$group:{_id:null,costoTotalPropio:{$sum:"$costoTotalPropio"},ingresoTotal:{$sum:"$totalPrice"}}}]);case 3:return n=e.sent,e.next=6,_n.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$project:{codigo:1,totalPrice:1,costoTotalPropio:{$multiply:["$priceCosto","$cantidad"]}}},{$group:{_id:null,costoTotalPropio:{$sum:"$costoTotalPropio"},ingresoTotal:{$sum:"$totalPrice"}}}]);case 6:o=e.sent,r.json({gananciaEnVentasFueraTienda:n[0].ingresoTotal-n[0].costoTotalPropio,gananciaEnVentas:o[0].ingresoTotal-o[0].costoTotalPropio,gananciaEnVentasDeTienda:o[0].ingresoTotal-n[0].ingresoTotal-(o[0].costoTotalPropio-n[0].costoTotalPropio)}),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}(),jo=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_n.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$group:{_id:"$codigo",cantidad:{$sum:1}}},{$sort:{cantidad:-1}}]);case 3:return n=e.sent,e.next=6,kn.findOne({codigo:n[0]._id});case 6:o=e.sent,r.json(o),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}(),Oo=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_n.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$documento"},{$replaceRoot:{newRoot:"$documento"}},{$match:{codigo:{$ne:null}}},{$group:{_id:{codigo:"$codigo",name:"$name"},cantidad:{$sum:1}}},{$sort:{cantidad:-1}}]);case 3:n=e.sent,r.json({cliente:n[0]._id.name,numero:n[0].cantidad}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),ko=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.findOneAndUpdate({codigo:t.body.itemCod},{$pull:{caracteristicas:{$in:t.body.deleteArray}}},{useFindAndModify:!1,new:!0});case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),To=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.findOneAndUpdate({codigo:t.body.itemCod},{$push:{caracteristicas:t.body.newCaracteristica}},{useFindAndModify:!1,new:!0});case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),_o=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(n=e.sent).startTransaction(),e.prev=4,e.next=7,kn.countDocuments({deleted:!1,subTipo:t.body.itemReOrder[0].subTipo,tipo:t.body.itemReOrder[0].tipo});case 7:if(e.sent===t.body.itemReOrder.length){e.next=10;break}throw"Variacion Invalida";case 10:o=0;case 11:if(!(o<t.body.itemReOrder.length)){e.next=17;break}return e.next=14,kn.findOneAndUpdate({codigo:t.body.itemReOrder[o].codigo},{orderNumber:o},{useFindAndModify:!1});case 14:o++,e.next=11;break;case 17:return e.next=19,n.commitTransaction();case 19:n.endSession(),r.json({message:"done"}),e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(4),e.next=27,n.abortTransaction();case 27:return n.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 29:case"end":return e.stop()}}),e,null,[[4,23]])})));return function(t,r){return e.apply(this,arguments)}}(),Eo=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.find({deleted:!1,$and:[{cantidad:{$lt:5}},{cantidad:{$gt:0}}]});case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Co=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.find({deleted:!1,cantidad:0});case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),No=function(){var e=On($n().mark((function e(t,r){var n,o,a,i;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.aggregate([{$match:{codigo:t.params.codigoItem}},{$unwind:"$variaciones"},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$set:{firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$set:{cantidadVarNI:{$cond:[{$eq:["$firstPartVar","new item"]},"$variaciones.cantidad",0]},cantidadVarQuitar:{$cond:[{$eq:["$firstPartVar","quitar"]},"$variaciones.cantidad",0]},cantidadVarAgregar:{$cond:[{$eq:["$firstPartVar","agregar"]},"$variaciones.cantidad",0]},cantidadVarAnular:{$cond:[{$eq:["$firstPartVar","anular"]},"$variaciones.cantidad",0]},cantidadVarVenta:{$cond:[{$eq:["$firstPartVar","venta"]},"$variaciones.cantidad",0]}}},{$group:{_id:null,totalCantidadNI:{$sum:"$cantidadVarNI"},totalCantidadQuitar:{$sum:"$cantidadVarQuitar"},totalCantidadAgregar:{$sum:"$cantidadVarAgregar"},totalCantidadVenta:{$sum:"$cantidadVarVenta"},totalCantidadAnular:{$sum:"$cantidadVarAnular"}}}]);case 3:return n=e.sent,e.next=6,kn.aggregate([{$match:{codigo:t.params.codigoItem}},{$unwind:"$variaciones"},{$project:{_id:0,codigo:1,name:1,variaciones:1,costoVarTrue:{$cond:[{$eq:["$variaciones.tipo",!0]},"$variaciones.costoVar",0]},costoVarFalse:{$cond:[{$eq:["$variaciones.tipo",!1]},"$variaciones.costoVar",0]}}},{$group:{_id:{name:"$name",codigo:"$codigo"},totalTrue:{$sum:"$costoVarTrue"},totalFalse:{$sum:"$costoVarFalse"}}}]);case 6:return o=e.sent,e.next=9,kn.aggregate([{$match:{codigo:t.params.codigoItem}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!1}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"quitar"}},{$group:{_id:null,totalVarQuitar:{$sum:"$variaciones.costoVar"}}}]);case 9:return a=e.sent,e.next=12,kn.aggregate([{$match:{codigo:t.params.codigoItem}},{$project:{_id:0,codigo:1,name:1,variaciones:1}},{$unwind:"$variaciones"},{$match:{"variaciones.tipo":!0}},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$project:{variaciones:1,firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$match:{firstPartVar:"anular"}},{$group:{_id:null,totalVarAnular:{$sum:"$variaciones.costoVar"}}}]);case 12:i=e.sent,r.json({itemVendidos:n[0].totalCantidadVenta-n[0].totalCantidadAnular,cantidadHistorica:n[0].totalCantidadNI+n[0].totalCantidadAgregar-n[0].totalCantidadQuitar,totalCosto:o[0].totalTrue-((a[0]?a[0].totalVarQuitar:0)+(i[0]?i[0].totalVarAnular:0)),totalIngreso:o[0].totalFalse-((a[0]?a[0].totalVarQuitar:0)+(i[0]?i[0].totalVarAnular:0))}),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,r){return e.apply(this,arguments)}}(),Vo=function(){var e=On($n().mark((function e(t,r){var n,o;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.aggregate([{$match:{codigo:t.params.codigoItem}},{$unwind:"$variaciones"},{$project:{variaciones:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$set:{firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$set:{cantidadVarAnular:{$cond:[{$eq:["$firstPartVar","anular"]},"$variaciones.cantidad",0]},cantidadVarVenta:{$cond:[{$eq:["$firstPartVar","venta"]},"$variaciones.cantidad",0]},dateVar:{$dateToString:{format:"%Y-%m",date:"$variaciones.date",timezone:"-05:00"}}}},{$group:{_id:"$dateVar",valueVenta:{$sum:"$cantidadVarVenta"},valueAnular:{$sum:"$cantidadVarAnular"}}},{$project:{_id:0,name:"$_id",value:{$subtract:["$valueVenta","$valueAnular"]}}},{$sort:{name:1}}]);case 3:n=e.sent,o=[{name:"Cantidad",series:n}],r.json(o),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Lo=function(){var e=On($n().mark((function e(t,r){var n;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn.aggregate([{$match:{deleted:!1}},{$unwind:"$variaciones"},{$project:{name:1,codigo:1,cantidad:1,variaciones:1,priceIGV:1,costoPropio:1,codVar:{$split:["$variaciones.comentario","|"]}}},{$set:{firstPartVar:{$arrayElemAt:["$codVar",0]}}},{$set:{cantidadVarAgregar:{$cond:[{$eq:["$firstPartVar","agregar"]},"$variaciones.costoVar",0]},cantidadVarNewItem:{$cond:[{$eq:["$firstPartVar","new item"]},"$variaciones.costoVar",0]},cantidadVarQuitar:{$cond:[{$eq:["$firstPartVar","quitar"]},"$variaciones.costoVar",0]},cantidadVarAnular:{$cond:[{$eq:["$firstPartVar","anular"]},"$variaciones.costoVar",0]},cantidadVarVenta:{$cond:[{$eq:["$firstPartVar","venta"]},"$variaciones.costoVar",0]}}},{$group:{_id:{name:"$name",codigo:"$codigo",cantidad:"$cantidad",priceIGV:"$priceIGV",costoPropio:"$costoPropio"},valueAgregar:{$sum:"$cantidadVarAgregar"},valueVenta:{$sum:"$cantidadVarVenta"},valueAnular:{$sum:"$cantidadVarAnular"},valueNewItem:{$sum:"$cantidadVarNewItem"},valueQuitar:{$sum:"$cantidadVarQuitar"}}},{$project:{_id:0,name:"$_id.name",codigo:"$_id.codigo",cantidad:"$_id.cantidad",priceIGV:"$_id.priceIGV",costoPropio:"$_id.costoPropio",valueQuitar:1,preValueGasto:{$sum:["$valueAgregar","$valueNewItem"]},valueIngreso:{$subtract:["$valueVenta","$valueAnular"]}}},{$project:{_id:0,name:1,codigo:1,cantidad:1,priceIGV:1,costoPropio:1,valueGasto:{$subtract:["$preValueGasto","$valueQuitar"]},valueIngreso:1}},{$sort:{valueIngreso:-1}}]);case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Po=function(){var e=On($n().mark((function e(t,r){var n,o,a,i,s;return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.body.rating<=5&&t.body.rating>=1){e.next=3;break}return e.abrupt("return",r.status(400).json({errorMSG:"Rating no valido"}));case 3:return e.next=5,kn.aggregate([{$match:{codigo:t.body.codigo}},{$unwind:"$variaciones"},{$match:{"variaciones.usuario":t.user.aud.split(" ")[0]}},{$limit:4}]);case 5:if(0!==e.sent.length){e.next=8;break}return e.abrupt("return",r.status(403).json({message:"No has comprado el item."}));case 8:return n=new Date,e.next=11,kn.findOne({codigo:t.body.codigo});case 11:if(o=e.sent,a=!1,o.reviews.length>0&&(a=o.reviews.some((function(e){return e.user===t.user.aud.split(" ")[0]}))),!a){e.next=19;break}return e.next=17,kn.findOneAndUpdate({codigo:t.body.codigo,"reviews.user":t.user.aud.split(" ")[0]},{$set:{"reviews.$.date":n.toISOString(),"reviews.$.rating":t.body.rating}},{new:!0,useFindAndModify:!1});case 17:return i=e.sent,e.abrupt("return",r.json(i));case 19:return e.next=21,kn.findOneAndUpdate({codigo:t.body.codigo},{$push:{reviews:{user:t.user.aud.split(" ")[0],rating:t.body.rating,date:n.toISOString()}}},{new:!0,useFindAndModify:!1});case 21:return s=e.sent,e.abrupt("return",r.json(s));case 25:return e.prev=25,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 28:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(t,r){return e.apply(this,arguments)}}();const Io=new z.Schema({name:{type:String,required:!0,unique:!0,trim:!0},date:{type:Date,default:Date.now},codigo:{type:String},subTipo:{type:[String],trim:!0},subTipoLink:{type:[String],trim:!0},deleted:{type:Boolean,default:!1},link:{type:String,default:"noPhoto.jpg"},order:{type:Number,default:-1}});function Ao(e){return Ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ao(e)}function Go(){Go=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==Ao(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Ao(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Mo(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function qo(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Mo(a,n,o,i,s,"next",e)}function s(e){Mo(a,n,o,i,s,"throw",e)}i(void 0)}))}}var Do=W().model("Tipo",Io),Ro=W().model("Item",Ke),Fo=function(){var e=qo(Go().mark((function e(t,r){var n,o,a,i,s,c,u;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(n=new Date).setDate(n.getDate()-7),e.next=5,Do.find({deleted:!1});case 5:return o=e.sent,e.next=8,Ro.find({deleted:!1});case 8:for(a=e.sent,i=[{url:"store/main",priority:1,changefreq:"monthly"},{url:"servicio-al-cliente/contactanos",priority:.8,changefreq:"monthly"},{url:"carrito",priority:.7,changefreq:"monthly"},{url:"servicio-al-cliente/terminos-y-condiciones",priority:.3,changefreq:"monthly"},{url:"servicio-al-cliente/politica-de-privacidad",priority:.3,changefreq:"monthly"},{url:"servicio-al-cliente/politica-de-devolucion",priority:.3,changefreq:"monthly"},{url:"servicio-al-cliente/politica-de-envio",priority:.3,changefreq:"monthly"},{url:"/",priority:1,changefreq:"monthly"},{url:"store/categorias",priority:.9,changefreq:"weekly"}],s=0;s<o.length;s++)for(i.push({url:"store/categorias/"+o[s].name,priority:.7,changefreq:"daily"}),c=0;c<o[s].subTipo.length;c++)i.push({url:"store/categorias/"+o[s].name+"/"+o[s].subTipo[c],priority:.6,changefreq:"daily"});for(u=0;u<a.length;u++)i.push({url:"store/categorias/"+a[u].tipo+"/"+a[u].subTipo+"/"+a[u].codigo,priority:.5,changefreq:"daily"});r.json(i),e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",r.status(500).end());case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),Uo=function(){var e=qo(Go().mark((function e(t,r){var n,o;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(n=new Do(t.body)).codigo=Date.now().toString(),n.subTipo=[],e.next=6,n.save();case 6:return o=e.sent,e.abrupt("return",r.json(o));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}(),Bo=function(){var e=qo(Go().mark((function e(t,r){var n;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Do.findOne({name:t.body.codigo});case 3:if(!((n=e.sent).subTipo.indexOf(t.body.subTipo)>-1)){e.next=6;break}return e.abrupt("return",r.json(null));case 6:return e.next=8,Do.updateOne({codigo:n.codigo},{$push:{subTipo:t.body.subTipo,subTipoLink:"noPhoto.jpg"}});case 8:return e.abrupt("return",r.json({message:"success"}));case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}(),zo=function(){var e=qo(Go().mark((function e(t,r){var n;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Do.find({deleted:!1}).sort({order:1});case 3:return n=e.sent,e.abrupt("return",r.json(n));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Wo=function(){var e=qo(Go().mark((function e(t,r){var n;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Do.findOne({name:t.params.tipoCod}).select("subTipo -_id");case 3:return n=e.sent,e.abrupt("return",r.json(n));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Ko=function(){var e=qo(Go().mark((function e(t,r){var n;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Do.findOne({name:t.params.codigo});case 3:return n=e.sent,e.abrupt("return",r.json(n));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Jo=function(){var e=qo(Go().mark((function e(t,r){var n,o,a;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(n=e.sent).startTransaction(),e.prev=4,e.next=7,Do.findOne({codigo:t.body.codigo});case 7:return o=e.sent,t.beforeName=o.name,e.next=11,Do.findOneAndUpdate({codigo:t.body.codigo},{name:t.body.tipoName},{new:!0,useFindAndModify:!1});case 11:return a=e.sent,t.newTipo=a,e.next=15,Ro.updateMany({tipo:t.beforeName},{tipo:t.body.tipoName},{new:!0,useFindAndModify:!1,runValidators:!0});case 15:return e.next=17,n.commitTransaction();case 17:n.endSession(),r.json(t.newTipo),e.next=27;break;case 21:return e.prev=21,e.t0=e.catch(4),e.next=25,n.abortTransaction();case 25:return n.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 27:case"end":return e.stop()}}),e,null,[[4,21]])})));return function(t,r){return e.apply(this,arguments)}}(),Ho=function(){var e=qo(Go().mark((function e(t,r){var n,o,a,i;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(n=e.sent).startTransaction(),e.prev=4,e.next=7,Do.findOne({name:t.body.codigo});case 7:if(!((o=e.sent).subTipo.indexOf(t.body.newSubName)>-1)){e.next=10;break}return e.abrupt("return",r.json(null));case 10:return a=o.subTipo.indexOf(t.body.antiguoSubName),o.subTipo[a]=t.body.newSubName,e.next=14,Do.findOneAndUpdate({name:t.body.codigo},{subTipo:o.subTipo},{new:!0,useFindAndModify:!1});case 14:return e.next=16,Ro.updateMany({subTipo:t.body.antiguoSubName},{subTipo:t.body.newSubName},{new:!0,useFindAndModify:!1});case 16:return i=e.sent,e.next=19,n.commitTransaction();case 19:n.endSession(),r.json(i),e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(4),e.next=27,n.abortTransaction();case 27:return n.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 29:case"end":return e.stop()}}),e,null,[[4,23]])})));return function(t,r){return e.apply(this,arguments)}}(),Yo=function(){var e=qo(Go().mark((function e(t,r){var n,o,a,i;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(n=e.sent).startTransaction(),e.prev=4,e.next=7,Do.findOne({name:t.params.codigo});case 7:return o=e.sent,a=o.subTipo.indexOf(t.params.subTipoName),o.subTipo.splice(a,1),e.next=12,Do.findOneAndUpdate({name:t.params.codigo},{subTipo:o.subTipo},{new:!0,useFindAndModify:!1});case 12:return e.next=14,Ro.updateMany({subTipo:t.params.subTipoName},{deleted:!0});case 14:return i=e.sent,e.next=17,n.commitTransaction();case 17:return n.endSession(),e.abrupt("return",r.json(i));case 21:return e.prev=21,e.t0=e.catch(4),e.next=25,n.abortTransaction();case 25:return n.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 27:case"end":return e.stop()}}),e,null,[[4,21]])})));return function(t,r){return e.apply(this,arguments)}}(),Qo=function(){var e=qo(Go().mark((function e(t,r){var n;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Do.findOneAndUpdate({codigo:t.params.codigo},{link:t.fileName},{new:!0,useFindAndModify:!1});case 3:n=e.sent,r.status(200).json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Zo=function(){var e=qo(Go().mark((function e(t,r){var n,o;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Do.findOne({name:t.params.codigo});case 3:return n=e.sent,o=n.subTipo.findIndex((function(e){return e===t.params.subCat})),n.subTipoLink[o]=t.fileName,e.next=8,Do.findOneAndUpdate({name:t.params.codigo},{subTipoLink:n.subTipoLink},{new:!0,useFindAndModify:!1});case 8:e.sent,r.status(200).json({newPhoto:n.subTipoLink[o]}),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r){return e.apply(this,arguments)}}(),Xo=function(){var e=qo(Go().mark((function e(t,r){var n,o;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(n=e.sent).startTransaction(),e.prev=4,e.next=7,Do.findOneAndUpdate({codigo:t.params.codigo},{deleted:!0},{new:!0,useFindAndModify:!1});case 7:return o=e.sent,t.tipoDeleted=o,e.next=11,Ro.updateMany({tipo:t.tipoDeleted.name},{deleted:!0});case 11:return e.next=13,n.commitTransaction();case 13:n.endSession(),r.json(t.tipoDeleted),e.next=23;break;case 17:return e.prev=17,e.t0=e.catch(4),e.next=21,n.abortTransaction();case 21:return n.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 23:case"end":return e.stop()}}),e,null,[[4,17]])})));return function(t,r){return e.apply(this,arguments)}}(),ea=function(){var e=qo(Go().mark((function e(t,r){var n,o;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(n=e.sent).startTransaction(),e.prev=4,e.next=7,Do.countDocuments({deleted:!1});case 7:if(e.sent===t.body.tiposReOrder.length){e.next=10;break}throw"Variacion Invalida";case 10:o=0;case 11:if(!(o<t.body.tiposReOrder.length)){e.next=17;break}return e.next=14,Do.findOneAndUpdate({codigo:t.body.tiposReOrder[o].codigo},{order:o},{useFindAndModify:!1});case 14:o++,e.next=11;break;case 17:return e.next=19,n.commitTransaction();case 19:n.endSession(),r.json({message:"done"}),e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(4),e.next=27,n.abortTransaction();case 27:return n.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 29:case"end":return e.stop()}}),e,null,[[4,23]])})));return function(t,r){return e.apply(this,arguments)}}(),ta=function(){var e=qo(Go().mark((function e(t,r){var n;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Do.findOne({name:t.body.tipoCodigo});case 3:if(e.sent.subTipo.length===t.body.subTipoList.length){e.next=6;break}throw"Variacion Invalida";case 6:return e.next=8,Do.findOneAndUpdate({name:t.body.tipoCodigo},{subTipoLink:t.body.linksList,subTipo:t.body.subTipoList},{useFindAndModify:!1,new:!0});case 8:n=e.sent,r.json(n),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,r){return e.apply(this,arguments)}}(),ra=function(){var e=qo(Go().mark((function e(t,r){var n,o,a;return Go().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W().startSession();case 2:return(n=e.sent).startTransaction(),e.prev=4,e.next=7,Ro.findOneAndUpdate({codigo:t.body.codigo},{subTipo:t.body.newSubTipo,tipo:t.body.newTipo,orderNumber:-2},{useFindAndModify:!1,new:!0});case 7:return o=e.sent,e.next=10,Do.findOne({name:t.body.newTipo});case 10:if(null!==(a=e.sent)){e.next=13;break}throw"Tipo Ya No Existe";case 13:if(-1!==a.subTipo.indexOf(t.body.newSubTipo)){e.next=15;break}throw"Sub Tipo Ya No Existe";case 15:return e.next=17,n.commitTransaction();case 17:n.endSession(),r.json(o),e.next=27;break;case 21:return e.prev=21,e.t0=e.catch(4),e.next=25,n.abortTransaction();case 25:return n.endSession(),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 27:case"end":return e.stop()}}),e,null,[[4,21]])})));return function(t,r){return e.apply(this,arguments)}}(),na=new w.Router;na.get("/getTipos",zo),na.get("/getTipo/:codigo",Ko),na.get("/getSubTipos/:tipoCod",Wo),na.get("/getItem/:tipo/:codigo",po),na.get("/getItems",ao),na.get("/getItemsDestacados",Ln),na.get("/getItemsByType/:tipo",co),na.get("/getItemsSubTipo/:tipo/:subTipo",uo),na.get("/getItemsRelacionados/:tipo/:codigo",Pn),na.get("/getItemsSearch/:searchTerms",In),na.get("/pdf/:pdfName",yn),na.get("/getTags",Zn),na.get("/marcas/getAll",ro),na.get("/getSiteMap",Fo),na.post("/getListOfItemsFilteredByRegex",Nn),na.post("/getListOfTagsFilteredByRegex",Vn),na.post("/addTipo",Se,Uo),na.put("/updateTipo",Se,Jo),na.put("/addSubTipo",Se,Bo),na.put("/uptateSupTipos",Se,Ho),na.post("/addItem",xe,no),na.put("/updateItem",Se,lo),na.post("/addItemReview",$e,Po),na.post("/addCaracteristica",Se,To),na.post("/deteleCaracteristicas",Se,ko),na.post("/addTag",Se,Yn),na.post("/deteleTags",Se,Qn),na.post("/toFavorite",Se,io),na.post("/toUnFavorite",Se,so),na.put("/uploadVariationSC",Se,Hn),na.put("/uploadVariationSimple",Se,Jn),na.post("/marcas/add",Se,Xn),na.post("/changeFolder",Se,ra),na.post("/reorderItems",Se,_o),na.post("/reorderTipos",Se,ea),na.post("/reorderSubTipos",Se,ta),na.delete("/deleteItem/:codigo",be,fo,hn),na.delete("/deleteTipo/:codigo",be,Xo),na.delete("/deleteSupTipo/:codigo/:subTipoName",be,Yo),na.delete("/marcas/delete/:deleteString",Se,to),na.get("/getItemMayorGananciaPosible",xe,So),na.get("/getItemsLowStock",xe,Eo),na.get("/getItemsNoStock",xe,Co),na.get("/getClienteConMasCompras",xe,Oo),na.get("/getItemsMasVendido",xe,jo),na.get("/getGananciasTotalesSNS",xe,$o),na.get("/gananciasInvercionTotal",xe,bo),na.get("/getPeorMejorItem",xe,xo),na.get("/getVariacionPosnegAll",xe,vo),na.get("/ventasPotenciales",xe,wo),na.get("/getItemBalance/:codigo",xe,An),na.get("/getItemReport/:codigo",xe,Mn),na.get("/getTableInfItem",xe,Lo),na.get("/getItemVentasPorMes/:codigoItem",xe,Vo),na.get("/getItemGIC/:codigoItem",xe,No),na.post("/uploads/image/:codigo",Se,gn.single("img"),bn,mn,mo),na.post("/uploads/imageCat/:codigo",Se,gn.single("img"),bn,mn,Qo),na.post("/uploads/imageSubCat/:codigo/:subCat",Se,gn.single("img"),bn,mn,Zo),na.post("/uploads/ficha/:codigo",Se,vn.single("pdf"),(function(e,t,r){var n=e.file;if(!n){var o=new Error("Please upload a file");return o.httpStatusCode=400,r(o)}e.uploadInfo={statusCode:200,status:"success",uploadedFile:n},r()}),yo);const oa=na,aa=require("axios");var ia=r.n(aa);function sa(e){return sa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sa(e)}function ca(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ua(){ua=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==sa(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(sa(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function da(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var pa=function(){var e,t=(e=ua().mark((function e(t,r,n,o){var a,i,s,c,u,d;return ua().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=new(gt().Workbook),i=a.addWorksheet(t,{sheetFormat:{defaultRowHeight:20,defaultColWidth:20}}),s=a.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00"}),c=a.createStyle({font:{color:"black",size:12},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{vertical:"center"},numberFormat:"[$S/-es-PE]#,##0.00",fill:{type:"pattern",patternType:"solid",fgColor:"#e2f3ff"}}),i.row(2).setHeight(40),i.row(4).setHeight(20),i.column(1).setWidth(10),i.column(4).setWidth(60),la(a,i,r),fa(a,i,n),u=ma(i,o,5,s,c),i.cell(u,6).string("Total").style(s).style({font:{size:14,bold:!0,color:"white"},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),i.cell(u,7).formula("SUBTOTAL(9,F5:F".concat(u-1,")")).style(s).style({font:{size:14,bold:!0,color:"black"},fill:{type:"pattern",patternType:"solid",fgColor:"white"}}),e.next=16,a.writeToBuffer();case 16:return d=e.sent,e.abrupt("return",d);case 20:throw e.prev=20,e.t0=e.catch(0),new Error(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){da(a,n,o,i,s,"next",e)}function s(e){da(a,n,o,i,s,"throw",e)}i(void 0)}))});return function(e,r,n,o){return t.apply(this,arguments)}}(),la=function(e,t,r){var n=e.createStyle({font:{color:"white",size:16,bold:!0},alignment:{horizontal:"center",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#005087"}});t.cell(2,2,2,7,!0).string(r).style(n),t.row(3).setHeight(10)},fa=function(e,t,r){var n,o=e.createStyle({font:{color:"white",size:14},border:{right:{style:"thin",color:"white"},left:{style:"thin",color:"white"},bottom:{style:"thin",color:"white"}},alignment:{horizontal:"left",vertical:"center"},fill:{type:"pattern",patternType:"solid",fgColor:"#e87200"}}),a=2,i=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return ca(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ca(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}(r);try{for(i.s();!(n=i.n()).done;){var s=n.value;t.cell(4,a).string(s).style(o),a++}}catch(e){i.e(e)}finally{i.f()}t.row(4).filter({firstColumn:2,lastColumn:7})},ma=function e(t,r,n,o,a){var i,s=n-5;if(s>=r.length)return 5;t.row(n).setHeight(20),i=n%2==0?a:o;var c=new Date(r[s].date);t.cell(n,2).date(c.toLocaleDateString()).style(i).style({numberFormat:"dd-mm-yyy",alignment:{horizontal:"left",vertical:"center"}}),t.cell(n,3).string(r[s].codigo).style(i);var u="";return r[s].documento.name&&(u=r[s].documento.name+" | "+r[s].documento.codigo),t.cell(n,4).string(u).style(i),t.cell(n,5).string(r[s].vendedor).style(i),t.cell(n,6).number(r[s].totalPriceNoIGV).style(i),t.cell(n,7).number(r[s].totalPrice).style(i),1+e(t,r,n+1,o,a)};function ha(e){return ha="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ha(e)}function ya(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return ga(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ga(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function ga(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function va(){va=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==ha(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(ha(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function ba(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function wa(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ba(a,n,o,i,s,"next",e)}function s(e){ba(a,n,o,i,s,"throw",e)}i(void 0)}))}}var xa=f.production.sunatToken,Sa=W().model("Venta",Je),$a=function(){var e=wa(va().mark((function e(t,r){var n,o;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new RegExp(t.params.vendedor,"i"),e.next=4,Sa.find({vendedor:n}).sort({date:-1}).limit(20);case 4:o=e.sent,r.json(o),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}(),ja=function(){var e=wa(va().mark((function e(t,r){var n,o,a,i,s,c,u,d,p;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Sa.findOne({codigo:t.body.codigo});case 3:n=e.sent,o=Math.round(100*(n.totalPrice-t.body.totalPriceSC+Number.EPSILON))/100,a=ka(o),i=0,s=0,c=ya(n.itemsVendidos),e.prev=9,c.s();case 11:if((u=c.n()).done){e.next=19;break}if(d=u.value,t.body.itemCodigo!==d.codigo){e.next=17;break}return i=Math.round(100*(d.totalPrice-t.body.totalPriceSC+Number.EPSILON))/100,s=ka(i),e.abrupt("break",19);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),c.e(e.t0);case 24:return e.prev=24,c.f(),e.finish(24);case 27:return e.next=29,Sa.findOneAndUpdate({codigo:t.body.codigo,itemsVendidos:{$elemMatch:{codigo:t.body.itemCodigo}}},{$pull:{"itemsVendidos.$.cantidadSC":{name:t.body.name,nameSecond:t.body.nameSecond}},$inc:{"itemsVendidos.$.cantidad":-t.body.cantidadVenta},$set:{"itemsVendidos.$.totalPrice":i,"itemsVendidos.$.totalPriceNoIGV":s,totalPrice:o,totalPriceNoIGV:a}},{new:!0,useFindAndModify:!1});case 29:p=e.sent,r.json(p),e.next=36;break;case 33:return e.prev=33,e.t1=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t1}));case 36:case"end":return e.stop()}}),e,null,[[0,33],[9,21,24,27]])})));return function(t,r){return e.apply(this,arguments)}}(),Oa=function(){var e=wa(va().mark((function e(t,r){var n,o,a,i;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Sa.findOne({codigo:t.body.codigo});case 3:if(-1!==(n=e.sent).itemsVendidos.findIndex((function(e){return e.codigo===t.body.itemCodigo}))){e.next=7;break}return e.abrupt("return",r.status(409).json({errorMSG:"El item ya a sido eliminado"}));case 7:return o=Math.round(100*(n.totalPrice-t.body.totalItemPrice+Number.EPSILON))/100,a=ka(o),e.next=11,Sa.findOneAndUpdate({codigo:t.body.codigo},{$pull:{itemsVendidos:{codigo:t.body.itemCodigo}},$set:{totalPrice:o,totalPriceNoIGV:a}},{new:!0,useFindAndModify:!1});case 11:return i=e.sent,e.abrupt("return",r.json(i));case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),ka=function(e){var t=e/1.18;return Math.round(100*(t+Number.EPSILON))/100},Ta=function(){var e=wa(va().mark((function e(t,r){var n;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Sa.findOne({codigo:t.params.ventaCod});case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),_a=function(){var e=wa(va().mark((function e(t,r){var n;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Sa.find({estado:"pendiente",vendedor:t.user.aud.split(" ")[0]});case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Ea=function(){var e=wa(va().mark((function e(t,r){var n,o,a,i,s;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(o={})[t.body.orden]=t.body.ordenOrden,a=new RegExp(t.body.busqueda||"","gi"),i=new RegExp(t.body.busquedaItemCodigo||"","gi"),s=new RegExp(t.body.busquedaUsername||"","gi"),"noone"!==t.body.dateOne&&"noone"!==t.body.dateTwo){e.next=12;break}return e.next=9,Sa.find({estado:{$in:t.body.estado},"itemsVendidos.codigo":{$regex:i},vendedor:{$regex:s},$or:[{"documento.name":{$regex:a}},{"documento.codigo":Number(t.body.busqueda)||-1}],"documento.type":{$in:t.body.tipo}}).skip(parseInt(t.body.skip)).limit(parseInt(t.body.limit)).sort(o);case 9:n=e.sent,e.next=15;break;case 12:return e.next=14,Sa.find({estado:{$in:t.body.estado},"itemsVendidos.codigo":{$regex:i},vendedor:{$regex:s},$or:[{"documento.name":{$regex:a}},{"documento.codigo":Number(t.body.busqueda)||-1}],"documento.type":{$in:t.body.tipo},date:{$gte:new Date(t.body.dateOne),$lte:new Date(t.body.dateTwo)}}).skip(parseInt(t.body.skip)).limit(parseInt(t.body.limit)).sort(o);case 14:n=e.sent;case 15:r.json(n),e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,r){return e.apply(this,arguments)}}(),Ca=function(){var e=wa(va().mark((function e(t,r){var n,o,a,i;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o=new RegExp(t.body.busqueda||"","gi"),a=new RegExp(t.body.busquedaItemCodigo||"","gi"),i=new RegExp(t.body.busquedaUsername||"","gi"),"noone"!==t.body.dateOne&&"noone"!==t.body.dateTwo){e.next=10;break}return e.next=7,Sa.aggregate([{$match:{estado:{$in:t.body.estado},"itemsVendidos.codigo":{$regex:a},vendedor:{$regex:i},$or:[{"documento.name":{$regex:o}},{"documento.codigo":Number(t.body.busqueda)||-1}],"documento.type":{$in:t.body.tipo}}},{$count:"cantidadVentas"}]);case 7:n=e.sent,e.next=13;break;case 10:return e.next=12,Sa.aggregate([{$match:{estado:{$in:t.body.estado},"itemsVendidos.codigo":{$regex:a},vendedor:{$regex:i},$or:[{"documento.name":{$regex:o}},{"documento.codigo":Number(t.body.busqueda)||-1}],"documento.type":{$in:t.body.tipo},date:{$gte:new Date(t.body.dateOne),$lt:new Date(t.body.dateTwo)}}},{$count:"cantidadVentas"}]);case 12:n=e.sent;case 13:r.json(n[0]),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,r){return e.apply(this,arguments)}}(),Na=function(){var e=wa(va().mark((function e(t,r){var n;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ia().post("https://api.migo.pe/api/v1/dni",{token:xa,dni:t.params.dni});case 3:n=e.sent,r.json(n.data),e.next=18;break;case 7:if(e.prev=7,e.t0=e.catch(0),422!==e.t0.response.status){e.next=13;break}return e.abrupt("return",r.status(422).json({errorMSG:"Numero Invalido"}));case 13:if(404!==e.t0.response.status){e.next=17;break}return e.abrupt("return",r.status(404).json({errorMSG:"Documento No Encontrado"}));case 17:return e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Va=function(){var e=wa(va().mark((function e(t,r){var n;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ia().post("https://api.migo.pe/api/v1/ruc",{token:xa,ruc:t.params.ruc});case 3:n=e.sent,r.json(n.data),e.next=18;break;case 7:if(e.prev=7,e.t0=e.catch(0),422!==e.t0.response.status){e.next=13;break}return e.abrupt("return",r.status(422).json({errorMSG:"Numero Invalido"}));case 13:if(404!==e.t0.response.status){e.next=17;break}return e.abrupt("return",r.status(404).json({errorMSG:"Documento No Encontrado"}));case 17:return e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),La=function(){var e=wa(va().mark((function e(t,r){var n,o,a,i,s;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new RegExp(t.body.busqueda||"","gi"),o=new RegExp(t.body.busquedaItemCodigo||"","gi"),a=new RegExp(t.body.busquedaUsername||"","gi"),e.next=6,Sa.find({estado:{$in:t.body.estado},"documento.type":{$in:t.body.tipo},"itemsVendidos.codigo":{$regex:o},vendedor:{$regex:a},date:{$gte:new Date(t.body.dateOne),$lte:new Date(t.body.dateTwo)},$or:[{"documento.name":{$regex:n}},{"documento.codigo":Number(t.body.busqueda)||-1}]});case 6:return i=e.sent,e.next=9,pa("Ventas","Reporte De Ventas",["Fecha","Codigo","Para","Vendido Por","Precio No IGV","Precio"],i);case 9:s=e.sent,r.writeHead(200,{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":"attachment; filename=reporte.xlsx"}),r.write(s,"binary"),r.end(null,"binary"),e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),Pa=function(){var e=wa(va().mark((function e(t,r){var n;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Sa.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$project:{codigo:"$documento.codigo",name:"$documento.name",_id:0,totalPrice:1}},{$group:{_id:"$name",value:{$sum:"$totalPrice"}}},{$match:{_id:{$ne:null,$exists:!0}}},{$match:{_id:{$ne:""}}},{$project:{_id:0,name:"$_id",value:1}},{$sort:{value:-1}},{$limit:4}]);case 3:n=e.sent,r.json(n),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Ia=function(){var e=wa(va().mark((function e(t,r){var n;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Sa.aggregate([{$match:{estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$match:{"itemsVendidos.codigo":t.params.codigoItem}},{$group:{_id:null,totalVenta:{$sum:{$multiply:["$itemsVendidos.priceIGV","$itemsVendidos.cantidad"]}},totalGasto:{$sum:{$multiply:["$itemsVendidos.priceCosto","$itemsVendidos.cantidad"]}}}},{$project:{_id:0,totalVenta:1,value:{$subtract:["$totalVenta","$totalGasto"]}}}]);case 3:n=e.sent,r.json(n[0]?n[0]:{value:0,totalVenta:0}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),Aa=function(){var e=wa(va().mark((function e(t,r){var n,o,a;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Sa.aggregate([{$match:{estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$match:{"itemsVendidos.codigo":t.params.codigoItem}},{$set:{mesVenta:{$dateToString:{format:"%Y-%m",date:"$date",timezone:"-05:00"}}}},{$group:{_id:"$mesVenta",totalVenta:{$sum:{$multiply:["$itemsVendidos.priceIGV","$itemsVendidos.cantidad"]}},totalGasto:{$sum:{$multiply:["$itemsVendidos.priceCosto","$itemsVendidos.cantidad"]}}}},{$project:{name:"$_id",_id:0,value:{$trunc:[{$subtract:["$totalVenta","$totalGasto"]},0]}}},{$sort:{name:1}}]);case 3:return n=e.sent,e.next=6,Sa.aggregate([{$match:{estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$match:{"itemsVendidos.codigo":t.params.codigoItem}},{$set:{mesVenta:{$dateToString:{format:"%Y-%m",date:"$date",timezone:"-05:00"}}}},{$group:{_id:"$mesVenta",totalVenta:{$sum:{$multiply:["$itemsVendidos.priceIGV","$itemsVendidos.cantidad"]}},totalGasto:{$sum:{$multiply:["$itemsVendidos.priceCosto","$itemsVendidos.cantidad"]}}}},{$project:{name:"$_id",_id:0,value:"$totalVenta"}},{$sort:{name:1}}]);case 6:o=e.sent,a=[{name:"Ingresos",series:o},{name:"Ganancia",series:n}],r.json(a),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}(),Ga=function(){var e=wa(va().mark((function e(t,r,n){var o;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Sa.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$group:{_id:"$codigo",totalVenta:{$sum:{$multiply:["$priceIGV","$cantidad"]}},totalGasto:{$sum:{$multiply:["$priceCosto","$cantidad"]}}}},{$project:{name:"$_id",_id:0,totalVenta:1,value:{$trunc:[{$subtract:["$totalVenta","$totalGasto"]},0]}}},{$sort:{value:-1}}]);case 3:o=e.sent,t.gananciaPorItem=o,n(),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Ma=function(){var e=wa(va().mark((function e(t,r){var n,o,a;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Sa.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$project:{month:{$dateToString:{format:"%Y-%m",date:"$date",timezone:"-05:00"}},date:1,totalPrice:1,totalPriceNoIGV:1}},{$group:{_id:"$month",value:{$sum:"$totalPrice"}}},{$project:{_id:0,value:{$trunc:["$value",0]},name:"$_id"}},{$sort:{name:1}}]);case 3:return n=e.sent,e.next=6,Sa.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$project:{month:{$dateToString:{format:"%Y-%m",date:"$date",timezone:"-05:00"}},itemsVendidos:1}},{$unwind:"$itemsVendidos"},{$group:{_id:"$month",itemsVendidosPorMes:{$push:{$subtract:[{$multiply:["$itemsVendidos.cantidad","$itemsVendidos.priceIGV"]},{$multiply:["$itemsVendidos.cantidad","$itemsVendidos.priceCosto"]}]}}}},{$project:{_id:0,value:{$trunc:[{$sum:"$itemsVendidosPorMes"},0]},name:"$_id"}},{$sort:{name:1}}]);case 6:return o=e.sent,a=[{name:"Ventas",series:n},{name:"Ganancias",series:o}],e.abrupt("return",r.json(a));case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}(),qa=function(){var e=wa(va().mark((function e(t,r){var n,o,a,i,s,c,u;return va().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=Da(parseInt(t.params.month),parseInt(t.params.year)),e.next=4,Sa.aggregate([{$match:{date:{$gte:new Date("2021-01-01")},estado:"ejecutada"}},{$project:{_id:0,codigo:1,totalPrice:1,day:{$dayOfMonth:"$date"},gastosVenta:{$sum:{$map:{input:"$itemsVendidos",as:"itemVendido",in:{$multiply:["$$itemVendido.cantidad","$$itemVendido.priceCosto"]}}}},year:{$year:"$date"},month:{$month:"$date"}}},{$match:{year:parseInt(t.params.year),month:parseInt(t.params.month)}},{$project:{_id:0,codigo:1,totalPrice:1,day:1,gastosVenta:1,gananciasVenta:{$subtract:["$totalPrice","$gastosVenta"]}}},{$group:{_id:"$day",ganancias:{$sum:"$gananciasVenta"},ventas:{$sum:"$totalPrice"}}},{$sort:{_id:1}}]);case 4:o=e.sent,a=[],i=0,s=0,c=0;case 9:if(!(c<n)){e.next=22;break}if((u=o[s]?o[s]._id:-1)!==c+1){e.next=16;break}"ganancia"===t.params.calcular?i+=o[s].ganancias:"venta"===t.params.calcular&&(i+=o[s].ventas),s++,e.next=18;break;case 16:if(-1!==u){e.next=18;break}return e.abrupt("break",22);case 18:a.push({name:c+1,value:i.toFixed(2)});case 19:c++,e.next=9;break;case 22:r.json(a),e.next=28;break;case 25:return e.prev=25,e.t0=e.catch(0),e.abrupt("return",r.status(500).json({errorMSG:e.t0}));case 28:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(t,r){return e.apply(this,arguments)}}(),Da=function(e,t){return new Date(t,e,0).getDate()},Ra=new w.Router;Ra.get("/getLastVentas/:vendedor",$e,$a),Ra.get("/getGananciaTotalPorItem/:codigoItem",xe,Ia),Ra.get("/getItemGananciaIngreso/:codigoItem",xe,Aa),Ra.get("/getVentasPorDiaMes/:month/:year/:calcular",xe,qa),Ra.get("/getMejoresClientes",xe,Pa),Ra.get("/getItemsGanancias",xe,Ga,go),Ra.get("/getInfoToPlotVentasOverTime",xe,Ma),Ra.put("/eliminarItemVenta",Se,Oa),Ra.put("/eliminarItemSCVenta",Se,ja),Ra.put("/anularVentaPost",Se,Fn),Ra.get("/dni/:dni",$e,Na),Ra.post("/createExcelReport",xe,La),Ra.post("/getEjecutadas",xe,Ea),Ra.post("/getCantidadVentas",xe,Ca),Ra.get("/testTotal",xe,eo),Ra.get("/ruc/:ruc",$e,Va),Ra.get("/obtenerVenta/:ventaCod",xe,Ta),Ra.post("/ventaSimple",Se,Un,Tr,Er,Wn),Ra.post("/agregarVenta",Se,Ie,Rn,Le),Ra.get("/ventasActivasFull",xe,_a),Ra.get("/ventasActivasList",xe,Pe),Ra.post("/agregarItemVenta",Se,Dn),Ra.post("/ventasForCard",xe,qn),Ra.post("/ejecutarVenta",Se,Bn,Tr,Er,Wn),Ra.put("/anularVenta",Se,zn);const Fa=Ra,Ua=require("swagger-ui-express");var Ba=r.n(Ua);const za=JSON.parse('{"openapi":"3.0.2","info":{"license":{"name":"MIT","url":"https://github.com/TacEtarip/sirioinventarioserver/blob/master/LICENSE"},"contact":{"email":"hu3rtas@outlook.com","name":"Luis Huertas","url":"https://github.com/TacEtarip/sirioinventarioserver"},"title":"Sirio Dinar Inventario API","version":"1.0","description":"Rest API para el uso del inventari de la empresa Sirio Dinar. Front End: https://inventario.siriodinar.com/"},"servers":[{"url":"https://inventario-sirio-dinar.herokuapp.com"},{"url":"http://localhost:5000"}],"tags":[{"name":"tipos","description":"Manejar los tipos de items."},{"name":"items","description":"Manejar los items"},{"name":"ventas","description":"Manejar las ventas"},{"name":"reportes","description":"Reportes sobre inventario."},{"name":"organizar","description":"Organizar la presentación de los tipos, sub-tipo e items."},{"name":"utilidades","description":"Utilidades para el inventario."},{"name":"auth","description":"Manejar la autenticación y usuarios."}],"components":{"responses":{"500":{"description":"Ocurrio un error en el servidor","content":{"aplication/json":{"schema":{"type":"object","properties":{"errorMSG":{"type":"string"}}}}}},"Error-401":{"description":"No exite un token de autorización valido"},"Succes":{"description":"Exito al procesar request"}},"securitySchemes":{"JWT TOKEN TRANSACCIONAL":{"type":"http","scheme":"bearer","bearerFormat":"JWT #token #usuario #tipo"},"JWT TOKEN ADMIN":{"type":"http","scheme":"bearer","bearerFormat":"JWT #token #usuario #tipo"},"JWT TOKEN ALL":{"type":"http","scheme":"bearer","bearerFormat":"JWT #token #usuario #tipo"}},"schemas":{"error401":{"description":"NO AUTORIZADO","type":"object","properties":{"message":{"type":"string"}}},"tipo":{"type":"object","required":["name"],"properties":{"name":{"type":"string","description":"Nombre del tipo"},"date":{"type":"string","description":"Fecha de creación del tipo","readOnly":true},"codigo":{"type":"string","description":"Codigo del tipo"},"subTipo":{"type":"array","description":"Listado de sub-tipos","items":{"type":"string","description":"Nombre del sub-tipo"}},"subTipoLink":{"type":"array","description":"Listado las imagenes de los sub-tipos","items":{"type":"string","description":"URL de imagén del sub-tipo"}},"deleted":{"type":"boolean"},"link":{"type":"string","description":"URL de imagén del tipo"},"order":{"type":"number","default":-1,"description":"Orden en que se muestra el tipo"}},"example":{"subTipo":["Respiradores 3M","Filtros 3M","Respiradores Master","Mascarillas","Respiradores Astara","Retenedores para filtros"],"name":"Pro. Respiratoria","date":"2021-01-14T20:04:04.125+00:00","codigo":"1610645929520","deleted":false,"link":"img-1610645929520-1621997665489.png","subTipoLink":["IMG-1622763250845.png","img-1622747657121.png","IMG-1622763288076.png","IMG-1622763339734.png","IMG-1631032975632.jpg","IMG-1630012297019.jpg"],"order":1}},"review":{"type":"object","required":["name"],"properties":{"user":{"type":"string","description":"Username de quien realizo la review"},"rating":{"type":"number","description":"Rating del item de 1 a 5"},"date":{"type":"string","description":"Fecha de publicación de la review"}}},"cantidadSC":{"type":"object","required":["name"],"properties":{"name":{"type":"string","description":"Nombre de la sub cantidad"},"nameSecond":{"type":"string","description":"Segundo nombre de la sub cantidad"},"cantidadDisponible":{"type":"number","description":"Cantidad disponible al momento de la variación"},"cantidadVenta":{"type":"number","description":"Cantidad"}}},"order":{"type":"object","required":["name"],"properties":{"name":{"type":"string","description":"Nombre especifico de la sub cantidad"},"nameSecond":{"type":"string","description":"Segundo especifico nombre de la sub cantidad"},"cantidad":{"type":"number","description":"Cantidad del subconteo"}}},"subConteo":{"type":"object","required":["name"],"properties":{"name":{"type":"string","description":"Nombre de la sub cantidad"},"nameSecond":{"type":"string","description":"Segundo nombre de la sub cantidad"},"order":{"type":"array","items":{"$ref":"#/components/schemas/order"}}}},"variacion":{"type":"object","properties":{"date":{"type":"string","description":"Fecha de la variación ISO STRING","readOnly":true},"tipo":{"type":"boolean","description":"Variación positiva o negativa"},"comentario":{"type":"string","description":"Comentario sobre la variación"},"costoVar":{"type":"number","description":"Costo de la variación"},"cantidad":{"type":"number","description":"Cantidad de variación"},"cantidadSC":{"type":"array","items":{"$ref":"#/components/schemas/cantidadSC"}},"usuario":{"type":"string","description":"Nombre del usuario que realizo la variación"}}},"item":{"type":"object","required":["name","priceIGV","tipo"],"properties":{"codigo":{"type":"string","description":"Codigo del producto, es auto generado."},"name":{"type":"string","description":"Nombre del producto"},"nameLowerCase":{"type":"string","description":"Nombre en minusculas"},"priceIGV":{"type":"number","description":" Precio del producto sin IGV"},"cantidad":{"type":"number","description":"Cantidad de items disponibles del producto"},"subConteo":{"$ref":"#/components/schemas/subConteo"},"variaciones":{"type":"array","items":{"$ref":"#/components/schemas/variacion"}},"tipo":{"type":"string","description":"Tipo al que pertenece el producto"},"subTipo":{"type":"string","description":"Sub tipo al que pertenece el producto"},"unidadDeMedida":{"type":"string","description":"Unidad de medida del item"},"oferta":{"type":"number","description":"Oferta del item"},"date":{"type":"string","description":"Fecha de creación del item ISO STRING","readOnly":true},"description":{"type":"string","description":"Descripción del producto"},"photo":{"type":"string","description":"URL de la foto de este item"},"ficha":{"type":"boolean","description":"Tiene una ficha este producto?"},"marca":{"type":"string","description":"Marca del item"},"costoPropio":{"type":"number","description":"Costo de compra de item"},"multiSearchParams":{"type":"string","description":"Parametros por los cuales puede ser buscado este item","deprecated":true},"deleted":{"type":"boolean","description":"Este item existe?"},"tags":{"type":"array","items":{"type":"string","description":"Tags del item"}},"caracteristicas":{"type":"array","items":{"type":"string","description":"Caracteristicas del item"}},"orderNumber":{"type":"number","description":"En que POS se muestra el nuemro"},"reviews":{"type":"array","items":{"$ref":"#/components/schemas/review"}},"googleCategory":{"type":"string","description":"Categoria del item segun google","default":"2047"}},"example":{"cantidad":425,"subTipo":"LENTES SPIDER","unidadDeMedida":"UND","oferta":0,"photo":"img-14SDLP4-1610836257167.jpeg","ficha":false,"marca":"CLUTE","deleted":false,"tags":[],"caracteristicas":["Lente de policarbonato de alta transparencia.","Proteccion de 99.9% de la radiacion UV.","Tratamiento anti-empañante que reduce la obstrucción de la visibilidad en ambientes húmedos y cambios bruscos de temperatura.","Tratamiento anti-rayadura que prolonga la vida útil del policarbonato."],"orderNumber":-2,"googleCategory":"2047","_id":"600368bd53a848001fc98ea4","name":"Lentes Alpine","priceIGV":35,"description":"Alipme","costoPropio":27,"tipo":"Protec. Visual","variaciones":[{"cantidad":432,"tipo":true,"usuario":"desconocido","date":"2021-01-16T22:29:17.386Z","comentario":"new item","costoVar":10800,"cantidadSC":[]},{"cantidad":1,"tipo":false,"usuario":"desconocido","date":"2021-02-17T22:49:35.594Z","comentario":"venta|SD01-000333","costoVar":35,"cantidadSC":[]},{"cantidad":1,"tipo":true,"usuario":"desconocido","date":"2021-02-17T23:01:24.220Z","comentario":"anular|SD01-000333","costoVar":35,"cantidadSC":[]},{"cantidad":2,"tipo":false,"usuario":"desconocido","date":"2021-06-08T22:44:08.841Z","comentario":"quitar|Actualización","costoVar":54,"cantidadSC":[]},{"cantidad":1,"tipo":false,"usuario":"desconocido","date":"2021-06-21T20:14:08.578Z","comentario":"venta|SD01-001013","costoVar":35,"cantidadSC":[]},{"cantidad":1,"tipo":false,"usuario":"admin","date":"2021-07-15T15:26:49.169Z","comentario":"venta|SD01-001157","costoVar":25,"cantidadSC":[]},{"cantidad":2,"tipo":false,"usuario":"desconocido","date":"2021-07-30T22:07:45.576Z","comentario":"quitar|Actualización","costoVar":54,"cantidadSC":[]},{"cantidad":1,"tipo":false,"usuario":"admin","date":"2021-08-27T22:15:32.180Z","comentario":"venta|SD01-001438","costoVar":35,"cantidadSC":[]}],"date":"2021-01-16T22:29:17.383Z","priceNoIGV":29.66,"codigo":"14SDLP4","nameLowerCase":"lentes alpine","__v":0,"reviews":[]}},"marca":{"type":"object","properties":{"name":{"type":"string","description":"Nombre de la marca"},"codigo":{"type":"string","description":"Codigo de la marca"},"ruc":{"type":"string"}}},"tag":{"type":"object","properties":{"name":{"type":"string","description":"Nombre del tag"},"deleted":{"type":"boolean"}}},"user":{"required":["username","email","created_date"],"type":"object","properties":{"username":{"type":"string"},"type":{"type":"string"},"created_date":{"type":"string"},"displayName":{"type":"string"},"email":{"type":"string"},"dirOne":{"type":"string"},"dirTwo":{"type":"string"},"reference":{"type":"string"},"ciudad":{"type":"string"},"nombre":{"type":"string"},"apellido":{"type":"string"},"nomape":{"type":"string"},"googleCod":{"type":"string"},"documento":{"type":"string"},"tipoPersona":{"type":"string"},"verified":{"type":"boolean"},"celular":{"type":"string"},"ventaActiva":{"type":"array","items":{"type":"string"}},"carrito":{"type":"string"}}},"login":{"type":"object","properties":{"username":{"type":"string"},"password":{"type":"string"}}},"authToken":{"type":"object","properties":{"displayName":{"type":"string"},"username":{"type":"string"},"message":{"type":"string"},"type":{"type":"string"},"token":{"type":"string"}}},"document":{"type":"object","properties":{"type":{"type":"string"},"name":{"type":"string"},"codigo":{"type":"number"},"direccion":{"type":"string"}}},"itemvendido":{"type":"object","properties":{"codigo":{"type":"string"},"tipo":{"type":"string"},"name":{"type":"string"},"descripcion":{"type":"string"},"priceIGV":{"type":"number"},"priceNoIGV":{"type":"number"},"priceCosto":{"type":"number"},"cantidad":{"type":"number"},"cantidadSC":{"type":"array","items":{"$ref":"#/components/schemas/cantidadSC"}},"totalPrice":{"type":"number"},"totalPriceNoIGV":{"type":"number"},"unidadDeMedida":{"type":"string"},"photo":{"type":"string"},"ventaCod":{"type":"string"}}},"venta":{"type":"object","properties":{"codigo":{"type":"string"},"totalPrice":{"type":"number"},"totalPriceNoIGV":{"type":"number"},"estado":{"type":"string"},"documento":{"$ref":"#/components/schemas/document"},"itemsVendidos":{"type":"array","items":{"$ref":"#/components/schemas/itemvendido"}},"date":{"type":"string"},"vendedor":{"type":"string"},"tipoVendedor":{"type":"string"},"medio_de_pago":{"type":"string"},"linkComprobante":{"type":"string"},"serie":{"type":"string"},"tipoComprobante":{"type":"string"},"numero":{"type":"number"},"cliente_email":{"type":"string"},"guia_serie":{"type":"string"},"guia_numero":{"type":"string"},"guia":{"type":"boolean"},"guia_link":{"type":"string"},"carrito_venta":{"type":"boolean"},"estado_carrito_comprando":{"type":"boolean"}}}}},"paths":{"/inventario/getTipos":{"get":{"tags":["tipos"],"summary":"Optener todos los tipos","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/tipo"}}}}}}}},"/inventario/getTipo/{nameTipo}":{"get":{"tags":["tipos"],"summary":"Obtener un tipo en especifico","parameters":[{"name":"nameTipo","in":"path","required":true,"allowEmptyValue":false,"example":"Pro. Respiratoria","schema":{"type":"string","description":"Nombre del tipo que deseamos"}}],"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/tipo"}}}}}}},"/inventario/addTipo":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["tipos"],"summary":"Agregar tipo","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/tipo"},"example":{"name":"Nuevo Tipo"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/tipo"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/updateTipo":{"put":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["tipos"],"summary":"Actualizar tipo","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"codigo":{"type":"string","description":"Codigo del tipo"},"tipoName":{"type":"string","description":"Nuevo nombre del tipo"}}},"example":{"codigo":"123123","tipoName":"Tipo Editado"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/tipo"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/deleteTipo/{codigo}":{"delete":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"parameters":[{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"123456","schema":{"type":"string","description":"Codigo del tipo que deseamos eliminar"}}],"tags":["tipos"],"summary":"Elimina el tipo y todos los sub-tipos e items dentro del él.","responses":{"200":{"description":"Ok, Tipo eliminado","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/tipo"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getSubTipos/{nameTipo}":{"get":{"tags":["tipos"],"summary":"Optener todos los sub-tipos","parameters":[{"name":"nameTipo","in":"path","required":true,"allowEmptyValue":false,"example":"Pro. Respiratoria","schema":{"type":"string","description":"Nombre del tipo que deseamos"}}],"responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","properties":{"subTipo":{"type":"array","items":{"type":"string"}}},"example":{"subTipo":["Respiradores 3M","Filtros 3M"]}}}}}}}},"/inventario/addSubTipo":{"put":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["tipos"],"summary":"Agregar sub-tipo","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"codigo":{"type":"string","description":"Codigo del tipo"},"subTipo":{"type":"string","description":"Nombre del sub-tipo"}}},"example":{"codigo":"123123","subTipo":"SubTipo Nuevo"}}}},"responses":{"200":{"$ref":"#/components/responses/Succes"},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/uptateSupTipos":{"put":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["tipos"],"summary":"Editar sub-tipo","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"codigo":{"type":"string","description":"Codigo del tipo"},"newSubName":{"type":"string","description":"Nuevo nombre del sub-tipo"},"antiguoSubName":{"type":"string","description":"Antiguo nombre del sub-tipo"}}},"example":{"codigo":"123123","newSubName":"SubTipo Nuevo","antiguoSubName":"SubTipo Antiguo"}}}},"responses":{"200":{"$ref":"#/components/responses/Succes"},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/deleteSupTipo/{codigo}/{subTipoName}":{"delete":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"parameters":[{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"123456","schema":{"type":"string","description":"Codigo del tipo del sub-tipo que deseamos eliminar"}},{"name":"subTipoName","in":"path","required":true,"allowEmptyValue":false,"example":"Pro. Respiratoria","schema":{"type":"string","description":"Nombre del sub-tipo que se desea eliminar."}}],"tags":["tipos"],"summary":"Elimina el sub-tipo y todos los items dentro del él.","responses":{"200":{"description":"Ok, sub-tipo eliminado","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/tipo"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getItem/cod/{codigo}":{"get":{"tags":["items"],"parameters":[{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"1SDRP4","schema":{"type":"string","description":"Codigo del item"}}],"summary":"Obtener un item","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/item"}}}}}}},"/inventario/getItems":{"get":{"tags":["items"],"deprecated":true,"summary":"Optener todos los items. No usar.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/item"}}}}}}}},"/inventario/getItemsDestacados":{"get":{"tags":["items"],"summary":"Obtener los items destacados","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/item"}}}}}}}},"/inventario/getItemsByType/{nameTipo}":{"get":{"tags":["items"],"parameters":[{"name":"nameTipo","in":"path","required":true,"allowEmptyValue":false,"example":"Pro. Respiratoria","schema":{"type":"string","description":"Nombre del tipo que deseamos"}}],"summary":"Obtener los items de un tipo","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/item"}}}}}}}},"/inventario/getItemsSubTipo/{nameTipo}/{subTipo}":{"get":{"tags":["items"],"parameters":[{"name":"nameTipo","in":"path","required":true,"allowEmptyValue":false,"example":"Pro. Respiratoria","schema":{"type":"string","description":"Nombre del tipo que deseamos"}},{"name":"subTipo","in":"path","required":true,"allowEmptyValue":false,"example":"Respiradores Master","schema":{"type":"string","description":"Nombre del sub-tipo que deseamos"}}],"summary":"Obtener los items de un sub-tipo","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/item"}}}}}}}},"/inventario/getItemsRelacionados/{tipo}/{codigo}":{"get":{"tags":["items"],"parameters":[{"name":"tipo","in":"path","required":true,"allowEmptyValue":false,"example":"Pro. Respiratoria","schema":{"type":"string","description":"Tipo del que buscar"}},{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"1SDRP4","schema":{"type":"string","description":"Codigo del item del que queremos sacar items relacionados."}}],"summary":"Obtener los items realacionados, NOT COMPLETE","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/item"}}}}}}}},"/inventario/getItemsSearch/{searchTerms}":{"get":{"tags":["items"],"parameters":[{"name":"searchTerms","in":"path","required":true,"allowEmptyValue":false,"example":"Cualquier texto","schema":{"type":"string","description":"Terminos que se desean buscar"}}],"summary":"Obtener los items segun regex","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/item"}}}}}}}},"/inventario/addItem":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["items"],"summary":"Agregar item","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/item"},"example":{"cantidad":425,"subTipo":"LENTES SPIDER","unidadDeMedida":"UND","marca":"CLUTE","deleted":false,"googleCategory":"2047","name":"Lentes Alpine TEST","priceIGV":35,"description":"Alipme","costoPropio":27,"tipo":"Protec. Visual","priceNoIGV":29.66}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/updateItem":{"put":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["items"],"summary":"Actualizar item","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/item"},"example":{"codigo":"1SDRP4","cantidad":425,"unidadDeMedida":"UND","marca":"CLUTE","name":"Lentes Alpine TEST","priceIGV":35,"description":"Alipme","costoPropio":27,"tags":["Clute"]}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/uploadVariationSC":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["items"],"summary":"Actualizar item","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"codigo":{"type":"string"},"cantidad":{"type":"number"},"comentario":{"type":"string"},"tipo":{"type":"boolean"},"subConteo":{"$ref":"#/components/schemas/subConteo"}}}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/uploadVariationSimple":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["items"],"summary":"Actualizar item","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"codigo":{"type":"string"},"cantidad":{"type":"number"},"comentario":{"type":"string"},"tipo":{"type":"boolean"}}}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/addItemReview":{"post":{"security":[{"JWT TOKEN ALL":[]}],"tags":["items"],"summary":"Agrega una review al item.","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/item"},"example":{"codigo":"1SDRP4","rating":5}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"400":{"description":"Numero no valido","content":{"aplication/json":{"schema":{"type":"array","properties":{"errorMSG":{"description":"Mensaje de error"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/addCaracteristica":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["items"],"summary":"Agrega una caracteristica","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"itemCod":{"type":"string"}}},"example":{"itemCod":"1SDRP4"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/deteleCaracteristicas":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["items"],"summary":"Eliminar caracteristica de item","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"itemCod":{"type":"string"},"deleteArray":{"type":"array","items":{"type":"string"}}}}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/toFavorite":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["items"],"summary":"Agregar item a favoritos o destacados","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/item"},"example":{"codigo":"1SDRP4"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/toUnFavorite":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["items"],"summary":"Quitar item de favoritos o destacados","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/item"},"example":{"codigo":"1SDRP4"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/deleteItem/{codigo}":{"delete":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["items"],"parameters":[{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"1SDRP4","schema":{"type":"string","description":"Codigo del item que deseamos eliminar"}}],"summary":"Eliminar item","responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/uploads/image/{codigo}":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["items"],"summary":"Agregar o modificar imagen de item","requestBody":{"required":true,"content":{"form-data":{"schema":{"type":"object","properties":{"img":{"type":"string","description":"File Type"},"oldPhoto":{"type":"string","description":"URL de la imagén antigua."}}}}}},"parameters":[{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"1SDRP4","schema":{"type":"string","description":"Codigo del item que queremos modificar la imagén"}}],"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/uploads/imageCat/{codigo}":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["tipos"],"summary":"Agregar o modificar imagen de tipo","requestBody":{"required":true,"content":{"form-data":{"schema":{"type":"object","properties":{"img":{"type":"string","description":"File Type"},"oldPhoto":{"type":"string","description":"URL de la imagén antigua."}}}}}},"parameters":[{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"1SDRP4","schema":{"type":"string","description":"Codigo del tipo que queremos modificar la imagén"}}],"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/tipo"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/uploads/imageSubCat/{codigo}/{subCat}":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["tipos"],"summary":"Agregar o modificar imagen de sub-tipo","requestBody":{"required":true,"content":{"form-data":{"schema":{"type":"object","properties":{"img":{"type":"string","description":"File Type"},"oldPhoto":{"type":"string","description":"URL de la imagén antigua."}}}}}},"parameters":[{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"1SDRP4","schema":{"type":"string","description":"Codigo del tipo del sub-tipo que queremos modificar la imagén"}},{"name":"subCat","in":"path","required":true,"allowEmptyValue":false,"example":"Un Sub Tipo","schema":{"type":"string","description":"Sub-tipo del que queremos modificar la imagén"}}],"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"newPhoto":{"type":"string","description":"Link de la nueva foto"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/changeFolder":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["organizar"],"summary":"Modificar a que tipo/sub-tipo un item pertenece.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["codigo"],"properties":{"codigo":{"type":"string","description":"Codigo del item"},"newTipo":{"type":"string","description":"Nombre del nuevo tipo."},"newSubTipo":{"type":"string","description":"Nombre del nuevo sub tipo"}}}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/item"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/reorderItems":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["organizar"],"summary":"Ordenar items.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["codigo"],"properties":{"itemReOrder":{"type":"array","items":{"$ref":"#/components/schemas/item"}}}}}}},"responses":{"200":{"$ref":"#/components/responses/Succes"},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/reorderTipos":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["organizar"],"summary":"Ordenar tipos.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["codigo"],"properties":{"tiposReOrder":{"type":"array","items":{"$ref":"#/components/schemas/tipo"}}}}}}},"responses":{"200":{"$ref":"#/components/responses/Succes"},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/reorderSubTipos":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["organizar"],"summary":"Ordenar sub-tipos.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["codigo"],"properties":{"tipoCodigo":{"type":"string","description":"Codigo del tipo al que pertenecen los sub-tipos"},"linksList":{"type":"array","items":{"type":"string"}},"subTipoList":{"type":"array","items":{"type":"string"}}}}}}},"responses":{"200":{"$ref":"#/components/responses/Succes"},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getItemMayorGananciaPosible":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["reportes"],"summary":"Optener item con la mayor ganancia posible.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string","description":"Nombre del item"},"balance":{"type":"number","description":"Balance del item en soles (S/)"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getItemsLowStock":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["reportes"],"summary":"Optener items con poca cantidad.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/item"}}}}}}}},"/inventario/getItemsNoStock":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["reportes"],"summary":"Optener items agotados.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/item"}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getClienteConMasCompras":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["reportes"],"summary":"Optener clientes que más han comprado.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"object","properties":{"cliente":{"type":"string","description":"Nombre del cliente"},"numero":{"type":"number","description":"Cantidad de compras"}}}}}}}}},"/inventario/getItemsMasVendido":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["reportes"],"summary":"Optener item más vendido.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/item"}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getGananciasTotalesSNS":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["reportes"],"summary":"Optener ganancias por ventas.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"object","properties":{"gananciaEnVentasFueraTienda":{"type":"number","description":"Ganancias por items no registrados en el inventario."},"gananciaEnVentas":{"type":"number","description":"Ganancias por ventas totales."},"gananciaEnVentasDeTienda":{"type":"number","description":"Ganancias por items registardos en el inventario."}}}}}}}}},"/inventario/gananciasInvercionTotal":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["reportes"],"summary":"Optener ganancias y gastos totales.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"object","properties":{"gastoTotalHistorico":{"type":"number","description":"Total de gastos registrados."},"ingresoTotalHistorico":{"type":"number","description":"Total de ganancias registradas."}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getPeorMejorItem":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["reportes"],"summary":"Optener los items con el mejor y peor rendimiento.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"object","properties":{"peor":{"type":"object","description":"Peor item.","properties":{"name":{"type":"string"},"balance":{"type":"number"}}},"mejor":{"type":"object","description":"Mejor item.","properties":{"name":{"type":"string"},"balance":{"type":"number"}}}}}}}}}}},"/inventario/ventasPotenciales":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["reportes"],"summary":"Optener ventas potenciales.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"object","properties":{"ventasPosibles":{"type":"number","description":"Ventas potenciales de los items"},"costoPropioTotalAprox":{"type":"number","description":"Cuanto han costado todos los items"},"gananciaAprox":{"type":"number","description":"Ganancias aproximadas"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getTableInfItem":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["reportes"],"summary":"Obtener JSON con información necesaria para realizar un reporte por cada item.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"name":{"type":"string"},"codigo":{"type":"string"},"cantidad":{"type":"number"},"priceIGV":{"type":"number"},"costoPropio":{"type":"number"},"valueIngreso":{"type":"number"},"valueGasto":{"type":"number"}}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getItemBalance/{codigo}":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"parameters":[{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"123dDF","schema":{"type":"string","description":"Codigo del item"}}],"tags":["reportes"],"summary":"Obtener balance de un item.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"number","description":"Balance del item"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getItemReport/{codigo}":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"parameters":[{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"123dDF","schema":{"type":"string","description":"Codigo del item"}}],"tags":["reportes"],"summary":"Obtener un excel con el reporte de variaciones del item.","responses":{"200":{"description":"Ok","content":{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getItemVentasPorMes/{codigo}":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"parameters":[{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"123dDF","schema":{"type":"string","description":"Codigo del item"}}],"tags":["reportes"],"externalDocs":{"url":"https://swimlane.gitbook.io/ngx-charts/"},"summary":"Obtener ventas por mes para ser graficadas usando ngx-charts.","responses":{"200":{"$ref":"#/components/responses/Succes"},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getItemGIC/{codigo}":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"parameters":[{"name":"codigo","in":"path","required":true,"allowEmptyValue":false,"example":"123dDF","schema":{"type":"string","description":"Codigo del item"}}],"tags":["reportes"],"summary":"Obtener ganancias, ingresos y costos de item.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"object","properties":{"itemVendidos":{"type":"number"},"cantidadHistorica":{"type":"number"},"totalCosto":{"type":"number"},"totalIngreso":{"type":"number"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/marcas/getAll":{"get":{"tags":["utilidades"],"summary":"Obtener todas las marcas.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/marca"}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/marcas/add":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["utilidades"],"summary":"Agregar una marca.","requestBody":{"content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/marca"},"example":{"nombre":"Marca X"}}}},"responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/marca"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/marcas/delete/{deleteString}":{"delete":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["utilidades"],"summary":"Eliminar un listado de marcas.","parameters":[{"name":"deleteString","in":"path","required":true,"allowEmptyValue":false,"example":"marca marsa marxa marza","schema":{"type":"string","description":"String de marcas a elminar separados por un espacio en blanco"}}],"responses":{"200":{"$ref":"#/components/responses/Succes"},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getTags":{"get":{"tags":["utilidades"],"summary":"Obtener todas los tags.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/tag"}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getListOfTagsFilteredByRegex":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["utilidades"],"summary":"Obtener todas los tags.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"value":{"type":"string","description":"Regex para buscar"}}}}}},"responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/tag"}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/addTag":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["utilidades"],"summary":"Agregar un tag.","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/tag"},"example":{"name":"TAGX"}}}},"responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/tag"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/deteleTags":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["utilidades"],"summary":"Eliminar tags.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"array","items":{"type":"string"}}}}},"responses":{"200":{"$ref":"#/components/responses/Succes"},"401":{"$ref":"#/components/responses/Error-401"}}}},"/auth/login":{"post":{"tags":["auth"],"summary":"Realizar login.","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/login"}}}},"responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/authToken"}}}},"400":{"$ref":"#/components/responses/Error-401"}}}},"/auth/google":{"get":{"tags":["auth"],"summary":"Te redirije a el sistema de autorizacion de login de google.","externalDocs":{"url":"https://cloud.google.com/nodejs/getting-started/authenticate-users?hl=es"},"responses":{"302":{"description":"Redirijiendo"},"400":{"$ref":"#/components/responses/Error-401"}}}},"/auth/google/callback":{"get":{"tags":["auth"],"summary":"Callback a donde te redirije google. Detectara si ir a la pagina de registro o iniciar sesión.","externalDocs":{"url":"https://cloud.google.com/nodejs/getting-started/authenticate-users?hl=es"},"responses":{"302":{"description":"Redirijiendo."},"400":{"$ref":"#/components/responses/Error-401"}}}},"/auth/google/loginfast":{"post":{"tags":["auth"],"summary":"Usando un token se realiza el inicio de sesión.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"loginToken":{"type":"string"}}}}}},"responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/authToken"}}}},"400":{"$ref":"#/components/responses/Error-401"}}}},"/auth/google/getLoginInfoFromToken":{"post":{"tags":["auth"],"summary":"Usando un token adquiera la información de usuario dada por google.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"loginToken":{"type":"string"}}}}}},"responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"type":"boolean","properties":{"given_name":{"type":"string"},"family_name":{"type":"string"},"email":{"type":"string"},"sub":{"type":"string","description":"Codigo de google"}}}}}},"400":{"$ref":"#/components/responses/Error-401"}}}},"/auth/google/registerlow":{"post":{"tags":["auth"],"summary":"Registra a un usuario, ademas envia un email de confirmación.","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/user"}}}},"responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/user"}}}},"400":{"$ref":"#/components/responses/Error-401"}}}},"/auth/cambiarContrasena":{"post":{"security":[{"JWT TOKEN ALL":[]}],"tags":["auth"],"summary":"Cambiar contraseña de usuario","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","description":"ID del usuario"},"passwordOld":{"type":"string","description":"Contraseña antigua"}}}}}},"responses":{"200":{"$ref":"#/components/responses/Succes"},"400":{"$ref":"#/components/responses/Error-401"}}}},"/auth/actCelular":{"post":{"tags":["auth"],"security":[{"JWT TOKEN ALL":[]}],"summary":"Cambiar celular de usuario","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","description":"ID del usuario"},"celular":{"type":"string","description":"Contraseña antigua"}}}}}},"responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/user"}}}},"400":{"$ref":"#/components/responses/Error-401"}}}},"/auth/agregarDireccion":{"post":{"tags":["auth"],"security":[{"JWT TOKEN ALL":[]}],"summary":"Agregar o cambiar dirección de usuario.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","description":"ID del usuario"},"dirOne":{"type":"string"},"dirTwo":{"type":"string"},"reference":{"type":"string"}}}}}},"responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/user"}}}},"400":{"$ref":"#/components/responses/Error-401"}}}},"/auth/agregarDocumento":{"post":{"tags":["auth"],"security":[{"JWT TOKEN ALL":[]}],"summary":"Agregar o cambiar documento de usuario.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","description":"ID del usuario"},"documento":{"type":"string"},"tipoPersona":{"type":"string","enum":["dni","ruc"]}}}}}},"responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/user"}}}},"400":{"$ref":"#/components/responses/Error-401"}}}},"/auth/getUserInfo/{username}":{"get":{"security":[{"JWT TOKEN ALL":[]}],"parameters":[{"name":"username","in":"path","required":true,"allowEmptyValue":false,"example":"DWEWQX123D2D","schema":{"type":"string","description":"Codigo del usario"}}],"tags":["reportes"],"summary":"Obtener usuario.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/user"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/auth/getOwnUser":{"get":{"security":[{"JWT TOKEN ALL":[]}],"tags":["reportes"],"summary":"Obtener usuario propio.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/user"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/auth/userEx":{"get":{"security":[{"JWT TOKEN ALL":[]}],"parameters":[{"name":"username","in":"path","required":true,"allowEmptyValue":false,"example":"DWEWQX123D2D","schema":{"type":"string","description":"Codigo del usario"}}],"tags":["reportes"],"summary":"Buscar si el usuario existe.","responses":{"200":{"description":"Ok","content":{"application/json":{"schema":{"$ref":"#/components/schemas/user"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/ventaSimple":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["ventas"],"summary":"Realiza una venta con solo 1 item.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"venta":{"$ref":"#/components/schemas/venta"}}}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"venta":{"$ref":"#/components/schemas/venta"},"message":{"type":"string"},"_sunat":{"type":"object"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/agregarVenta":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["ventas"],"summary":"Crear una nueva venta con 1 item.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"venta":{"$ref":"#/components/schemas/venta"}}}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"venta":{"$ref":"#/components/schemas/venta"},"message":{"type":"string"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/agregarItemVenta":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["ventas"],"summary":"Agregar un item a una venta.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"codigoVenta":{"type":"string"},"itemVendido":{"$ref":"#/components/schemas/itemvendido"}}}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"venta":{"$ref":"#/components/schemas/venta"},"message":{"type":"string"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/ejecutarVenta":{"post":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["ventas"],"summary":"Ejecutar venta.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"venta":{"$ref":"#/components/schemas/venta"}}}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"venta":{"$ref":"#/components/schemas/venta"},"message":{"type":"string"},"_sunat":{"type":"object"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/anularVentaPost":{"put":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["ventas"],"summary":"Anular venta post ejecución.","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/venta"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"message":{"type":"string"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/anularVenta":{"put":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["ventas"],"summary":"Anular venta.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"venta":{"$ref":"#/components/schemas/venta"}}}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"message":{"type":"string"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/eliminarItemVenta":{"put":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["ventas"],"summary":"Eliminar item de venta.","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/venta"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/venta"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/eliminarItemSCVenta":{"put":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["ventas"],"summary":"Eliminar item de venta cuando el item tiene un sub-conteo.","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/venta"}}}},"responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/venta"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/getVentasActivasList":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["ventas"],"summary":"Obetener listado de las ventas activas del usuario.","responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"array","items":{"type":"string"}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/ventasActivasFull":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"tags":["ventas"],"summary":"Obetener listado detallado de las ventas activas del usuario.","responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/venta"}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/obtenerVenta/{ventaCod}":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"parameters":[{"name":"ventaCod","in":"path","required":true,"allowEmptyValue":false,"example":"SD222","schema":{"type":"string","description":"Codigo de la venta."}}],"tags":["ventas"],"summary":"Obetener venta.","responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"$ref":"#/components/schemas/venta"}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/ventas/getGananciaTotalPorItem/{codigoItem}":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"parameters":[{"name":"codigoItem","in":"path","required":true,"allowEmptyValue":false,"example":"SD222","schema":{"type":"string","description":"Codigo del item."}}],"tags":["reportes"],"summary":"Obetener ganancia total por item.","responses":{"200":{"description":"Ok","content":{"aplication/json":{"schema":{"type":"object","properties":{"value":{"type":"number"},"totalVenta":{"type":"number"}}}}}},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getItemGananciaIngreso/{codigoItem}":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"parameters":[{"name":"codigoItem","in":"path","required":true,"allowEmptyValue":false,"example":"SD222","schema":{"type":"string","description":"Codigo del item."}}],"tags":["reportes"],"externalDocs":{"url":"https://swimlane.gitbook.io/ngx-charts/"},"summary":"Obtener ventas por mes para ser graficadas usando ngx-charts.","responses":{"200":{"$ref":"#/components/responses/Succes"},"401":{"$ref":"#/components/responses/Error-401"}}}},"/inventario/getItemsGanancias":{"get":{"security":[{"JWT TOKEN TRANSACCIONAL":[]}],"parameters":[{"name":"codigoItem","in":"path","required":true,"allowEmptyValue":false,"example":"SD222","schema":{"type":"string","description":"Codigo del item."}}],"tags":["reportes"],"externalDocs":{"url":"https://swimlane.gitbook.io/ngx-charts/"},"summary":"Obtener ventas por mes para ser graficadas usando ngx-charts.","responses":{"200":{"$ref":"#/components/responses/Succes"},"401":{"$ref":"#/components/responses/Error-401"}}}}}}'),Wa=require("morgan");var Ka=r.n(Wa);E().key=f.production.tinyKey;var Ja=x()(),Ha=f.production.log();Ja.use($()({contentSecurityPolicy:!1})),Ja.use(h()()),Ja.use(g()()),Ja.use(Ka()(":method :url")),Ja.options("*",b()({credentials:!0,origin:f.production.origin})),Ja.use(b()({credentials:!0,origin:f.production.origin})),Ja.use(x().json()),Ja.use(x().urlencoded({extended:!0})),Ja.use((function(e,t,r){if(e.headers&&e.headers.authorization&&"JWT"===e.headers.authorization.split(" ")[0]){var n=e.headers.authorization;O().verify(n.split(" ")[1],f.production.jwtKey,{audience:n.split(" ")[2]+" "+n.split(" ")[3]},(function(n,o){if(n)return e.user=void 0,t.status(401).json({message:"Usuario No Autorizado"});e.user=o,r()}))}else e.user=void 0,r()})),Ja.use("/inventario",oa),Ja.use("/carrito",mt),Ja.use("/auth",Me),Ja.use("/ventas",Fa),Ja.use("/email",sr),Ja.use("/coti",ar),Ja.use("/api-docs",Ba().serve,Ba().setup(za)),Ja.get("/",(function(e,t){return t.redirect("/api-docs")})),Ja.use("/static",x().static(T().join(__dirname,"uploads"))),Ja.use((function(e,t,r,n){return r.status(e.status||500),Ha.error(e),Ha.info(e),r.json({error:{message:e.message}})}));const Ya=Ja;function Qa(e){return Qa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qa(e)}function Za(){Za=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),s=new C(n||[]);return o(i,"_invoke",{value:k(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,i,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var $=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,a,i,s){var c=p(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==Qa(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function k(t,r,n){var o=l;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=T(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?h:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=h,n.method="throw",n.arg=u.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Qa(t)+" is not iterable")}return v.prototype=b,o($,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},j(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j($),u($,c,"Generator"),u($,i,(function(){return this})),u($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Xa(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var ei=f.production.log();const ti=function(){var e,t=(e=Za().mark((function e(t){return Za().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,W().connect(t,{useNewUrlParser:!0,useUnifiedTopology:!0,useCreateIndex:!0});case 3:return e.abrupt("return",ei.info("Connected To DataBase"));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",ei.error(e.t0));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Xa(a,n,o,i,s,"next",e)}function s(e){Xa(a,n,o,i,s,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}();r(142).config();var ri=o().createServer(Ya),ni=f.production.PORT,oi=f.production.log(),ai=process.env.WEB_CONCURRENCY||1;Ya.set("port",ni),i()({worker:function(e,t){oi.info("Id Worker ".concat(e)),ri.listen(ni||0),ti(f.production.mongoKey)},count:ai}),ri.on("listening",(function(){oi.info("Hi there! I'm listening on port ".concat(ri.address().port," in ").concat(Ya.get("env")," mode."))}))},502:e=>{e.exports=require("core-js/stable")},142:e=>{e.exports=require("dotenv")},936:e=>{e.exports=require("regenerator-runtime/runtime")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(502),r(936),r(212)})();