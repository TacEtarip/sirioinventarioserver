!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=32)}([function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return v})),n.d(t,"a",(function(){return b}));var r=n(2),a=n.n(r),o=n(10),u=n.n(o),i=n(8),s=n.n(i);function c(e,t,n,r,a,o,u){try{var i=e[o](u),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}var d=new r.Schema({username:{type:String,required:!0,unique:!0,lowercase:!0},hashPassword:{type:String,required:!0},type:{type:String,required:!0},created_date:{type:Date,default:Date.now},displayName:{type:String,required:!0}});d.methods.comparePassword=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.compare(t,n);case 3:return r=e.sent,e.abrupt("return",r);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function u(e){c(o,r,a,u,i,"next",e)}function i(e){c(o,r,a,u,i,"throw",e)}u(void 0)}))});return function(e,n){return t.apply(this,arguments)}}();var p=n(3);function f(e,t,n,r,a,o,u){try{var i=e[o](u),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}var m=a.a.model("User",d),l=function(e,t,n){if(!e.user||"admin"!==e.user.type)return t.status(401).json({message:"Unauthorized User"});n()},v=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.body.username,(a=new m(t.body)).displayName=r,e.next=6,u.a.hash(t.body.password,10);case 6:return a.hashPassword=e.sent,e.next=9,a.save();case 9:return(o=e.sent).hashPassword=void 0,e.abrupt("return",n.json(o));case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",n.status(400).send({message:e.t0}));case 17:case"end":return e.stop()}}),e,null,[[0,14]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function u(e){f(o,r,a,u,i,"next",e)}function i(e){f(o,r,a,u,i,"throw",e)}u(void 0)}))});return function(e,n){return t.apply(this,arguments)}}(),b=function(e,t){m.findOne({username:e.body.username.toLowerCase()},(function(n,r){if(n)throw n;return r?r?r.comparePassword(e.body.password,r.hashPassword)?t.json({displayName:r.displayName,username:e.body.username,success:!0,message:"Success",token:s.a.sign({type:r.type,username:r.username,_id:r.id},p.a.develoment.jwtKey)}):t.status(401).json({username:e.body.username,success:!1,message:"Authenticacion failed. Incorrect Password!",token:null}):void 0:t.status(401).json({username:e.body.username,success:!1,message:"Authenticacion failed. No user found!",token:null})}))}},function(e,t,n){"use strict";n.d(t,"v",(function(){return x})),n.d(t,"s",(function(){return w})),n.d(t,"d",(function(){return k})),n.d(t,"k",(function(){return S})),n.d(t,"C",(function(){return j})),n.d(t,"B",(function(){return R})),n.d(t,"D",(function(){return N})),n.d(t,"e",(function(){return T})),n.d(t,"u",(function(){return V})),n.d(t,"a",(function(){return P})),n.d(t,"p",(function(){return A})),n.d(t,"j",(function(){return G})),n.d(t,"r",(function(){return O})),n.d(t,"b",(function(){return I})),n.d(t,"l",(function(){return q})),n.d(t,"m",(function(){return D})),n.d(t,"n",(function(){return $})),n.d(t,"o",(function(){return F})),n.d(t,"q",(function(){return U})),n.d(t,"w",(function(){return E})),n.d(t,"x",(function(){return B})),n.d(t,"y",(function(){return _})),n.d(t,"z",(function(){return K})),n.d(t,"g",(function(){return z})),n.d(t,"i",(function(){return H})),n.d(t,"h",(function(){return L})),n.d(t,"c",(function(){return Y})),n.d(t,"t",(function(){return J})),n.d(t,"A",(function(){return W})),n.d(t,"f",(function(){return X}));var r=n(2),a=n.n(r),o=new r.Schema({name:{type:String,trim:!0,required:!0},nameSecond:{type:String,trim:!0},cantidad:{type:Number}},{_id:!1}),u=new r.Schema({name:{type:String,trim:!0,required:!0},nameSecond:{type:String,trim:!0},order:{type:[o]}},{_id:!1}),i=new r.Schema({date:{type:Date,default:Date.now},cantidad:{type:Number,default:0},tipo:{type:Boolean,default:!1},comentario:{type:String,trim:!0},costoVar:{type:Number}},{_id:!1}),s=new r.Schema({name:{type:String,required:!0,trim:!0,unique:!0},nameLowerCase:{type:String,trim:!0,lowercase:!0},priceIGV:{type:Number,required:!0},priceNoIGV:{type:Number},cantidad:{type:Number,default:0},subConteo:{type:u},variaciones:{type:[i]},codigo:{type:String,required:!0,trim:!0,unique:!0},tipo:{type:String,required:!0},subTipo:{type:String,default:"noone"},unidadDeMedida:{type:String,default:"UND",trim:!0},oferta:{type:Number,default:0},date:{type:Date,default:Date.now},description:{type:String,trim:!0},photo:{type:String,trim:!0,default:"noPhoto.jpg"},ficha:{type:Boolean,default:!1},marca:{type:String,default:"noone"},costoPropio:{type:Number},multiSearchParams:{type:String,trim:!0}});s.index({nameLowerCase:"text",tipo:"text",subTipo:"text",marca:"text",multiSearchParams:"text"});var c=s,d=new r.Schema({name:{type:String,required:!0,unique:!0},codigo:{type:String,required:!0,unique:!0},ruc:{type:Number}}),p=n(9),f=n(4);n(3);function m(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return u=e.done,e},e:function(e){i=!0,o=e},f:function(){try{u||null==n.return||n.return()}finally{if(i)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t,n,r,a,o,u){try{var i=e[o](u),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function u(e){v(o,r,a,u,i,"next",e)}function i(e){v(o,r,a,u,i,"throw",e)}u(void 0)}))}}var g=a.a.model("Item",c),y=a.a.model("Marca",d),h=a.a.model("Venta",p.a),x=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.find({codigo:{$in:["0SDTT2","2SDeT3"]}});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),w=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.aggregate([{$match:{codigo:t.body.codVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$unwind:{path:"$cantidadSC",preserveNullAndEmptyArrays:!0}}]);case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),k=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.aggregate([{$match:{codigo:t.body.codigoVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}},{$count:"thisItem"}]);case 3:if(0===e.sent.length){e.next=13;break}return e.next=7,h.aggregate([{$match:{codigo:t.body.codigoVenta}},{$unwind:"$itemsVendidos"},{$replaceRoot:{newRoot:"$itemsVendidos"}},{$match:{codigo:t.body.itemVendido.codigo}}]);case 7:return r=e.sent,a=Math.round(100*(r[0].totalPrice-t.body.itemVendido.totalPrice+Number.EPSILON))/100*-1,o=Math.round(100*(r[0].totalPriceNoIGV-t.body.itemVendido.totalPriceNoIGV+Number.EPSILON))/100*-1,e.next=12,h.findOneAndUpdate({codigo:t.body.codigoVenta,itemsVendidos:{$elemMatch:{codigo:t.body.itemVendido.codigo}}},{$set:{"itemsVendidos.$":t.body.itemVendido},$inc:{totalPrice:a,totalPriceNoIGV:o}},{useFindAndModify:!1});case 12:return e.abrupt("return",n.json({message:"Cantidades actualizadas"}));case 13:return e.next=15,h.findOneAndUpdate({codigo:t.body.codigoVenta},{$push:{itemsVendidos:t.body.itemVendido},$inc:{totalPrice:t.body.itemVendido.totalPrice,totalPriceNoIGV:t.body.itemVendido.totalPriceNoIGV}},{useFindAndModify:!1});case 15:n.json({message:"Item agregado correctamente"}),e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,n){return e.apply(this,arguments)}}(),S=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.aggregate([{$match:{estado:"pendiente"}},{$count:"ventasActivas"}]);case 3:if(!e.sent[0]){e.next=6;break}return e.abrupt("return",n.status(202).json({message:"Ya tienes una venta pendiente"}));case 6:return r=new h(t.body.venta),e.next=9,M(r.documento.type);case 9:return r.codigo=e.sent,e.next=12,r.save();case 12:a=e.sent,n.json({message:"Venta generada con el codigo: ".concat(a.codigo),venta:r}),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,o,u,i,s,c,d,p,l,v,b,y,x,w,k,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.startSession();case 2:(r=e.sent).startTransaction(),e.prev=4,o=[],u=[],i=m(t.body.venta.itemsVendidos);try{for(i.s();!(s=i.n()).done;)c=s.value,u.push(c.codigo),o.push({date:Date.now(),cantidad:c.candidad,tipo:!0,comentario:"venta",costoVar:t.body.venta.totalPrice})}catch(e){i.e(e)}finally{i.f()}d=0,p=m(t.body.venta.itemsVendidos),e.prev=11,p.s();case 13:if((l=p.n()).done){e.next=55;break}v=l.value,b=m(v.cantidadSC),e.prev=16,b.s();case 18:if((y=b.n()).done){e.next=36;break}if(!((x=y.value).cantidadVenta>0)){e.next=34;break}return e.next=23,g.findOneAndUpdate({codigo:v.codigo,"subConteo.order":{$elemMatch:{name:x.name,nameSecond:x.nameSecond}}},{$inc:{"subConteo.order.$.cantidad":-x.cantidadVenta}},{useFindAndModify:!1,new:!0,session:r});case 23:w=e.sent,k=0;case 25:if(!(k<w.subConteo.order.length)){e.next=34;break}if(!(w.subConteo.order[k].cantidad<0)){e.next=31;break}return e.next=29,r.abortTransaction();case 29:return r.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado"}));case 31:k++,e.next=25;break;case 34:e.next=18;break;case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(16),b.e(e.t0);case 41:return e.prev=41,b.f(),e.finish(41);case 44:return e.next=46,g.findOneAndUpdate({codigo:v.codigo},{$inc:{cantidad:-v.cantidad},$push:{variaciones:o[d]}},{new:!0,useFindAndModify:!1,session:r});case 46:if(!(e.sent.cantidad<0)){e.next=52;break}return e.next=50,r.abortTransaction();case 50:return r.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado"}));case 52:d++;case 53:e.next=13;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(11),p.e(e.t1);case 60:return e.prev=60,p.f(),e.finish(60);case 63:return e.next=65,h.findOneAndUpdate({codigo:t.body.venta.codigo},{estado:"ejecutada"},{useFindAndModify:!1,new:!0,session:r});case 65:return S=e.sent,e.next=68,r.commitTransaction();case 68:return r.endSession(),e.next=71,Object(f.i)(S);case 71:n.json({message:"succes||".concat(S.codigo)}),e.next=80;break;case 74:return e.prev=74,e.t2=e.catch(4),e.next=78,r.abortTransaction();case 78:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t2}));case 80:case"end":return e.stop()}}),e,null,[[4,74],[11,57,60,63],[16,38,41,44]])})));return function(t,n){return e.apply(this,arguments)}}(),R=function(){var e=b(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.findOneAndUpdate({codigo:t.body.venta.codigo},{estado:"anulada"},{useFindAndModify:!0});case 3:n.json({message:"succes"}),e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,o,u,i,s,c,d,p,l,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.startSession();case 2:return(r=e.sent).startTransaction(),e.prev=4,e.next=7,g.findOne({codigo:t.body.venta.itemsVendidos[0].codigo});case 7:if(o=e.sent,u={date:Date.now(),cantidad:t.body.venta.itemsVendidos[0].cantidad,tipo:!0,comentario:"venta",costoVar:t.body.venta.totalPrice},0===t.body.venta.itemsVendidos[0].cantidadSC.length){e.next=39;break}i=m(t.body.venta.itemsVendidos[0].cantidadSC),e.prev=11,i.s();case 13:if((s=i.n()).done){e.next=31;break}if(!((c=s.value).cantidadVenta>0)){e.next=29;break}return e.next=18,g.findOneAndUpdate({codigo:t.body.venta.itemsVendidos[0].codigo,"subConteo.order":{$elemMatch:{name:c.name,nameSecond:c.nameSecond}}},{$inc:{"subConteo.order.$.cantidad":-c.cantidadVenta}},{useFindAndModify:!1,new:!0,session:r});case 18:d=e.sent,p=0;case 20:if(!(p<d.subConteo.order.length)){e.next=29;break}if(!(d.subConteo.order[p].cantidad<0)){e.next=26;break}return e.next=24,r.abortTransaction();case 24:return r.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado",item:o}));case 26:p++,e.next=20;break;case 29:e.next=13;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(11),i.e(e.t0);case 36:return e.prev=36,i.f(),e.finish(36);case 39:return e.next=41,g.findOneAndUpdate({codigo:t.body.venta.itemsVendidos[0].codigo},{$inc:{cantidad:-t.body.venta.itemsVendidos[0].cantidad},$push:{variaciones:u}},{new:!0,useFindAndModify:!1,session:r});case 41:if(!((l=e.sent).cantidad<0)){e.next=47;break}return e.next=45,r.abortTransaction();case 45:return r.endSession(),e.abrupt("return",n.status(202).json({message:"La Cantidad Ha Cambiado",item:o}));case 47:return t.newItem=l,v=new h(t.body.venta),e.next=51,M(v.documento.type);case 51:return v.codigo=e.sent,e.next=54,v.save({session:r});case 54:return e.next=56,r.commitTransaction();case 56:return r.endSession(),e.next=59,Object(f.i)(v);case 59:n.json({item:t.newItem,message:"Succes||".concat(v.codigo)}),e.next=68;break;case 62:return e.prev=62,e.t1=e.catch(4),e.next=66,r.abortTransaction();case 66:return r.endSession(),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 68:case"end":return e.stop()}}),e,null,[[4,62],[11,33,36,39]])})));return function(t,n){return e.apply(this,arguments)}}(),M=function(){var e=b(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.countDocuments({});case 3:n=e.sent,r="SD01-000000",e.t0=t,e.next="factura"===e.t0?8:"boleta"===e.t0?10:12;break;case 8:return r="E002-000000",e.abrupt("break",13);case 10:return r="EB02-000000",e.abrupt("break",13);case 12:return e.abrupt("break",13);case 13:for(a=0;a<n.toString().length;a++)r=r.slice(0,-1);return o=r+n.toString(),e.abrupt("return",o);case 18:return e.prev=18,e.t1=e.catch(0),e.abrupt("return",res.status(500).json({errorMSG:e.t1}));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.body.cantidadNueva>=t.body.cantidadAntigua?(r=t.body.cantidadNueva-t.body.cantidadAntigua,a=!0):(r=t.body.cantidadAntigua-t.body.cantidadNueva,a=!1),o={date:Date.now(),cantidad:r,tipo:a,comentario:t.body.comentario,costoVar:t.body.costoVar},e.next=5,g.findOneAndUpdate({codigo:t.body.codigo},{cantidad:t.body.cantidadNueva,$push:{variaciones:o}},{new:!0,useFindAndModify:!1});case 5:u=e.sent,n.json(u),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),V=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.body.cantidadNueva>=t.body.cantidadAntigua?(r=t.body.cantidadNueva-t.body.cantidadAntigua,a=!0):(r=t.body.cantidadAntigua-t.body.cantidadNueva,a=!1),o={date:Date.now(),cantidad:r,tipo:a,comentario:t.body.comentario,costoVar:t.body.costoVar},e.next=5,g.findOneAndUpdate({codigo:t.body.codigo},{subConteo:t.body.subConteo,cantidad:t.body.cantidadNueva,$push:{variaciones:o}},{new:!0,useFindAndModify:!1});case 5:u=e.sent,n.json(u),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),P=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=new y(t.body)).codigo=Date.now().toString(),e.next=5,r.save();case 5:return a=e.sent,e.abrupt("return",n.json(a));case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.aggregate([{$match:{codigo:"4SDtT4"}},{$project:{cantidadTotal:{$sum:"$subConteo.order.cantidad"}}}]);case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),G=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.params.deleteString.split("_"),e.next=4,y.deleteMany({name:{$in:r}});case 4:n.json({message:"succes"}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),O=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.find({});case 3:r=e.sent,n.json(r),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),I=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=new g(t.body)).priceNoIGV=Q(r.priceIGV),e.next=5,C(r.name,r.tipo);case 5:return r.codigo=e.sent,r.nameLowerCase=r.name,a={date:Date.now(),cantidad:r.cantidad,tipo:!0,comentario:"new item",costoVar:r.costoPropio},r.variaciones=[a],e.next=11,r.save();case 11:return o=e.sent,e.abrupt("return",n.json(o));case 15:e.prev=15,e.t0=e.catch(0);case 17:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}(),C=function(){var e=b(regeneratorRuntime.mark((function e(){var t,n,r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"",n=a.length>1&&void 0!==a[1]?a[1]:"",e.prev=2,e.next=5,g.countDocuments({});case 5:return r=e.sent,e.abrupt("return",r.toString()+"SD"+t.charAt(0)+n.charAt(0)+Math.floor(10*Math.random()).toString());case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",new Error(e.t0));case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),q=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.find({});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),D=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,a,o,u,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=0,"asc"===t.params.tipoSort?r=1:"dsc"===t.params.tipoSort&&(r=-1),a=t.params.subORtipo,o=t.params.tipoBusqueda,u=t.params.filtro,i={},"all"!==t.params.filtro&&("sub"===a?i={subTipo:u}:"tipo"===a&&(i={tipo:u})),e.t0=o,e.next="date"===e.t0?11:"name"===e.t0?15:"priceIGV"===e.t0?19:23;break;case 11:return e.next=13,g.find(i).collation({locale:"en",strength:2}).sort({date:-1*r});case 13:return s=e.sent,e.abrupt("break",24);case 15:return e.next=17,g.find(i).collation({locale:"en",strength:2}).sort({name:r});case 17:return s=e.sent,e.abrupt("break",24);case 19:return e.next=21,g.find(i).collation({locale:"en",strength:2}).sort({priceIGV:r});case 21:return s=e.sent,e.abrupt("break",24);case 23:return e.abrupt("break",24);case 24:return e.abrupt("return",n.json(s));case 27:return e.prev=27,e.t1=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 30:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t,n){return e.apply(this,arguments)}}(),$=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.find({tipo:t.params.tipo});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),F=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.find({subTipo:t.params.subTipo}).select("name -_id");case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),U=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={},e.prev=1,e.t0=t.params.tipo,e.next="cod"===e.t0?5:"name"===e.t0?9:"tipo"===e.t0?13:17;break;case 5:return e.next=7,g.findOne({codigo:t.params.codigo});case 7:return r=e.sent,e.abrupt("break",19);case 9:return e.next=11,g.find({name:t.body.name});case 11:return r=e.sent,e.abrupt("break",19);case 13:return e.next=15,g.find({tipo:t.body.tipo});case 15:return r=e.sent,e.abrupt("break",19);case 17:return r={message:"Not A Type Of Search"},e.abrupt("break",19);case 19:return e.abrupt("return",n.json(r));case 22:return e.prev=22,e.t1=e.catch(1),e.abrupt("return",n.status(500).json({errorMSG:e.t1}));case 25:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t,n){return e.apply(this,arguments)}}(),E=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r={},a=0,o=0,"redu"!==t.params.tipo){e.next=19;break}return e.next=7,g.findOne({codigo:t.body.codigo});case 7:if(r=e.sent,!((a=r.cantidad)>=t.body.cantidad)){e.next=16;break}return o=a-t.body.cantidad,e.next=13,g.findOneAndUpdate({codigo:t.body.codigo},{cantidad:o},{new:!0,useFindAndModify:!1});case 13:r=e.sent,e.next=17;break;case 16:return e.abrupt("return",n.status(409).json({message:"No Hay Los Suficientes Items En Stock"}));case 17:e.next=32;break;case 19:if("aume"!==t.params.tipo){e.next=31;break}return e.next=22,g.findOne({codigo:t.body.codigo});case 22:if(r=e.sent,!((a=r.cantidad)>=t.body.cantidadRedu)){e.next=29;break}return o=a+t.body.cantidadRedu,e.next=28,g.findOneAndUpdate({codigo:t.body.codigo},{cantidad:o},{new:!0,useFindAndModify:!1});case 28:r=e.sent;case 29:e.next=32;break;case 31:return e.abrupt("return",n.json({message:"Not An opc"}));case 32:return e.abrupt("return",n.json(r));case 35:return e.prev=35,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 38:case"end":return e.stop()}}),e,null,[[0,35]])})));return function(t,n){return e.apply(this,arguments)}}(),B=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=t.body).priceIGV&&(r.priceNoIGV=Q(r.priceIGV)),e.next=5,g.findOneAndUpdate({codigo:t.body.codigo},r,{new:!0,useFindAndModify:!1});case 5:a=e.sent,n.json(a),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.updateMany({subTipo:t.body.antiguoSubName},{subTipo:t.body.newSubName},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),K=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.updateMany({tipo:t.beforeName},{tipo:t.body.name},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),z=function(){var e=b(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.findOneAndDelete({codigo:t.params.codigo});case 3:a=e.sent,t.photNameToDelete=a.photo,r(),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n,r){return e.apply(this,arguments)}}(),H=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.deleteMany({tipo:t.tipoName});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),L=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.deleteMany({subTipo:t.params.subTipoName});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Y=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.findOneAndUpdate({codigo:t.body.codigo},{oferta:t.body.ofertaNum},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),J=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.findOneAndUpdate({codigo:t.body.codigo},{oferta:0},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.status(200).json({res:r,uploadInfo:t.uploadInfo}),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),n.status(500).json({errorMSG:e.t0});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),W=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.findOneAndUpdate({codigo:t.params.codigo},{photo:t.fileName},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.status(200).json({res:r,uploadInfo:t.uploadInfo}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Q=function(e){var t=e/1.18;return Math.round(100*(t+Number.EPSILON))/100},X=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.findOneAndUpdate({codigo:t.params.codigo},{ficha:!0},{new:!0,useFindAndModify:!1});case 3:r=e.sent,n.status(200).json({res:r,uploadInfo:t.uploadInfo}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()},function(e,t){e.exports=require("mongoose")},function(e,t,n){"use strict";var r=n(27),a=n.n(r),o=n(18);n(20).config();var u=o.name,i=o.version,s={develoment:{PORT:process.env.PORT,mongoKey:process.env.MONGO_KEY,tinyKey:process.env.TINY_KEY,jwtKey:process.env.JWT_KEY,awsID:process.env.AWS_ID,awsKey:process.env.AWS_KEY,bucket:process.env.S3_BUCKET,sunatToken:process.env.SUNAT_TOKEN,log:function(){return e=u,t=i,n="debug",a.a.createLogger({name:"".concat(e,":").concat(t),level:n});var e,t,n}}};t.a=s},function(e,t,n){"use strict";n.d(t,"i",(function(){return l})),n.d(t,"d",(function(){return v})),n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return g})),n.d(t,"e",(function(){return y})),n.d(t,"g",(function(){return h})),n.d(t,"h",(function(){return x})),n.d(t,"c",(function(){return w})),n.d(t,"f",(function(){return k}));var r=n(16),a=n.n(r),o=n(17),u=n.n(o),i=n(12),s=n.n(i),c=(n(7),n(21),n(13)),d=n(3);function p(e,t,n,r,a,o,u){try{var i=e[o](u),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function u(e){p(o,r,a,u,i,"next",e)}function i(e){p(o,r,a,u,i,"throw",e)}u(void 0)}))}}var m=new s.a.S3({accessKeyId:d.a.develoment.awsID,secretAccessKey:d.a.develoment.awsKey,Bucket:d.a.develoment.bucket,region:"us-east-1"}),l=function(){var e=f(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(n=Object(c.a)(t)).end(),e.next=5,m.upload({Bucket:d.a.develoment.bucket,Key:"".concat(t.codigo,".pdf"),Body:n,ContentType:"application/pdf"}).promise();case 5:e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=f(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.getObject({Bucket:d.a.develoment.bucket,Key:t.params.imgName}).promise();case 3:r=e.sent,n.writeHead(200,{"Content-Type":"image/jpeg"}),n.write(r.Body,"binary"),n.end(null,"binary"),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),b=function(){var e=f(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noPhoto.jpg"===t.body.oldPhoto){e.next=4;break}return e.next=4,m.deleteObject({Bucket:d.a.develoment.bucket,Key:t.body.oldPhoto}).promise();case 4:r(),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),g=function(){var e=f(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"noPhoto.jpg"===t.photNameToDelete){e.next=4;break}return e.next=4,m.deleteObject({Bucket:d.a.develoment.bucket,Key:t.photNameToDelete}).promise();case 4:n.json({message:"Succes"}),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),y=function(){var e=f(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.getObject({Bucket:d.a.develoment.bucket,Key:t.params.pdfName}).promise();case 3:r=e.sent,n.writeHead(200,{"Content-Type":"aplication/pdf"}),n.write(r.Body,"binary"),n.end(null,"binary"),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({message:e.t0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),h=a()({storage:u()({s3:m,bucket:d.a.develoment.bucket,metadata:function(e,t,n){n(null,Object.assign({},e.body))},key:function(e,t,n){var r=t.originalname.split(".")[1];n(null,t.fieldname+"-"+e.params.codigo+"-"+Date.now().toString()+"."+r)}}),limits:{fileSize:1e6},fileFilter:function(e,t,n){t.originalname.match(/\.(jpg|jpeg|png)$/)||n(new Error("Please upload JPG and PNG images only!")),t.size>1e6&&n(new Error("Please upload JPG and PNG images only!")),n(void 0,!0)}}),x=a()({storage:u()({s3:m,bucket:d.a.develoment.bucket,metadata:function(e,t,n){n(null,Object.assign({},e.body))},key:function(e,t,n){n(null,"ficha-"+e.params.codigo+".pdf")}}),limits:{fileSize:1e6},fileFilter:function(e,t,n){t.originalname.match(/\.(pdf)$/)||n(new Error("Please upload PDF only!")),n(void 0,!0)}}),w=function(e,t,n){var r=e.file;if(!r){var a=new Error("Please upload a file");return a.httpStatusCode=400,n(a)}e.uploadInfo={statusCode:200,status:"success",uploadedFile:r},n()},k=function(e,t,n){var r=e.file;if(!r){var a=new Error("Please upload a file");return a.httpStatusCode=400,n(a)}e.fileName=r.key,e.uploadInfo={statusCode:200,status:"success",uploadedFile:r},n()}},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("tinify")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,n){"use strict";var r=n(2),a=new r.Schema({name:{type:String},nameSecond:{type:String},cantidadDisponible:{type:Number},cantidadVenta:{type:Number}}),o=new r.Schema({type:{type:String,required:!0},name:{type:String,trim:!0},codigo:{type:Number,trim:!0}},{_id:!1}),u=new r.Schema({codigo:{type:String,required:!0,unique:!0,trim:!0},name:{type:String,trim:!0},descripcion:{type:String,trim:!0},priceIGV:{type:Number,required:!0,trim:!0},priceNoIGV:{type:Number,required:!0,trim:!0},cantidad:{type:Number,required:!0,trim:!0,min:0},cantidadSC:{type:[a],default:[]},totalPrice:{type:Number},totalPriceNoIGV:{type:Number}},{_id:!1}),i=new r.Schema({codigo:{type:String,required:!0,trim:!0,unique:!0},totalPrice:{type:Number,trim:!0,required:!0},totalPriceNoIGV:{type:Number,trim:!0,required:!0},estado:{type:String,trim:!0,required:!0},documento:{type:o},itemsVendidos:{type:[u],required:!0},date:{type:Date,default:Date.now}});t.a=i},function(e,t){e.exports=require("bcrypt")},function(e,t,n){"use strict";(function(e){var r=n(6),a=n.n(r),o=n(5),u=n.n(o),i=n(14),s=n.n(i),c=n(24),d=n.n(c),p=n(25),f=n.n(p),m=n(15),l=n.n(m),v=n(7),b=n.n(v),g=n(8),y=n.n(g),h=(n(12),n(30)),x=n(28),w=n(31),k=n(29),S=n(3);n(13);b.a.key=S.a.develoment.tinyKey;var j=u()(),R=S.a.develoment.log();S.a.develoment.bucket;j.use(d()()),j.use(f()()),j.options("*",l()({credentials:!0,origin:!0})),j.use(l()({credentials:!0,origin:!0})),j.use(s.a.json()),j.use(s.a.urlencoded({extended:!0})),Object(k.a)(S.a.develoment.mongoKey),j.use((function(e,t,n){e.headers&&e.headers.authorization&&"JWT"===e.headers.authorization.split(" ")[0]?y.a.verify(e.headers.authorization.split(" ")[1],S.a.develoment.jwtKey,(function(t,r){t&&(e.user=void 0),e.user=r,n()})):(e.user=void 0,n())})),j.use("/inventario",h.a),j.use("/auth",x.a),j.use("/ventas",w.a),j.use("/static",u.a.static(a.a.join(e,"uploads"))),j.use((function(e,t,n,r){return n.status(e.status||500),R.error(e),n.json({error:{message:e.message}})})),t.a=j}).call(this,"/")},function(e,t){e.exports=require("aws-sdk")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i}));var r=n(26),a=n.n(r),o=(n(21),n(6)),u=n.n(o),i=function(e){var t=new a.a({size:"A4",margin:50});return s(t),c(t,e),m(t,e),l(t),t},s=function(t){t.image(u.a.resolve(e,"../uploads/images/sirio-logo.png"),50,30,{width:70}).fillColor("#444444").fontSize(20).fontSize(10).text("Sirio Dinar | RUC: 20605746587",200,50,{align:"right"}).text("Jr. Felipe Pardo Y Aliaga 213, Trujillo.",200,65,{align:"right"}).text("+51 977-426-349",200,80,{align:"right"}).moveDown()},c=function(e,t){e.fillColor("#444444").fontSize(20).text("Comprobante",50,160),d(e,185);e.fontSize(10).text("Codigo:",50,200).font("Helvetica-Bold").text(t.codigo,150,200).font("Helvetica").text("Fecha de emisión:",50,215).text(f(new Date),150,215).font("Helvetica-Bold").text(t.documento.name,300,200).font("Helvetica").text(t.documento.codigo,300,215).moveDown(),d(e,235)},d=function(e,t){e.strokeColor("#aaaaaa").lineWidth(1).moveTo(50,t).lineTo(550,t).stroke()},p=function(e){return"S/"+e.toFixed(2)},f=function(e){var t=e.getDate(),n=e.getMonth()+1;return e.getFullYear()+"/"+n+"/"+t},m=function(e,t){var n;for(e.fontSize(8).font("Helvetica-Bold"),v(e,290,"Cod","Nombre","Descripcion","Precio","Cantidad","Total"),d(e,315),e.font("Helvetica"),n=0;n<t.itemsVendidos.length;n++){var r=t.itemsVendidos[n],a=290+30*(n+1);v(e,a,r.codigo,r.name,r.descripcion,p(r.priceNoIGV),r.cantidad,p(r.totalPriceNoIGV)),d(e,a+25)}var o=290+32*(n+1);v(e,o,"","","","","Subtotal",p(t.totalPriceNoIGV));var u=o+15;v(e,u,"","","","","IGV 18%",p(t.totalPrice-t.totalPriceNoIGV));var i=u+15;e.font("Helvetica-Bold"),v(e,i,"","","","","Total",p(t.totalPrice)),e.font("Helvetica")},l=function(e){e.fontSize(10).text("siriodinar.com",50,780,{align:"center",width:500})},v=function(e,t,n,r,a,o,u,i){e.fontSize(8).text(n,50,t,{width:40}).text(r,100,t,{width:100}).text(a,210,t,{width:180}).text(o,400,t,{width:35,align:"right"}).text(u,460,t,{width:35,align:"right"}).text(i,0,t,{align:"right"})}}).call(this,"/")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("multer-s3")},function(e){e.exports=JSON.parse('{"name":"inv-mannager","version":"0.0.3","description":"Manejo General De Inventario De Sirio Dinar","main":"index.js","scripts":{"build":"webpack -p","start":"node ./dist/main.js","dev:start":"nodemon --exec babel-node ./bin/www.js | bunyan"},"keywords":["inventario","siriodinar"],"author":"Tac Etarip","license":"ISC","devDependencies":{"@babel/core":"^7.10.2","@babel/node":"^7.10.1","@babel/preset-env":"^7.10.2","babel-loader":"^8.1.0","webpack":"^4.43.0","webpack-cli":"^3.3.12","webpack-node-externals":"^2.5.0"},"dependencies":{"aws-sdk":"^2.713.0","axios":"^0.19.2","babel-polyfill":"^6.26.0","bcrypt":"^5.0.0","body-parser":"^1.19.0","bunyan":"^1.8.14","compression":"^1.7.4","cors":"^2.8.5","dotenv":"^8.2.0","express":"^4.17.1","helmet":"^3.23.3","jsonwebtoken":"^8.5.1","mongoose":"^5.9.18","multer":"^1.4.2","multer-s3":"^2.9.0","pdfkit":"^0.11.0","throng":"^4.0.0","tinify":"^1.6.0-beta.2"},"engines":{"node":"12.18.x"}}')},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("throng")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("pdfkit")},function(e,t){e.exports=require("bunyan")},function(e,t,n){"use strict";var r=n(5),a=n(0),o=new r.Router;o.post("/register",a.c),o.post("/login",a.a),t.a=o},function(e,t,n){"use strict";var r=n(2),a=n.n(r);function o(e,t,n,r,a,o,u){try{var i=e[o](u),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}var u=n(3).a.develoment.log(),i=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.a.connect(t,{useNewUrlParser:!0,useUnifiedTopology:!0,useCreateIndex:!0});case 3:return e.abrupt("return",u.info("Connected To DataBase"));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",u.error(e.t0));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function i(e){o(u,r,a,i,s,"next",e)}function s(e){o(u,r,a,i,s,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}();t.a=i},function(e,t,n){"use strict";var r=n(5),a=n(1),o=n(2),u=n.n(o),i=new o.Schema({name:{type:String,required:!0,unique:!0},date:{type:Date,default:Date.now},codigo:{type:String},subTipo:{type:[String]}});function s(e,t,n,r,a,o,u){try{var i=e[o](u),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function u(e){s(o,r,a,u,i,"next",e)}function i(e){s(o,r,a,u,i,"throw",e)}u(void 0)}))}}var d=u.a.model("Tipo",i),p=function(){var e=c(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=new d(t.body)).codigo=Date.now().toString(),r.subTipo=[],e.next=6,r.save();case 6:return a=e.sent,e.abrupt("return",n.json(a));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=c(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.updateOne({codigo:t.body.codigo},{$push:{subTipo:t.body.subTipo}});case 3:return e.abrupt("return",n.json({message:"succes"}));case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=c(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.find({}).select("name codigo -_id");case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),l=function(){var e=c(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.params.tipoCod}).select("subTipo -_id");case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),v=function(){var e=c(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.params.codigo});case 3:return r=e.sent,e.abrupt("return",n.json(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),b=function(){var e=c(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.body.codigo});case 3:return a=e.sent,t.beforeName=a.name,e.next=7,d.findOneAndUpdate({codigo:t.body.codigo},{name:t.body.name},{new:!0,useFindAndModify:!1});case 7:r(),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),g=function(){var e=c(regeneratorRuntime.mark((function e(t,n,r){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.body.codigo});case 3:return a=e.sent,o=a.subTipo.indexOf(t.body.antiguoSubName),a.subTipo[o]=t.body.newSubName,e.next=8,d.findOneAndUpdate({codigo:t.body.codigo},{subTipo:a.subTipo},{new:!0,useFindAndModify:!1});case 8:r(),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n,r){return e.apply(this,arguments)}}(),y=function(){var e=c(regeneratorRuntime.mark((function e(t,n,r){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.params.codigo});case 3:return a=e.sent,o=a.subTipo.indexOf(t.params.subTipoName),a.subTipo.splice(o,1),e.next=8,d.findOneAndUpdate({codigo:t.params.codigo},{subTipo:a.subTipo},{new:!0,useFindAndModify:!1});case 8:r(),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n,r){return e.apply(this,arguments)}}(),h=function(){var e=c(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.findOne({codigo:t.params.codigo});case 3:return a=e.sent,e.next=6,d.findOneAndDelete({codigo:t.params.codigo});case 6:t.tipoName=a.name,r(),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),x=n(4),w=n(0),k=new r.Router;k.get("/testFind",a.v),k.post("/addItem",w.b,a.b),k.get("/getItems",a.l),k.get("/getItemsByType/:tipo",a.n),k.get("/getItem/:tipo/:codigo",a.q),k.get("/getAllItemsSort/:subORtipo/:filtro/:tipoBusqueda/:tipoSort",a.m),k.get("/getTipo/:codigo",v),k.get("/getItemsSubTipo/:subTipo",a.o),k.put("/uploadVariationSC",w.b,a.u),k.put("/uploadVariationSimple",w.b,a.e),k.put("/modCant/:tipo",w.b,a.w),k.put("/updateItem",w.b,a.x),k.put("/updateTipo",w.b,b,a.z),k.delete("/deleteItem/:codigo",w.b,a.g,x.b),k.delete("/deleteTipo/:codigo",w.b,h,a.i),k.delete("/deleteSupTipo/:codigo/:subTipoName",w.b,y,a.h),k.put("/addSubTipo",w.b,f),k.put("/offer/add",w.b,a.c),k.put("/offer/remove",w.b,a.t),k.post("/addTipo",w.b,p),k.get("/getTipos",m),k.get("/getSubTipos/:tipoCod",l),k.get("/marcas/getAll",a.r),k.delete("/marcas/delete/:deleteString",w.b,a.j),k.post("/marcas/add",w.b,a.a),k.put("/uptateSupTipos",w.b,g,a.y),k.post("/uploads/image/:codigo",w.b,x.g.single("img"),x.f,x.a,a.A),k.post("/uploads/ficha/:codigo",w.b,x.h.single("pdf"),x.c,a.f),k.get("/image/:imgName",x.d),k.get("/pdf/:pdfName",x.e);t.a=k},function(e,t,n){"use strict";var r=n(5),a=n(2),o=n.n(a),u=n(9),i=n(19),s=n.n(i);function c(e,t,n,r,a,o,u){try{var i=e[o](u),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function u(e){c(o,r,a,u,i,"next",e)}function i(e){c(o,r,a,u,i,"throw",e)}u(void 0)}))}}var p=n(3).a.develoment.sunatToken,f=o.a.model("Venta",u.a),m=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.findOne({codigo:t.params.ventaCod});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),l=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.find({estado:"pendiente"});case 3:r=e.sent,n.json(r),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),v=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.post("https://api.migo.pe/api/v1/dni",{token:p,dni:t.params.dni});case 3:r=e.sent,n.json(r.data),e.next=18;break;case 7:if(e.prev=7,e.t0=e.catch(0),422!==e.t0.response.status){e.next=13;break}return e.abrupt("return",n.status(422).json({errorMSG:"Numero Invalido"}));case 13:if(404!==e.t0.response.status){e.next=17;break}return e.abrupt("return",n.status(404).json({errorMSG:"Documento No Encontrado"}));case 17:return e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),b=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.post("https://api.migo.pe/api/v1/ruc",{token:p,ruc:t.params.ruc});case 3:r=e.sent,n.json(r.data),e.next=18;break;case 7:if(e.prev=7,e.t0=e.catch(0),422!==e.t0.response.status){e.next=13;break}return e.abrupt("return",n.status(422).json({errorMSG:"Numero Invalido"}));case 13:if(404!==e.t0.response.status){e.next=17;break}return e.abrupt("return",n.status(404).json({errorMSG:"Documento No Encontrado"}));case 17:return e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 18:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=d(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new f(t.body),e.next=4,y();case 4:return r.codigo=e.sent,e.next=7,r.save();case 7:a=e.sent,n.json(a),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n.status(500).json({errorMSG:e.t0}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=d(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.countDocuments({});case 3:n=e.sent,r="SD01-000000",e.t0=t,e.next="factura"===e.t0?8:"boleta"===e.t0?10:12;break;case 8:return r="E002-000000",e.abrupt("break",13);case 10:return r="EB02-000000",e.abrupt("break",13);case 12:return e.abrupt("break",13);case 13:for(a=0;a<n.toString().length;a++)r=r.slice(0,-1);return o=r+n.toString(),e.abrupt("return",o);case 18:return e.prev=18,e.t1=e.catch(0),e.abrupt("return",res.status(500).json({errorMSG:e.t1}));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t){return e.apply(this,arguments)}}(),h=n(1),x=n(0),w=new r.Router;w.post("/generarVenta",x.b,g),w.get("/dni/:dni",x.b,v),w.get("/testTotal",x.b,h.p),w.get("/ruc/:ruc",x.b,b),w.get("/obtenerVenta/:ventaCod",x.b,m),w.post("/ventaSimple",x.b,h.D),w.post("/agregarVenta",x.b,h.k),w.get("/ventasPendientes",x.b,l),w.post("/agregarItemVenta",x.b,h.d),w.post("/ventasForCard",x.b,h.s),w.post("/ejecutarVenta",x.b,h.C),w.put("/anularVenta",x.b,h.B);t.a=w},function(e,t,n){n(33),e.exports=n(34)},function(e,t){e.exports=require("babel-polyfill")},function(e,t,n){"use strict";n.r(t);var r=n(22),a=n.n(r),o=n(23),u=n.n(o),i=n(11),s=n(3);n(20).config();var c=a.a.createServer(i.a),d=s.a.develoment.PORT,p=s.a.develoment.log(),f=process.env.WEB_CONCURRENCY||1;i.a.set("port",d);u()({workers:f,lifetime:1/0},(function(){c.listen(d||0)})),c.on("listening",(function(){p.info("Hi there! I'm listening on port ".concat(c.address().port," in ").concat(i.a.get("env")," mode."))}))}]);